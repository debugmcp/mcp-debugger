# analyze-coverage.js
@source-hash: 607ea8ca1b309805
@generated: 2026-02-09T18:15:17Z

## Purpose
Post-test coverage analysis script for mcp-debugger that parses Istanbul/NYC coverage reports and provides prioritized insights for improving test coverage.

## Core Functionality

**Main Analysis Flow (L13-94):**
- Reads `coverage/coverage-summary.json` generated by test runner
- Silently exits if coverage data unavailable (L16-19)
- Processes coverage data to identify files needing attention
- Outputs formatted report with actionable priorities

**Key Processing Steps:**
- **Coverage Data Parsing (L21-22):** Extracts overall line coverage percentage
- **File Analysis Loop (L28-45):** Iterates through coverage entries, calculating uncovered lines and cleaning file paths
- **Impact Calculation (L48-50):** Determines each file's contribution to overall coverage gaps
- **Prioritization (L53):** Sorts files by uncovered line count (descending)

## Data Structures

**File Analysis Object (L39-44):**
```javascript
{
  path: string,      // Cleaned relative path
  coverage: number,  // Line coverage percentage
  uncovered: number, // Count of uncovered lines
  total: number,     // Total line count
  impact: number     // Percentage impact on overall coverage
}
```

## Output Format

**Report Structure (L56-89):**
- Header with overall coverage percentage
- Top 10 files table showing: uncovered lines, coverage %, impact %, file path
- Path truncation for display (L68-72)
- Continuation indicator for additional files (L82-84)

## Dependencies
- `fs`: File system operations for reading coverage data
- `path`: Path manipulation utilities
- `url`: ESM module path resolution (L8-11)

## Error Handling
- Graceful failure mode: silently exits or shows minimal error message (L16-19, L91-94)
- Designed not to disrupt test pipeline flow

## Key Design Decisions
- **Silent Operation:** No verbose output or process disruption on errors
- **Impact-Based Prioritization:** Focuses on files with most uncovered lines rather than lowest percentages
- **Compact Display:** Limited to top 10 files with path truncation for readability
- **Cross-Platform Paths:** Normalizes path separators (L37)