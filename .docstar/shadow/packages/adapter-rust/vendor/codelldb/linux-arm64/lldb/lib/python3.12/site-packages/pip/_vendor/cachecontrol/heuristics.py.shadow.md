# packages/adapter-rust/vendor/codelldb/linux-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/cachecontrol/heuristics.py
@source-hash: 2187b84261c4456b
@generated: 2026-02-09T18:00:35Z

HTTP caching heuristics module for pip's cachecontrol library. Provides cache expiration strategies when server-provided cache headers are missing or insufficient.

## Core Utilities

**expire_after() (L18-20)**: Calculates future expiration datetime by adding timedelta to current/provided date
**datetime_to_header() (L23-24)**: Converts datetime to HTTP-compliant date string using RFC format

## Base Architecture

**BaseHeuristic (L27-57)**: Abstract base class defining the heuristic interface
- `warning()` (L28-37): Returns HTTP 110 warning header indicating stale response
- `update_headers()` (L39-46): Override point for subclasses to add cache headers
- `apply()` (L48-57): Main entry point that updates response headers and adds warning headers

## Heuristic Implementations

**OneDayCache (L60-74)**: Simple 1-day cache strategy
- Only adds expires header if none exists (L69)
- Uses response date + 1 day as expiration (L70-72)
- Sets cache-control to "public" (L73)

**ExpiresAfter (L77-91)**: Configurable time-based caching
- Constructor accepts timedelta kwargs (L82-83)
- Always sets expiration regardless of existing headers (L85-87)
- Custom warning message includes configured duration (L89-91)

**LastModified (L94-151)**: RFC 7234 compliant heuristic using Last-Modified header
- `cacheable_by_default_statuses` (L107-119): HTTP status codes eligible for caching
- Complex freshness calculation (L121-151):
  - Requires both date and last-modified headers (L133-134)
  - Calculates age and freshness lifetime using 10% rule (L143-146)
  - Caps freshness at 24 hours maximum (L146)
  - Only caches if response is still fresh (L147-148)
- Returns no warning header (L153-154)

## Dependencies
- email.utils for HTTP date parsing/formatting
- datetime/calendar for time calculations
- urllib3.HTTPResponse for type hints

## Key Patterns
- All heuristics follow template method pattern via BaseHeuristic
- Defensive programming with existence checks before header manipulation
- RFC compliance with proper HTTP date formatting and cache semantics