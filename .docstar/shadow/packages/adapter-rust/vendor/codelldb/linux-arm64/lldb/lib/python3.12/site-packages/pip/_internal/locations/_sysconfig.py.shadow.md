# packages/adapter-rust/vendor/codelldb/linux-arm64/lldb/lib/python3.12/site-packages/pip/_internal/locations/_sysconfig.py
@source-hash: 206cddb3ad2ab059
@generated: 2026-02-09T18:00:25Z

## Purpose
Python package installation path resolution using sysconfig. Determines appropriate installation schemes (prefix, user, home) and computes file system paths for different package components across platforms.

## Core Architecture

### Scheme Inference Functions
- `_should_use_osx_framework_prefix()` (L29-52): Detects Apple Command Line Tools framework builds requiring special `osx_framework_library` scheme
- `_infer_prefix()` (L55-83): Primary scheme detection using fallback hierarchy: preferred API → OSX framework → implementation+OS → implementation → OS+prefix → OS → posix_prefix
- `_infer_user()` (L86-98): User installation scheme detection with OSX framework and platform-specific handling
- `_infer_home()` (L101-108): Home directory scheme detection with platform suffix fallback

### Main API
- `get_scheme()` (L124-199): Central function generating `Scheme` objects with validation, path computation, and special case handling for virtual environments and custom prefixes
- `get_bin_prefix()` (L202-206): Binary/script installation directory with macOS system library override
- `get_purelib()` (L209-210): Pure Python library path
- `get_platlib()` (L213-214): Platform-specific library path

## Key Data Structures
- `_AVAILABLE_SCHEMES` (L24): Set of available sysconfig scheme names
- `_PREFERRED_SCHEME_API` (L26): Optional sysconfig.get_preferred_scheme function (Python 3.10+)
- `_HOME_KEYS` (L112-121): Configuration variables updated for custom home installations
- `Scheme` objects: Encapsulate installation paths for platlib, purelib, headers, scripts, data

## Platform-Specific Behavior
- **macOS Framework**: Special `osx_framework_library` scheme for Apple Command Line Tools, automatic `/usr/local/bin` override for system installations
- **Virtual Environment**: Custom header path logic using `include/site/pythonX.Y` structure
- **Windows**: Uses `nt` scheme naming convention
- **PyPy**: Implementation-specific schemes (`pypy`, `pypy_nt`)

## Critical Logic Patterns
- Hierarchical scheme fallback with platform detection
- Mutual exclusion validation for user/home/prefix options (L145-148)
- Custom prefix forces `posix_prefix` over `osx_framework_library` (L160-161)
- Virtual environment detection affects header path generation (L177-183)
- Root directory rebasing using `change_root` utility (L194-198)

## Dependencies
- `pip._internal.exceptions`: `InvalidSchemeCombination`, `UserInstallationInvalid`
- `pip._internal.models.scheme`: `Scheme`, `SCHEME_KEYS`
- `pip._internal.utils.virtualenv.running_under_virtualenv`
- `.base`: `change_root`, `get_major_minor_version`, `is_osx_framework`