# packages/adapter-rust/vendor/codelldb/linux-arm64/lldb/lib/python3.12/site-packages/pip/_internal/operations/check.py
@source-hash: 429c3b17064c1b56
@generated: 2026-02-09T18:00:27Z

## Primary Purpose

Package dependency validation engine for pip that checks for missing dependencies and version conflicts in Python package installations. Provides both current state validation and pre-installation conflict simulation.

## Core Data Structures

- **PackageDetails** (L18-20): NamedTuple containing package version and dependencies list
- **PackageSet** (L24): Dict mapping normalized names to PackageDetails
- **Type Aliases** (L25-31): 
  - Missing/Conflicting tuples for dependency issues
  - MissingDict/ConflictingDict for grouped results
  - CheckResult/ConflictDetails for return values

## Key Functions

### State Analysis
- **create_package_set_from_installed()** (L34-48): Scans installed packages via metadata environment, builds PackageSet with error tolerance for broken metadata
- **check_package_set()** (L51-93): Core validation logic that identifies missing dependencies and version conflicts, supports optional package filtering via should_ignore callback

### Installation Simulation  
- **check_install_conflicts()** (L96-113): Main entry point for pre-installation validation, creates baseline from current state, simulates installation, and checks conflicts only for affected packages
- **_simulate_installation_of()** (L116-132): Updates PackageSet with would-be-installed packages using distribution metadata
- **_create_whitelist()** (L135-149): Identifies packages affected by installation (direct installs + their dependents) to limit conflict checking scope

## Dependencies

- **pip._vendor.packaging**: Requirement parsing, name normalization, version handling
- **pip._internal.metadata**: Environment access for installed packages
- **pip._internal.distributions**: Distribution creation for install requirements
- **pip._internal.req.req_install**: InstallRequirement interface

## Architecture Patterns

- **Separation of Concerns**: Distinct phases for data collection, simulation, and validation
- **Error Tolerance**: Graceful handling of metadata parsing failures with logging
- **Marker Evaluation**: Conditional dependency checking based on environment markers (L77-80)
- **Scope Limitation**: Whitelist approach prevents false positives from unrelated packages

## Critical Logic

- **Dependency Resolution** (L71-86): Canonicalizes names, evaluates markers, checks presence and version compatibility
- **Conflict Detection**: Uses packaging.specifier.contains() with prerelease support
- **Result Aggregation**: Groups issues by dependent package, sorts for deterministic output