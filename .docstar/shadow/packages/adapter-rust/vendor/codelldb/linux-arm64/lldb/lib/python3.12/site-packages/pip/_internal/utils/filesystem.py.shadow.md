# packages/adapter-rust/vendor/codelldb/linux-arm64/lldb/lib/python3.12/site-packages/pip/_internal/utils/filesystem.py
@source-hash: 4613085d468d54c1
@generated: 2026-02-09T18:00:31Z

**Primary Purpose:** Filesystem utility module providing secure file operations, ownership checks, and directory/file size calculations for pip's internal operations.

**Core Functions:**

- **check_path_owner(path) (L16-40):** Verifies if current user owns a path by traversing up directory tree. Handles Windows compatibility and root user edge cases. Returns True on Windows or when os.geteuid() unavailable.

- **adjacent_tmp_file(path, **kwargs) (L44-65):** Context manager creating secure temporary files in same directory as target path. Ensures data persistence with flush() and fsync() operations. Uses NamedTemporaryFile with custom prefix/suffix pattern.

- **test_writable_dir(path) (L76-91):** Cross-platform directory write permission checker. Uses os.access() on POSIX systems, delegates to Windows-specific implementation otherwise. Traverses to nearest existing parent directory.

- **_test_writable_dir_win(path) (L94-119):** Windows-specific write test using actual file creation attempts. Uses random filename generation with 10 retry attempts. Handles PermissionError and FileExistsError cases.

**File Operations:**

- **find_files(path, pattern) (L122-129):** Recursive file search using UNIX shell glob patterns via fnmatch. Returns absolute paths of matching files.

- **file_size(path) (L132-136):** Returns file size in bytes, treating symlinks as zero-size.

- **format_file_size(path) (L139-140):** Human-readable file size formatting wrapper.

- **directory_size(path) (L143-149):** Calculates total size of directory contents recursively.

- **format_directory_size(path) (L152-153):** Human-readable directory size formatting wrapper.

**Key Dependencies:**
- tenacity for retry logic with exponential backoff (L69-71)
- pip._internal.utils.compat.get_path_uid for cross-platform UID handling
- pip._internal.utils.misc.format_size for size formatting

**Retry Mechanism:**
- **replace (L71):** Decorated os.replace with retry logic (1-second timeout, 0.25s intervals)

**Architecture Notes:**
- Platform-specific implementations for Windows vs POSIX systems
- Security-focused with proper file handle management and atomic operations
- Defensive programming with path traversal limits and error handling