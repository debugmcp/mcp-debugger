# packages/adapter-rust/vendor/codelldb/linux-arm64/lldb/lib/python3.12/site-packages/pip/_internal/network/session.py
@source-hash: 5e66a704a8d5c0f1
@generated: 2026-02-09T18:00:30Z

## Core Purpose
Network session management module for pip's HTTP operations, providing security-aware HTTP adapters and session configuration for package downloads and repository interactions.

## Key Classes & Functions

### PipSession (L320-522)
Main session class extending `requests.Session` with pip-specific behavior:
- **Constructor (L323-401)**: Configures retries, caching, trusted hosts, SSL context, and authentication
- **Key attributes**: 
  - `timeout` (L321): Default request timeout
  - `pip_trusted_origins` (L341): List of trusted host/port tuples
  - Custom User-Agent header using `user_agent()` (L344)
  - Multi-domain basic auth handler (L347)
- **Methods**:
  - `update_index_urls()` (L403-408): Updates authentication handler with new index URLs
  - `add_trusted_host()` (L410-441): Adds host to trusted origins and mounts appropriate adapters
  - `iter_secure_origins()` (L443-446): Generator yielding secure origins from constants and trusted hosts
  - `is_secure_origin()` (L448-513): Validates if a URL/Link uses secure transport or trusted host
  - `request()` (L515-522): Overrides base request to apply default timeout and proxies

### HTTP Adapters
- **LocalFSAdapter (L212-254)**: Handles `file://` URLs, serving local files with proper headers and error handling
- **_SSLContextAdapterMixin (L256-287)**: Mixin adding SSL context support to HTTP adapters
- **HTTPAdapter (L290-291)**: Standard HTTPS adapter with SSL context support
- **CacheControlAdapter (L294-295)**: Caching-enabled HTTPS adapter
- **InsecureHTTPAdapter (L298-306)**: Forces verification=False for trusted hosts
- **InsecureCacheControlAdapter (L309-317)**: Caching version of insecure adapter

### Utility Functions
- **user_agent() (L110-209)**: Generates comprehensive User-Agent string including:
  - Python implementation/version details
  - OS/distribution information (Linux, macOS detection)
  - OpenSSL, setuptools, rustc versions if available
  - CI environment detection
- **looks_like_ci() (L100-107)**: Detects CI environment via environment variables

## Key Constants & Configuration

### SECURE_ORIGINS (L68-78)
Defines trusted protocol/host/port combinations:
- HTTPS anywhere, localhost, loopback addresses
- File protocol, SSH protocol

### CI_ENVIRONMENT_VARIABLES (L88-97)
Environment variables indicating CI execution for traffic analysis

## Architecture Patterns

### Security Model
- Strict origin validation with IP address/network checking
- Separate adapters for secure vs insecure connections
- Caching only allowed for secure or explicitly trusted origins
- Certificate verification bypassed only for trusted hosts

### Adapter Mounting Strategy
- `https://` → secure adapter (with caching if enabled)
- `http://` → insecure adapter (no caching)
- `file://` → local filesystem adapter
- Trusted hosts → special insecure adapters with optional caching

### Error Handling
- Graceful degradation for missing system info (rustc, distro details)
- Proper HTTP status codes and error responses for file operations
- Warning suppression for intentionally insecure connections

## Dependencies
- Core: `requests`, `urllib3` (via pip._vendor)
- Authentication: `MultiDomainBasicAuth` from `pip._internal.network.auth`
- Caching: `SafeFileCache` from `pip._internal.network.cache`
- URL utilities: `Link` model and URL parsing utilities