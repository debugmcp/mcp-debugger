# packages/adapter-rust/vendor/codelldb/linux-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/pygments/formatters/terminal256.py
@source-hash: d77489dc3e6915da
@generated: 2026-02-09T17:57:58Z

## Purpose
Provides ANSI terminal formatters for syntax highlighting with 256-color and true-color support. Converts style colors to terminal escape sequences for console output with proper newline handling for paging.

## Key Classes

### EscapeSequence (L34-96)
Manages ANSI escape sequence generation for text formatting.
- `__init__()` (L35-40): Sets fg/bg colors and text attributes (bold, underline, italic)
- `color_string()` (L47-71): Generates 256-color ANSI sequences, handles ansicolor mappings
- `true_color_string()` (L73-85): Generates 24-bit RGB ANSI sequences
- `reset_string()` (L87-95): Creates reset sequences to clear formatting
- `escape()` (L42-45): Helper to build escape sequence string

### Terminal256Formatter (L98-290)
Main formatter for 256-color terminal output. Inherits from Formatter.
- `__init__()` (L135-150): Initializes color tables, style mappings, and options
- `_build_color_table()` (L152-186): Creates 256-color palette (16 basic + 6x6x6 cube + 24 grayscale)
- `_closest_color()` (L188-203): RGB distance-based color matching algorithm
- `_color_index()` (L205-222): Converts hex colors to xterm256 indices with caching
- `_setup_styles()` (L224-243): Maps style definitions to escape sequences
- `format_unencoded()` (L252-286): Core formatting logic with line number support and token type hierarchy traversal

### TerminalTrueColorFormatter (L293-337)
True-color (24-bit RGB) formatter extending Terminal256Formatter.
- `_color_tuple()` (L314-322): Converts hex colors to RGB tuples
- `_setup_styles()` (L324-337): Creates true-color escape sequences instead of indexed colors
- `_build_color_table()` (L311-312): No-op since true-color doesn't need palette

## Key Dependencies
- `pip._vendor.pygments.formatter.Formatter`: Base formatter class
- `pip._vendor.pygments.console.codes`: ANSI color code mappings
- `pip._vendor.pygments.style.ansicolors`: ANSI color definitions

## Architecture Patterns
- **Color Caching**: `best_match` dict caches RGB-to-index conversions for performance
- **Token Type Hierarchy**: Walks up parent token types when specific styles not found
- **Newline Handling**: Resets colors at newlines for proper paging behavior
- **Style Inheritance**: True-color formatter reuses 256-color logic, overriding color handling

## Configuration Options
- `style`: Color style to use (default: 'default')
- `linenos`: Enable line numbers (default: False)
- `nobold`/`nounderline`/`noitalic`: Disable text attributes

## Critical Constraints
- Colors reset at newlines to prevent terminal state corruption during paging
- Token type lookup uses parent fallback when specific type styling unavailable
- RGB values constrained to 0-255 range for terminal compatibility