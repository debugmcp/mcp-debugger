# packages/adapter-rust/vendor/codelldb/linux-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/rich/traceback.py
@source-hash: 094a7160b8d05886
@generated: 2026-02-09T18:01:13Z

**Primary Purpose & Responsibility**
Provides rich, visually enhanced traceback rendering for Python exceptions using the Rich console library. The module offers enhanced traceback display with syntax highlighting, local variable inspection, code context, and customizable formatting.

**Core Classes & Data Structures**

`Frame` (L176-182) - Dataclass representing a single stack frame with filename, line number, function name, source line, and optional local variables.

`_SyntaxError` (L184-191) - Dataclass encapsulating syntax error details including offset, filename, line content, line number, and error message.

`Stack` (L194-200) - Dataclass representing a complete exception stack containing exception type/value, optional syntax error, causality flag, and list of frames.

`Trace` (L203-205) - Container dataclass holding a list of Stack objects representing the complete traceback chain.

`PathHighlighter` (L207-209) - RegexHighlighter subclass for highlighting file paths by dimming directory portions and emphasizing filenames.

`Traceback` (L211-720) - Main console renderable class for displaying enhanced tracebacks with extensive customization options.

**Key Methods & Functions**

`install()` (L48-173) - Global function installing rich traceback handler as sys.excepthook with IPython integration support. Handles console creation, parameter validation, and environment-specific hook installation.

`Traceback.__init__()` (L241-291) - Constructor accepting trace object or extracting from current exception context. Processes suppression paths and validates frame limits.

`Traceback.from_exception()` (L292-361) - Classmethod factory creating Traceback instances from exception type, value, and traceback objects.

`Traceback.extract()` (L362-486) - Classmethod extracting structured trace information from Python traceback objects. Handles exception chaining (__cause__ and __context__), local variable collection, and frame filtering.

`Traceback.__rich_console__()` (L487-564) - Rich console protocol implementation rendering complete traceback with theming, panels, and exception chain handling.

`Traceback._render_stack()` (L604-719) - Renders individual stack frames with code syntax highlighting, local variables, and frame suppression logic.

`Traceback._render_syntax_error()` (L565-587) - Specialized renderer for syntax errors with error position indicators.

`Traceback._guess_lexer()` (L588-603) - Determines appropriate Pygments lexer for syntax highlighting based on file extension or shebang detection.

**Important Dependencies & Relationships**

- `pip._vendor.pygments.*` - Syntax highlighting and lexer detection
- `rich.console.*` - Console rendering protocol and theming
- `rich.syntax.Syntax` - Code syntax highlighting
- `rich.panel.Panel` - Bordered container rendering
- `rich.scope.render_scope` - Local variable display formatting
- `traceback.walk_tb` - Standard library traceback traversal
- Platform detection via `platform.system()` for Windows-specific handling

**Configuration Constants**

`LOCALS_MAX_LENGTH = 10` (L44) - Default maximum container length before abbreviation
`LOCALS_MAX_STRING = 80` (L45) - Default string truncation length
`LEXERS` dict (L233-240) - File extension to lexer name mapping for syntax highlighting

**Notable Patterns & Architecture**

- Rich console renderable protocol implementation for seamless integration
- Exception chaining support following Python's __cause__/__context__ model
- Frame suppression system for hiding internal library frames
- IPython integration with custom exception hook handling
- Lazy code loading using linecache for performance
- Theme inheritance system for consistent styling across components

**Critical Invariants & Constraints**

- Minimum 4 frames displayed when max_frames > 0 (L290)
- Frame suppression requires absolute normalized paths (L288-289)
- Local variable hiding respects dunder/sunder prefix rules (L427-435)
- Exception safety in string conversion prevents recursive failures (L397-403)
- Guard mechanisms (_rich_traceback_omit, _rich_traceback_guard) control frame inclusion/exclusion