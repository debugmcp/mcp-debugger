# packages/adapter-rust/vendor/codelldb/linux-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/urllib3/contrib/appengine.py
@source-hash: 551ebc780544d77e
@generated: 2026-02-09T17:57:53Z

## Purpose
Google App Engine URLFetch adapter for urllib3, providing a connection manager that uses GAE's URLFetch service instead of sockets for HTTP requests in sandbox environments.

## Key Components

### Exception Classes
- `AppEnginePlatformWarning` (L71-72): Warning for GAE-specific issues
- `AppEnginePlatformError` (L75-76): Error for GAE platform limitations

### Main Class: AppEngineManager
`AppEngineManager` (L79-306): Connection manager implementing RequestMethods interface for GAE sandbox applications.

**Constructor** (L99-123):
- Validates URLFetch availability
- Issues warning about URLFetch usage vs sockets
- Configures certificate validation and retry behavior
- Accepts: headers, retries, validate_certificate, urlfetch_retries

**Core Method: urlopen** (L131-243):
- Primary HTTP request method wrapping urlfetch.fetch()
- Handles GAE-specific exceptions and translates to urllib3 equivalents
- Manages redirects and retries according to urllib3 patterns
- Key exception handling:
  - `DeadlineExceededError` → `TimeoutError` (L157-158)
  - `InvalidURLError` → `AppEnginePlatformError` for size limits (L160-167)
  - `DownloadError` → `MaxRetryError`/`ProtocolError` (L169-172)
  - `ResponseTooLargeError` → `AppEnginePlatformError` (L174-179)
  - `SSLCertificateError` → `SSLError` (L181-182)
  - `InvalidMethodError` → `AppEnginePlatformError` (L184-187)

**Response Processing** (L245-279):
- `_urlfetch_response_to_http_response()`: Converts URLFetch response to HTTPResponse
- Handles GAE production quirks (deflate encoding, chunked transfer)
- Creates file-like body using io.BytesIO for urllib3 compatibility

**Helper Methods**:
- `_get_absolute_timeout()` (L281-292): Converts urllib3 Timeout to URLFetch deadline
- `_get_retries()` (L294-305): Validates retry configuration, warns about unsupported granular retries

## Dependencies
- `google.appengine.api.urlfetch`: Core GAE URLFetch service (optional import L62-65)
- `urllib3` components: exceptions, request, response, retry, timeout utilities
- `_appengine_environ`: Environment detection functions

## Public API Aliases (L308-314)
Re-exports environment detection functions from `_appengine_environ`:
- `is_appengine`, `is_appengine_sandbox`, `is_local_appengine`, `is_prod_appengine`, `is_prod_appengine_mvms`

## Key Constraints
- URLFetch request size limit: 10MB
- URLFetch response size limit: 32MB
- Limited HTTP method support
- No granular timeout control (connect/read timeouts)
- No granular retry control (connect/read/redirect retries)

## Architecture Notes
- Context manager support via `__enter__`/`__exit__` (L124-129)
- Maintains urllib3 interface compatibility while delegating to URLFetch
- Automatic handling of redirects and retries with URLFetch limitations
- Production GAE automatic deflate handling accommodation