# packages/adapter-rust/vendor/codelldb/linux-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/rich/_wrap.py
@source-hash: 1654aca26e445f42
@generated: 2026-02-09T18:00:52Z

## Primary Purpose
Text wrapping utility for Rich library that handles Unicode-aware line breaking and word wrapping with cell-based width calculations.

## Key Components

### Module-level Regex (L9)
- `re_word`: Compiled pattern `r"\s*\S+\s*"` for matching words with optional trailing whitespace

### Core Functions

**`words(text: str)` (L12-23)**
- Generator that yields `(start_index, end_index, word)` tuples for each word in text
- Word definition includes actual word plus any trailing whitespace
- Uses regex matching with position tracking for iteration

**`divide_line(text: str, width: int, fold: bool = True)` (L26-78)**
- Primary line-breaking algorithm that returns list of character indices for line breaks
- Uses cell-based width measurement (supports Unicode/CJK characters)
- Handles three scenarios:
  1. Word fits in remaining space: continues on current line
  2. Word too long for any line: either folds across lines or crops (based on `fold` parameter)
  3. Word fits on next line: breaks at word boundary
- Performance optimization: caches `cell_len` function reference (L42)

### Test/Demo Code (L81-93)
- Demonstrates functionality with various Unicode text examples
- Shows both narrow (width=10) and wider (width=20) console output
- Includes Japanese text examples for Unicode handling validation

## Dependencies
- `._loop.loop_last`: Iteration utility for detecting last item
- `.cells.cell_len, chop_cells`: Unicode-aware cell width calculations and text chopping

## Key Algorithms
1. **Word extraction**: Regex-based tokenization preserving whitespace
2. **Greedy line breaking**: Fits words until width exceeded, then breaks
3. **Long word handling**: Conditional folding vs. cropping based on parameters
4. **Cell-aware measurement**: Accounts for variable-width Unicode characters

## Notable Patterns
- Generator-based word iteration for memory efficiency
- Cell-based rather than character-based width calculations for proper Unicode support
- Conditional word folding with multi-line support via `chop_cells` integration