# packages/adapter-rust/vendor/codelldb/linux-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/pygments/formatters/svg.py
@source-hash: 75038d5b2a5bcdfb
@generated: 2026-02-09T17:57:50Z

## Primary Purpose
SVG formatter for Pygments syntax highlighting that converts tokenized source code into SVG graphics with styled text elements. Produces either complete SVG documents or raw SVG fragments with line-by-line text positioning.

## Key Components

### Core Classes
- **SvgFormatter (L29-188)**: Main formatter class inheriting from Pygments Formatter
  - Converts token streams into positioned SVG text elements
  - Supports configurable fonts, positioning, and line numbering
  - Maintains style cache for performance optimization

### Utility Functions
- **escape_html (L18-24)**: HTML entity escaping for SVG content
  - Escapes `&`, `<`, `>`, `"`, and `'` characters
  - Essential for preventing XML parsing errors in SVG output

### Key Methods
- **__init__ (L93-112)**: Configuration and option parsing
  - Processes 11 different formatting options (nowrap, fonts, positioning, line numbers)
  - Calculates derived values (yoffset, ystep) from font size
  - Initializes style cache dictionary
  
- **format_unencoded (L114-171)**: Main formatting logic
  - Generates SVG structure with optional XML declaration and DOCTYPE
  - Iterates through token stream, creating `<text>` and `<tspan>` elements
  - Handles line breaks by incrementing Y coordinates
  - Manages line number generation and positioning

- **_get_style (L173-188)**: Token-to-SVG style conversion
  - Walks token type hierarchy to find applicable styles
  - Converts Pygments style attributes to SVG attributes (fill, font-weight, font-style)
  - Implements caching to avoid redundant style lookups

## Architecture Patterns
- **Template Method**: Inherits from Pygments Formatter base class
- **Caching**: Uses `_stylecache` dictionary to optimize repeated style lookups
- **State Management**: Tracks line positioning (x, y coordinates) and line numbering state

## Configuration Options
Supports 11 configuration parameters including:
- Layout control: `nowrap`, `xoffset`, `yoffset`, `ystep`
- Typography: `fontfamily`, `fontsize`, `spacehack`
- Line numbering: `linenos`, `linenostart`, `linenostep`, `linenowidth`

## Dependencies
- `pip._vendor.pygments.formatter.Formatter`: Base formatter class
- `pip._vendor.pygments.token.Comment`: Token type for line number styling  
- `pip._vendor.pygments.util`: Option parsing utilities

## Critical Constraints
- Coordinates are absolute SVG positions (not relative)
- Text baseline positioning requires Y offset calculation
- Line numbers are right-aligned using `text-anchor="end"`
- Space handling requires workaround due to SVG viewer inconsistencies