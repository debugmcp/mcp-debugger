# packages/adapter-rust/vendor/codelldb/linux-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/rich/_windows.py
@source-hash: 681c1a0ff4b9e926
@generated: 2026-02-09T18:00:51Z

## Purpose
Windows console feature detection module for the Rich terminal library. Provides cross-platform abstraction for detecting Windows-specific console capabilities like VT escape code support and truecolor rendering.

## Key Components

### WindowsConsoleFeatures (L6-13)
Dataclass representing Windows console capabilities:
- `vt: bool = False` - Console supports VT100/ANSI escape codes
- `truecolor: bool = False` - Console supports 24-bit color rendering

### Platform Detection Logic (L15-31)
Conditional import block that:
- Imports Windows-specific libraries only on win32 platform
- Sets up `windll` loader for Windows DLL access
- Imports Win32 console functions from `_win32_console` module
- Raises ImportError on non-Windows platforms to trigger fallback

### get_windows_console_features() - Two Implementations

#### Fallback Implementation (L34-36)
Used when Windows libraries unavailable (non-Windows platforms or import failures):
- Returns default WindowsConsoleFeatures with all capabilities disabled

#### Windows Implementation (L40-61)
Full feature detection for Windows platforms:
- Gets standard output handle via GetStdHandle()
- Queries console mode using GetConsoleMode()
- Detects VT support by checking ENABLE_VIRTUAL_TERMINAL_PROCESSING flag
- Determines truecolor support based on Windows version (Windows 10 build 15063+)
- Handles LegacyWindowsError gracefully by disabling features

### Debug Script (L64-71)
Command-line testing interface that prints platform and detected features.

## Architecture Pattern
Uses try/except import pattern to provide platform-specific implementations with graceful degradation. The module exports the same interface regardless of platform, with feature detection automatically disabled on non-Windows systems.

## Critical Dependencies
- `ctypes` and `ctypes.LibraryLoader` for Windows DLL access
- `pip._vendor.rich._win32_console` for low-level Windows console operations
- `sys.getwindowsversion()` for Windows version detection (truecolor capability)

## Key Invariants
- Function always returns WindowsConsoleFeatures instance
- Truecolor support implies VT support (truecolor only enabled when vt=True)
- Non-Windows platforms always return disabled features
- Error conditions result in conservative feature detection (all disabled)