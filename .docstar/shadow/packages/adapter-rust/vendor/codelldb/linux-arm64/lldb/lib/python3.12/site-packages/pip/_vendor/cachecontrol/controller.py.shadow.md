# packages/adapter-rust/vendor/codelldb/linux-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/cachecontrol/controller.py
@source-hash: a3e7a31899419a92
@generated: 2026-02-09T18:00:40Z

## Primary Purpose
HTTP cache controller implementing RFC 7234 caching algorithms, ported from httplib2 for use with requests library. Manages cache storage, retrieval, validation, and freshness calculations for HTTP responses.

## Key Classes and Functions

### CacheController (L48-499)
Main class controlling HTTP caching behavior with comprehensive cache management:
- `__init__` (L51-61): Configures cache backend, serializer, etag handling, and cacheable status codes
- `cached_request` (L167-275): Primary cache lookup method returning cached response or False
- `cache_response` (L322-457): Stores responses in cache based on RFC 7234 rules
- `conditional_headers` (L277-290): Generates If-None-Match/If-Modified-Since headers
- `update_cached_response` (L459-499): Updates cached response with 304 Not Modified headers

### Utility Functions
- `parse_uri` (L37-45): RFC 3986 URI parsing using regex groups
- `_urlnorm` (L63-81): URL normalization for consistent cache keys
- `parse_cache_control` (L87-139): Parses Cache-Control header directives with validation

## Key Dependencies
- `pip._vendor.cachecontrol.cache`: BaseCache, DictCache, SeparateBodyBaseCache
- `pip._vendor.cachecontrol.serialize`: Serializer for response serialization
- `pip._vendor.requests.structures`: CaseInsensitiveDict for header handling

## Core Algorithms

### Cache Lookup Logic (L167-275)
1. Validates request cache-control directives (no-cache, max-age=0)
2. Handles permanent redirects (301, 308) without freshness checks
3. Calculates response age using Date header and current time
4. Determines freshness lifetime from max-age or expires headers
5. Applies min-fresh adjustments and returns fresh responses

### Cache Storage Logic (L322-457)
1. Validates status codes against cacheable list (200, 203, 300, 301, 308)
2. Handles no-store directives by purging existing entries
3. Skips responses with Vary: * header
4. Caches responses with etags, permanent redirects, or valid expiration

### Response Freshness Calculation (L232-267)
- Primary: max-age from Cache-Control
- Fallback: expires header relative to date
- Override: request max-age takes precedence
- Adjustment: min-fresh increases effective age

## Architectural Patterns
- Strategy pattern for cache backends (DictCache vs SeparateBodyBaseCache)
- Template method pattern in cache operations with customizable status codes
- Decorator pattern for conditional request headers

## Critical Invariants
- Only absolute URIs allowed for caching (L67-68)
- Permanent redirects bypass freshness validation (L200-206)
- Content-Length validation prevents partial content caching (L358-364)
- ETags require minimum 14-day cache lifetime (L404)

## Notable Constraints
- Range requests not supported for caching (L147-148)
- Partial content (206) responses explicitly excluded
- Vary: * responses never cached due to RFC compliance