# packages/adapter-rust/vendor/codelldb/linux-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/urllib3/contrib/ntlmpool.py
@source-hash: 3657e45bb58c756f
@generated: 2026-02-09T17:57:51Z

## Purpose
Implements NTLM (NT LAN Manager) authentication for HTTPS connections in urllib3. This is a deprecated module that extends HTTPSConnectionPool to handle Windows domain authentication through a custom connection pool.

## Key Components

### NTLMConnectionPool Class (L27-130)
- **Inherits from**: HTTPSConnectionPool 
- **Purpose**: Manages persistent HTTPS connections with NTLM authentication
- **Scheme**: Fixed to "https" (L32)

### Constructor (L34-46)
- **Parameters**: user (domain\username format), pw (password), authurl (protected endpoint)
- **User Processing**: Splits user into domain and username components (L43-45)
- **Storage**: Stores raw user, domain, username, password, and auth URL

### Connection Creation (_new_conn, L48-113)
- **NTLM Handshake**: Implements 3-step NTLM authentication protocol
  1. **Negotiate** (L66-68): Sends NTLM negotiate message
  2. **Challenge** (L82-95): Parses server challenge response
  3. **Authenticate** (L96-109): Sends authentication response with credentials
- **Socket Management**: Explicitly manages socket lifecycle by setting res.fp = None (L79, L111)
- **Error Handling**: Custom exceptions for authentication failures (L106-109)

### URL Opening (urlopen, L115-130)
- **Override**: Ensures "Keep-Alive" connection header is set
- **Delegation**: Calls parent class with modified headers

## Dependencies
- **ntlm module** (L11): Handles NTLM message creation and parsing
- **HTTPSConnectionPool** (L13): Base class for HTTPS connection pooling
- **HTTPSConnection** (L14): Individual HTTPS connection implementation

## Critical Notes
- **Deprecated**: Module warns of removal in urllib3 v2.0 (L16-22)
- **Socket Persistence**: Requires keeping connections alive for NTLM session
- **Domain Authentication**: Designed for Windows domain environments
- **Security**: Handles sensitive credentials in memory

## Architectural Patterns
- **Template Method**: Overrides _new_conn to customize connection establishment
- **Decorator Pattern**: Adds NTLM authentication layer to standard HTTPS pooling
- **State Management**: Maintains authentication state across requests through persistent connections