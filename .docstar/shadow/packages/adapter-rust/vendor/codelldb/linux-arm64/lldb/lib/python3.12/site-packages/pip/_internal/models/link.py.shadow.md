# packages/adapter-rust/vendor/codelldb/linux-arm64/lldb/lib/python3.12/site-packages/pip/_internal/models/link.py
@source-hash: 8c76b1f4efbdce54
@generated: 2026-02-09T18:00:31Z

## Purpose
Core data model for package links in pip's package index handling. Provides comprehensive URL parsing, validation, and normalization for Python package distribution links with hash verification, metadata handling, and equivalency checking.

## Key Classes

### LinkHash (L43-95)
Frozen dataclass for parsing and validating cryptographic hashes embedded in URLs. Supports hash algorithms: sha512, sha384, sha256, sha224, sha1, md5 (L40). Key methods:
- `find_hash_url_fragment()` (L73-79): Extracts hash from URL fragment using regex pattern
- `as_hashes()` (L84-86): Converts to Hashes instance for validation
- `is_hash_allowed()` (L88-94): Validates hash against allowed Hashes set

### MetadataFile (L97-106)
Frozen dataclass storing core metadata file information with optional hash dictionary. Validates all hash names against supported algorithms in `__post_init__`.

### Link (L181-528)
Primary class representing parsed package index links with comprehensive URL handling:

**Construction:**
- `__init__()` (L197-258): Main constructor with URL normalization, hash extraction, UNC path conversion
- `from_json()` (L261-309): Creates Link from PyPI JSON API response
- `from_element()` (L312-361): Creates Link from HTML anchor element attributes

**Properties:**
- `filename` (L394-405): Extracts filename from URL path with auth sanitization
- `scheme`, `netloc`, `path` (L412-424): URL component accessors
- `is_wheel`, `is_vcs`, `is_yanked`, `has_hash` (L504-519): Type/status checks
- `subdirectory_fragment` (L466-470): VCS subdirectory extraction

**Hash Management:**
- `as_hashes()` (L481-482): Converts internal hash dict to Hashes instance
- `is_hash_allowed()` (L521-527): Validates link hashes against allowed set

**Metadata:**
- `metadata_link()` (L472-479): Generates link to associated .metadata file

### _CleanResult (L530-560)
NamedTuple for link normalization supporting equivalency checks. Strips auth, normalizes query parameters, preserves only subdirectory and hash fragments.

## Key Functions

### URL Cleaning (L119-178)
- `_clean_url_path_part()` (L119-124): URL-encodes path segments
- `_clean_file_url_path()` (L127-137): Handles local filesystem paths with drive letters
- `_clean_url_path()` (L144-163): Splits on reserved chars (@, %2F) before cleaning
- `_ensure_quoted_url()` (L166-178): Complete URL normalization

### Hash Support (L108-116)
`supported_hashes()`: Filters hash dictionary to only supported algorithms, returns None if no valid hashes remain.

### Link Equivalency (L562-585, L588-589)
- `_clean_link()` (L562-585): Normalizes Link for comparison (removes auth, normalizes query/fragment)
- `links_equivalent()` (L588-589): LRU-cached equivalency check using cleaned links

## Dependencies
- `urllib.parse`: URL parsing and manipulation
- `pip._internal.utils.hashes.Hashes`: Hash validation
- `pip._internal.utils.misc`: URL utilities, auth handling
- `pip._internal.vcs`: VCS scheme detection

## Architectural Patterns
- Frozen dataclasses for immutable hash/metadata objects
- `__slots__` optimization for Link class
- LRU caching for expensive operations (hash extraction, link equivalency)
- Total ordering implementation for Link sorting
- Comprehensive URL normalization pipeline handling edge cases (UNC paths, auth, encoding)

## Critical Invariants
- Hash names must be in `_SUPPORTED_HASHES` (validated in `__post_init__`)
- URLs are normalized during construction to prevent double-encoding
- Link equivalency ignores auth differences and normalizes query/fragment ordering
- Metadata file links append `.metadata` suffix to base URL without fragment