# packages/adapter-rust/vendor/codelldb/linux-arm64/lldb/lib/python3.12/site-packages/pip/_internal/vcs/git.py
@source-hash: deda5cf4b400fc9e
@generated: 2026-02-09T18:00:40Z

**Primary Purpose:** Git version control adapter for pip's VCS subsystem. Implements Git-specific operations for cloning, updating, and managing Git repositories during package installation.

**Key Classes:**

- `Git` (L60-527): Core Git VCS adapter inheriting from VersionControl. Defines Git-specific behavior including supported schemes (git+http, git+https, git+ssh, git+git, git+file), directory patterns (.git), and environment variable handling.

**Critical Methods:**

- `get_git_version()` (L94-105): Parses Git version output using GIT_VERSION_REGEX to determine Git capabilities
- `is_immutable_rev_checkout()` (L80-92): Determines if a checkout represents an immutable commit hash (not a branch/tag reference)
- `get_current_branch()` (L108-130): Extracts current branch name from symbolic-ref, returns None for detached HEAD
- `get_revision_sha()` (L133-176): Maps revision names to commit SHAs, distinguishes between branches and tags using refs/remotes/origin/ and refs/tags/ prefixes
- `resolve_revision()` (L202-245): Core revision resolution logic - converts branch/tag names to commit SHAs, handles fetching if needed
- `fetch_new()` (L262-323): Initial repository cloning with partial clone optimization for Git >=2.17, handles specific revision checkout and submodule updates
- `update()` (L335-347): Updates existing repository by fetching and hard resetting to target revision
- `switch()` (L325-333): Changes remote URL and switches to different revision
- `get_remote_url()` (L350-377): Extracts remote URL from Git config, prioritizes origin remote
- `_git_remote_to_pip_url()` (L380-408): Converts Git remote URLs to pip-compatible format, handles SSH shorthand (user@host:path) and local paths

**Key Utility Functions:**

- `looks_like_hash()` (L56-57): Validates 40-character hex strings as potential commit hashes using HASH_REGEX
- `_should_fetch()` (L179-199): Determines if remote fetch is needed based on revision type and local availability
- `has_commit()` (L411-424): Checks local commit existence using rev-parse
- `get_revision()` (L427-436): Gets commit SHA for given revision (defaults to HEAD)
- `update_submodules()` (L488-494): Recursively initializes and updates Git submodules

**Important Regex Patterns:**

- `GIT_VERSION_REGEX` (L30-36): Parses "git version X.Y.Z" output for version detection
- `HASH_REGEX` (L38): Validates 40-character Git commit hashes
- `SCP_REGEX` (L41-53): Matches SSH shorthand syntax (user@host:path)

**Architectural Decisions:**

- Unsets GIT_DIR and GIT_WORK_TREE environment variables to prevent interference (L73)
- Uses partial clone (--filter=blob:none) for Git >=2.17 to optimize initial clones (L273-285)
- Implements sophisticated URL handling for SSH shorthand, local paths, and standard URLs
- Handles branch tracking by creating local branches that track remote origin branches
- Separates immutable revision detection to enable caching optimizations

**Dependencies:**

- Inherits from `VersionControl` base class from pip._internal.vcs.versioncontrol
- Uses `make_command`, `HiddenText`, `RevOptions` from pip internal utilities
- Integrates with pip's VCS registry via `vcs.register(Git)` (L527)