# packages/adapter-rust/vendor/codelldb/linux-arm64/lldb/lib/python3.12/site-packages/pip/_internal/distributions/sdist.py
@source-hash: 3e570fe1aebe47a7
@generated: 2026-02-09T18:00:22Z

## SourceDistribution - PEP 517/518 Source Distribution Handler

This module implements the `SourceDistribution` class (L16-158) that handles source distributions requiring build-time metadata generation through PEP 517/518 or legacy `setup.py egg_info`.

**Core Responsibility**: Manages the complete lifecycle of source distribution preparation, from pyproject.toml parsing through build environment isolation and dependency resolution.

### Key Components

**SourceDistribution Class (L16-158)**
- Inherits from `AbstractDistribution` 
- Implements metadata preparation for packages requiring compilation/build steps
- Handles both PEP 517 and legacy build systems

**Critical Methods:**
- `build_tracker_id` (L24-27): Returns unique identifier based on requirement link URL
- `get_metadata_distribution()` (L29-30): Delegates to requirement's distribution getter
- `prepare_distribution_metadata()` (L32-69): **Core orchestration method** - loads pyproject.toml, sets up build isolation, validates dependencies, and prepares metadata

**Build Environment Management:**
- `_prepare_build_backend()` (L71-96): Creates isolated `BuildEnvironment`, installs static build dependencies, validates PEP 517/518 requirements
- `_install_build_reqs()` (L115-132): Installs dynamic build requirements after querying backend (second-pass installation)

**Build Requirements Resolution:**
- `_get_build_requires_wheel()` (L97-103): Queries PEP 517 backend for wheel build requirements
- `_get_build_requires_editable()` (L105-113): Queries backend for editable installation requirements

**Error Handling:**
- `_raise_conflicts()` (L134-149): Formats and raises InstallationError for conflicting dependencies
- `_raise_missing_reqs()` (L151-158): Formats and raises InstallationError for missing build dependencies

### Dependencies
- `BuildEnvironment`: Isolated environment for build operations
- `PackageFinder`: Package discovery and retrieval
- `runner_with_spinner_message`: User feedback during subprocess operations
- Requirement object (`self.req`): Central state holder with build backend access

### Architectural Patterns
- **Two-phase build dependency installation**: Static requirements first (pyproject.toml), then dynamic requirements from backend
- **Build isolation**: Optional isolated environment prevents system pollution
- **PEP 517 detection**: Automatic fallback between modern (PEP 517) and legacy (setup.py) build systems
- **Editable installation support**: Special handling for development installations with PEP 660 compatibility checks

### Critical Invariants
- `pyproject_requires` must be non-None when using PEP 517 (assertions at L61, L75)
- `pep517_backend` must be available when querying build requirements (assertions at L101, L111)
- Build environment context management ensures proper cleanup
- Dependency conflicts are fatal and immediately abort installation