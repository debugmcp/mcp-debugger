# packages/adapter-rust/vendor/codelldb/linux-arm64/lldb/lib/python3.12/site-packages/pip/_internal/locations/
@generated: 2026-02-09T18:16:11Z

## Purpose and Responsibility
The `pip._internal.locations` module is pip's core installation path resolution system, responsible for determining where packages, scripts, headers, and data should be installed across different Python environments and platforms. It abstracts the complexity of Python's evolving packaging standards, distribution-specific patches, and platform differences into a consistent API.

## Key Components and Architecture

### Multi-Backend Strategy
The module employs a dual-backend architecture to handle Python's packaging evolution:
- **Sysconfig Backend** (`_sysconfig.py`): Modern Python 3.10+ approach using the `sysconfig` module
- **Distutils Backend** (`_distutils.py`): Legacy fallback for older Python versions and compatibility
- **Runtime Selection** (`__init__.py`): Intelligent switching between backends based on Python version and environment detection

### Core Components

#### Main Orchestrator (`__init__.py`)
- Central scheme resolution with `get_scheme()` containing 8+ platform-specific workarounds
- Extensive platform detection functions (Red Hat, Debian, Slackware, MSYS2, macOS Framework, PyPy)
- Compatibility layer that compares sysconfig vs distutils results and applies appropriate fixes
- Comprehensive caching strategy using `@functools.lru_cache` for expensive platform detection

#### Backend Implementations
- **`_sysconfig.py`**: Hierarchical scheme inference with fallback chains, special handling for macOS frameworks and virtual environments
- **`_distutils.py`**: Distutils-based resolution with setuptools shim removal and isolation support
- **`base.py`**: Foundation utilities for path manipulation, version detection, and cross-platform root directory handling

## Public API Surface

### Primary Entry Points
- **`get_scheme()`**: Main scheme resolution returning `Scheme` objects with installation paths
- **`get_bin_prefix()`**: Binary/script installation directory
- **`get_purelib()`**: Pure Python library installation path  
- **`get_platlib()`**: Platform-specific library installation path
- **`get_bin_user()`**: User-specific binary installation path

### Supporting Utilities
- **`change_root()`**: Cross-platform path root manipulation
- **`get_major_minor_version()`**: Python version string formatting
- **`get_src_prefix()`**: Source code installation directory resolution
- **`USER_CACHE_DIR`**: Global pip cache directory

## Internal Organization and Data Flow

### Resolution Flow
1. **Backend Selection**: `_USE_SYSCONFIG` flag determines sysconfig vs distutils usage
2. **Platform Detection**: Cached functions identify distribution patches and special environments
3. **Scheme Generation**: Backend-specific scheme creation with path computation
4. **Compatibility Checking**: Cross-validation between backends with mismatch warnings
5. **Workaround Application**: Platform-specific fixes applied based on detection results

### Data Structures
- **`Scheme` Objects**: Encapsulate installation paths (platlib, purelib, headers, scripts, data)
- **`SCHEME_KEYS`**: Standardized path categories across backends
- **Detection Caches**: LRU-cached platform and environment detection results

## Critical Patterns and Conventions

### Compatibility Strategy
- **Graceful Degradation**: Falls back to working solutions when mismatches detected
- **Extensive Workarounds**: Handles known issues in major Linux distributions (Red Hat lib64, Debian dist-packages, Slackware)
- **Warning System**: Structured logging for debugging path resolution issues

### Platform Handling
- **Framework Detection**: Special logic for macOS Command Line Tools and framework builds
- **Virtual Environment Awareness**: Custom header paths and prefix detection
- **Cross-Platform Path Logic**: Handles Windows drive letters, POSIX absolute paths, and root rebasing

### Performance Optimizations
- **Heavy Caching**: Platform detection functions cached with `@functools.lru_cache`
- **Lazy Loading**: Distutils imported only when needed
- **Single Resolution**: Paths resolved once per pip execution with consistency guarantees

## Role in Larger System
This module serves as the foundation for pip's installation system, providing the critical path resolution that enables pip to install packages correctly across the vast diversity of Python environments, operating systems, and distribution-specific modifications found in the wild. It bridges the gap between Python's theoretical packaging standards and the reality of heterogeneous deployment environments.