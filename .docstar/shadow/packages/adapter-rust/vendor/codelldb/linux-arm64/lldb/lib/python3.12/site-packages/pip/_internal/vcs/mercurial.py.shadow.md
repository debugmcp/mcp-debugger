# packages/adapter-rust/vendor/codelldb/linux-arm64/lldb/lib/python3.12/site-packages/pip/_internal/vcs/mercurial.py
@source-hash: a142ce8732765227
@generated: 2026-02-09T18:00:32Z

**Primary Purpose**: Implements Mercurial (hg) version control system support for pip package management, providing repository operations like cloning, updating, and metadata extraction.

**Architecture**: Inherits from `VersionControl` base class (L20) and integrates with pip's VCS plugin system through registration (L163).

## Key Components

**Mercurial Class (L20-161)**
- Core VCS adapter with standard pip integration points
- Configuration: name="hg", dirname=".hg", repo_name="clone" (L21-23)
- Supported schemes: hg+file, hg+http, hg+https, hg+ssh, hg+static-http (L24-30)

**Repository Operations**
- `fetch_new()` (L36-58): Clone repository with verbosity-based flags and update to specific revision
- `switch()` (L60-72): Change repository URL by modifying .hg/hgrc config file
- `update()` (L74-77): Pull latest changes and update to specified revision

**Metadata Extraction**
- `get_remote_url()` (L79-89): Extract default remote URL from hg config, converting local paths to file URLs
- `get_revision()` (L92-102): Get current changeset revision number as integer
- `get_requirement_revision()` (L105-116): Get changeset hash as 40-character hex string

**Repository Introspection**
- `get_subdirectory()` (L124-135): Find Python project root relative to repo root using `hg root` command
- `get_repository_root()` (L138-160): Determine if location is under hg control with error handling for missing hg binary
- `is_commit_id_equal()` (L119-121): Always returns False, forcing version checks

## Critical Patterns

**Error Handling**: Graceful degradation when hg binary unavailable (L151-157), config file access issues (L68-69)

**Command Execution**: Uses `make_command()` and `run_command()` abstractions for consistent hg invocation with proper working directory handling

**Security**: Handles `HiddenText` URLs to prevent credential exposure in logs