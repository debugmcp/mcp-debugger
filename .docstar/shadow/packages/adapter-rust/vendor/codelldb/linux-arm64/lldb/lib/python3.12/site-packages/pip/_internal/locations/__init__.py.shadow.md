# packages/adapter-rust/vendor/codelldb/linux-arm64/lldb/lib/python3.12/site-packages/pip/_internal/locations/__init__.py
@source-hash: 51a031799fdff771
@generated: 2026-02-09T18:00:31Z

## Purpose and Responsibility
Core location resolution module for pip that determines installation paths (purelib, platlib, scripts) across different Python environments. Handles compatibility between `sysconfig` (Python 3.10+) and legacy `distutils`, with extensive platform-specific patches and workarounds.

## Key Components

### Configuration and State (L41-74)
- `_PLATLIBDIR` (L41): Platform library directory from `sys.platlibdir` 
- `_USE_SYSCONFIG_DEFAULT` (L43): Boolean flag for Python 3.10+ sysconfig usage
- `_should_use_sysconfig()` (L46-57): Determines sysconfig vs distutils usage with override support
- `_USE_SYSCONFIG` (L60): Runtime configuration flag

### Platform Detection Functions (L76-175)
All cached with `@functools.lru_cache(maxsize=None)`:
- `_looks_like_bpo_44860()` (L76-87): Detects Python bug 44860 affecting platlib paths
- `_looks_like_red_hat_patched_platlib_purelib()` (L90-97): Red Hat lib64 patch detection
- `_looks_like_red_hat_lib()` (L101-112): Red Hat patched Python detection
- `_looks_like_debian_scheme()` (L116-120): Debian scheme detection (`deb_system`, `unix_local`)
- `_looks_like_red_hat_scheme()` (L124-140): Red Hat `/local` prefix patch detection
- `_looks_like_slackware_scheme()` (L144-156): Slackware lib64 patch detection
- `_looks_like_msys2_mingw_scheme()` (L160-174): MSYS2 MINGW scheme detection

### Path Processing (L177-227)
- `_fix_abiflags()` (L177-190): Generator that strips ABI flags from LDVERSION paths
- `_warn_mismatched()` (L194-201): Cached warning logger for path mismatches
- `_warn_if_mismatch()` (L204-208): Mismatch detection and warning trigger
- `_log_context()` (L212-227): Logs installation context for debugging

### Primary API Functions (L230-456)

#### `get_scheme()` (L230-394)
Main scheme resolution function with extensive compatibility logic:
- Compares sysconfig vs distutils results for all `SCHEME_KEYS`
- Contains 8+ platform-specific workarounds (PyPy, OSX Framework, Red Hat, BPO-44860, Slackware, Linux system, MSYS2, CPython build)
- Handles distutils config file deprecation warnings
- Returns appropriate scheme based on `_USE_SYSCONFIG` flag

#### Other Public Functions
- `get_bin_prefix()` (L397-405): Binary installation prefix with compatibility checking
- `get_bin_user()` (L408-409): User binary path via sysconfig
- `get_purelib()` (L429-440): Pure Python library path with Debian special case
- `get_platlib()` (L443-456): Platform library path with Debian special case

### Helper Functions
- `_looks_like_deb_system_dist_packages()` (L412-426): Debian APT dist-packages detection

## Dependencies
- **Internal**: `_sysconfig`, `_distutils` modules, `base` module utilities, `Scheme` model
- **External**: Standard library (`sysconfig`, `pathlib`, `logging`, `functools`)
- **Conditional**: `distutils` imported lazily when not using sysconfig (L66)

## Architecture Patterns
- **Conditional Backend**: Runtime selection between sysconfig/distutils based on Python version and overrides
- **Extensive Workarounds**: Platform-specific compatibility shims for known distribution patches
- **Caching Strategy**: Heavy use of `@functools.lru_cache` for expensive platform detection
- **Graceful Degradation**: Falls back to working solution when mismatches detected
- **Warning System**: Structured logging for debugging path resolution issues

## Critical Invariants
- Must maintain backward compatibility with existing installations
- Path resolution must be consistent within single pip run
- Platform detection functions should be idempotent and cacheable
- Warnings logged at appropriate levels based on expected vs actual behavior