# packages/adapter-rust/vendor/codelldb/linux-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/msgpack/ext.py
@source-hash: 7caa74d01a832e35
@generated: 2026-02-09T18:00:38Z

## Primary Purpose
Extension type support for MessagePack serialization format, providing two core types: `ExtType` for generic extension data and `Timestamp` for precise time representation.

## Key Classes and Functions

### ExtType (L6-16)
Immutable namedtuple subclass representing MessagePack extension types.
- **Constructor (L9-16)**: Validates code (0-127 integer) and data (bytes), raising TypeError/ValueError on invalid input
- **Fields**: `code` (extension type identifier), `data` (binary payload)
- Used to wrap arbitrary binary data with type identifiers in MessagePack streams

### Timestamp (L19-168) 
Immutable class for high-precision timestamps with nanosecond resolution.
- **Constructor (L31-51)**: Takes `seconds` (Unix epoch) and optional `nanoseconds` (0-999,999,999)
- **Serialization methods**:
  - `to_bytes()` (L97-116): Packs to 4/8/12-byte formats based on value range
  - `from_bytes()` (L71-95): Unpacks from MessagePack timestamp extension payload
- **Unix timestamp conversion**:
  - `from_unix()`/`to_unix()` (L119-135): Float seconds conversion
  - `from_unix_nano()`/`to_unix_nano()` (L138-152): Nanosecond precision conversion
- **DateTime integration**:
  - `from_datetime()`/`to_datetime()` (L154-168): Python datetime conversion with UTC handling
- **Standard methods**: `__eq__`, `__ne__`, `__hash__`, `__repr__` for object behavior

## Dependencies
- `collections.namedtuple`: Base for ExtType
- `datetime`: UTC timezone and datetime conversion
- `struct`: Binary packing/unpacking for timestamp serialization

## Architecture Notes
- **Dual implementation support**: Comments indicate Cython optimization available, falling back to pure Python methods
- **MessagePack timestamp spec compliance**: Implements official timestamp extension (code -1) with variable-length encoding
- **Immutability**: Both classes designed as immutable value types with validation
- **Precision handling**: Careful bit manipulation for 32/64/96-bit timestamp formats based on value ranges

## Critical Constraints
- ExtType codes limited to 0-127 range
- Nanoseconds must be < 1 billion for valid time representation
- Timestamp encoding automatically selects minimal byte representation
- Negative timestamps supported with specific nanosecond handling semantics