# packages/adapter-rust/vendor/codelldb/linux-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/rich/_win32_console.py
@source-hash: 3f4bf12367dc9ddc
@generated: 2026-02-09T18:01:04Z

## Primary Purpose
Windows Console API wrapper providing ctypes-based bindings for legacy Windows console operations. Windows-only module that enables direct manipulation of console screen buffer, cursor positioning, text attributes, and console properties through Win32 API calls.

## Key Components

### Platform Check & Setup (L9-13)
- Enforces Windows-only import with `sys.platform == "win32"` check
- Raises `ImportError` on non-Windows platforms
- Initializes `windll` using `ctypes.LibraryLoader(ctypes.WinDLL)`

### Core Constants (L22-25)
- `STDOUT = -11`: Standard output handle identifier
- `ENABLE_VIRTUAL_TERMINAL_PROCESSING = 4`: Console mode flag
- `COORD = wintypes._COORD`: Coordinate structure alias

### Custom Types & Structures

**WindowsCoordinates (L32-53)**: NamedTuple for (row, col) coordinates
- Prevents Windows API's (y, x) vs standard (x, y) confusion
- `from_param()` classmethod enables automatic ctypes conversion to COORD

**CONSOLE_SCREEN_BUFFER_INFO (L56-63)**: ctypes Structure for buffer information
- Fields: screen size, cursor position, attributes, window rect, max window size

**CONSOLE_CURSOR_INFO (L66-67)**: ctypes Structure for cursor properties
- Fields: cursor size, visibility flag

### Win32 API Function Wrappers (L70-327)
All functions follow pattern: private ctypes binding → public Python wrapper

**GetStdHandle (L77-86)**: Retrieve standard device handles
**GetConsoleMode (L94-113)**: Get console input/output mode, raises `LegacyWindowsError` on failure
**FillConsoleOutputCharacter (L127-154)**: Write character repeatedly to console buffer
**FillConsoleOutputAttribute (L168-192)**: Set character attributes for multiple cells
**SetConsoleTextAttribute (L203-216)**: Set text color attributes for subsequent output
**GetConsoleScreenBufferInfo (L227-240)**: Retrieve console buffer information
**SetConsoleCursorPosition (L251-263)**: Move cursor to specific coordinates
**GetConsoleCursorInfo/SetConsoleCursorInfo (L274-310)**: Cursor visibility/size management
**SetConsoleTitle (L318-327)**: Set console window title

### LegacyWindowsTerm Class (L330-574)
Main abstraction layer for Windows console operations.

**Color Mapping (L342-359)**: `ANSI_TO_WINDOWS` array maps ANSI color codes to Windows console color values
- Includes bright variants and detailed bit-field comments

**Initialization (L361-373)**:
- Stores console handle, default text attributes
- Extracts default foreground/background colors from current attributes
- Delegates `write`/`flush` to provided file object

**Properties**:
- `cursor_position` (L376-383): Returns current cursor coordinates
- `screen_size` (L386-395): Returns console buffer dimensions

**Text Output**:
- `write_text()` (L397-404): Direct text output without formatting
- `write_styled()` (L406-443): Renders Rich Style objects to Windows console attributes
  - Handles color downgrading, bold/dim effects, reverse video
  - Uses ANSI→Windows color mapping

**Cursor Management**:
- `move_cursor_to()` (L445-453): Absolute positioning with bounds checking
- `move_cursor_up/down/forward/backward()` (L494-546): Relative movement with wrapping
- `move_cursor_to_column()` (L527-534): Horizontal positioning
- `hide/show_cursor()` (L548-558): Cursor visibility control

**Line Operations**:
- `erase_line/end_of_line/start_of_line()` (L455-492): Clear line content using fill operations

**Utility**:
- `set_title()` (L560-567): Window title with 255-character limit assertion
- `_get_cursor_size()` (L569-573): Internal cursor size retrieval

### Demo Script (L576-662)
Comprehensive test suite demonstrating all functionality:
- Color output testing with various Rich styles
- Cursor movement with visual feedback and timing
- Line erasing operations with cursor position indicators

## Dependencies
- `ctypes`: Win32 API bindings
- `pip._vendor.rich.color.ColorSystem`: Color system enumeration
- `pip._vendor.rich.style.Style`: Text styling abstraction

## Architectural Notes
- Consistent error handling pattern: private ctypes functions + public wrappers with validation
- WindowsCoordinates provides type safety for coordinate handling
- Color conversion pipeline: Rich Style → ANSI codes → Windows console attributes
- Maintains console state (default colors) for proper restoration after styled output