# packages/adapter-rust/vendor/codelldb/linux-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/requests/sessions.py
@source-hash: ca44c8f145864a5b
@generated: 2026-02-09T18:00:56Z

## Primary Purpose

Core session management module for the requests library providing persistent settings, connection pooling, cookie management, and HTTP redirect handling across requests.

## Key Classes and Functions

### Utility Functions
- `merge_setting()` (L61-88): Merges request-level and session-level settings, handling dictionary merging and None value cleanup
- `merge_hooks()` (L91-103): Special merge logic for request/session hooks to prevent breaking session hooks when request hooks are empty
- `preferred_clock` (L55-58): Platform-specific timing function selection (perf_counter on Windows, time on others)

### SessionRedirectMixin (L106-354)
Mixin providing comprehensive HTTP redirect handling capabilities:

- `get_redirect_target()` (L107-125): Extracts redirect URL from response Location header with UTF-8 encoding fixes
- `should_strip_auth()` (L127-157): Security logic determining when to strip Authorization header during redirects (different hosts, schemes, ports)
- `resolve_redirects()` (L159-280): Core redirect resolution generator handling redirect chains with proper cookie/auth management
- `rebuild_auth()` (L282-300): Intelligently manages authentication during redirects, stripping/reapplying credentials
- `rebuild_proxies()` (L302-331): Re-evaluates proxy configuration for redirected requests, handles Proxy-Authorization header
- `rebuild_method()` (L333-353): HTTP method transformation during redirects per RFC specs and browser behavior

### Session (L356-817)
Main session class inheriting from SessionRedirectMixin:

**Initialization & State** (L390-449):
- Manages persistent settings: headers, auth, proxies, hooks, params, verify, cert, cookies
- Default adapters for http/https protocols
- `__attrs__` (L375-388): Serializable attributes list

**Core Request Methods**:
- `prepare_request()` (L457-498): Merges request with session settings, creates PreparedRequest
- `request()` (L500-591): Main request method - creates Request, prepares it, sends via adapter
- HTTP method shortcuts: `get()`, `post()`, `put()`, `patch()`, `delete()`, `head()`, `options()` (L593-671)

**Request Execution**:
- `send()` (L673-748): Sends PreparedRequest through appropriate adapter, handles timing, hooks, cookies, redirects
- `get_adapter()` (L781-792): URL-to-adapter matching based on registered prefixes

**Configuration Management**:
- `merge_environment_settings()` (L750-779): Merges environment variables (proxies, CA bundles) with session settings
- `mount()` (L799-808): Register connection adapters with prefix-based routing
- `close()` (L794-797): Cleanup method closing all adapters

**Context Management** (L451-455): Support for `with` statement usage

### session() (L819-831)
Deprecated factory function for backwards compatibility.

## Key Dependencies

- **Internal**: `_internal_utils`, `adapters.HTTPAdapter`, `auth`, `cookies`, `exceptions`, `hooks`, `models`, `utils`
- **External**: `collections.OrderedDict`, `datetime.timedelta`, standard library modules

## Architectural Patterns

- **Mixin Pattern**: SessionRedirectMixin separates redirect logic from main Session class
- **Adapter Pattern**: Pluggable transport adapters registered by URL prefix
- **Context Manager**: Session supports resource cleanup via context management
- **Settings Inheritance**: Request-level settings override session defaults with intelligent merging

## Critical Invariants

- Adapter prefixes sorted by length (descending) for proper URL matching
- Cookie persistence across requests within session scope  
- Authentication stripping on cross-domain redirects for security
- Connection pooling maintained per adapter instance
- Redirect limit enforcement to prevent infinite loops