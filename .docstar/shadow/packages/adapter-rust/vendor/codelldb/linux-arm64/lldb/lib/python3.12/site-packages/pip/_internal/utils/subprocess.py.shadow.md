# packages/adapter-rust/vendor/codelldb/linux-arm64/lldb/lib/python3.12/site-packages/pip/_internal/utils/subprocess.py
@source-hash: 12cbea4918923071
@generated: 2026-02-09T18:00:38Z

**Purpose:** Subprocess execution utilities for pip's internal operations, providing secure command handling with redaction support, spinner integration, and comprehensive logging.

**Core Types:**
- `CommandArgs` (L14): Type alias for `List[Union[str, HiddenText]]` - command argument list supporting secret redaction
- `HiddenText`: Imported type for arguments containing sensitive data (passwords, tokens)

**Key Functions:**

**Command Construction & Formatting:**
- `make_command(*args)` (L17-31): Flattens mixed string/HiddenText/list arguments into unified CommandArgs
- `format_command_args(args)` (L34-46): Shell-quotes arguments for display, automatically redacting HiddenText values
- `reveal_command_args(args)` (L49-53): Extracts raw unredacted values for actual subprocess execution

**Core Subprocess Execution:**
- `call_subprocess(cmd, **kwargs)` (L56-221): Main subprocess runner with comprehensive error handling
  - **Parameters:** command, output control (`show_stdout`, `stdout_only`), environment manipulation (`extra_environ`, `unset_environ`), error handling (`on_returncode`, `extra_ok_returncodes`)
  - **Logging Strategy:** DEBUG/VERBOSE by default, INFO if `show_stdout=True`
  - **Output Modes:** Combined stdout/stderr (default) or separate streams (`stdout_only=True`)
  - **Error Handling:** Configurable via `on_returncode` - raise `InstallationSubprocessError`, warn, or ignore
  - **Spinner Integration:** Shows progress spinner when subprocess output not visible to user

**Factory Function:**
- `runner_with_spinner_message(message)` (L224-244): Creates subprocess runner with pre-configured spinner message, compatible with BuildBackendHookCaller API

**Key Dependencies:**
- `pip._internal.exceptions.InstallationSubprocessError`: Exception for subprocess failures
- `pip._internal.cli.spinners`: Progress indication during long operations  
- `pip._internal.utils.misc.HiddenText`: Secure string handling for sensitive data
- `pip._vendor.rich.markup`: Rich text formatting for enhanced logging

**Architecture Patterns:**
- **Security-First Design:** Automatic redaction of sensitive arguments in logs/display while preserving them for execution
- **Adaptive Logging:** Dynamic log level selection based on user verbosity settings
- **Conditional UI Feedback:** Spinner shown only when subprocess output hidden from user
- **Flexible Error Handling:** Configurable response to subprocess failures (raise/warn/ignore)

**Critical Behavior:**
- Environment isolation: Copies `os.environ`, applies modifications, unsets specified variables
- Stream handling: `stderr` redirected to `stdout` by default unless `stdout_only=True`
- Process cleanup: Ensures proper stream closure and process termination
- Output preservation: Captures all output for error reporting even when not displayed live