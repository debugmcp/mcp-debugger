# packages/adapter-rust/vendor/codelldb/linux-arm64/lldb/lib/python3.12/site-packages/pip/_internal/locations/_distutils.py
@source-hash: 1fd6472bfdf9add0
@generated: 2026-02-09T18:00:26Z

## Purpose
Provides distutils-based package installation scheme resolution for pip. Handles determining where packages, scripts, headers, and data should be installed across different installation modes (user, home, prefix) while working around setuptools injection issues.

## Architecture
The module follows a two-layer design pattern:
1. **Core scheme resolution**: `distutils_scheme()` (L35-112) - directly interfaces with distutils
2. **Abstraction layer**: `get_scheme()` (L115-147) - returns pip's internal Scheme objects

## Key Functions

### `distutils_scheme()` (L35-112)
Core function that creates a distutils Distribution object and extracts installation paths. Key behaviors:
- Handles setuptools shim removal via `_distutils_hack.remove_shim()` (L13)
- Creates Distribution with isolation support (`--no-user-cfg`)
- Manages mutually exclusive installation modes (user vs prefix vs home)
- Applies special virtualenv header path logic (L93-111)
- Handles `install_lib` override from setup.cfg (L85-91)

### `get_scheme()` (L115-147)
Public API that wraps `distutils_scheme()` and returns pip's standardized Scheme object. Maps distutils scheme keys to Scheme constructor parameters.

### Platform-specific utilities:
- `get_bin_prefix()` (L150-164) - Returns platform-appropriate binary directory (Scripts on Windows, bin on Unix, special handling for macOS system installs)
- `get_purelib()` (L167-168) - Returns pure Python library directory
- `get_platlib()` (L171-172) - Returns platform-specific library directory

## Dependencies
- **distutils**: Core installation scheme logic
- **pip._internal.models.scheme**: Target Scheme abstraction
- **pip._internal.utils.compat**: Platform detection (WINDOWS)
- **pip._internal.utils.virtualenv**: Virtual environment detection

## Critical Behaviors
1. **Setuptools conflict resolution**: Removes injected setuptools shim to ensure clean distutils usage
2. **Mutually exclusive modes**: Enforces constraints between user/home/prefix options via assertions (L71-72)
3. **Virtualenv header handling**: Custom header path construction in virtual environments (L100-106)
4. **Config file encoding**: Graceful handling of malformed config files with encoding errors (L58-63)
5. **Root path rebasing**: Proper handling of root installation with drive letter stripping on Windows (L108-110)