# packages/adapter-rust/vendor/codelldb/linux-arm64/lldb/lib/python3.12/site-packages/pip/_internal/metadata/importlib/_envs.py
@source-hash: f001a88db7fb122f
@generated: 2026-02-09T17:57:44Z

## Purpose
Implements importlib-based Python package environment discovery for pip's internal metadata system. Provides distribution finding and environment management capabilities that bridge modern importlib.metadata with legacy pkg_resources for backward compatibility.

## Key Classes and Functions

**_DistributionFinder (L34-147)**: Core distribution discovery engine with memoization to ensure single distribution per package name (setuptools compatibility). Key methods:
- `find()` (L74-84): Discovers distributions in directories/ZIP archives
- `find_linked()` (L86-108): Processes .egg-link files for development installations  
- `find_eggs()` (L134-146): Handles legacy .egg format discovery using pkg_resources fallback

**Environment (L159-189)**: Main environment abstraction implementing BaseEnvironment interface:
- `default()` (L164-165): Creates environment from sys.path
- `from_paths()` (L167-171): Creates environment from custom path list
- `_iter_distributions()` (L173-181): Orchestrates distribution discovery across all paths
- `get_distribution()` (L183-189): Retrieves specific distribution by canonical name

**Helper Functions**:
- `_looks_like_wheel()` (L24-31): Validates wheel file format and structure
- `_emit_egg_deprecation()` (L149-156): Cached deprecation warning for .egg usage

## Architecture Patterns

**Memoization Strategy**: _DistributionFinder uses `_found_names` set to prevent duplicate distributions, respecting precedence order in sys.path.

**Hybrid Metadata Backend**: Primarily uses importlib.metadata but falls back to pkg_resources for legacy .egg support, with deprecation warnings.

**Error Resilience**: Gracefully handles BadMetadata exceptions and zipimport errors, logging warnings but continuing discovery.

## Dependencies
- importlib.metadata: Primary metadata backend
- pip._vendor.pkg_resources: Legacy .egg support fallback
- pip._internal.metadata.base: BaseDistribution/BaseEnvironment abstractions
- pip._internal.utils.deprecation: Deprecation warning system

## Critical Invariants
- Distribution precedence follows sys.path order
- Only first found distribution per normalized name is returned
- Wheel files are excluded from installed distribution discovery
- .egg-link files resolve relative paths against containing directory