# packages/adapter-rust/vendor/codelldb/linux-arm64/lldb/lib/python3.12/site-packages/pip/_internal/metadata/importlib/_compat.py
@source-hash: 1807bfa6b21f084e
@generated: 2026-02-09T17:57:41Z

## Purpose and Responsibility

This compatibility shim module provides utilities for working with `importlib.metadata` in pip's internal metadata handling. It bridges differences between Python versions and provides type-safe abstractions for metadata operations while working around importlib.metadata's private implementation details.

## Key Classes and Functions

**BadMetadata (L5-11)**: Custom exception for metadata parsing errors. Stores the problematic distribution and reason for failure. Used when metadata validation fails during package introspection.

**BasePath (L14-32)**: Protocol defining common interface for path objects used by importlib.metadata. Unifies `pathlib.Path` and `zipfile.Path` types to avoid Union type complications in older linter setups. Only includes `name` and `parent` properties that are needed by pip's codebase.

**get_info_location (L34-43)**: Retrieves the filesystem path to a distribution's metadata directory by accessing importlib.metadata's private `_path` attribute. Returns `Optional[BasePath]` since not all distributions exist on disk. Explicitly documented as a hack to avoid larger codebase refactoring.

**get_dist_name (L46-55)**: Safely extracts distribution project name with type validation. Uses `cast(Any, dist).name` to work around mypy limitations for Python 3.10+ features. Raises `BadMetadata` if the name is not a string.

## Dependencies and Relationships

- Imports `importlib.metadata` for distribution introspection
- Uses `typing` for Protocol definition and type casting
- Part of pip's internal metadata abstraction layer
- Designed to be consumed by higher-level metadata handling code

## Architectural Decisions

- Uses Protocol instead of Union types for path abstraction due to linter constraints
- Accepts technical debt with private attribute access (`_path`) to avoid major refactoring
- Implements defensive programming with explicit type validation in `get_dist_name`
- Maintains compatibility shim pattern to isolate version-specific behaviors