# packages/adapter-rust/vendor/codelldb/linux-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/idna/core.py
@source-hash: 972869a1edafba51
@generated: 2026-02-09T18:00:39Z

## Purpose and Responsibility
Core implementation of Internationalized Domain Names in Applications (IDNA) encoding/decoding, providing RFC 5891 compliant domain name processing with Unicode normalization, bidirectional text validation, and Punycode conversion.

## Key Classes and Exceptions
- **IDNAError (L12-14)**: Base exception for all IDNA processing errors
- **IDNABidiError (L17-19)**: Raised when bidirectional text requirements fail
- **InvalidCodepoint (L22-24)**: Raised for disallowed or unallocated codepoints
- **InvalidCodepointContext (L27-29)**: Raised when codepoints are invalid in context

## Core Functions

### Validation Functions
- **valid_label_length (L49-52)**: Validates label length ≤ 63 characters
- **valid_string_length (L55-58)**: Validates domain length ≤ 253/254 characters
- **check_bidi (L61-117)**: Comprehensive bidirectional text validation implementing RFC 5893 rules
- **check_initial_combiner (L120-123)**: Prevents labels starting with combining marks
- **check_hyphen_ok (L126-131)**: Validates hyphen placement restrictions
- **check_nfc (L134-136)**: Ensures Unicode NFC normalization

### Context Validation
- **valid_contextj (L139-184)**: Validates CONTEXTJ codepoints (ZWJ 0x200C, ZWNJ 0x200D)
- **valid_contexto (L186-225)**: Validates CONTEXTO codepoints with script-specific rules

### Label Processing
- **check_label (L228-252)**: Comprehensive label validation orchestrating all checks
- **alabel (L255-271)**: Converts Unicode label to ASCII-compatible encoding (A-label)
- **ulabel (L274-300)**: Converts A-label back to Unicode (U-label)

### Domain Processing
- **uts46_remap (L303-332)**: UTS46 character remapping with transitional/non-transitional modes
- **encode (L335-365)**: Full domain encoding to ASCII with dot handling
- **decode (L368-395)**: Full domain decoding from ASCII to Unicode

## Helper Functions
- **_combining_class (L32-37)**: Gets Unicode combining class for codepoint
- **_is_script (L39-40)**: Checks if character belongs to specific script
- **_punycode (L42-43)**: Punycode encoding wrapper
- **_unot (L45-46)**: Formats codepoint as U+XXXX notation

## Dependencies
- **idnadata module**: Contains codepoint classes, joining types, and script ranges
- **intranges**: Efficient codepoint range checking
- **uts46data**: UTS46 processing tables
- **unicodedata**: Unicode character properties and normalization

## Key Constants
- **_virama_combining_class = 9 (L8)**: Virama combining class for Indic scripts
- **_alabel_prefix = b'xn--' (L9)**: Punycode A-label prefix
- **_unicode_dots_re (L10)**: Regex matching various Unicode dot characters

## Architecture Notes
- Follows RFC 5891 IDNA2008 specification with UTS46 compatibility
- Implements strict validation pipeline: NFC → hyphen → combiner → codepoint → bidi
- Supports both strict (ASCII dots only) and lenient (Unicode dots) processing
- Handles edge cases like trailing dots, empty labels, and length limits
- Uses bisect for efficient UTS46 table lookups on large codepoint ranges