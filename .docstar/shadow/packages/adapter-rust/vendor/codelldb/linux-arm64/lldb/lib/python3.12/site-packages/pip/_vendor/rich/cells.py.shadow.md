# packages/adapter-rust/vendor/codelldb/linux-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/rich/cells.py
@source-hash: 68c9862b80635e18
@generated: 2026-02-09T18:00:57Z

## Purpose
Text cell width calculation module for terminal/console rendering, handling Unicode character display widths including CJK (Chinese/Japanese/Korean) characters and emoji that occupy multiple terminal cells.

## Core Functions

**cached_cell_len(text: str) -> int** (L13-28)
- Cached version that calculates total display cells required for text string
- Uses LRU cache with 4096 entries - can consume significant memory
- Sums individual character cell sizes via get_character_cell_size()

**cell_len(text: str) -> int** (L31-44) 
- Primary function for calculating text display width in terminal cells
- Optimizes by using cache for strings < 512 chars, direct calculation for longer strings
- Avoids memory issues with very large texts by bypassing cache

**get_character_cell_size(character: str) -> int** (L47-57)
- Returns cell width (0, 1, or 2) for single Unicode character
- LRU cached with 4096 entries
- Delegates to _get_codepoint_cell_size() with character's codepoint

**_get_codepoint_cell_size(codepoint: int) -> int** (L60-86)
- Core lookup function using binary search on CELL_WIDTHS table
- Returns 0 for zero-width chars, 1 for normal chars, 2 for wide chars (CJK, emoji)
- Fallback to width 1 if codepoint not found in table

## Text Manipulation Functions

**set_cell_size(text: str, total: int) -> str** (L89-122)
- Truncates or pads text to exact cell width
- Fast path optimization for single-cell-width characters using regex check
- Binary search to find optimal truncation point for mixed-width text
- Handles wide character boundary cases (replaces partial wide char with space)

**chop_cells(text: str, width: int) -> list[str]** (L124-158)
- Splits text into lines that fit within specified cell width
- Character-by-character processing with width tracking
- Performance optimizations: function reference caching, method reference caching

## Key Dependencies
- `CELL_WIDTHS` from `._cell_widths`: Unicode width lookup table for binary search
- `_is_single_cell_widths` regex (L10): Fast detection of ASCII-like characters

## Performance Patterns
- Heavy use of LRU caching to avoid repeated Unicode width calculations
- Method reference caching in tight loops (chop_cells)
- Fast path optimizations for common ASCII text
- Binary search algorithms for both character lookup and text truncation

## Architecture Notes
- Separation of concerns: character-level vs text-level operations
- Configurable caching strategy (cached vs non-cached cell_len variants)
- Handles edge cases like zero-width characters and wide character boundaries