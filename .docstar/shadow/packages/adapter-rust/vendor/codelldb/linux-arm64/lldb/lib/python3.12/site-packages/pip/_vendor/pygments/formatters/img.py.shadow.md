# packages/adapter-rust/vendor/codelldb/linux-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/pygments/formatters/img.py
@source-hash: 6e495876cd77998c
@generated: 2026-02-09T17:57:58Z

## Primary Purpose
Pygments image formatter module that converts source code to pixmap images (PNG, GIF, JPEG, BMP) using Python Imaging Library (PIL). Creates syntax-highlighted visual representations with customizable fonts, colors, and line numbering.

## Key Classes and Components

### FontManager (L60-269)
Core font management system that handles cross-platform font loading and style variants.

**Key Methods:**
- `__init__(font_name, font_size)` (L65-90): Initializes font system, detects platform and loads appropriate fonts
- `_create_nix()` (L106-125): Linux/Unix font loading via fontconfig (`fc-list` command)
- `_create_mac()` (L130-157): macOS font loading from system font directories
- `_create_win()` (L174-211): Windows font loading via registry lookup
- `get_font(bold, oblique)` (L229-252): Returns appropriate font variant based on style flags
- `get_text_size(text)` (L219-227): Measures text dimensions, handles Pillow version compatibility

**Font Style System:**
- Uses `STYLES` dict (L39-44) mapping style names to font variant names
- Supports NORMAL, ITALIC, BOLD, BOLDITALIC styles
- Falls back to NORMAL font for missing variants

### ImageFormatter (L272-640)
Main formatter class that renders syntax-highlighted code to images.

**Initialization (L392-446):**
- Validates PIL availability, raises `PilNotAvailable` if missing
- Parses extensive configuration options (image format, padding, fonts, line numbers, highlighting)
- Creates FontManager instance and calculates character dimensions

**Core Rendering Methods:**
- `format(tokensource, outfile)` (L608-639): Main entry point, orchestrates entire rendering process
- `_create_drawables(tokensource)` (L540-578): Processes tokens into drawable elements, handles text positioning and wrapping
- `_draw_line_numbers()` (L580-589): Generates line number drawables
- `_paint_line_number_bg(im)` (L591-606): Renders line number background and separator

**Positioning System:**
- `_get_text_pos(linelength, lineno)` (L476-480): Calculates character coordinates
- `_get_line_y(lineno)` (L458-462): Calculates line Y coordinates with padding
- `_get_char_x(linelength)` (L470-474): Calculates character X coordinates

**Configuration Options (L279-381):**
Extensive customization via constructor options including image format, fonts, padding, line numbering appearance, and highlighting.

### Format-Specific Subclasses (L645-684)
- `GifImageFormatter` (L645-656): GIF output variant
- `JpgImageFormatter` (L659-670): JPEG output variant  
- `BmpImageFormatter` (L673-684): BMP output variant

Each sets appropriate `default_image_format`, `name`, `aliases`, and `filenames` attributes.

## Dependencies and Imports
- **PIL (Pillow)**: Core dependency for image generation and font rendering (L21-24)
- **Platform Detection**: Uses `sys.platform` for OS-specific font loading
- **External Tools**: Linux version uses `fontconfig` via subprocess (L93-95)
- **Registry Access**: Windows version uses `winreg` for font registry queries (L27-32)

## Architecture Patterns
- **Strategy Pattern**: Platform-specific font loading methods (`_create_win`, `_create_mac`, `_create_nix`)
- **Template Method**: Base `ImageFormatter` with format-specific subclasses
- **Builder Pattern**: Drawable accumulation before final image rendering
- **Fallback Chain**: Font style resolution with graceful degradation

## Critical Constraints
- Requires PIL/Pillow library availability
- Monospace fonts recommended for proper alignment
- Platform-specific font discovery mechanisms
- Memory usage scales with source code length and image dimensions
- Font rendering compatibility across Pillow versions (L224-227)