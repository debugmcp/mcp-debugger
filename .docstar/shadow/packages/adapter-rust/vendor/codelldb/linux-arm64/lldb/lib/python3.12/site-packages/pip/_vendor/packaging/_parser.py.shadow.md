# packages/adapter-rust/vendor/codelldb/linux-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/packaging/_parser.py
@source-hash: b3f4ef4ef0cd2b43
@generated: 2026-02-09T18:00:42Z

## Purpose
Handwritten recursive descent parser for Python dependency specifiers and environment markers, used by pip's packaging infrastructure. Provides structured parsing of requirement strings like `package[extra]>=1.0.0;python_version>="3.8"`.

## Core Architecture

### AST Node Classes (L15-42)
- `Node` (L15-27): Base class with value storage and abstract serialize method
- `Variable` (L29-31): Environment variables in markers (e.g., `python_version`)
- `Value` (L34-36): Quoted string values with quote serialization
- `Op` (L39-41): Operators in marker expressions (==, !=, in, etc.)

### Type Definitions (L44-55)
- `MarkerVar`: Union of Variable or Value nodes
- `MarkerItem`: Tuple representing comparison (var, op, var)
- `MarkerAtom`: Recursive marker expression component
- `MarkerList`: Complete marker expression structure
- `ParsedRequirement`: Final parsed result with name, url, extras, specifier, marker

## Primary Entry Points

### Requirement Parsing (L61-84)
- `parse_requirement(source)` (L61): Main public API
- `_parse_requirement(tokenizer)` (L65): Core parser following grammar:
  `requirement = WS? IDENTIFIER WS? extras WS? requirement_details`

### Marker Parsing (L252-259)
- `parse_marker(source)` (L252): Public API for standalone marker parsing
- `_parse_full_marker(tokenizer)` (L256): Ensures complete consumption

## Parser Implementation

### Requirement Details (L86-134)
`_parse_requirement_details()` handles two forms:
- URL form: `@ URL (WS requirement_marker?)?`
- Specifier form: `specifier WS? (requirement_marker)?`

### Extras Parsing (L157-200)
- `_parse_extras()` (L157): Optional `[extra1,extra2]` syntax
- `_parse_extras_list()` (L176): Comma-separated identifier list

### Version Specifiers (L203-246)
- `_parse_specifier()` (L203): Optional parentheses around version constraints
- `_parse_version_many()` (L220): Comma-separated specifier list with validation

### Marker Expression Parsing (L262-354)
Recursive descent for boolean expressions:
- `_parse_marker()` (L262): Handles `marker_atom (BOOLOP marker_atom)+`
- `_parse_marker_atom()` (L274): Parenthesized expressions or items
- `_parse_marker_item()` (L296): Three-part comparison expressions
- `_parse_marker_var()` (L310): Variables or quoted strings
- `_parse_marker_op()` (L336): Comparison operators including `in`/`not in`

### Utility Functions (L324-333)
- `process_env_var()` (L324): Normalizes environment variable names
- `process_python_str()` (L331): Safely evaluates quoted string literals using ast.literal_eval

## Dependencies
- `._tokenizer`: Tokenizer with DEFAULT_RULES for lexical analysis
- `ast`: For safe string literal evaluation
- `typing`: For type annotations

## Key Patterns
- Extensive use of tokenizer.consume() for optional whitespace handling
- Grammar documented in docstrings using EBNF-like notation
- Error messages include context about expected tokens and parsing state
- Recursive descent with mutual recursion between marker parsing functions