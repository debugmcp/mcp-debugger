# packages/adapter-rust/vendor/codelldb/linux-arm64/lldb/lib/python3.12/site-packages/pip/_internal/metadata/importlib/_dists.py
@source-hash: b01d9e87076acac8
@generated: 2026-02-09T17:57:48Z

## Primary Purpose
Provides importlib-based implementation of distribution metadata handling for pip's internal package management. Acts as an adapter layer between pip's base distribution abstraction and Python's importlib.metadata system, supporting both wheel files and directory-based distributions.

## Key Classes

### WheelDistribution (L36-93)
Custom `importlib.metadata.Distribution` subclass for reading wheel metadata from memory rather than keeping ZipFile handles open. Key features:
- **Constructor (L47-53)**: Takes pre-loaded files mapping and info location
- **from_zipfile() (L55-73)**: Class method to create instance from ZipFile, eagerly loads all metadata files into memory
- **iterdir() (L75-79)**: Provides directory iteration over metadata files
- **read_text() (L81-92)**: Reads metadata file content with UTF-8 decoding and error handling

### Distribution (L95-228)
Main adapter implementing `BaseDistribution` interface. Wraps `importlib.metadata.Distribution` with pip-specific functionality:

**Construction Methods:**
- **from_directory() (L106-110)**: Creates from filesystem directory
- **from_metadata_file_contents() (L112-127)**: Creates from raw metadata bytes using temporary directory
- **from_wheel() (L129-136)**: Creates from wheel file using WheelDistribution

**Core Properties:**
- **location (L138-142)**: Parent directory of metadata location
- **info_location (L144-148)**: Metadata directory path
- **installed_location (L150-154)**: Normalized installation path
- **canonical_name (L168-171)**: Normalized package name using fast directory parsing fallback
- **version/raw_version (L173-179)**: Parsed and raw version strings

**Metadata Access:**
- **_get_dist_name_from_location() (L156-166)**: Fast name extraction from .dist-info/.egg-info directory names
- **read_text() (L193-197)**: File content reading with FileNotFoundError handling
- **iter_distutils_script_names() (L184-191)**: Enumerates distutils scripts (filesystem only)
- **iter_entry_points() (L199-201)**: Returns entry points compatible with BaseEntryPoint
- **_metadata_impl() (L203-209)**: Casts metadata to email.message.Message (workaround for importlib.metadata protocol limitations)
- **iter_provided_extras() (L211-215)**: Extracts and normalizes Provides-Extra metadata
- **iter_dependencies() (L217-228)**: Parses Requires-Dist with marker evaluation for extras

## Key Dependencies
- `importlib.metadata`: Core metadata access
- `pip._vendor.packaging`: Requirement/version parsing and name canonicalization
- `pip._internal.metadata.base`: Base distribution abstractions
- `pip._internal.utils.wheel`: Wheel file parsing utilities
- `._compat`: Compatibility utilities for cross-platform path handling

## Architecture Notes
- **Memory vs Lazy Loading**: WheelDistribution eagerly loads metadata to avoid ZipFile handle management issues
- **Fast Path Optimization**: Uses directory name parsing for package names before falling back to metadata parsing
- **Type Casting Workaround**: Casts importlib.metadata objects to concrete types due to protocol limitations
- **Marker Evaluation**: Handles dependency marker evaluation with proper context for extras
- **Error Handling**: Provides specific exceptions (InvalidWheel, UnsupportedWheel) for wheel-related failures