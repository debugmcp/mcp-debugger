# packages/adapter-rust/vendor/codelldb/linux-arm64/lldb/lib/python3.12/site-packages/pip/_internal/req/req_install.py
@source-hash: dbd2cb078a06e888
@generated: 2026-02-09T18:00:32Z

## Purpose
Core pip requirement representation and installation logic. The `InstallRequirement` class (L64-862) models a package requirement from specification through installation, handling both source distributions and wheels, editable and non-editable packages, with support for both legacy setup.py and modern PEP 517/660 build systems.

## Key Classes

### InstallRequirement (L64-862)
Primary class representing a package requirement with full installation lifecycle management:

**Initialization & State (L71-198)**
- Accepts optional `Requirement` object, link, markers, build options
- Manages editable installations, constraints, extras, user-supplied flags
- Handles both PEP 517 and legacy build configurations
- Sets up source directories for editable packages automatically

**Core Properties (L241-327)**
- `name` (L242-245): Package name from requirement
- `specifier` (L259-262): Version constraints
- `is_direct` (L264-267): Whether specified as direct URL
- `is_pinned` (L269-277): Exact version specification check
- `hashes()` (L301-326): Combines option-based and URL-based hashes

**Build System Management (L503-594)**
- `load_pyproject_toml()` (L503-529): Loads PEP 517/518 configuration
- `prepare_metadata()` (L552-594): Generates metadata via PEP 517 or legacy methods
- `supports_pyproject_editable` (L247-257): Cached property checking PEP 660 support

**Installation Logic (L806-861)**
- `install()` (L806-861): Main installation entry point
- Handles both editable legacy and wheel installations
- Manages installation schemes and user site configurations

**Utility Methods**
- `check_if_exists()` (L426-461): Version compatibility and reinstallation logic
- `ensure_has_source_dir()` (L635-655): Source directory management
- `uninstall()` (L699-723): Package removal with confirmation prompts

## Key Dependencies
- `pip._vendor.packaging`: Requirement parsing, version handling, markers
- `pip._vendor.pyproject_hooks.BuildBackendHookCaller`: PEP 517 build backend interface
- `pip._internal.build_env.BuildEnvironment`: Isolated build environments
- `pip._internal.metadata`: Distribution metadata handling
- `pip._internal.operations.install`: Wheel and editable installation logic

## Architecture Patterns

**State Management**: Complex state tracking through installation phases with flags like `prepared`, `install_succeeded`, `should_reinstall`

**Build System Abstraction**: Unified interface over PEP 517 and legacy build systems, with automatic detection and configuration

**Lazy Loading**: Metadata and build backend initialization deferred until needed

**Path Management**: Careful handling of temporary directories, source directories, and build locations with cleanup

## Critical Invariants
- `req` can be None initially but must be set before installation
- Source directory must exist before metadata preparation or installation
- PEP 517 backend required when `use_pep517=True`
- Editable packages require either PEP 660 support or setup.py/setup.cfg for legacy fallback

## Utility Functions

### check_invalid_constraint_type (L864-889)
Validates constraint requirements, ensuring they follow proper format (name + version specifier only)

### check_legacy_setup_py_options (L901-918)  
Handles deprecation warnings for legacy build options, forces binary package disallowing when present