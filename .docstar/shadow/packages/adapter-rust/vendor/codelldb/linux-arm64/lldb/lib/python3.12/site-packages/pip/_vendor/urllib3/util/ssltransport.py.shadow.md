# packages/adapter-rust/vendor/codelldb/linux-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/urllib3/util/ssltransport.py
@source-hash: 340faee6b313ac31
@generated: 2026-02-09T17:57:56Z

## Purpose
SSL transport wrapper that enables TLS-in-TLS connections by wrapping existing sockets with SSL/TLS encryption using memory BIOs instead of direct socket SSL wrapping.

## Key Components

### SSLTransport Class (L11-221)
Primary SSL transport implementation that mimics socket interface while providing SSL encryption capabilities.

**Constructor** (L44-61):
- Takes socket, ssl_context, optional server_hostname and suppress_ragged_eofs flag
- Creates incoming/outgoing MemoryBIO objects for SSL data buffering
- Wraps BIOs with ssl_context.wrap_bio() to create SSL object
- Performs initial SSL handshake via _ssl_io_loop()

**Core SSL Methods**:
- `_ssl_io_loop()` (L195-221): Central I/O coordination between SSL BIOs and underlying socket
- `_wrap_ssl_read()` (L186-193): SSL read wrapper with EOF handling
- `_validate_ssl_context_for_tls_in_tls()` (L22-42): Static validation for TLS-in-TLS capability

**Socket Interface Methods**:
- `read()`/`recv()` (L72-78): SSL-encrypted data reading
- `send()`/`sendall()` (L89-103): SSL-encrypted data transmission  
- `recv_into()` (L80-87): Buffer-based SSL reading
- `makefile()` (L105-148): Creates file-like object for buffered I/O

**SSL Information Methods** (L156-175):
- Certificate, cipher, protocol negotiation details
- Wraps corresponding sslobj methods

**Socket Delegation** (L177-184):
- Timeout operations, file descriptor access
- Direct delegation to underlying socket

## Architecture Patterns

**Memory BIO Pattern**: Uses ssl.MemoryBIO for incoming/outgoing data buffering, enabling SSL over any transport without direct socket SSL binding.

**I/O Loop Pattern**: `_ssl_io_loop()` handles SSL state machine by:
1. Attempting SSL operation
2. Sending outgoing BIO data to socket
3. Reading socket data into incoming BIO on SSL_ERROR_WANT_READ
4. Repeating until operation completes

**Socket Interface Mimicry**: Implements socket-compatible interface enabling drop-in replacement for SSL-enabled applications.

## Dependencies
- `ssl` module for SSL/TLS operations and MemoryBIO
- `socket` module for SocketIO and underlying transport
- `..exceptions.ProxySchemeUnsupported` for TLS-in-TLS validation errors
- `..packages.six` for Python 2/3 compatibility

## Constants
- `SSL_BLOCKSIZE = 16384` (L8): Buffer size for socket reads during SSL operations

## Key Invariants
- SSL context must support wrap_bio() method for TLS-in-TLS
- All socket operations with flags parameter reject non-zero flags
- Suppress ragged EOFs by default to handle common SSL termination patterns