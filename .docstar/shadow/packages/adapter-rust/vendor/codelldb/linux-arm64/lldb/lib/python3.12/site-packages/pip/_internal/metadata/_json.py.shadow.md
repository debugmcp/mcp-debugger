# packages/adapter-rust/vendor/codelldb/linux-arm64/lldb/lib/python3.12/site-packages/pip/_internal/metadata/_json.py
@source-hash: 3f470026b1ff9ad9
@generated: 2026-02-09T18:00:18Z

**Purpose**: Converts Python package metadata from RFC 5322 Message format to JSON-compatible dictionaries. Part of pip's internal metadata handling system, extracted from pfmoore/pkg_metadata.

**Core Components**:

- `METADATA_FIELDS` (L7-34): Canonical list of Python package metadata field definitions, each tuple containing field name and boolean indicating if multiple values are allowed (follows PEP 314/345/566 standards)
- `json_name()` (L37-38): Utility function that normalizes field names for JSON by converting to lowercase and replacing hyphens with underscores
- `msg_to_json()` (L41-84): Main conversion function that transforms email.message.Message objects into JSON dictionaries
  - `sanitise_header()` (L44-58): Nested helper that handles email header encoding issues, specifically dealing with "unknown-8bit" encoding by attempting UTF-8 fallback to latin1

**Key Behaviors**:
- Handles both single-value and multi-value metadata fields based on METADATA_FIELDS configuration
- Special handling for "keywords" field (L71-77): accepts both comma-separated and space-separated formats for backward compatibility
- Processes message payload as description field if present (L80-82)
- Robust encoding handling for international characters in headers

**Dependencies**:
- `email.header` and `email.message` for RFC 5322 message parsing
- Standard typing annotations for type safety

**Architectural Notes**:
- Pure transformation layer with no side effects
- Designed for pip's metadata processing pipeline
- Maintains compatibility with legacy metadata formats while providing modern JSON interface