# packages/adapter-rust/vendor/codelldb/linux-arm64/lldb/lib/python3.12/site-packages/pip/_internal/network/lazy_wheel.py
@source-hash: d8f5d576e6193c23
@generated: 2026-02-09T18:00:27Z

## Purpose
Implements lazy loading of ZIP files over HTTP using range requests to minimize data transfer. Specifically designed for pip's wheel package metadata extraction without downloading entire wheel files.

## Core Classes

### HTTPRangeRequestUnsupported (L19-20)
Custom exception raised when HTTP servers don't support byte range requests.

### LazyZipOverHTTP (L40-210)
File-like object that lazily downloads ZIP content over HTTP using range requests. Implements the file protocol methods required by Python's ZipFile class.

**Key Methods:**
- `__init__(L49-63)`: Validates server supports range requests via HEAD request, initializes temporary file
- `_check_zip(L153-166)`: Downloads chunks from end of file backwards until valid ZIP structure found
- `_download(L200-210)`: Core download logic using bisection to merge overlapping ranges
- `_merge(L178-198)`: Optimizes download ranges by merging overlapping/adjacent intervals
- `_stream_response(L168-176)`: Creates HTTP GET request with Range header

**File Protocol Methods:**
- Standard I/O methods (read L88-100, seek L106-114, tell L116-118, etc.)
- Context manager support (`__enter__`/`__exit__` L134-139)

## Key Functions

### dist_from_wheel_url (L23-37)
Main entry point that creates a BaseDistribution from a wheel URL by:
1. Using LazyZipOverHTTP to access wheel metadata
2. Wrapping in MemoryWheel for pip's distribution system
3. Canonicalizing package names

## Architecture Patterns

**Range Request Optimization:** Uses bisection search (L203-204) and interval merging to minimize HTTP requests by combining adjacent/overlapping ranges.

**Lazy Loading Strategy:** Only downloads ZIP central directory and requested file portions, dramatically reducing bandwidth for metadata-only operations.

**Temporary File Management:** Uses NamedTemporaryFile as backing store, truncated to full file size but only populated with actually-requested ranges.

## Dependencies
- `pip._internal.metadata`: Distribution and wheel handling
- `pip._internal.network.session`: HTTP session management  
- `pip._vendor.requests`: HTTP client functionality
- `zipfile`: ZIP file format validation and parsing

## Critical Constraints
- Requires HTTP servers supporting "Accept-Ranges: bytes" header
- Assumes ZIP files have valid central directory at end (standard ZIP format)
- Temporary file must remain open during ZipFile object lifetime
- Range requests cached with "no-cache" directive (L175)