# packages/adapter-rust/vendor/codelldb/linux-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/urllib3/util/retry.py
@source-hash: 67a5847f9d7c7933
@generated: 2026-02-09T17:58:09Z

## urllib3 Retry Configuration Module

**Primary Purpose:** Implements sophisticated HTTP request retry logic with configurable backoff strategies, error categorization, and deprecation management for urllib3's connection pooling system.

### Core Components

**RequestHistory namedtuple (L26-28):** Immutable data structure tracking retry metadata including method, URL, error, status code, and redirect location for each retry attempt.

**_RetryMeta metaclass (L35-89):** Manages deprecated attribute aliases with warning emission:
- `DEFAULT_METHOD_WHITELIST` → `DEFAULT_ALLOWED_METHODS` (L37-52)
- `DEFAULT_REDIRECT_HEADERS_BLACKLIST` → `DEFAULT_REMOVE_HEADERS_ON_REDIRECT` (L55-70)
- `BACKOFF_MAX` → `DEFAULT_BACKOFF_MAX` (L73-88)

**Retry class (L92-617):** Main retry configuration object with immutable-style updates. Each retry attempt creates a new instance with decremented counters.

### Key Methods

**`__init__` (L243-302):** Constructor handling parameter validation and deprecated `method_whitelist` parameter conversion. Sets defaults for retry counts, backoff behavior, and header handling.

**`new` (L304-338):** Factory method creating new Retry instances with updated parameters while preserving existing configuration. Handles deprecated parameter compatibility.

**`from_int` (L340-352):** Class method for backward compatibility, converting integer retry counts to full Retry objects.

**`get_backoff_time` (L354-369):** Calculates exponential backoff delay using formula: `backoff_factor * (2 ** (consecutive_errors - 1))`, capped at `DEFAULT_BACKOFF_MAX` (120 seconds).

**`parse_retry_after` (L371-392):** Parses HTTP Retry-After headers supporting both delta-seconds format and HTTP-date format, with timezone handling for Python 2 compatibility.

**`sleep` (L418-432):** Orchestrates retry delays, respecting server Retry-After headers when `respect_retry_after_header=True`, falling back to exponential backoff.

**`increment` (L504-596):** Core retry logic that categorizes errors and decrements appropriate counters:
- Connection errors (L540-545): DNS, socket connection failures
- Read errors (L547-552): Timeouts, protocol errors after request sent
- Redirects (L559-565): HTTP 3xx responses with Location header
- Status errors (L567-575): HTTP status codes in `status_forcelist`
- Other errors (L554-557): Uncategorized failures

### Error Classification

**Connection vs Read Errors:** Critical distinction for retry safety:
- `_is_connection_error` (L434-440): Pre-request failures safe to retry
- `_is_read_error` (L442-446): Post-request failures requiring method idempotency check

**Method Retryability (L448-466):** Validates HTTP method against `allowed_methods` (default: HEAD, GET, PUT, DELETE, OPTIONS, TRACE).

### Configuration Constants

- `DEFAULT_ALLOWED_METHODS` (L230-232): Idempotent HTTP methods
- `RETRY_AFTER_STATUS_CODES` (L235): Status codes that respect Retry-After (413, 429, 503)
- `DEFAULT_REMOVE_HEADERS_ON_REDIRECT` (L238): Headers stripped on redirect (Cookie, Authorization)
- `DEFAULT_BACKOFF_MAX` (L241): 120-second maximum backoff

### Architectural Patterns

**Immutable Updates:** Each retry creates new instance rather than modifying existing state, enabling safe reuse across requests.

**Deprecation Strategy:** Maintains backward compatibility through metaclass properties and `__getattr__` override (L604-616) while issuing warnings for deprecated usage.

**Error Propagation:** Raises `MaxRetryError` when retry limits exceeded (L591-592), otherwise re-raises original exceptions with preserved stacktraces using `six.reraise`.

**Flexible Configuration:** Supports per-error-type retry limits (connect, read, redirect, status, other) with total retry cap taking precedence.