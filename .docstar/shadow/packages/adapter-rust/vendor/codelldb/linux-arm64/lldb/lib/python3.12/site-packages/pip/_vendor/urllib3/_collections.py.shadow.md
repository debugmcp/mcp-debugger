# packages/adapter-rust/vendor/codelldb/linux-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/urllib3/_collections.py
@source-hash: a72012249856ef07
@generated: 2026-02-09T18:01:10Z

**Purpose:** Implements thread-safe collection classes for urllib3 - a recently used container with LRU eviction and a case-insensitive HTTP header dictionary.

## Key Classes

### RecentlyUsedContainer (L31-105)
Thread-safe LRU cache implementing `MutableMapping` interface. Uses OrderedDict as underlying storage with RLock for thread safety.

**Key Methods:**
- `__init__(maxsize=10, dispose_func=None)` (L47-52): Initializes with size limit and optional disposal callback
- `__getitem__(key)` (L54-59): Thread-safe access that moves item to end (most recent)
- `__setitem__(key, value)` (L61-74): Thread-safe insertion with LRU eviction and disposal callback
- `clear()` (L92-100): Thread-safe clearing with disposal of all values
- `__iter__()` (L87-90): Explicitly disabled due to thread safety concerns

**Thread Safety:** All operations protected by RLock instance (L52). Disposal callbacks executed outside lock to prevent deadlocks.

### HTTPHeaderDict (L107-355)
Case-insensitive HTTP header dictionary implementing RFC 7230 compliance. Headers stored with original casing but accessed case-insensitively.

**Internal Structure:** Uses OrderedDict where keys are lowercased and values are lists `[original_key, value1, value2, ...]`

**Key Methods:**
- `__init__(headers=None, **kwargs)` (L141-150): Supports multiple initialization formats
- `add(key, val)` (L215-229): Appends values without overwriting existing ones
- `extend(*args, **kwargs)` (L231-257): Bulk insertion supporting various input formats
- `getlist(key)` (L259-269): Returns all values for a header as list
- `iteritems()` (L313-318): Iterates all header instances including duplicates
- `itermerged()` (L320-324): Iterates headers with values joined by ", "
- `from_httplib(cls, message)` (L329-355): Class method for Python 2 httplib compatibility

**Special Features:**
- Case-insensitive access while preserving original casing
- Multiple values per header supported (RFC compliant)
- Backwards compatibility aliases for httplib and cookiejar (L289-295)
- HTTP method change preparation (L271-287) removes content-specific headers

## Dependencies
- `collections.OrderedDict` for ordered storage
- `threading.RLock` with fallback no-op implementation for thread-unsafe platforms (L8-16)
- `.exceptions.InvalidHeader` for malformed header validation
- `.packages.six` for Python 2/3 compatibility

## Architecture Patterns
- **Thread Safety:** RecentlyUsedContainer uses RLock; HTTPHeaderDict is not thread-safe
- **Disposal Pattern:** RecentlyUsedContainer supports cleanup callbacks for evicted items
- **Case-Insensitive Storage:** HTTPHeaderDict normalizes keys to lowercase internally
- **RFC Compliance:** HTTPHeaderDict follows RFC 7230 for header handling