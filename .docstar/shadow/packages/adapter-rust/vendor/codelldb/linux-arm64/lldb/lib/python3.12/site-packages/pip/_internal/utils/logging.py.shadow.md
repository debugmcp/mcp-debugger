# packages/adapter-rust/vendor/codelldb/linux-arm64/lldb/lib/python3.12/site-packages/pip/_internal/utils/logging.py
@source-hash: c520df20745fcbde
@generated: 2026-02-09T18:00:34Z

**Primary Purpose**: Comprehensive logging system for pip package installer, providing Rich-enhanced console output, indented log formatting, file rotation, and broken pipe error handling.

**Core Components**:

- **Thread-Safe Indentation System** (L31, L55-71): Uses `threading.local()` storage for per-thread indentation state. `indent_log()` context manager (L55-66) manages hierarchical log indentation, `get_indentation()` (L69-70) retrieves current level.

- **IndentingFormatter** (L73-122): Custom `logging.Formatter` that applies thread-local indentation and optional timestamps. Key methods:
  - `get_message_start()` (L91-105): Adds "WARNING:" or "ERROR:" prefixes based on log level
  - `format()` (L107-121): Applies indentation prefix to each line and optional timestamps

- **Rich Console Integration**:
  - **IndentedRenderable** (L124-137): Dataclass wrapper for Rich renderables with indentation support
  - **RichPipStreamHandler** (L140-197): Custom Rich handler with color-coded output (red for errors, yellow for warnings), handles both rich and plain text records

- **Enhanced File Handling**:
  - **BetterRotatingFileHandler** (L200-203): Extends standard rotating file handler to auto-create directories
  - **MaxLevelFilter** (L206-211): Excludes log records above specified level
  - **ExcludeLoggerFilter** (L214-222): Inverted filter that excludes specific logger hierarchies

- **Error Handling**: 
  - **BrokenStdoutLoggingError** (L35-38): Custom exception for broken pipe scenarios
  - **_is_broken_pipe_error()** (L41-51): Cross-platform broken pipe detection (handles Windows EINVAL/EPIPE differences)

- **Central Configuration** - `setup_logging()` (L225-346): Main entry point that:
  - Maps verbosity levels to Python logging levels (L232-243)
  - Configures complex logging dictionary with multiple handlers:
    - `console`: stdout for info/debug (excludes subprocess and warnings)
    - `console_errors`: stderr for warnings/errors 
    - `console_subprocess`: stderr for subprocess logger only
    - `user_log`: optional file logging with timestamps
  - Returns configured log level number

**Key Dependencies**:
- Rich library for enhanced console output and rendering
- pip internal utilities (_log, compat, deprecation, misc)
- Standard logging with thread-local storage for indentation

**Architecture Patterns**:
- Thread-safe logging with per-thread state management
- Separation of concerns: console vs file logging, subprocess isolation
- Rich integration for enhanced terminal output
- Robust error handling for broken pipe scenarios common in CLI tools

**Global State**:
- `_log_state` (L31): Thread-local storage for indentation
- `subprocess_logger` (L32): Dedicated logger instance for subprocess output