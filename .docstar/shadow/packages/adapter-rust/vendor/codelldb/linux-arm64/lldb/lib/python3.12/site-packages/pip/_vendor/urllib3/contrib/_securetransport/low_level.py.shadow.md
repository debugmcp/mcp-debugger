# packages/adapter-rust/vendor/codelldb/linux-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/urllib3/contrib/_securetransport/low_level.py
@source-hash: 076241076fcd44fd
@generated: 2026-02-09T17:56:58Z

## Purpose
Low-level SecureTransport bindings helper module providing CoreFoundation memory management utilities and certificate handling for macOS SSL/TLS operations. Bridges Python data structures to CoreFoundation objects while ensuring proper memory lifecycle management.

## Key Functions

### Memory Management & Data Conversion
- `_cf_data_from_bytes(bytestring)` (L27-34): Creates CFData from Python bytes, caller must CFRelease
- `_cf_dictionary_from_tuples(tuples)` (L37-56): Converts Python tuple list to CFDictionary 
- `_cfstr(py_bstr)` (L59-70): Creates CFString from Python binary data, requires CFRelease
- `_create_cfstring_array(lst)` (L73-101): Builds CFMutableArray of CFStrings with error handling
- `_cf_string_to_unicode(value)` (L104-126): Extracts Unicode string from CFString for error reporting

### Error Handling
- `_assert_no_error(error, exception_class=None)` (L129-147): Converts Security.framework error codes to Python exceptions using SecCopyErrorMessageString

### Certificate Management
- `_cert_array_from_pem(pem_bundle)` (L150-193): Parses PEM certificate bundle into CFArray of SecCertificateRef objects
- `_is_cert(item)` (L196-201): Type checker for SecCertificateRef
- `_is_identity(item)` (L204-209): Type checker for SecIdentityRef

### Keychain Operations
- `_temporary_keychain()` (L212-244): Creates temporary keychain with random password for credential storage, returns (SecKeychainRef, temp_dir_path)
- `_load_items_from_file(keychain, path)` (L247-299): Imports certificates/identities from file into keychain using SecItemImport
- `_load_client_cert_chain(keychain, *paths)` (L302-374): Loads client certificate chain, creates SecIdentityRef from first certificate if needed

### Protocol Utilities
- `TLS_PROTOCOL_VERSIONS` (L377-383): Maps protocol names to version tuples
- `_build_tls_unknown_ca_alert(version)` (L386-396): Constructs TLS alert record for unknown CA errors

## Dependencies
- External: `base64`, `ctypes`, `itertools`, `os`, `re`, `ssl`, `struct`, `tempfile`
- Internal: `.bindings.CFConst`, `.bindings.CoreFoundation`, `.bindings.Security`

## Key Patterns
- Consistent CFRetain/CFRelease memory management with try/finally blocks
- Error propagation through `_assert_no_error` with Security.framework error messages
- PEM parsing using regex pattern `_PEM_CERTS_RE` (L22-24)
- Temporary keychain strategy for client certificate handling without persistent storage

## Critical Invariants
- All created CoreFoundation objects must be explicitly released by caller
- Keychain deletion required for temporary keychains to prevent resource leaks  
- Certificate arrays maintain proper reference counting during construction
- Error handling converts all Security.framework errors to ssl.SSLError exceptions