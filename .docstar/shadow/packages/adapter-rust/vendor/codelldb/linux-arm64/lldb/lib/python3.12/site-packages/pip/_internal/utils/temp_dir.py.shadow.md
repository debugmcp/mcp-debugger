# packages/adapter-rust/vendor/codelldb/linux-arm64/lldb/lib/python3.12/site-packages/pip/_internal/utils/temp_dir.py
@source-hash: 0d4030db6b85aee4
@generated: 2026-02-09T18:00:33Z

## Primary Purpose
Manages temporary directories for pip package operations with support for global management, cleanup policies, and adjacent directory creation. Provides both context manager and OOP interfaces for temp directory lifecycle management.

## Key Components

### Global Management
- `_tempdir_manager` (L36): Global ExitStack for managing temporary directories across pip operations
- `global_tempdir_manager()` (L40-47): Context manager that establishes global temp directory management scope
- `tempdir_kinds` (L29-33): Enum defining pip-specific temp directory types (BUILD_ENV, EPHEM_WHEEL_CACHE, REQ_BUILD)

### Registry System
- `TempDirectoryTypeRegistry` (L50-67): Manages auto-deletion policies per temp directory type
  - `set_delete()` (L56-60): Configure deletion policy for directory kind
  - `get_delete()` (L62-66): Retrieve deletion policy, defaults to True
- `tempdir_registry()` (L73-83): Context manager providing scoped registry for deletion policies
- `_tempdir_registry` (L69): Global registry instance

### Core Directory Management
- `TempDirectory` (L93-224): Main temporary directory class
  - `__init__()` (L114-147): Creates temp dir with configurable deletion, kind, and global management
  - `path` property (L149-152): Returns directory path, asserts not deleted
  - `_create()` (L171-179): Creates temp directory with realpath resolution and pip-specific prefix
  - `cleanup()` (L181-223): Removes directory with error handling and optional error ignoring
  - `__enter__/__exit__` (L157-169): Context manager support with registry-aware deletion logic

### Adjacent Directory Creation
- `AdjacentTempDirectory` (L226-296): Creates temp directories next to existing directories
  - `LEADING_CHARS` (L246): Character set for generating adjacent directory names
  - `_generate_names()` (L253-276): Algorithm generating filesystem-safe, package-invalid names
  - `_create()` (L278-296): Creates directory adjacent to original, falls back to standard temp creation

## Key Dependencies
- `tempfile.mkdtemp`: Standard temp directory creation
- `pip._internal.utils.misc.rmtree`: Enhanced directory removal with retry logic
- `contextlib.ExitStack`: Resource management for global temp directory tracking

## Architecture Patterns
- **Registry Pattern**: Centralized policy management for temp directory deletion
- **Context Manager Protocol**: Automatic cleanup with customizable policies
- **Global State Management**: Thread-local-style global managers for cross-operation coordination
- **Fallback Strategy**: AdjacentTempDirectory falls back to standard creation if adjacent fails

## Critical Invariants
- Temp directories are globally managed when `globally_managed=True` requires active `_tempdir_manager`
- Path access after cleanup raises assertion error
- Adjacent directories use invalid package names to avoid conflicts
- Cleanup handles both tenacious retry and ignore-errors modes