# packages/adapter-rust/vendor/codelldb/linux-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/pyproject_hooks/_impl.py
@source-hash: eb5189c73422a742
@generated: 2026-02-09T18:00:53Z

## Purpose

This module provides an implementation for calling build backend hooks as defined in PEP 517/PEP 518 Python packaging standards. It serves as a bridge between frontend tools (like pip) and build backends (like setuptools, flit, poetry) by managing subprocess communication and hook execution.

## Core Classes

### BuildBackendHookCaller (L98-330)
Main orchestrator class that wraps build backend hook invocations for a source directory. Manages:
- Subprocess execution with configurable runners
- Backend path validation and normalization  
- Hook method calls with fallback handling
- Error propagation from backend processes

Key constructor parameters:
- `source_dir`: Source directory path
- `build_backend`: Backend spec string (e.g., "setuptools.build_meta")  
- `backend_path`: Additional Python path entries for backend discovery
- `runner`: Subprocess runner function (defaults to `default_subprocess_runner`)
- `python_executable`: Python interpreter path

### Exception Hierarchy (L23-48)
- `BackendUnavailable`: Backend import failed in subprocess
- `BackendInvalid`: Backend module/object validation failed  
- `HookMissing`: Required hook method not found (when no fallback available)
- `UnsupportedOperation`: Backend explicitly declined operation (e.g., sdist not supported)

## Key Methods

### Hook Methods (L151-295)
Standard PEP 517 build backend hooks:
- `_supported_features()` (L151-153): Query optional backend capabilities
- `get_requires_for_build_wheel()` (L155-168): Get wheel build dependencies
- `prepare_metadata_for_build_wheel()` (L170-190): Generate metadata without full build
- `build_wheel()` (L192-213): Build wheel package
- `get_requires_for_build_editable()` (L215-228): Get editable install dependencies
- `prepare_metadata_for_build_editable()` (L230-250): Prepare editable metadata  
- `build_editable()` (L252-274): Build editable wheel
- `get_requires_for_build_sdist()` (L276-284): Get source distribution dependencies
- `build_sdist()` (L286-295): Build source distribution

All hook methods delegate to `_call_hook()` with appropriate parameter marshalling.

### Core Infrastructure

#### `_call_hook()` (L297-330)
Central method that:
1. Sets up environment variables (`PEP517_BUILD_BACKEND`, `PEP517_BACKEND_PATH`)
2. Creates temporary directory for JSON-based IPC
3. Serializes hook arguments to `input.json`  
4. Executes subprocess with in-process script
5. Deserializes results from `output.json`
6. Raises appropriate exceptions based on error conditions

#### `subprocess_runner()` context manager (L133-149)
Temporarily overrides the subprocess runner for specific operations.

## Utility Functions

- `write_json()` (L13-15) / `read_json()` (L18-20): JSON file I/O with UTF-8 encoding
- `default_subprocess_runner()` (L50-59): Standard subprocess execution with environment merging
- `quiet_subprocess_runner()` (L62-71): Silent subprocess execution (captures all output)
- `norm_and_check()` (L74-95): Path validation ensuring relative paths stay within source tree

## Architecture Patterns

**Subprocess Isolation**: All backend operations execute in separate Python processes to avoid import conflicts and ensure clean environments.

**JSON IPC Protocol**: Communication with backend subprocess via JSON files in temporary directories, enabling complex data serialization.

**Configurable Execution**: Runner pattern allows customization of subprocess execution (silent, verbose, custom environments).

**Fallback Mechanisms**: Some hooks (prepare_metadata_for_build_*) support fallback to full build operations when metadata-only generation unavailable.

## Dependencies
- `._in_process`: Provides script path for subprocess execution
- Standard library: `json`, `os`, `sys`, `tempfile`, `contextlib`, `subprocess`

## Critical Invariants
- Backend paths must be relative and resolve within source tree (enforced by `norm_and_check()`)
- All directory paths passed to hooks are converted to absolute paths
- Environment variables `PEP517_BUILD_BACKEND` and `PEP517_BACKEND_PATH` must be set for subprocess
- Temporary directories are automatically cleaned up after hook execution