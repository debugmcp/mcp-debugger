# packages/adapter-rust/vendor/codelldb/linux-arm64/lldb/lib/python3.12/site-packages/pip/_internal/resolution/resolvelib/factory.py
@source-hash: ab334847f62c0b89
@generated: 2026-02-09T17:57:58Z

**Primary Purpose:** Core candidate and requirement factory for pip's resolvelib-based dependency resolver. Bridges pip's internal models with resolvelib's interfaces, managing package candidate discovery, caching, and requirement generation.

**Key Classes:**

- `CollectedRootRequirements` (L89-93): NamedTuple containing requirements, constraints, and user-requested packages for root dependency collection
- `ConflictCause` (L78-81): Protocol for typing conflict cause objects with requirement and parent candidate
- `Factory` (L95-816): Main orchestrator class managing candidate creation, requirement generation, and resolution state

**Factory Core Methods:**

- `__init__` (L96-133): Initializes with PackageFinder, RequirementPreparer, and various caches; builds installed distributions map unless ignored
- `find_candidates` (L390-464): Primary candidate discovery interface - finds installable candidates from index, installed packages, and constraints
- `collect_root_requirements` (L519-559): Processes root InstallRequirements into resolver-compatible requirements and constraints
- `make_requirements_from_spec` (L566-582): Creates requirement objects from specifier strings
- `get_installation_error` (L716-816): Converts resolvelib ResolutionImpossible exceptions into user-friendly InstallationError messages

**Candidate Creation Pipeline:**

- `_make_candidate_from_link` (L177-190): Creates candidates from Links with extras support
- `_make_base_candidate_from_link` (L192-247): Core candidate factory with caching and build failure tracking
- `_make_candidate_from_dist` (L162-175): Creates candidates from already-installed distributions
- `_make_extras_candidate` (L147-160): Wraps base candidates with extra requirements

**Caching Strategy:**
- `_build_failures` (L117): Caches failed builds to avoid retries
- `_link_candidate_cache` (L118): Caches LinkCandidates by Link
- `_editable_candidate_cache` (L119): Separate cache for editable installations
- `_installed_candidate_cache` (L120): Caches installed package candidates
- `_extras_candidate_cache` (L121-123): Caches extras-wrapped candidates by (base_id, extras) tuple

**Candidate Discovery:**

- `_iter_found_candidates` (L249-344): Orchestrates candidate discovery from installed packages and package index
- `iter_index_candidate_infos` (L299-337): Internal function handling yanked package logic per PEP 592
- `_get_installed_candidate` (L275-297): Checks for compatible installed versions

**Requirement Generation:**

- `_make_requirements_from_install_req` (L466-517): Converts InstallRequirements to Requirement objects, handling edge cases like marker mismatches and extras splitting
- `make_requires_python_requirement` (L584-593): Creates Python version requirements

**Error Handling:**

- `_report_requires_python_error` (L642-662): Formats Python version incompatibility errors
- `_report_single_requirement_conflict` (L664-714): Creates detailed error messages for single requirement failures
- `_fail_if_link_is_unsupported_wheel` (L138-145): Validates wheel platform compatibility

**Key Dependencies:**
- Uses resolvelib for dependency resolution framework
- Integrates with PackageFinder for package discovery
- Relies on RequirementPreparer for package preparation
- Uses WheelCache for build artifact caching

**Architecture Notes:**
- Implements bridge pattern between pip internals and resolvelib interfaces
- Uses extensive caching to avoid redundant operations
- Handles complex requirement splitting for extras and constraints
- Manages installed package precedence rules for user vs global site