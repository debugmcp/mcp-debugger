# packages/adapter-rust/vendor/codelldb/linux-arm64/lldb/lib/python3.12/site-packages/pip/_internal/req/req_uninstall.py
@source-hash: ab30c8c49a3e3844
@generated: 2026-02-09T18:00:36Z

## Purpose
Package uninstallation functionality for pip, handling removal of installed Python packages with proper file tracking, safety checks, and rollback capabilities.

## Key Components

### Helper Functions
- `_script_names()` (L21-38): Generates platform-specific script filenames (console/GUI scripts, Windows executables with .exe/.manifest/.py/.pyw variants)
- `_unique()` (L40-52): Decorator ensuring generator yields unique items only
- `uninstallation_paths()` (L54-86): Core path discovery function that reads RECORD files and yields all files to uninstall, including .pyc/.pyo variants
- `compact()` (L88-105): Path compression to minimize directories by removing redundant nested paths
- `compress_for_rename()` (L107-139): Optimizes file operations by identifying when entire directories can be renamed instead of individual files
- `compress_for_output_listing()` (L141-188): Prepares user-friendly display of files to be removed vs skipped

### Main Classes

#### `StashedUninstallPathSet` (L190-293)
Temporary file management during uninstallation with rollback capability.
- `__init__()` (L194-200): Initializes move tracking and temp directory mapping
- `_get_directory_stash()` (L202-214): Creates adjacent temp directories for directory stashing
- `_get_file_stash()` (L216-241): Finds appropriate temp location for individual files
- `stash()` (L243-262): Moves files/directories to temporary locations, handling symlinks as files
- `commit()` (L264-269): Permanently removes stashed files
- `rollback()` (L271-288): Restores all stashed files to original locations

#### `UninstallPathSet` (L295-575)
Main uninstallation orchestrator for a single package.
- `__init__()` (L299-308): Sets up path tracking, permissions, and caching
- `_permitted()` (L310-319): Virtualenv-aware permission checking (allows all in system, prefix-only in venv)
- `add()` (L321-338): Adds files to uninstall set with permission validation and automatic .pyc handling
- `add_pth()` (L340-347): Manages .pth file entry removal
- `remove()` (L349-376): Main uninstallation workflow with user confirmation and progress logging
- `_allowed_to_proceed()` (L378-404): Interactive confirmation with detailed file listing
- `rollback()`/`commit()` (L406-421): Delegates to StashedUninstallPathSet
- `from_dist()` (L423-575): Factory method handling different installation types:
  - Setuptools flat .egg-info installations (L473-500)
  - Legacy distutils installations (L501-502) 
  - Easy_install egg installations (L504-514)
  - Modern .dist-info installations (L516-518)
  - Setuptools editable installs (L520-538)
  - Script removal for console_scripts/gui_scripts (L562-573)

#### `UninstallPthEntries` (L578-633)
Specialized handler for .pth file entry removal with cross-platform path normalization.
- `add()` (L584-597): Normalizes and tracks entries to remove, handling Windows path separators
- `remove()` (L599-624): Modifies .pth files in-place, preserving line endings and handling missing files
- `rollback()` (L626-633): Restores original .pth file content

## Key Dependencies
- BaseDistribution: Package metadata interface
- TempDirectory/AdjacentTempDirectory: Temporary file management
- Various pip utilities for logging, path handling, and platform detection

## Architecture Patterns
- **Stash-and-commit pattern**: Files moved to temp locations before permanent removal for rollback safety
- **Factory pattern**: `UninstallPathSet.from_dist()` handles multiple installation types
- **Permission checking**: Virtualenv-aware safety to prevent system package corruption
- **Path compression**: Multiple optimization strategies to minimize file operations

## Critical Invariants
- All file operations must be reversible until `commit()` is called
- Permission validation prevents removal outside virtual environment prefix
- Cross-platform path handling (Windows vs Unix separators, case sensitivity)
- RECORD file integrity drives standard uninstallation paths