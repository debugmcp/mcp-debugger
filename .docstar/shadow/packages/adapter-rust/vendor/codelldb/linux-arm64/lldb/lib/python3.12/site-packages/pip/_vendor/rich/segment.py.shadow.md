# packages/adapter-rust/vendor/codelldb/linux-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/rich/segment.py
@source-hash: 854d6e79e5ea23a6
@generated: 2026-02-09T18:01:07Z

## Purpose
Core segment rendering system for the Rich library. Defines the fundamental `Segment` class that represents styled text pieces with optional terminal control codes - the final step before ANSI code generation.

## Key Classes

### ControlType (L35-53)
`IntEnum` defining terminal control codes (BELL, CURSOR movements, CLEAR, etc.) that map to ANSI escape sequences.

### Segment (L64-655)
**Primary class** - `NamedTuple` representing a piece of styled text with three fields:
- `text: str` - The text content
- `style: Optional[Style]` - Visual styling information  
- `control: Optional[Sequence[ControlCode]]` - Terminal control sequences

**Key Properties:**
- `cell_length` (L82-89): Returns terminal cell width (0 for control segments)
- `is_control` (L105-107): Checks if segment contains control codes
- `__bool__` (L100-102): True if segment contains text

**Critical Methods:**
- `split_cells()` (L148-168): Splits segment at specified column, handles wide characters
- `_split_cells()` (L109-146): Cached implementation with complex wide-character handling
- `apply_style()` (L176-214): Applies base and post styles to segment iterables
- `filter_control()` (L217-233): Filters segments by control flag
- `split_lines()` (L236-262): Splits segments on newlines into line lists
- `split_and_crop_lines()` (L265-309): Splits and crops to specified length with padding
- `adjust_line_length()` (L312-354): Crops/pads single line to target width
- `simplify()` (L509-533): Combines consecutive segments with same style
- `divide()` (L588-654): Splits segments at specified cut points

**Shape/Alignment Methods:**
- `get_line_length()` (L357-367): Calculates line width in cells
- `get_shape()` (L370-381): Returns (width, height) of line array
- `set_shape()` (L384-417): Adjusts line array dimensions
- `align_top/bottom/middle()` (L420-506): Vertical alignment with padding

**Style Processing:**
- `strip_links()` (L536-550): Removes link styling
- `strip_styles()` (L553-563): Removes all styling
- `remove_color()` (L566-585): Removes color while preserving other styles

### Segments (L657-679)
Simple renderable wrapper around segment iterable with optional newline insertion.

### SegmentLines (L682-704)
Renderable for multiple lines of segments with newline control.

## Dependencies
- `.cells`: Character width calculation functions (`cell_len`, `get_character_cell_size`, etc.)
- `.style`: Style class for text formatting
- `.repr`: Rich representation utilities

## Architecture Notes
- Heavy use of `@lru_cache` on `_split_cells()` for performance
- Optimized fast-path for single-cell width text in `split_cells()`
- Extensive use of generator functions for memory efficiency
- Control segments (non-printable) have special handling throughout
- Wide character support with proper cell width calculations

## Performance Considerations
- Caching used extensively (`_split_cells`, `cached_cell_len`)
- Generator-based processing to avoid memory allocation
- Fast-path optimizations for common cases (single-cell characters)
- Local variable assignment to avoid attribute lookups in tight loops