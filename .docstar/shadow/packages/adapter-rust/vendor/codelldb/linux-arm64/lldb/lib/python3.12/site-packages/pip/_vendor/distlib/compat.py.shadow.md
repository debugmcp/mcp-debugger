# packages/adapter-rust/vendor/codelldb/linux-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/distlib/compat.py
@source-hash: 527fae201bf2d36c
@generated: 2026-02-09T18:00:47Z

## Primary Purpose

Python 2/3 compatibility abstraction layer for the distlib package. Provides unified interfaces for standard library modules that differ between Python versions, along with fallback implementations for missing functionality.

## Key Compatibility Patterns

**Version Detection & Imports (L19-88)**: Core branching logic using `sys.version_info[0] < 3` to conditionally import Python 2 vs 3 modules:
- StringIO, urllib modules, configparser, html parsing, queue, etc.
- Establishes type aliases: `string_types`, `text_type`, `file_type`
- Handles SSL module availability with graceful fallback

**SSL Certificate Validation (L89-186)**: Custom implementation when `ssl.match_hostname` unavailable:
- `CertificateError` exception class (L93-94)
- `_dnsname_match()` function (L96-143) - RFC 6125 compliant DNS name matching with wildcard support
- `match_hostname()` function (L145-185) - Full certificate hostname verification

**Missing Standard Library Backports**:
- `Container` class (L192-198) - Simple namespace replacement for `types.SimpleNamespace`
- `which()` function (L205-266) - Command lookup in PATH with Windows PATHEXT support
- `ZipFile` context manager wrapper (L271-302) - Adds `__enter__`/`__exit__` for Python 2.6
- `python_implementation()` (L308-316) - Detects Python variant (CPython, PyPy, Jython, IronPython)

**Text/Binary Handling (L330-363)**:
- `fsencode()/fsdecode()` functions - Filesystem encoding conversion with fallback to UTF-8
- Handles `sys.getfilesystemencoding()` returning None in containerized environments

**Source Code Analysis (L366-474)**:
- `detect_encoding()` function - PEP 263 compliant source file encoding detection
- `_get_normal_name()` helper (L372-381) - Normalizes encoding names
- Full BOM and encoding cookie parsing with error handling

**HTML Escaping (L476-484)**: Version-appropriate HTML escape/unescape functions

**Advanced Collections (L486-910)**:
- `ChainMap` implementation (L525-627) - Multi-dict view with full MutableMapping interface
- `OrderedDict` implementation (L660-909) - Complete ordered dictionary with linked list backing
- Includes `_recursive_repr` decorator (L495-523) for safe recursive representation

**Utility Functions**:
- `cache_from_source()` (L633-641) - Generates .pyc/.pyo filenames
- `callable()` function (L322-327) - Python 2 compatible callable check

**Configuration Framework (L911-1138)**:
- `BaseConfigurator` class (L1005-1133) - Converts configuration strings to Python objects
- `ConvertingDict/List/Tuple` classes (L931-1003) - Auto-converting containers
- Protocol handlers for `ext://` and `cfg://` string conversion
- `valid_ident()` function (L916-920) - Python identifier validation

## Critical Dependencies

- Standard library modules conditionally imported based on Python version
- Regex patterns for encoding detection and configuration parsing
- Thread-local storage for recursive representation handling

## Architectural Notes

- Extensive use of `try/except ImportError` with `pragma: no cover` for version branching
- Fallback implementations maintain API compatibility with standard library
- Complex linked list implementation in OrderedDict for insertion order preservation
- Protocol-based string conversion system in configurator classes