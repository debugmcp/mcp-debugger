# packages/adapter-rust/vendor/codelldb/linux-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/tomli/_parser.py
@source-hash: 83df8435a00b4be0
@generated: 2026-02-09T18:01:11Z

## Primary Purpose
Core TOML parser implementation for the tomli library. Provides complete TOML document parsing with state management, type conversion, and comprehensive error handling following the TOML specification.

## Key Classes and Data Structures

### TOMLDecodeError (L53-54)
Custom exception for TOML parsing errors, inherits from ValueError.

### Flags (L135-191)  
State management system tracking namespace mutability and creation rules:
- `FROZEN = 0`: Marks immutable namespaces (inline arrays/tables)
- `EXPLICIT_NEST = 1`: Marks explicitly created nests that cannot be reopened
- Methods: `add_pending()` (L148), `finalize_pending()` (L151), `set()` (L164), `is_()` (L175)
- Uses hierarchical flag storage with recursive flag inheritance

### NestedDict (L193-225)
Container for parsed TOML content with namespace navigation:
- `get_or_create_nest()` (L198): Creates nested dictionary structures, handles list access
- `append_nest_to_list()` (L215): Manages array-of-tables syntax
- Core data stored in `self.dict` (L196)

### Output (L227-229)
NamedTuple combining NestedDict and Flags for parser state.

## Core Parser Functions

### Main Entry Points
- `load()` (L57): Parses from binary file, handles encoding detection
- `loads()` (L69): Primary string parser with statement-by-statement processing

### Grammar Rules  
- `create_dict_rule()` (L284): Handles `[table]` syntax
- `create_list_rule()` (L302): Handles `[[array]]` syntax  
- `key_value_rule()` (L323): Processes key=value pairs with namespace validation

### Key Parsing
- `parse_key()` (L373): Handles dotted keys, builds Key tuples
- `parse_key_part()` (L391): Parses individual key components (bare, quoted)

### Value Parsing
- `parse_value()` (L584): Main value dispatcher with type detection priority
- `parse_array()` (L412): Array parsing with nested value handling
- `parse_inline_table()` (L436): Inline table parsing with separate state
- String parsers: `parse_basic_str()` (L552), `parse_literal_str()` (L512), `parse_multiline_str()` (L521)
- `parse_basic_str_escape()` (L468): Escape sequence handling including Unicode

## Key Constants and Character Sets
- `ASCII_CTRL` (L22): Control characters for validation
- `ILLEGAL_*_CHARS` (L26-32): Character validation sets for different contexts
- `TOML_WS*` (L34-35): Whitespace definitions
- `BARE_KEY_CHARS` (L36): Valid bare key characters
- `BASIC_STR_ESCAPE_REPLACEMENTS` (L40): Escape sequence mappings

## Utility Functions
- `skip_chars()` (L232): Efficient character skipping
- `skip_until()` (L241): Skip until delimiter with error checking
- `skip_comments_and_array_ws()` (L275): Complex whitespace/comment handling for arrays
- `suffixed_err()` (L652): Error reporting with source coordinates
- `make_safe_parse_float()` (L673): Decorator ensuring safe float parsing

## Architecture Notes
- Uses position-based parsing (Pos type) for efficient string traversal
- Implements comprehensive TOML specification compliance including edge cases
- Separates namespace flags from data to handle TOML's complex redefinition rules
- Handles multiline strings with proper escape sequence processing
- Provides detailed error messages with line/column coordinates
- Uses frozensets for efficient character membership testing