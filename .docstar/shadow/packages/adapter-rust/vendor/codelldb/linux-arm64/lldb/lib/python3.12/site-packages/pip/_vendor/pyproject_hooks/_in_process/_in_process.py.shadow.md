# packages/adapter-rust/vendor/codelldb/linux-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/pyproject_hooks/_in_process/_in_process.py
@source-hash: 9b66f7e1cf75ec85
@generated: 2026-02-09T17:57:57Z

## Purpose
Subprocess entry point for invoking PEP 517 build backend hooks in isolated environments. Acts as a bridge between the main process and build backends, handling dynamic import, hook execution, and result serialization.

## Core Architecture
**Process Communication (L1-14)**: Uses file-based IPC with JSON serialization. Expects command line args (hook_name, control_dir), environment variables (PEP517_BUILD_BACKEND, PEP517_BACKEND_PATH), and reads input from `control_dir/input.json`, writing results to `control_dir/output.json`.

**Exception Hierarchy (L40-57, L290-298)**: 
- `BackendUnavailable` - Import failures with traceback
- `BackendInvalid` - Security/path validation failures  
- `HookMissing` - Required hooks not implemented
- `GotUnsupportedOperation` - Backend explicitly doesn't support operation

## Backend Management
**Dynamic Loading (`_build_backend`, L66-92)**: Parses `PEP517_BUILD_BACKEND` environment variable as `module:object` spec, dynamically imports backend module, and validates backend loaded from approved paths when `PEP517_BACKEND_PATH` is set.

**Security (`contained_in`, L59-64)**: Path validation utility ensuring backends are loaded from expected directories to prevent malicious code injection.

## Hook Implementations
**Requirements Hooks (L107-133, L276-288)**: 
- `get_requires_for_build_wheel/editable/sdist` - Return build dependencies, gracefully handle missing hooks by returning empty list

**Metadata Preparation (L135-182)**: 
- `prepare_metadata_for_build_wheel/editable` - Extract wheel metadata without full build
- Implements fallback by building actual wheel if hook missing (controlled by `_allow_fallback` parameter)

**Build Hooks (L239-274, L300-307)**:
- `build_wheel/editable` - Create wheel files with optimization to reuse wheels from metadata preparation phase
- `build_sdist` - Create source distributions, handles `UnsupportedOperation` specially

## Wheel Optimization System
**Prebuilt Detection (L217-237, L184)**: Uses `PEP517_ALREADY_BUILT_WHEEL` marker file to identify wheels built during metadata preparation, avoiding duplicate builds.

**Metadata Extraction (`_get_wheel_metadata_from_wheel`, L199-215)**: Fallback implementation that extracts `.dist-info` from built wheels using regex pattern matching.

## Main Entry Point
**Hook Dispatcher (`main`, L322-350)**: Validates hook names against `HOOK_NAMES` whitelist (L309-319), loads input JSON, executes requested hook with exception handling, and serializes results with detailed error information.

## Key Dependencies
- Standard library: `json`, `os`, `sys`, `importlib`, `zipfile`, `glob`
- File operations: JSON serialization utilities (`write_json`/`read_json`, L30-38)
- Dynamic imports: Backend loading and attribute resolution

## Critical Invariants
- All communication via JSON files in control directory
- Backend paths must be validated for security
- Missing optional hooks return sensible defaults (empty lists)
- Wheel reuse optimization maintains build consistency
- Exception information preserved across process boundary