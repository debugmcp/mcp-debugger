# packages/adapter-rust/vendor/codelldb/linux-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/packaging/markers.py
@source-hash: 756292aa7e52a7e8
@generated: 2026-02-09T18:00:43Z

This module implements PEP 508 environment markers for Python packaging, enabling conditional dependency specifications based on platform and Python version characteristics.

## Core Purpose
Provides the `Marker` class for parsing, evaluating, and formatting environment markers used in Python package requirements. Markers allow packages to specify conditional dependencies like `requests; python_version >= "3.6"`.

## Key Classes

**Environment (L49-119)**: TypedDict defining the structure of environment variables available for marker evaluation. Contains platform info (os_name, platform_machine, platform_system), Python version details (python_version, python_full_version, implementation_name), and system identifiers (sys_platform).

**Marker (L260-325)**: Primary class for working with environment markers.
- `__init__(marker: str)` (L261): Parses marker string using `_parse_marker`, stores normalized result in `_markers` attribute
- `evaluate(environment: dict[str, str] | None = None) -> bool` (L301): Evaluates marker against current or provided environment
- String representation methods `__str__` (L286) and `__repr__` (L289)
- Equality/hashing support for marker comparison (L292-299)

## Exception Classes
- **InvalidMarker (L30)**: Raised for malformed marker syntax
- **UndefinedComparison (L36)**: Raised for invalid operations on incompatible types  
- **UndefinedEnvironmentName (L42)**: Raised when referencing non-existent environment variables

## Key Functions

**default_environment() -> Environment (L242-257)**: Constructs environment dictionary from current Python runtime, gathering platform info via `platform` module and Python version data.

**format_full_version(info: sys._version_info) -> str (L234-239)**: Formats Python version info including release level (alpha, beta, etc.).

**_evaluate_markers(markers: MarkerList, environment: dict[str, str]) -> bool (L204-231)**: Core evaluation engine that processes parsed marker AST, handling logical operators (and/or) and comparison operations.

**_eval_op(lhs: str, op: Op, rhs: str) -> bool (L177-189)**: Evaluates individual comparison operations, with special handling for version specifiers via `Specifier` class.

**_normalize_extra_values(results: Any) -> Any (L121-134)**: Normalizes "extra" values in markers using `canonicalize_name` for consistent comparison.

**_format_marker(marker, first: bool | None = True) -> str (L137-162)**: Recursively formats parsed marker AST back to string representation, handling nested structures and parentheses.

## Dependencies
- `._parser`: Provides AST types (`MarkerAtom`, `MarkerList`, `Op`, `Value`, `Variable`) and `parse_marker` function
- `._tokenizer`: Provides `ParserSyntaxError` for parsing failures
- `.specifiers`: Version comparison via `Specifier` and `InvalidSpecifier`  
- `.utils`: Name canonicalization via `canonicalize_name`

## Architecture Notes
- Markers are parsed into recursive list/tuple AST structure representing logical expressions
- Evaluation uses short-circuit boolean logic with proper operator precedence
- Extra names are normalized per PEP 685 for consistent comparison
- Handles both version specifiers (`>=`, `<`, etc.) and string operations (`in`, `not in`)
- Environment merging allows override of default system detection

## Operator Support
The `_operators` dict (L165-174) defines supported comparison operators: `in`, `not in`, `<`, `<=`, `==`, `!=`, `>=`, `>`. Version operators delegate to `Specifier` for PEP 440 compliance.