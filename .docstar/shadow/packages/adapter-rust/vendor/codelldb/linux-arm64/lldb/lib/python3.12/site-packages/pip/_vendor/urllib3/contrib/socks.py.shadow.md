# packages/adapter-rust/vendor/codelldb/linux-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/urllib3/contrib/socks.py
@source-hash: 6918bd7965e8f591
@generated: 2026-02-09T17:57:52Z

## Purpose
SOCKS proxy support for urllib3, providing connection classes and pool managers that route HTTP/HTTPS traffic through SOCKS4, SOCKS4A, and SOCKS5 proxies. Requires PySocks dependency.

## Key Components

### Connection Classes
- **SOCKSConnection (L75-141)**: Plain HTTP connection via SOCKS proxy
  - Inherits from HTTPConnection
  - `__init__` (L80-82): Extracts `_socks_options` parameter
  - `_new_conn` (L84-140): Creates connection through `socks.create_connection()`, handles timeouts and proxy errors
  - Converts socket errors to urllib3 exceptions (ConnectTimeoutError, NewConnectionError)

- **SOCKSHTTPSConnection (L147-148)**: HTTPS connection via SOCKS proxy
  - Multiple inheritance from SOCKSConnection and HTTPSConnection
  - No additional implementation - relies on parent classes

### Connection Pools
- **SOCKSHTTPConnectionPool (L151-152)**: HTTP connection pool using SOCKSConnection
- **SOCKSHTTPSConnectionPool (L155-156)**: HTTPS connection pool using SOCKSHTTPSConnection

### Proxy Manager
- **SOCKSProxyManager (L159-215)**: Main entry point for SOCKS proxy functionality
  - Inherits from PoolManager
  - `pool_classes_by_scheme` (L165-168): Maps HTTP/HTTPS to respective SOCKS pool classes
  - `__init__` (L170-214): 
    - Parses proxy URL to determine SOCKS version and settings
    - Extracts credentials from URL or parameters
    - Maps schemes: `socks5`/`socks5h` → SOCKS5, `socks4`/`socks4a` → SOCKS4
    - Sets remote DNS flag (`rdns`) for `socks5h` and `socks4a` schemes
    - Passes SOCKS options to connection pools via `_socks_options`

## Dependencies
- **PySocks** (socks module): Required dependency with fallback warning (L43-58)
- **urllib3 core**: HTTPConnection, HTTPSConnection, connection pools, PoolManager
- **Standard library**: socket, ssl (optional)

## SOCKS Protocol Support
- **SOCKS4**: Basic IPv4 support (`socks4://`)
- **SOCKS4A**: SOCKS4 + domain name support (`socks4a://`)
- **SOCKS5**: Full protocol support (`socks5://` for local DNS, `socks5h://` for remote DNS)
- **Authentication**: Username/password for SOCKS5, userid for SOCKS4

## Error Handling
- Socket timeouts → ConnectTimeoutError
- Proxy errors → NewConnectionError with detailed messages
- Missing PySocks dependency → DependencyWarning + ImportError

## Architecture Notes
- Uses composition pattern - SOCKS options passed through connection pool chain
- Leverages existing urllib3 verified/unverified HTTPS connection logic
- Fragment comment (L116) acknowledges brittle error handling approach for PySocks exceptions