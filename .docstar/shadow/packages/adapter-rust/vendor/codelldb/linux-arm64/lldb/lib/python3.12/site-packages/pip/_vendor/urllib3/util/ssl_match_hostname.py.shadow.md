# packages/adapter-rust/vendor/codelldb/linux-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/urllib3/util/ssl_match_hostname.py
@source-hash: 22be1c6551239809
@generated: 2026-02-09T17:57:57Z

## SSL Hostname Verification Module

**Purpose**: Backport of Python 3.3.3's `match_hostname()` function for SSL certificate hostname verification, maintaining compatibility with Python 2.7 while handling modern certificate validation requirements.

### Key Components

**CertificateError (L21-22)**: Custom exception class extending `ValueError` for certificate validation failures.

**_dnsname_match(dn, hostname, max_wildcards=1) (L25-76)**: Core DNS name matching logic implementing RFC 6125 section 6.4.3. Handles wildcard certificates with security restrictions:
- Limits wildcards per fragment (max 1 by default) to prevent DoS attacks
- Supports leftmost-label wildcards only (`*.example.com`)
- Handles internationalized domain names (IDN) with `xn--` prefixes
- Returns regex match result or boolean for exact matches

**_to_unicode(obj) (L79-83)**: Python 2/3 compatibility helper converting byte strings to unicode for `ipaddress` module compatibility. Uses ASCII encoding with strict error handling.

**_ipaddress_match(ipname, host_ip) (L86-95)**: Exact IP address matching function. Handles OpenSSL trailing newlines and uses the optional `ipaddress` module for validation.

**match_hostname(cert, hostname) (L98-159)**: Primary validation function taking SSL certificate dictionary and target hostname:
- First attempts IP address parsing of hostname
- Checks `subjectAltName` entries (DNS and IP Address types)
- Falls back to `commonName` in certificate subject if no SAN entries
- Raises `CertificateError` with descriptive messages on mismatch

### Dependencies & Architecture

- **Standard Library**: `re`, `sys` for regex and Python version detection
- **Optional Dependency**: `ipaddress` module (L13-16) with graceful fallback for Python 2.7 compatibility
- **PSF Licensed**: Code derived from Python standard library

### Critical Constraints

- Wildcard limit enforced for security (L41-48)
- IP address handling requires `ipaddress` module or falls back to DNS-only matching
- Certificate must contain either `subjectAltName` or `commonName` fields
- Hostname parameter cannot be IP address format when validating against DNS entries