# packages/adapter-rust/vendor/codelldb/linux-arm64/lldb/lib/python3.12/site-packages/pip/_internal/network/download.py
@source-hash: ad9adb8ba39d635f
@generated: 2026-02-09T18:00:24Z

**Purpose**: Handles file downloads with progress indicators for pip's package installation system. Provides both single and batch download capabilities with streaming, progress bars, and proper filename handling.

**Key Components**:

- `_get_http_response_size()` (L24-28): Extracts content-length from HTTP response headers, returning None if unavailable
- `_prepare_download()` (L31-70): Core download preparation logic that determines progress bar visibility based on file size (>40KB), cache status, and logging level. Returns chunked response iterator with optional progress renderer
- `sanitize_content_filename()` (L73-77): Security function that strips directory paths from filenames to prevent traversal attacks
- `parse_content_disposition()` (L80-92): Parses Content-Disposition headers to extract proper filenames, with sanitization and fallback to default
- `_get_http_response_filename()` (L95-113): Intelligent filename resolution using Content-Disposition headers, MIME type extension guessing, and URL-based fallbacks
- `_http_get_download()` (L116-120): HTTP GET request handler with streaming enabled, removes URL fragments before download

**Main Classes**:

- `Downloader` (L123-151): Single file downloader that handles HTTP errors, filename resolution, and writes files to disk with progress tracking
- `BatchDownloader` (L154-187): Multi-file downloader with identical per-file logic but yields results as generator for memory efficiency

**Dependencies**:
- `pip._vendor.requests` for HTTP handling
- `pip._internal.cli.progress_bars` for progress rendering
- `pip._internal.network.session.PipSession` for authenticated requests
- `pip._internal.models.link.Link` for URL/link objects

**Architecture Patterns**:
- Callable classes implementing `__call__()` for downloader objects
- Streaming downloads using `CONTENT_CHUNK_SIZE` to manage memory
- Progress bar logic with size thresholds (40KB minimum) and cache detection
- Security-conscious filename handling with path traversal prevention
- Special handling for PyPI file storage domain URLs

**Critical Behaviors**:
- Progress bars only show for files >40KB, non-cached, and when logging level allows
- Files written in binary mode with chunked streaming
- Network errors bubble up after logging with status codes
- Content-Type headers preserved and returned alongside file paths