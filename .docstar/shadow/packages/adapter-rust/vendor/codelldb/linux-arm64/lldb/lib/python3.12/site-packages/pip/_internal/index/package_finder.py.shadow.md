# packages/adapter-rust/vendor/codelldb/linux-arm64/lldb/lib/python3.12/site-packages/pip/_internal/index/package_finder.py
@source-hash: 5c71d09b54e6c38c
@generated: 2026-02-09T18:00:29Z

## Primary Purpose
Core module for finding and selecting Python packages from PyPI and other indexes. Implements the main package discovery, evaluation, and selection logic used by pip to determine which package versions to install.

## Key Classes and Functions

### LinkType (L99-107)
Enum defining different link evaluation results: candidate, different_project, yanked, format_unsupported, format_invalid, platform_mismatch, requires_python_mismatch.

### LinkEvaluator (L109-250)
Evaluates individual package links for installation compatibility.
- `__init__` (L120-156): Takes project name, canonical name, allowed formats, target Python, yanked allowance, and Python requirement settings
- `evaluate_link` (L157-249): Core method returning (LinkType, detail) tuple for a given link. Checks format support, wheel compatibility, Python version requirements, and yanked status

### CandidatePreferences (L326-335) 
Dataclass encapsulating filtering preferences: prefer_binary and allow_all_prereleases flags.

### BestCandidateResult (L337-375)
Container for candidate search results with three lists: all candidates, applicable candidates, and the best candidate. Provides iteration methods.

### CandidateEvaluator (L377-579)
Responsible for filtering and sorting installation candidates based on version specifiers, hashes, and preferences.
- `create` (L383-417): Class method factory with optional target Python and specifier defaults
- `get_applicable_candidates` (L445-479): Filters candidates by version specifier and allowed hashes
- `_sort_key` (L481-548): Complex sorting logic prioritizing allowed hashes, non-yanked packages, binary preference, version, and wheel tag compatibility
- `compute_best_candidate` (L563-578): Main entry point returning BestCandidateResult

### PackageFinder (L581-978)
Main facade class orchestrating package discovery across indexes and local sources.
- `create` (L627-657): Class method factory from SelectionPreferences
- `find_all_candidates` (L799-850): Discovers all available candidates from indexes and local files, with LRU caching
- `find_best_candidate` (L869-890): Returns best candidate matching specifier and hash requirements, with LRU caching  
- `find_requirement` (L892-977): High-level method for InstallRequirement objects, handles upgrade logic and installed version checks

## Key Dependencies
- `pip._vendor.packaging`: Version parsing, specifiers, tags, wheel handling
- `pip._internal.models`: Link, InstallationCandidate, TargetPython, FormatControl data structures
- `pip._internal.index.collector`: LinkCollector for fetching package indexes
- `pip._internal.utils.hashes`: Hash validation support

## Critical Architecture Patterns
- Factory pattern: `create()` class methods provide simplified construction
- Strategy pattern: Separate evaluator classes for links vs candidates
- Caching: LRU cache on expensive network operations (`find_all_candidates`, `find_best_candidate`)
- Tuple-based sorting keys: Complex multi-criteria sorting via tuple comparison

## Important Constraints
- Version compatibility checking against target Python interpreter
- Hash validation when hashes are provided
- Format filtering (binary/source) based on FormatControl settings  
- Yanked package handling per PEP 592
- Wheel tag compatibility checking for platform-specific installations

## Utility Functions
- `_check_link_requires_python` (L52-96): Validates Python version requirements from package metadata
- `filter_unallowed_hashes` (L252-323): Filters candidates based on allowed hash values
- `_find_name_version_sep` (L980-1003): Parses package name/version separator in filenames
- `_extract_version_from_fragment` (L1006-1021): Extracts version string from package filenames