# packages/adapter-rust/vendor/codelldb/linux-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/packaging/metadata.py
@source-hash: 28836e4a4275daef
@generated: 2026-02-09T18:00:50Z

## Python Package Metadata Parser and Validator

**Purpose:** Parses and validates Python package metadata from email-style headers (e.g., from METADATA files in wheels/eggs). Supports metadata versions 1.0-2.3 per PEPs 241, 314, 345, 566, 643, 685.

### Core Components

**Exception Classes:**
- `ExceptionGroup` (L24-46): Backport for Python <3.11 compatibility 
- `InvalidMetadata` (L49-57): Raised for invalid metadata fields, stores field name

**Data Structures:**
- `RawMetadata` (L64-130): TypedDict defining all possible metadata fields across versions. Fields use underscore naming (e.g., `author_email` vs `Author-Email`)
- Field classification sets: `_STRING_FIELDS` (L132), `_LIST_FIELDS` (L149), `_DICT_FIELDS` (L164)

**Email Header Parsing:**
- `parse_email()` (L276-449): Main parser converting email headers to RawMetadata tuple
- `_parse_keywords()` (L169): Splits comma-separated keywords
- `_parse_project_urls()` (L174-211): Converts "label, URL" strings to dict, handles duplicates
- `_get_payload()` (L214-228): Extracts message body with encoding handling
- Header mapping: `_EMAIL_TO_RAW_MAPPING` (L243-272) and reverse `_RAW_TO_EMAIL_MAPPING` (L273)

**Validation System:**
- `_Validator` (L462-635): Generic descriptor for field validation and conversion
  - `__get__()` (L487-512): Cached property access with lazy validation
  - `_invalid_metadata()` (L514-521): Creates formatted InvalidMetadata exceptions
  - Field processors: `_process_metadata_version()` (L523), `_process_name()` (L529), `_process_version()` (L542), etc.
- `Metadata` (L637-804): High-level metadata representation with validated, typed fields

**Key Methods:**
- `Metadata.from_raw()` (L648-703): Creates Metadata from RawMetadata with optional validation
- `Metadata.from_email()` (L705-731): Parses email headers and creates validated Metadata

### Architecture Decisions

**Lenient Parsing:** Parser attempts to handle malformed data gracefully, moving unparseable fields to separate dict rather than failing completely.

**Caching:** _Validator uses instance `__dict__` for caching converted values and removes from `_raw` after processing.

**Metadata Version Handling:** Validates field availability against metadata version (L675-695), ensuring fields aren't used before they were introduced.

**Special Cases:**
- Keywords: Stored as comma-separated string but parsed to list (L400)
- Project URLs: Stored as formatted strings but converted to dict (L411-415)
- Description: Can come from headers OR message body (L421-443)

### Dependencies

- `email.*` modules for RFC-compliant header parsing
- Local modules: `requirements`, `specifiers`, `utils`, `version`
- Type system relies heavily on `typing.TypedDict` and generics

### Critical Constraints

- Required fields: `metadata_version`, `name`, `version` (L459)
- Supported versions: 1.0, 1.1, 1.2, 2.1, 2.2, 2.3 (L456)
- Field availability enforced by metadata version
- Unicode handling with fallback to latin1 for mojibake (L347)