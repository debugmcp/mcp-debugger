# packages/adapter-rust/vendor/codelldb/linux-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/msgpack/
@generated: 2026-02-09T18:16:15Z

## Overall Purpose
This is a complete MessagePack serialization library implementation providing fast, compact binary data serialization/deserialization for Python. MessagePack is a binary format similar to JSON but more space-efficient and type-preserving. The library supports both C extension and pure Python implementations with automatic fallback.

## Key Components and Architecture

**Main Entry Point (`__init__.py`)**
- Central API facade providing high-level functions: `pack()`, `packb()`, `unpack()`, `unpackb()`
- Dynamic implementation loading with priority: environment override → C extension → pure Python fallback
- Compatibility aliases for JSON/pickle-style naming (`load`, `loads`, `dump`, `dumps`)
- Version management and unified exception handling

**Core Implementation (`fallback.py`)**
- Pure Python MessagePack implementation serving as fallback when C extension unavailable
- `Packer` class: Configurable serializer with type detection, recursion limits, and custom object hooks
- `Unpacker` class: Streaming deserializer supporting both file-like objects and manual data feeding
- Platform-specific optimizations (PyPy StringBuilder for faster byte operations)
- Comprehensive buffer management with checkpointing and size limits

**Exception Hierarchy (`exceptions.py`)**
- Specialized error types for unpacking (`UnpackException`, `BufferFull`, `OutOfData`, `FormatError`, `StackError`)
- `ExtraData` exception for handling trailing data in one-shot operations
- Deprecated aliases maintaining backward compatibility with standard Python exceptions

**Extension Type Support (`ext.py`)**
- `ExtType`: Generic wrapper for binary extension data with type codes (0-127)
- `Timestamp`: High-precision timestamp implementation with nanosecond resolution
- MessagePack timestamp specification compliance with variable-length encoding (4/8/12 bytes)
- Integration with Python's datetime system and Unix timestamp formats

## Public API Surface

**Primary Functions**:
- `packb(obj, **kwargs)` → bytes: Serialize object to bytes
- `unpackb(data, **kwargs)` → object: Deserialize bytes to object  
- `pack(obj, stream, **kwargs)`: Serialize object to stream
- `unpack(stream, **kwargs)` → object: Deserialize from stream

**Core Classes**:
- `Packer(**kwargs)`: Reusable serializer with configuration options
- `Unpacker(**kwargs)`: Reusable deserializer with streaming support
- `ExtType(code, data)`: Extension type wrapper
- `Timestamp(seconds, nanoseconds=0)`: High-precision timestamps

**Exception Types**:
- `UnpackException`: Base for unpacking errors
- `ExtraData`: Contains both unpacked data and remaining bytes

## Internal Organization and Data Flow

**Implementation Selection Flow**:
1. Check `MSGPACK_PUREPYTHON` environment variable
2. Try importing C extension (`._cmsgpack`)
3. Fall back to pure Python implementation (`.fallback`)
4. Expose unified API through `__init__.py`

**Serialization Flow**:
1. `packb()` creates temporary `Packer` instance
2. `Packer._pack()` recursively processes objects with type detection
3. Binary headers and data written to internal buffer
4. Buffer contents returned as bytes

**Deserialization Flow**:
1. `unpackb()` creates temporary `Unpacker` instance  
2. `Unpacker._read_header()` parses MessagePack format headers
3. `Unpacker._unpack()` recursively reconstructs objects
4. Custom hooks applied for extension types and objects

## Important Patterns and Conventions

**Graceful Degradation**: C extension preferred but transparent fallback to pure Python ensures broad compatibility

**Streaming Support**: `Unpacker` supports incremental data feeding for network streams and large files

**Type Flexibility**: Configurable handling of Python types (bytes vs strings, lists vs tuples) and custom object serialization through hook system

**Memory Safety**: Built-in limits for nesting depth, string lengths, container sizes, and total data size to prevent DoS attacks

**Extension System**: Standardized mechanism for custom data types through `ExtType` and built-in `Timestamp` support

**Error Handling**: Comprehensive exception hierarchy with structured error information, especially `ExtraData` for partial unpacking scenarios