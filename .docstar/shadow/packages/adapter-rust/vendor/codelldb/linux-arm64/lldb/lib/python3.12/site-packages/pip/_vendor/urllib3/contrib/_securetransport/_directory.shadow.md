# packages/adapter-rust/vendor/codelldb/linux-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/urllib3/contrib/_securetransport/
@generated: 2026-02-09T18:16:15Z

## Overall Purpose and Responsibility

This directory implements urllib3's SecureTransport backend adapter for macOS, providing SSL/TLS functionality using Apple's native Security.framework and CoreFoundation instead of OpenSSL. It serves as a platform-specific SSL backend within urllib3's pluggable crypto system, enabling native macOS SSL capabilities with proper certificate validation and client authentication.

## Key Components and Architecture

The module follows a three-tier architecture:

### 1. Package Structure (`__init__.py`)
- Empty package initializer marking this as a Python module
- Part of urllib3's `contrib/` optional backend system
- Uses underscored naming convention indicating internal/private implementation

### 2. Low-Level Framework Bindings (`bindings.py`)
- **Platform validation**: Enforces macOS-only usage with version checks (10.8+)
- **Security.framework bindings**: Complete ctypes interface to SSL/TLS operations, certificate handling, trust evaluation, and PKCS12 import
- **CoreFoundation bindings**: Memory management, data structures (CFString, CFArray, CFDictionary), and reference counting
- **Comprehensive constants**: SSL/TLS protocol versions, error codes, cipher suites, and trust result codes
- **Graceful fallbacks**: Handles missing functions in older macOS versions (e.g., ALPN support pre-10.12)

### 3. High-Level Helper Layer (`low_level.py`)
- **Memory management utilities**: Safe CoreFoundation object creation/destruction with proper CFRetain/CFRelease lifecycle
- **Certificate processing**: PEM bundle parsing, certificate array construction, and type validation
- **Keychain operations**: Temporary keychain creation for client certificate storage without persistence
- **Error handling**: Converts Security.framework error codes to Python SSL exceptions with descriptive messages
- **Protocol utilities**: TLS version mapping and alert record construction

## Public API Surface and Entry Points

The module doesn't expose a direct public API but provides infrastructure for urllib3's SSL adapter:

- **Certificate handling**: `_cert_array_from_pem()` for processing certificate bundles
- **Client authentication**: `_load_client_cert_chain()` for certificate/key loading
- **Error management**: `_assert_no_error()` for consistent exception handling
- **Memory utilities**: CoreFoundation object creation helpers with automatic cleanup
- **Keychain management**: Temporary credential storage via `_temporary_keychain()`

## Internal Organization and Data Flow

```
urllib3 SSL request → SecureTransport adapter → bindings.py (ctypes) → Security.framework/CoreFoundation
                                            ← low_level.py (helpers) ←
```

1. **Request initiation**: urllib3 detects macOS and selects SecureTransport backend
2. **Framework loading**: `bindings.py` loads Security.framework and CoreFoundation with platform validation
3. **SSL context setup**: Low-level bindings configure SSL contexts, protocols, and cipher suites
4. **Certificate processing**: `low_level.py` helpers convert PEM certificates to CoreFoundation objects
5. **Connection establishment**: SSL handshake using native SecureTransport APIs
6. **Memory cleanup**: Automatic CFRelease handling prevents resource leaks

## Important Patterns and Conventions

### Memory Management
- **Reference counting**: All CoreFoundation objects require explicit CFRelease
- **RAII pattern**: Try/finally blocks ensure cleanup even on exceptions
- **Caller responsibility**: Object creators must handle deallocation

### Error Handling
- **Unified exceptions**: All Security.framework errors convert to `ssl.SSLError`
- **Descriptive messages**: Uses `SecCopyErrorMessageString` for detailed error information
- **Graceful degradation**: Missing features in older macOS versions handled transparently

### Platform Constraints
- **Strict validation**: Hard failure on non-macOS platforms
- **Version requirements**: Enforces macOS 10.8+ with runtime checks
- **Library fallbacks**: Big Sur+ path handling for framework loading

### Security Patterns
- **Temporary storage**: Client certificates stored in ephemeral keychains
- **No persistence**: Credentials automatically cleaned up after use
- **Native validation**: Leverages macOS trust store and certificate validation

This module enables urllib3 to provide native, platform-optimized SSL/TLS functionality on macOS while maintaining compatibility with urllib3's cross-platform SSL abstraction layer.