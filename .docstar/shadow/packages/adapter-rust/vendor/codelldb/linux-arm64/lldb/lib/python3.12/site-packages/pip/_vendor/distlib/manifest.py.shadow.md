# packages/adapter-rust/vendor/codelldb/linux-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/distlib/manifest.py
@source-hash: dea7e6026570c51a
@generated: 2026-02-09T18:00:46Z

## Purpose
File manifest system that builds and filters file lists using glob patterns and MANIFEST.in-style directives. Provides a distutils.filelist replacement with bug fixes for Python distribution packaging.

## Core Class
**Manifest (L38-130)** - Main class managing file discovery and pattern-based filtering
- `__init__(base=None)` (L44-53): Initializes with base directory, sets up file tracking
- `findall()` (L59-84): Recursively discovers all files under base directory using stack-based traversal
- `add(item)` (L86-94): Adds individual file to manifest, handles relative/absolute paths
- `add_many(items)` (L96-103): Bulk add operation
- `sorted(wantdirs=False)` (L105-125): Returns files in directory order, optionally includes parent directories
- `clear()` (L127-130): Resets file collections

## Pattern Processing
**process_directive(directive)** (L132-194) - Processes MANIFEST.in-style commands:
- Supports: include, exclude, global-include, global-exclude, recursive-include, recursive-exclude, graft, prune
- Routes to appropriate internal pattern methods based on action type

**_parse_directive(directive)** (L200-245) - Parses and validates directive syntax:
- Returns tuple: (action, patterns, thedir, dir_pattern)
- Handles default 'include' action when none specified
- Validates argument counts per action type

## Pattern Matching Engine
**_include_pattern(pattern, anchor=True, prefix=None, is_regex=False)** (L247-286)
- Adds files matching pattern to manifest
- `anchor=True`: Pattern must match from base directory
- `prefix`: Restricts matching to files under specific directory
- `is_regex`: Treats pattern as regex instead of glob

**_exclude_pattern(pattern, anchor=True, prefix=None, is_regex=False)** (L288-306)
- Removes matching files from manifest
- Same parameters as _include_pattern
- Modifies self.files in place

**_translate_pattern(pattern, anchor=True, prefix=None, is_regex=False)** (L308-361)
- Converts glob patterns to compiled regex objects
- Handles Python version differences in fnmatch.translate behavior
- Manages prefix and anchor logic for different match types

**_glob_to_re(pattern)** (L363-384)
- Custom glob-to-regex translation
- Prevents '*' and '?' from matching path separators (unlike standard fnmatch)
- Handles platform-specific path separator escaping

## Key Dependencies
- `fnmatch` (L11): Base glob pattern matching
- `os` (L13): File system operations and path handling
- `re` (L14): Regex compilation and matching
- `distlib.util.convert_path` (L19): Cross-platform path conversion
- `distlib.compat.fsdecode` (L18): Filename decoding

## Data Structures
- `self.files` (set): Currently selected files in manifest
- `self.allfiles` (list): All discovered files under base (lazy-loaded)
- `self.base` (str): Absolute base directory path
- `self.prefix` (str): Base directory with trailing separator

## Architecture Notes
- Lazy loading: `allfiles` populated only when needed via `findall()`
- Version compatibility: Special handling for Python 3.2+ fnmatch differences
- Path normalization: Consistent absolute path handling throughout
- Stack-based traversal: Efficient directory walking without recursion
- Regex caching: Compiled patterns reused via `_translate_pattern()`