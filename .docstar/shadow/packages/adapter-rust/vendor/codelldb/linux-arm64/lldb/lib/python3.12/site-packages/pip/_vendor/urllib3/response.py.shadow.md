# packages/adapter-rust/vendor/codelldb/linux-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/urllib3/response.py
@source-hash: 7e60c9005906ef5b
@generated: 2026-02-09T18:01:15Z

## urllib3.response - HTTP Response Handling

Core module for HTTP response processing, content decoding, and streaming in urllib3. Handles decompression, chunked transfer encoding, and connection management.

### Key Components

**Compression Decoders:**
- `DeflateDecoder` (L35-65): Handles deflate/zlib decompression with fallback for raw deflate (without headers)
- `GzipDecoder` (L74-102): Multi-member gzip decompression with state tracking via `GzipDecoderState` (L67-72)
- `BrotliDecoder` (L106-121): Brotli decompression supporting both 'brotlipy' and 'Brotli' packages
- `MultiDecoder` (L123-142): Chains multiple decoders for stacked content encodings per RFC7231

**Core Response Class:**
- `HTTPResponse` (L157-879): Main response container inheriting from `io.IOBase`
  - Backward compatible with `http.client.HTTPResponse`
  - On-demand body loading and decoding
  - Supports streaming, chunked transfer, and connection pooling

### Critical Methods

**Initialization & Setup:**
- `__init__` (L195-261): Configures headers, encoding detection, length calculation, optional preloading
- `_init_length` (L317-367): Determines response length from headers, handles edge cases (HEAD requests, 204/304 status)
- `_init_decoder` (L369-386): Sets up content decoder based on Content-Encoding header

**Content Reading:**
- `read` (L529-599): Primary read method with decode/cache options, handles partial reads and connection cleanup
- `_fp_read` (L481-527): Low-level read with 32-bit integer overflow protection for SSL/pyOpenSSL
- `stream` (L601-626): Generator for chunked reading, auto-detects chunked vs regular streaming
- `read_chunked` (L783-851): Specialized chunked transfer encoding reader

**Connection Management:**
- `release_conn` (L275-280): Returns connection to pool
- `drain_conn` (L282-291): Consumes remaining response data to enable connection reuse
- `_error_catcher` (L425-479): Context manager for exception handling and connection cleanup

**Decoder Operations:**
- `_decode` (L392-412): Applies content decoding with error handling
- `_get_decoder` (L144-154): Factory function selecting appropriate decoder

### Dependencies & Architecture

**Key Imports:**
- Content encoding support: `zlib`, optional `brotli` 
- urllib3 internals: `HTTPHeaderDict`, connection utilities, custom exceptions
- Standard library: `io`, `logging`, `contextlib`

**Design Patterns:**
- Factory pattern for decoder selection
- State machine for gzip multi-member handling  
- Context manager for resource cleanup
- Iterator protocol for line-by-line reading (L864-879)

### Critical Invariants

- Content-Length vs Transfer-Encoding precedence (RFC 7230 compliance)
- Connection lifecycle tied to response consumption
- Decoder state management for streaming scenarios
- Memory-efficient handling of large responses via chunked reading