# packages/adapter-rust/vendor/codelldb/linux-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/cachecontrol/adapter.py
@source-hash: 7c1c8efcf77f10e7
@generated: 2026-02-09T18:00:34Z

## Purpose

HTTP adapter that implements caching functionality for HTTP requests/responses in the pip cachecontrol system. Extends requests.HTTPAdapter to intercept and cache responses based on HTTP cache control semantics.

## Key Components

**CacheControlAdapter (L26-157)** - Main HTTP adapter class that:
- Inherits from requests HTTPAdapter to provide caching layer
- Manages cache storage, controller, and heuristics
- Handles request/response interception for cache operations

### Core Methods

**`__init__` (L29-48)** - Constructor accepting:
- `cache`: Storage backend (defaults to DictCache)
- `cache_etags`: Whether to cache ETags (default True)
- `controller_class`: Cache controller implementation
- `serializer`: Response serialization strategy
- `heuristic`: Cache heuristic rules
- `cacheable_methods`: HTTP methods to cache (default: GET only)

**`send` (L50-78)** - Request interceptor that:
- Checks if request method is cacheable (L65)
- Attempts cache lookup via controller.cached_request (L67)
- Handles zlib decompression errors gracefully (L68-69)
- Adds conditional headers for cache validation (L74)
- Falls back to parent's send method for cache misses

**`build_response` (L80-157)** - Response builder that:
- Applies heuristics before caching (L97-98)
- Handles 304 Not Modified responses with cache updates (L101-120)
- Caches permanent redirects immediately (L123-124)
- Wraps response streams for lazy caching (L128-133)
- Patches chunked response handling (L134-144)
- Invalidates cache for mutating methods (L149-152)
- Adds `from_cache` attribute to responses (L155)

**`close` (L159-161)** - Cleanup method that closes cache and parent adapter

## Dependencies

- **requests.HTTPAdapter**: Base HTTP adapter functionality
- **CacheController**: Core caching logic and HTTP semantics
- **DictCache**: Default in-memory cache implementation
- **CallbackFileWrapper**: Stream wrapper for lazy response caching

## Key Patterns

- **Lazy Caching**: Responses cached only when fully consumed via CallbackFileWrapper
- **Cache Invalidation**: PUT/PATCH/DELETE methods trigger cache deletion for the URL
- **ETag Support**: Automatic conditional request headers for cache validation
- **Error Resilience**: Graceful handling of cache corruption (zlib errors)

## Constants

- `invalidating_methods` (L27): {"PUT", "PATCH", "DELETE"} - HTTP methods that invalidate cache entries
- Default cacheable methods: {"GET"} - Only GET requests cached by default