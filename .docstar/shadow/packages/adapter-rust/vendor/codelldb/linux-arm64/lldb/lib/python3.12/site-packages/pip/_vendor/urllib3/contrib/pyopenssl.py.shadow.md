# packages/adapter-rust/vendor/codelldb/linux-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/urllib3/contrib/pyopenssl.py
@source-hash: 843261e0c87263fa
@generated: 2026-02-09T17:57:57Z

**Purpose**: PyOpenSSL integration module for urllib3 that provides TLS/SSL support with SNI capabilities, particularly targeting Python 2 compatibility. This module is deprecated and scheduled for removal in urllib3 2.x.

**Core Functionality**:
- Monkey-patches urllib3 to replace standard SSL context with PyOpenSSL implementation
- Provides certificate validation and Subject Alternative Name (SAN) extraction
- Handles SSL/TLS connections with better certificate checking than Python 2 defaults

**Key Classes**:

**PyOpenSSLContext (L423-514)**: SSL context wrapper that translates standard library SSLContext interface to PyOpenSSL calls
- `__init__(protocol)` (L430): Initializes with protocol mapping from stdlib to PyOpenSSL
- `wrap_socket()` (L485-514): Creates SSL connections with handshake handling and SNI support
- Properties for `options`, `verify_mode` with automatic translation between stdlib and PyOpenSSL constants
- Certificate management methods: `load_verify_locations()`, `load_cert_chain()`, `set_ciphers()`

**WrappedSocket (L276-421)**: API compatibility wrapper around PyOpenSSL Connection
- `recv()` (L300-323): Handles SSL-specific exceptions, implements timeout and ragged EOF suppression
- `sendall()` (L362-368): Chunked sending with SSL_WRITE_BLOCKSIZE (16K limit)
- `getpeercert()` (L384-396): Returns certificate info with SAN extraction
- Memory management methods `_reuse()`, `_drop()`, `_decref_socketios()` for PyPy compatibility

**Key Functions**:
- `inject_into_urllib3()` (L130-141): Monkey-patches urllib3 with PyOpenSSL backend
- `extract_from_urllib3()` (L143-152): Reverts monkey-patching
- `get_subj_alt_name()` (L223-273): Extracts Subject Alternative Names from certificates
- `_dnsname_to_stdlib()` (L180-220): Converts DNS names with IDNA encoding/decoding
- `_validate_dependencies_met()` (L154-178): Checks cryptography and pyOpenSSL version compatibility

**Dependencies**:
- OpenSSL.crypto, OpenSSL.SSL: Core PyOpenSSL functionality
- cryptography.x509: Certificate parsing and validation
- Conditional imports for Python 2/3 compatibility (_fileobject, backport_makefile)

**Protocol Support**:
- SSL version mapping dictionary `_openssl_versions` (L96-109)
- Certificate verification mode translation `_stdlib_to_openssl_verify` (L112-118)
- Conditional support for SSLv3, TLSv1.1, TLSv1.2 based on availability

**Architecture Notes**:
- Uses monkey-patching approach to integrate with urllib3
- Maintains original urllib3 references for clean reversal
- Handles both binary and text certificate formats
- Implements chunked SSL writing due to OpenSSL 16K write limit
- Platform-specific handling for Python 2/3 makefile differences