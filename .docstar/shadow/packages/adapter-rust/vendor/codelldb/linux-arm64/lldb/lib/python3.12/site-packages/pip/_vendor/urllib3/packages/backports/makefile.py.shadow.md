# packages/adapter-rust/vendor/codelldb/linux-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/urllib3/packages/backports/makefile.py
@source-hash: 9dbcedde2d1a80f5
@generated: 2026-02-09T17:56:52Z

**Purpose**: Provides a backport of Python 3's `socket.makefile()` method for creating file-like objects from socket connections, enabling compatibility with older Python versions or alternative socket implementations.

**Key Function**:
- `backport_makefile()` (L13-51): Core implementation that creates file-like objects from socket-like objects with configurable buffering, encoding, and mode options

**Implementation Details**:
- **Mode Validation** (L19-24): Restricts modes to 'r', 'w', 'b' combinations, determines reading/writing flags and binary mode
- **Socket Wrapping** (L30-31): Creates `SocketIO` wrapper and increments reference counter on the socket object
- **Buffering Logic** (L32-39): Handles buffering parameter with defaults (-1 becomes `io.DEFAULT_BUFFER_SIZE`), validates unbuffered streams must be binary
- **Stream Creation** (L40-46): Creates appropriate buffered stream types:
  - `BufferedRWPair` for read-write mode
  - `BufferedReader` for read-only
  - `BufferedWriter` for write-only
- **Text Wrapping** (L47-51): Wraps binary streams in `TextIOWrapper` when not in binary mode, preserves original mode attribute

**Dependencies**:
- `io` module: For buffer and text wrapper classes
- `socket.SocketIO`: For low-level socket I/O wrapper

**Architecture**: Function designed as a method to be monkey-patched onto socket-like objects, expects `self` parameter to have `_makefile_refs` attribute for reference counting.

**Critical Constraints**:
- Socket object must support `_makefile_refs` attribute
- Unbuffered streams (buffering=0) must be in binary mode
- Mode string limited to combinations of 'r', 'w', 'b' characters