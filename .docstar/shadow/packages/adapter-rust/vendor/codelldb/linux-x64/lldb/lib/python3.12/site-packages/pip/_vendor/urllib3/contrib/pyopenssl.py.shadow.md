# packages/adapter-rust/vendor/codelldb/linux-x64/lldb/lib/python3.12/site-packages/pip/_vendor/urllib3/contrib/pyopenssl.py
@source-hash: 843261e0c87263fa
@generated: 2026-02-09T17:58:11Z

## Purpose
PyOpenSSL integration module for urllib3 that provides TLS/SSL support with SNI (Server Name Indication) capabilities. This deprecated module allows urllib3 to use PyOpenSSL instead of the standard library's ssl module for enhanced TLS functionality, particularly important for Python 2 certificate validation.

## Key Components

### Monkey-Patching Functions
- `inject_into_urllib3()` (L130-141): Replaces urllib3's SSL implementation with PyOpenSSL-backed versions by patching util module attributes
- `extract_from_urllib3()` (L143-152): Reverses the monkey-patching to restore original urllib3 SSL functionality

### Core Classes

#### PyOpenSSLContext (L423-514)
SSL context wrapper that translates standard library SSLContext interface to PyOpenSSL calls:
- `__init__(protocol)` (L430-434): Initializes with protocol mapping from `_openssl_versions`
- `options` property (L436-443): Manages SSL options via PyOpenSSL Context
- `verify_mode` property (L445-451): Maps between stdlib and PyOpenSSL verification modes
- `wrap_socket()` (L485-514): Creates SSL connections with SNI support and handshake handling

#### WrappedSocket (L276-409)
API compatibility wrapper for PyOpenSSL Connection objects:
- `recv()` (L300-323): Handles various OpenSSL exceptions and maps to socket errors
- `recv_into()` (L325-346): Similar error handling for recv_into operations
- `sendall()` (L362-368): Implements chunked sending with SSL_WRITE_BLOCKSIZE (16KB)
- `getpeercert()` (L384-396): Extracts certificate information including subject alt names

### Utility Functions
- `get_subj_alt_name(peer_cert)` (L223-273): Extracts Subject Alternative Names from certificates using cryptography library
- `_dnsname_to_stdlib(name)` (L180-220): Converts DNS names between cryptography and stdlib formats with IDNA encoding
- `_validate_dependencies_met()` (L154-178): Validates required cryptography and PyOpenSSL versions

## Key Dependencies
- OpenSSL.crypto, OpenSSL.SSL: PyOpenSSL bindings
- cryptography.x509: Modern certificate parsing
- urllib3.util: Target module for monkey-patching

## Protocol Mappings
- `_openssl_versions` (L96-109): Maps stdlib SSL protocols to PyOpenSSL methods
- `_stdlib_to_openssl_verify` (L112-117): Certificate verification mode translation
- SSL_WRITE_BLOCKSIZE = 16384 (L121): Maximum write chunk size

## Architecture Notes
- Module is deprecated (warning L82-88) and scheduled for removal in urllib3 2.x
- Maintains Python 2/3 compatibility with conditional imports (L67-71, L411-420)
- Uses monkey-patching approach to transparently replace urllib3's SSL backend
- HAS_SNI always True (L93) since PyOpenSSL supports SNI
- Implements proper PyPy garbage collection support via _makefile_refs tracking