# packages/adapter-rust/vendor/codelldb/linux-x64/lldb/lib/python3.12/site-packages/pip/_vendor/idna/core.py
@source-hash: 972869a1edafba51
@generated: 2026-02-09T18:01:35Z

## Purpose & Responsibility

Core IDNA (Internationalized Domain Names in Applications) implementation providing encoding/decoding of Unicode domain names to/from ASCII-Compatible Encoding (ACE) format using Punycode. Implements RFC 5891 IDNA2008 validation rules and UTS46 character mapping.

## Key Classes & Exceptions

- `IDNAError(UnicodeError)` (L12-14): Base exception for IDNA-related errors
- `IDNABidiError(IDNAError)` (L17-19): Bidirectional text validation failures
- `InvalidCodepoint(IDNAError)` (L22-24): Disallowed/unallocated codepoint usage
- `InvalidCodepointContext(IDNAError)` (L27-29): Context-dependent codepoint violations

## Core Functions

### Primary API Functions
- `encode(s, strict=False, uts46=False, std3_rules=False, transitional=False)` (L335-365): Converts Unicode domain to ASCII-compatible bytes
- `decode(s, strict=False, uts46=False, std3_rules=False)` (L368-395): Converts ASCII domain back to Unicode

### Label Processing
- `alabel(label)` (L255-271): Converts Unicode label to A-label (ASCII form with xn-- prefix)
- `ulabel(label)` (L274-300): Converts A-label back to Unicode U-label
- `check_label(label)` (L228-252): Comprehensive label validation against IDNA rules

### Validation Functions
- `check_bidi(label, check_ltr=False)` (L61-117): Implements bidirectional text rules 1-6
- `check_initial_combiner(label)` (L120-123): Prevents labels starting with combining marks
- `check_hyphen_ok(label)` (L126-131): Validates hyphen placement restrictions
- `check_nfc(label)` (L134-136): Ensures Normalization Form C compliance

### Context Validation
- `valid_contextj(label, pos)` (L139-183): Validates CONTEXTJ codepoints (joiners 0x200C/0x200D)
- `valid_contexto(label, pos, exception=False)` (L186-225): Validates CONTEXTO codepoints with script-specific rules

### Utility Functions
- `uts46_remap(domain, std3_rules=True, transitional=False)` (L303-332): UTS46 character mapping and normalization
- `valid_label_length(label)` (L49-52): 63-character label limit check
- `valid_string_length(label, trailing_dot)` (L55-58): 253/254-character domain limit check

## Important Dependencies

- `unicodedata`: Character properties, normalization, bidirectional info
- `idnadata`: IDNA-specific codepoint classifications and script mappings
- `intranges`: Efficient codepoint range membership testing
- `uts46data`: UTS46 character mapping tables (lazy import)

## Key Constants & Patterns

- `_alabel_prefix = b'xn--'` (L9): Punycode A-label identifier
- `_virama_combining_class = 9` (L8): Sanskrit virama combining class for contextual joiners
- `_unicode_dots_re` (L10): Regex for various Unicode dot separators
- Uses bisect for efficient UTS46 table lookups (L312)

## Critical Invariants

1. All labels must be NFC normalized before processing
2. Bidirectional rules apply only when RTL characters present
3. CONTEXTJ/CONTEXTO codepoints require specific surrounding character validation
4. A-labels must not exceed 63 bytes; full domains limited to 253/254 characters
5. Punycode encoding/decoding is reversible for valid Unicode labels

## Architecture Notes

- Follows fail-fast validation with specific exception types
- Separates concerns: character-level validation, label validation, domain processing
- Supports both strict (ASCII dots only) and permissive (Unicode dots) parsing modes
- UTS46 processing optional for compatibility with older IDNA2003 behavior