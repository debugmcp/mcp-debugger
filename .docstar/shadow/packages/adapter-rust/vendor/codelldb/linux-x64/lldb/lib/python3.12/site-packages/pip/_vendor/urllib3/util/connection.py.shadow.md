# packages/adapter-rust/vendor/codelldb/linux-x64/lldb/lib/python3.12/site-packages/pip/_vendor/urllib3/util/connection.py
@source-hash: e4bc760753d6dbd2
@generated: 2026-02-09T17:58:00Z

## Purpose

urllib3 connection utilities for cross-platform socket connection handling, including connection state detection and socket creation with IPv6/IPv4 support detection.

## Key Components

### Connection State Detection
- **`is_connection_dropped(conn)` (L11-30)**: Platform-aware function to detect dropped HTTP connections by checking socket readability. Returns `False` on AppEngine to delegate connection management to the platform.

### Socket Connection Creation  
- **`create_connection(address, timeout, source_address, socket_options)` (L37-97)**: Enhanced version of Python's standard `socket.create_connection()` with additional socket options support and IPv6 handling. Iterates through `getaddrinfo()` results, attempting connections until success.
- **`_set_socket_options(sock, options)` (L100-105)**: Helper to apply socket-level options via `setsockopt()`.

### IPv6 Support Detection
- **`allowed_gai_family()` (L108-116)**: Returns appropriate address family for `getaddrinfo()` calls - `AF_UNSPEC` if IPv6 is available, otherwise `AF_INET`.
- **`_has_ipv6(host)` (L119-146)**: Runtime IPv6 capability detection by attempting to bind an IPv6 socket. Includes AppEngine-specific early exit.
- **`HAS_IPV6` (L149)**: Module-level constant set by testing IPv6 binding to localhost.

## Dependencies

- `socket`: Core networking primitives
- `..contrib._appengine_environ`: AppEngine platform detection
- `..exceptions.LocationParseError`: URL parsing errors  
- `..packages.six`: Python 2/3 compatibility utilities
- `.wait`: Socket polling utilities (`wait_for_read`, `NoWayToWaitForSocketError`)

## Architectural Patterns

- **Platform abstraction**: Special handling for AppEngine's restricted socket environment
- **Graceful degradation**: Falls back to IPv4-only when IPv6 unavailable
- **Error consolidation**: Collects connection errors across address family attempts
- **Lazy initialization**: IPv6 support detected once at import time