# packages/adapter-rust/vendor/codelldb/linux-x64/lldb/lib/python3.12/site-packages/pip/_vendor/urllib3/connectionpool.py
@source-hash: 05eeaaeb9491f656
@generated: 2026-02-09T18:02:08Z

## urllib3 Connection Pool Implementation

This module implements HTTP connection pooling for urllib3, providing thread-safe connection reuse and management for single-host HTTP/HTTPS requests.

### Core Classes

**ConnectionPool (L69-107)**: Abstract base class defining the interface for all connection pools. Contains host validation and context manager support. Key attributes: `scheme`, `QueueCls` (defaults to LifoQueue), `host`, `port`.

**HTTPConnectionPool (L113-911)**: Main HTTP connection pool implementation extending ConnectionPool and RequestMethods. Manages a queue of reusable HTTP connections with configurable size limits, timeouts, and retry logic.

Key initialization parameters (L177-191):
- `maxsize`: Connection pool size limit (default 1)
- `block`: Whether to block when pool is full
- `timeout`: Socket timeout configuration
- `retries`: Retry policy configuration
- Proxy configuration via `_proxy`, `_proxy_headers`, `_proxy_config`

Core connection management methods:
- `_new_conn()` (L241-260): Creates fresh HTTPConnection instances
- `_get_conn()` (L262-299): Retrieves connection from pool or creates new one
- `_put_conn()` (L301-331): Returns connection to pool or closes if full
- `_validate_conn()` (L332-336): Hook for connection validation before use

**HTTPSConnectionPool (L913-1081)**: HTTPS-specific pool extending HTTPConnectionPool. Adds SSL certificate handling, hostname verification, and proxy tunnel establishment.

SSL-specific attributes (L969-977): `key_file`, `cert_file`, `cert_reqs`, `ca_certs`, `assert_hostname`, `assert_fingerprint`

Key HTTPS methods:
- `_prepare_conn()` (L979-997): Configures SSL settings on VerifiedHTTPSConnection
- `_prepare_proxy()` (L999-1012): Establishes HTTP CONNECT tunnel for HTTPS proxies
- `_validate_conn()` (L1050-1081): Validates SSL connections and issues security warnings

### Primary Request Method

**urlopen()** (L534-910): The main request execution method handling the full request lifecycle:

1. URL parsing and validation (L643-664)
2. Connection acquisition with timeout (L702-704)
3. Proxy tunnel setup if needed (L708-712)
4. Request execution via `_make_request()` (L715-723)
5. Response creation and connection management (L729-741)
6. Exception handling with retry logic (L752-806)
7. Redirect handling (L844-878)
8. Status-based retry logic (L881-908)

### Utility Functions

- **connection_from_url()** (L1083-1108): Factory function creating appropriate pool type from URL
- **_normalize_host()** (L1111-1126): Host normalization for IPv6 bracket handling
- **_close_pool_connections()** (L1129-1137): Drains and closes all pooled connections

### Key Dependencies

- Uses `LifoQueue` for connection pooling (LIFO strategy)
- Integrates with `Timeout` and `Retry` utility classes
- Depends on `HTTPConnection`/`HTTPSConnection` for actual network communication
- Implements comprehensive exception handling for network errors, SSL errors, and proxy issues

### Threading and Safety

The pool is designed for thread-safe operation with blocking/non-blocking modes. Connection state is carefully managed to prevent connection leaks and ensure proper cleanup via weakref finalizers (L239).