# packages/adapter-rust/vendor/codelldb/linux-x64/lldb/lib/python3.12/site-packages/pip/_internal/index/package_finder.py
@source-hash: 5c71d09b54e6c38c
@generated: 2026-02-09T18:01:22Z

## Purpose
Core package discovery and selection logic for pip's index searching. Responsible for finding, evaluating, and selecting the best installation candidate for a given package from PyPI and other indexes.

## Key Classes & Functions

### LinkEvaluator (L109-250)
Evaluates individual links to determine if they are valid installation candidates for a specific project. Key methods:
- `__init__` (L120-156): Configures evaluation criteria including project name, formats, target Python, and yanked package handling
- `evaluate_link` (L157-249): Core evaluation logic returning `(LinkType, detail)` tuple, checking format support, wheel compatibility, Python version requirements

### CandidateEvaluator (L377-579)
Filters and sorts installation candidates based on version specifiers and preferences. Key methods:
- `create` (L383-417): Factory method with sensible defaults
- `get_applicable_candidates` (L445-479): Filters candidates by version specifiers and hash requirements
- `_sort_key` (L481-548): Complex sorting logic prioritizing hash matches, non-yanked packages, binary preference, version, and platform compatibility
- `compute_best_candidate` (L563-578): Returns `BestCandidateResult` with all/applicable/best candidates

### PackageFinder (L581-978)
Main orchestrator class for package discovery. Key methods:
- `create` (L627-657): Factory method accepting `SelectionPreferences`
- `find_all_candidates` (L799-850): Discovers all available candidates from index URLs and find-links, cached with `@functools.lru_cache`
- `find_best_candidate` (L869-890): Returns best candidate matching specifier and hash requirements, cached
- `find_requirement` (L892-977): High-level method handling `InstallRequirement` objects, upgrade logic, and exception raising

### Supporting Classes
- `BestCandidateResult` (L337-375): Container for candidate search results with iteration methods
- `CandidatePreferences` (L326-335): Dataclass for binary/prerelease preferences
- `LinkType` (L99-107): Enum categorizing link evaluation outcomes

## Key Dependencies
- `pip._internal.index.collector.LinkCollector`: Link discovery from indexes
- `pip._internal.models.*`: Core data models (Link, InstallationCandidate, etc.)
- `pip._vendor.packaging.*`: Version parsing, specifiers, wheel tags

## Important Patterns
- **Caching**: `@functools.lru_cache` on expensive operations (`find_all_candidates`, `find_best_candidate`)
- **Factory Methods**: Preferred instantiation via `.create()` methods with defaults
- **Separation of Concerns**: LinkEvaluator for individual links, CandidateEvaluator for collections, PackageFinder for orchestration
- **Explicit Yanked Handling**: No default `allow_yanked` parameter forces explicit decision-making

## Critical Logic
- **Sorting Priority** (L541-548): Hash allowance > yank status > binary preference > version > platform compatibility > build tags
- **File Priority** (L849-850): Local files (`file_candidates`) take precedence over index pages (`page_candidates`)
- **Version Handling**: Complex debundling compatibility logic for version comparisons (L458-471)

## Utility Functions
- `_check_link_requires_python` (L52-96): Python version compatibility checking
- `filter_unallowed_hashes` (L252-323): Hash-based candidate filtering with detailed logging
- `_extract_version_from_fragment` (L1006-1021): Version parsing from filenames