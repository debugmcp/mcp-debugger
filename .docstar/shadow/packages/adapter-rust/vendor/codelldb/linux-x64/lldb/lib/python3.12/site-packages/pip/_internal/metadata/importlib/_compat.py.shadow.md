# packages/adapter-rust/vendor/codelldb/linux-x64/lldb/lib/python3.12/site-packages/pip/_internal/metadata/importlib/_compat.py
@source-hash: 1807bfa6b21f084e
@generated: 2026-02-09T17:57:49Z

## Primary Purpose
Compatibility layer for handling `importlib.metadata` operations in pip's internal metadata processing, providing type-safe access to distribution metadata with cross-version Python compatibility.

## Key Components

### BadMetadata Exception (L5-11)
Custom ValueError subclass for handling malformed distribution metadata. Stores both the problematic distribution object and a descriptive reason string. Used for structured error reporting when metadata parsing fails.

### BasePath Protocol (L14-32) 
Type protocol defining minimal interface for path-like objects. Abstracts over `pathlib.Path` and `zipfile.Path` differences to provide consistent typing. Includes `name` (L26) and `parent` (L30) properties that both path types implement.

### get_info_location Function (L34-43)
Extracts metadata directory path from distribution using private `_path` attribute. Returns Optional[BasePath] since not all distributions exist on disk. Implements documented hack for accessing internal importlib.metadata structure.

### get_dist_name Function (L46-55)
Safe extraction of distribution project name with type validation. Uses cast to Any for accessing `name` attribute (Python 3.10+ feature). Validates return type and raises BadMetadata for invalid entries.

## Dependencies
- `importlib.metadata`: Core metadata inspection
- `typing`: Protocol, cast, type hints for cross-version compatibility

## Architectural Patterns
- **Protocol-based abstraction**: BasePath protocol enables polymorphic path handling
- **Defensive programming**: Type validation in get_dist_name prevents runtime errors
- **Compatibility layer**: Bridges version differences in importlib.metadata API
- **Structured exceptions**: BadMetadata provides context-rich error handling

## Critical Constraints
- Relies on private `_path` attribute (acknowledged technical debt)
- Python 3.10+ name attribute access requires type casting
- Protocol limited to intersection of pathlib.Path and zipfile.Path capabilities