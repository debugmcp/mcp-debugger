# packages/adapter-rust/vendor/codelldb/linux-x64/lldb/lib/python3.12/site-packages/pip/_vendor/platformdirs/windows.py
@source-hash: 205a62a21501c313
@generated: 2026-02-09T18:01:43Z

## Windows Platform Directories Implementation

**Primary Purpose:** Implements Windows-specific directory location logic for the platformdirs library, providing standardized paths for application data, config, cache, and user directories following Microsoft's Windows Shell guidelines.

### Core Architecture

**Main Class:** `Windows` (L16-141) - Concrete implementation of `PlatformDirsABC` providing Windows-specific directory paths using Windows Shell folder constants (CSIDL values).

**Key Dependencies:**
- Inherits from `PlatformDirsABC` (L10) from `.api` module
- Uses Windows Shell API through multiple fallback mechanisms
- Leverages `functools.lru_cache` for performance optimization of folder lookups

### Directory Properties (All Properties Return Normalized Paths)

**Application Data Directories:**
- `user_data_dir` (L28-36): Returns roaming or local AppData based on `self.roaming` flag
- `site_data_dir` (L54-57): System-wide data directory using `CSIDL_COMMON_APPDATA`
- `user_config_dir` (L60-62): Aliases to `user_data_dir` (Windows pattern)
- `site_config_dir` (L65-67): Aliases to `site_data_dir`

**Cache Directories:**
- `user_cache_dir` (L70-76): Local AppData with "Cache" subfolder when opinionated
- `site_cache_dir` (L79-82): Common AppData with "Cache" subfolder when opinionated

**Specialized Directories:**
- `user_state_dir` (L85-87): Aliases to `user_data_dir`
- `user_log_dir` (L90-96): Adds "Logs" subfolder when opinionated
- `user_runtime_dir` (L129-135): Uses Local AppData/Temp for runtime files
- `site_runtime_dir` (L138-140): Aliases to `user_runtime_dir`

**User Media Directories:**
- `user_documents_dir` (L99-101): `%USERPROFILE%\Documents`
- `user_downloads_dir` (L104-106): `%USERPROFILE%\Downloads` 
- `user_pictures_dir` (L109-111): `%USERPROFILE%\Pictures`
- `user_videos_dir` (L114-116): `%USERPROFILE%\Videos`
- `user_music_dir` (L119-121): `%USERPROFILE%\Music`
- `user_desktop_dir` (L124-126): `%USERPROFILE%\Desktop`

### Path Construction Logic

**`_append_parts` Method (L38-51):** Core path building logic that:
1. Handles app author/name hierarchy (author first if specified, then appname)
2. Optionally adds opinion-based subfolder (e.g., "Cache", "Logs")
3. Appends version if specified
4. Creates directory if `ensure_exists` is enabled
5. Returns joined, normalized path

### Windows Folder Resolution Strategy

**Three-Tier Fallback System:**

1. **Primary: `get_win_folder_via_ctypes` (L213-249):** Uses Windows Shell API via ctypes
   - Direct SHGetFolderPathW calls with CSIDL constants (L221-231)
   - Handles Unicode path downgrading for compatibility (L241-244)
   - Special handling for CSIDL_DOWNLOADS (L246-247)

2. **Secondary: `get_win_folder_from_registry` (L183-210):** Registry-based lookup
   - Maps CSIDL names to Shell Folders registry keys (L191-200)
   - Queries `HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\Shell Folders`

3. **Fallback: `get_win_folder_from_env_vars` (L143-161):** Environment variable resolution
   - Maps common CSIDL names to environment variables (L149-153)
   - Falls back to `get_win_folder_if_csidl_name_not_env_var` for user folders (L164-180)

**Dynamic Selection:** `_pick_get_win_folder` (L252-265) chooses the best available method at import time based on available modules (ctypes > winreg > env vars).

**Cached Access:** `get_win_folder` (L268) - LRU cached function providing the selected folder resolution method.

### Critical Design Patterns

- **Fallback Strategy:** Graceful degradation across three folder resolution mechanisms
- **Path Normalization:** All paths normalized using `os.path.normpath`
- **Conditional Directory Creation:** Respects `ensure_exists` flag via `_optionally_create_directory`
- **Opinion-Based Customization:** Adds subfolders like "Cache" and "Logs" when opinion mode enabled
- **Windows-Only Imports:** Dynamic imports of `winreg` and `ctypes` to avoid import errors on non-Windows platforms