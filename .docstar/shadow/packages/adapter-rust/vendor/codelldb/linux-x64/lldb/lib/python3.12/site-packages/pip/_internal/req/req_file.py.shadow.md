# packages/adapter-rust/vendor/codelldb/linux-x64/lldb/lib/python3.12/site-packages/pip/_internal/req/req_file.py
@source-hash: 8670bd3b3fadaea1
@generated: 2026-02-09T18:01:32Z

## Primary Purpose
Requirements file parser for pip that handles parsing requirements.txt and constraints.txt files. Converts file content into structured ParsedRequirement objects with support for pip-specific options, environment variable expansion, line continuation, and nested file inclusion.

## Key Classes & Data Structures

**ParsedRequirement (L87-102)**: Represents a parsed requirement line containing:
- `requirement`: The requirement specification string
- `is_editable`: Whether it's an editable install (-e)
- `comes_from`: Source file and line information
- `constraint`: Whether from constraints file vs requirements file
- `options`: Dict of pip options specific to this requirement
- `line_source`: Human-readable source location

**ParsedLine (L105-130)**: Intermediate representation of a parsed line with:
- File metadata (filename, lineno)
- Parsed options (opts) and constraint flag
- Requirement detection logic that sets `is_requirement`, `is_editable`, and `requirement` fields

**RequirementsFileParser (L319-387)**: Core parsing engine that:
- Handles file content retrieval via PipSession
- Supports recursive parsing for nested -r/-c files
- Manages URL joining for remote requirement files
- Preprocesses content through multiple transformation stages

## Key Functions

**parse_requirements (L132-157)**: Main entry point that orchestrates parsing workflow. Returns generator of ParsedRequirement objects.

**preprocess (L159-168)**: Content transformation pipeline applying:
1. Line enumeration and joining (handles \ continuations)
2. Comment removal and filtering
3. Environment variable expansion (${VAR} format)

**handle_line (L275-317)**: Routes parsed lines to appropriate handlers:
- Requirement lines → `handle_requirement_line` → ParsedRequirement
- Option-only lines → `handle_option_line` → updates finder/session state

**get_line_parser (L389-411)**: Creates line-specific parser factory that builds fresh optparse.OptionParser for each line to avoid state accumulation.

## Critical Configuration

**SUPPORTED_OPTIONS (L49-64)**: Global pip options allowed in requirements files (index-url, find-links, etc.)

**SUPPORTED_OPTIONS_REQ (L67-71)**: Options that apply to individual requirements (global-options, hash, config-settings)

**SUPPORTED_OPTIONS_EDITABLE_REQ (L73-75)**: Subset of options valid for editable requirements

## Important Patterns

**Regex Patterns**:
- `SCHEME_RE (L40)`: Detects http/https/file URLs
- `COMMENT_RE (L41)`: Matches comments for removal
- `ENV_VAR_RE (L47)`: POSIX-compliant environment variables (${VAR})

**Error Handling**: Custom `OptionParsingError (L430-433)` wraps optparse failures, converted to `RequirementsFileParseError` with line context.

**Recursive Processing**: Handles nested requirements files by detecting -r/--requirement and -c/--constraint options, with proper path/URL resolution for relative references.

**State Management**: Updates PackageFinder search scope and PipSession trusted hosts based on parsed options, enabling dynamic configuration during parsing.

## Dependencies
- `pip._internal.cli.cmdoptions`: Command-line option definitions
- `pip._internal.network.session.PipSession`: HTTP session for remote files
- `pip._internal.index.package_finder.PackageFinder`: Package discovery configuration
- `pip._internal.utils.encoding.auto_decode`: Character encoding detection