# packages/adapter-rust/vendor/codelldb/linux-x64/lldb/lib/python3.12/site-packages/pip/_vendor/cachecontrol/heuristics.py
@source-hash: 2187b84261c4456b
@generated: 2026-02-09T18:01:27Z

## Purpose
HTTP cache heuristics module implementing RFC 7234 compliant cache control strategies for pip's cachecontrol system. Provides algorithmic approaches to determine cache expiration times when explicit cache headers are missing or insufficient.

## Key Components

### Core Functions
- `expire_after(delta, date=None)` (L18-20): Calculates future expiration datetime by adding timedelta to current UTC time or provided date
- `datetime_to_header(dt)` (L23-24): Converts datetime objects to RFC-compliant HTTP date format using `formatdate`

### Base Architecture
- `BaseHeuristic` (L27-57): Abstract base class defining the heuristic interface
  - `warning(response)` (L28-37): Returns HTTP 110 warning header for stale responses
  - `update_headers(response)` (L39-46): Override point for subclasses to add cache headers
  - `apply(response)` (L48-57): Main entry point that applies headers and warnings to HTTPResponse

### Heuristic Implementations

#### `OneDayCache` (L60-74)
Simple 1-day cache strategy. Sets `expires` header to 24 hours from response date if not already present. Uses response's existing `date` header as baseline, falling back to current time.

#### `ExpiresAfter` (L77-91) 
Configurable time-based caching accepting any timedelta kwargs. Always sets cache headers regardless of response state. Provides custom warning message including cache duration.

#### `LastModified` (L94-151)
RFC 7234 Section 4.2.2 compliant heuristic using Last-Modified header to calculate reasonable cache lifetime:
- Only applies to specific HTTP status codes (L107-119): 200, 203, 204, 206, 300, 301, 404, 405, 410, 414, 501
- Requires both `date` and `last-modified` headers
- Calculates freshness lifetime as min(10% of age since last-modified, 24 hours) 
- Respects existing cache-control directives
- Returns empty dict if response already expired or conditions not met

## Key Dependencies
- `email.utils` for HTTP date parsing/formatting
- `calendar.timegm` for timestamp conversions  
- `pip._vendor.urllib3.HTTPResponse` for response manipulation

## Architectural Patterns
- Template method pattern in BaseHeuristic with `apply()` orchestrating `update_headers()` and `warning()`
- Strategy pattern allowing different cache heuristics to be plugged in
- Defensive programming with extensive header validation in LastModified

## Critical Constraints
- LastModified limits cache lifetime to maximum 24 hours
- All heuristics respect existing cache headers (won't override expires/cache-control)
- Warning headers follow HTTP 1xx warning code conventions