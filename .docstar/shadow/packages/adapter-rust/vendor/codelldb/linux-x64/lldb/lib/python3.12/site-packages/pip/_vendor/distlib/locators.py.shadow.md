# packages/adapter-rust/vendor/codelldb/linux-x64/lldb/lib/python3.12/site-packages/pip/_vendor/distlib/locators.py
@source-hash: a35aff33cebf6d12
@generated: 2026-02-09T18:01:38Z

**Primary Purpose:** Package distribution locator system for finding and downloading Python packages from various sources (PyPI, local directories, etc.). Part of the distlib library for package management operations.

**Key Classes and Functions:**

**Locator (L89-408)** - Abstract base class for all distribution locators
- `__init__(scheme='default')` (L105): Sets up caching, URL opener with custom redirect handler, error queue
- `get_project(name)` (L174): Cached wrapper around `_get_project()` 
- `_get_project(name)` (L156): Abstract method for subclasses to implement project retrieval
- `locate(requirement, prereleases=False)` (L353): Main entry point - finds best distribution matching requirement
- `score_url(url)` (L191): Ranks URLs by preference (HTTPS > HTTP, PyPI > other, wheel compatibility)
- `convert_url_to_download_info(url, project_name)` (L234): Extracts package info from download URLs

**PyPIRPCLocator (L410-456)** - Uses XML-RPC to query PyPI
- `_get_project(name)` (L432): Fetches releases via RPC calls to get metadata and URLs

**PyPIJSONLocator (L459-525)** - Uses PyPI's JSON API (limited functionality)
- `_get_project(name)` (L474): Fetches project data via JSON endpoint

**SimpleScrapingLocator (L586-834)** - Multi-threaded HTML scraper for package indexes
- `__init__(url, timeout=None, num_workers=10)` (L600): Sets up threading infrastructure
- `_get_project(name)` (L653): Orchestrates multi-threaded page scraping
- `_fetch()` (L729): Worker thread method for fetching and parsing pages
- `get_page(url)` (L762): Retrieves and caches HTML pages with encoding handling

**Page (L528-584)** - HTML page parser for extracting download links
- `links` property (L557): Regex-based link extraction with rel attribute parsing

**DirectoryLocator (L836-900)** - Scans local filesystem for distributions
- `_get_project(name)` (L866): Walks directory tree looking for package files

**AggregatingLocator (L969-1056)** - Chains multiple locators together
- `_get_project(name)` (L1001): Queries locators in sequence, optionally merging results
- `merge` parameter controls whether to combine results from all locators

**DependencyFinder (L1069-1303)** - Resolves dependency trees
- `find(requirement, meta_extras=None, prereleases=False)` (L1195): Main dependency resolution algorithm
- Maintains internal tracking of providers, requirements, and distribution relationships

**Key Dependencies:**
- `.database`: Distribution, DistributionPath, make_dist
- `.metadata`: Metadata, MetadataInvalidError  
- `.wheel`: Wheel compatibility checking
- `.version`: Version scheme handling
- Standard library: threading, urllib, html parsing

**Architecture Patterns:**
- Strategy pattern for different locator implementations
- Template method pattern in base Locator class
- Multi-threaded producer/consumer for web scraping
- Caching layer for both metadata and web pages
- URL preference scoring system for choosing best downloads

**Critical Invariants:**
- All locators return consistent `{'urls': {}, 'digests': {}}` structure
- Thread safety maintained via RLock usage in scraping locator
- Version matching respects scheme-specific comparison rules
- Dependency resolution handles circular dependencies and conflicts

**Global Configuration:**
- `DEFAULT_INDEX = 'https://pypi.org/pypi'` (L39)
- `default_locator` (L1060): Pre-configured scraping locator for PyPI
- `locate` function (L1066): Convenience wrapper around default locator