# packages/adapter-rust/vendor/codelldb/linux-x64/lldb/lib/python3.12/site-packages/pip/_vendor/truststore/
@generated: 2026-02-09T18:16:12Z

## Overall Purpose and Responsibility

The truststore package provides cross-platform SSL/TLS certificate verification using native operating system certificate stores instead of Python's bundled CA certificates. It offers a drop-in replacement for Python's `ssl.SSLContext` that leverages Windows Crypto API, macOS Security framework, and OpenSSL system stores for certificate validation.

## Key Components and Integration

### Entry Point and Public API (`__init__.py`)
- **Version Requirements**: Enforces Python 3.10+ minimum requirement
- **Public Interface**: Exports three core functions:
  - `SSLContext`: Custom SSL context class using system trust stores
  - `inject_into_ssl()`: Global monkey-patching of Python's ssl module
  - `extract_from_ssl()`: Restoration of original ssl module behavior

### Core Architecture (`_api.py`)
Central orchestration module implementing the main truststore logic:
- **SSLContext Implementation**: Drop-in ssl.SSLContext replacement with decorator pattern
- **Certificate Verification Pipeline**: Post-handshake verification via `_verify_peercerts()`
- **Platform Abstraction**: Runtime detection and delegation to platform-specific implementations
- **Injection/Extraction System**: Global ssl module replacement mechanism

### Platform-Specific Implementations

#### Windows (`_windows.py`)
- **Windows Crypto API Integration**: Uses WinCrypt for certificate chain building and validation
- **Dual Verification Strategy**: System certificate stores first, fallback to custom CA certificates
- **SSL Policy Validation**: Windows-native SSL certificate chain policy verification

#### macOS (`_macos.py`) 
- **Security Framework Binding**: ctypes integration with macOS Security and CoreFoundation
- **System Trust Store Access**: Native macOS certificate validation via SecTrust APIs
- **Memory Management**: Extensive CoreFoundation object lifecycle management

#### Linux/Unix (`_openssl.py`)
- **System Certificate Discovery**: Searches common CA certificate file locations across distributions
- **OpenSSL Integration**: Leverages existing OpenSSL certificate validation infrastructure
- **Fallback Strategy**: OpenSSL defaults → system paths → failure

### Cross-Platform Utilities (`_ssl_constants.py`)
- **Implementation Compatibility**: Handles CPython vs other Python implementation differences
- **Original SSL Preservation**: Maintains references to unmodified SSL classes
- **Monkey-Patch Protection**: Prevents interference from other ssl module modifications

## Public API Surface

### Main Entry Points
1. **`SSLContext`** - Primary replacement class for ssl.SSLContext with system certificate store integration
2. **`inject_into_ssl()`** - Global activation of truststore for all SSL operations
3. **`extract_from_ssl()`** - Deactivation and restoration of original SSL behavior

### Integration Patterns
- **Drop-in Replacement**: SSLContext maintains full API compatibility with ssl.SSLContext
- **Global Monkey Patching**: Transparent integration with existing codebases via injection
- **Context Manager Support**: Platform-specific context managers for configuration

## Internal Organization and Data Flow

1. **Certificate Verification Flow**:
   - SSL handshake completion detected
   - Certificate chain extraction (version-aware for Python 3.13+)
   - Platform-specific verification call
   - Error translation to ssl.SSLCertVerificationError

2. **Platform Dispatch**:
   - Runtime OS detection determines implementation module
   - Conditional imports load appropriate platform backend
   - Unified verification interface across all platforms

3. **Resource Management**:
   - Platform-specific cleanup (CFRelease on macOS, store handles on Windows)
   - Exception safety with try/finally blocks
   - Proper SSL socket lifecycle management

## Important Patterns and Conventions

- **Error Handling**: Platform-specific errors translated to standard ssl.SSLError types
- **Version Compatibility**: Handles Python 3.10-3.13+ API differences gracefully
- **Memory Safety**: Explicit resource management for native system resources
- **Configuration Inheritance**: Custom CA certificates from SSLContext respected on all platforms
- **CRL Support**: Configurable Certificate Revocation List checking where supported