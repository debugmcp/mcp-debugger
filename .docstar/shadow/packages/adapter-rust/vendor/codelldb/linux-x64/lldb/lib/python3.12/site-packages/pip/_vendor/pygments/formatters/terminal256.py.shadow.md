# packages/adapter-rust/vendor/codelldb/linux-x64/lldb/lib/python3.12/site-packages/pip/_vendor/pygments/formatters/terminal256.py
@source-hash: d77489dc3e6915da
@generated: 2026-02-09T17:58:05Z

## Purpose
Terminal formatters for Pygments that output syntax-highlighted code using ANSI color sequences. Provides two formatters: 256-color terminal support and true-color (16M color) terminal support.

## Key Classes

### EscapeSequence (L34-96)
ANSI escape sequence builder that handles foreground/background colors and text attributes (bold, underline, italic). Key methods:
- `color_string()` (L47-71): Generates 256-color ANSI escape sequences, handles both indexed colors and ANSI color names
- `true_color_string()` (L73-85): Generates true-color RGB ANSI escape sequences  
- `reset_string()` (L87-95): Creates reset sequences to clear formatting
- `escape()` (L42-45): Helper to wrap attributes in ANSI escape format

### Terminal256Formatter (L98-290)
Main formatter for 256-color terminals. Extends Pygments `Formatter` base class.

**Initialization (L135-151):**
- Builds RGB-to-256-color conversion table via `_build_color_table()`
- Converts style colors to terminal colors via `_setup_styles()`
- Supports options: `linenos`, `nobold`, `nounderline`, `noitalic`

**Core Methods:**
- `_build_color_table()` (L152-187): Constructs 256-color palette (16 basic + 216 6x6x6 cube + 24 grayscale)
- `_closest_color()` (L188-203): Finds nearest xterm color using Euclidean distance in RGB space
- `_color_index()` (L205-222): Maps hex colors to xterm indices, with caching via `best_match` dict
- `_setup_styles()` (L224-243): Processes Pygments style definitions into ANSI escape sequences
- `format_unencoded()` (L252-289): Main formatting logic that applies color codes to tokens

### TerminalTrueColorFormatter (L293-338)
Extends Terminal256Formatter for true-color terminals. Overrides:
- `_build_color_table()` (L311-312): No-op since no color quantization needed
- `_color_tuple()` (L314-322): Converts hex colors directly to RGB tuples
- `_setup_styles()` (L324-338): Uses true-color escape sequences instead of indexed colors

## Key Dependencies
- `pip._vendor.pygments.formatter.Formatter`: Base formatter class
- `pip._vendor.pygments.console.codes`: ANSI color code mappings
- `pip._vendor.pygments.style.ansicolors`: ANSI color name definitions

## Architecture Patterns
- **Strategy Pattern**: Two formatters sharing common interface but different color handling strategies
- **Template Method**: Base class defines formatting flow, subclasses customize color conversion
- **Caching**: `best_match` dict caches expensive RGB-to-index conversions
- **Inheritance**: TerminalTrueColorFormatter reuses most logic from Terminal256Formatter

## Critical Constraints
- Color sequences terminated at newlines for proper terminal paging
- Style attributes (bold/underline/italic) preserved from source styles
- RGB conversion uses Euclidean distance for closest color matching
- Line numbering support with proper newline handling