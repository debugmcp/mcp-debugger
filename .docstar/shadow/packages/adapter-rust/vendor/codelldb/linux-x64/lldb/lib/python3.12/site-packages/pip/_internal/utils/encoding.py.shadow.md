# packages/adapter-rust/vendor/codelldb/linux-x64/lldb/lib/python3.12/site-packages/pip/_internal/utils/encoding.py
@source-hash: aaab170ed8b03088
@generated: 2026-02-09T18:01:17Z

## Purpose
Text encoding detection utility for pip's internal operations. Handles automatic detection of byte string encodings using BOM (Byte Order Mark) detection and PEP 263 encoding declarations.

## Key Components

### Constants
- `BOMS` (L7-15): List of tuples mapping byte order marks to their corresponding encoding names. Covers UTF-8, UTF-16 (BE/LE), and UTF-32 (BE/LE) variants.
- `ENCODING_RE` (L17): Compiled regex pattern to detect PEP 263 encoding declarations in format `coding[:=]\s*([-\w.]+)`.

### Functions
- `auto_decode(data: bytes) -> str` (L20-36): Main encoding detection function that:
  1. Checks for BOM at start of byte string
  2. Falls back to PEP 263 encoding declaration in first two lines
  3. Uses system locale encoding as final fallback

## Algorithm Flow
1. **BOM Detection** (L24-26): Iterates through known BOMs, strips matching BOM and decodes with corresponding encoding
2. **PEP 263 Check** (L28-33): Examines first two lines for Python encoding declarations (lines starting with `#`)
3. **Locale Fallback** (L34-36): Uses `locale.getpreferredencoding(False)` or system default encoding

## Dependencies
- Standard library: `codecs`, `locale`, `re`, `sys`
- Type hints: `typing.List`, `typing.Tuple`

## Usage Context
Critical for pip's file processing pipeline where text encoding must be reliably detected from various sources (setup.py files, requirements.txt, etc.). Follows Python's encoding detection standards while providing robust fallback mechanisms.