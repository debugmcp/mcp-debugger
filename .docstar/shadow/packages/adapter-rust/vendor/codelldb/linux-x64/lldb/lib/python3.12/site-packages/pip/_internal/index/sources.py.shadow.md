# packages/adapter-rust/vendor/codelldb/linux-x64/lldb/lib/python3.12/site-packages/pip/_internal/index/sources.py
@source-hash: 7497a0891f5ff3a9
@generated: 2026-02-09T18:01:18Z

**pip Package Index Link Sources**

This module defines the architecture for discovering Python package installation candidates from various source types in pip. The code implements a polymorphic LinkSource system that abstracts different package discovery mechanisms.

**Core Architecture**
- `LinkSource` (L29-42): Abstract base class defining the interface for package source discovery
- Type aliases (L23-26): Define common callback patterns for candidate parsing and page validation
- `build_source()` (L226-285): Factory function that analyzes a location string and returns the appropriate LinkSource implementation

**Key Classes and Responsibilities**

`_FlatDirectoryToUrls` (L48-93): Directory scanner with caching
- Scans local directories once and caches results for both HTML pages and package files
- `_scan_directory()` (L57-78): Parses filenames using wheel/sdist validation, categorizes as HTML pages or package archives
- `page_candidates` (L80-85): Returns cached HTML file URLs
- `project_name_to_urls` (L87-92): Returns package files grouped by project name

`_FlatDirectorySource` (L95-133): Handles `--find-links=<directory>` 
- Class-level cache `_paths_to_urls` (L104) prevents duplicate directory scanning
- `page_candidates()` (L126-128): Extracts candidates from HTML files in directory
- `file_links()` (L130-132): Returns direct package file links for specific project

`_LocalFileSource` (L135-166): Handles local file:// URLs and paths
- `page_candidates()` (L157-160): Processes HTML files for embedded links
- `file_links()` (L162-165): Returns non-HTML files as direct download links
- Uses `_is_html_file()` (L44-45) for content type detection

`_RemoteFileSource` (L168-198): Handles remote HTTP/HTTPS URLs
- Includes page validation via `_page_validator` callback
- `page_candidates()` (L191-194): Only processes pages that pass validation
- `file_links()` (L196-197): Always returns the link (assumes remote files are downloadable)

`_IndexDirectorySource` (L200-224): Handles `--index-url=<directory>`
- Treats directories as index servers (expects index.html)
- `file_links()` (L222-223): Returns empty tuple (no direct file access)

**Critical Logic in build_source()**
- Location type detection (L237-244): Distinguishes local paths, file:// URLs, and remote URLs
- Source selection based on path type:
  - Remote URLs → `_RemoteFileSource` (L255-260)
  - Directories with `expand_dir=True` → `_FlatDirectorySource` (L263-268)  
  - Directories with `expand_dir=False` → `_IndexDirectorySource` (L270-273)
  - Files → `_LocalFileSource` (L275-280)

**Key Dependencies**
- `pip._vendor.packaging.utils`: Filename parsing and validation
- `pip._internal.models.{candidate,link}`: Core data models
- `pip._internal.utils.urls`: URL/path conversion utilities
- `pip._internal.vcs.is_url()`: URL detection

**Architectural Patterns**
- Strategy Pattern: Different LinkSource implementations for different source types
- Factory Pattern: `build_source()` creates appropriate source instances
- Lazy Loading: `_FlatDirectoryToUrls` scans directories only when accessed
- Caching: Class-level cache prevents duplicate directory scans across instances