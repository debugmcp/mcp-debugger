# packages/adapter-rust/vendor/codelldb/linux-x64/lldb/lib/python3.12/site-packages/pip/_vendor/urllib3/packages/backports/makefile.py
@source-hash: 9dbcedde2d1a80f5
@generated: 2026-02-09T17:56:52Z

## Purpose
Provides a backport of Python 3.5's `socket.makefile` method for creating file-like objects from socket-like objects. This utility allows older Python versions or custom socket implementations to benefit from the enhanced makefile functionality.

## Key Function
**`backport_makefile` (L13-51)**: Core function that converts a socket-like object into a file-like object with configurable buffering, encoding, and text/binary modes.

### Parameters
- `self`: Socket-like object to wrap
- `mode`: File mode string ("r", "w", "b" combinations)
- `buffering`: Buffer size (-1 for default, 0 for unbuffered, >0 for custom size)
- `encoding`, `errors`, `newline`: Text mode parameters

### Implementation Flow
1. **Mode validation** (L19-23): Ensures only 'r', 'w', 'b' characters are used
2. **Raw socket creation** (L30): Creates `SocketIO` wrapper with appropriate rawmode
3. **Reference counting** (L31): Increments `_makefile_refs` on the socket object
4. **Buffering logic** (L32-39): Handles buffering configuration with fallback to `io.DEFAULT_BUFFER_SIZE`
5. **Stream wrapping** (L40-46): Creates appropriate buffered stream based on read/write mode:
   - `BufferedRWPair` for read+write
   - `BufferedReader` for read-only  
   - `BufferedWriter` for write-only
6. **Text wrapping** (L47-51): Optionally wraps in `TextIOWrapper` for text mode

## Dependencies
- `io`: Standard library for stream buffering and text wrapping
- `socket.SocketIO`: Low-level socket I/O interface

## Key Constraints
- Unbuffered streams must be binary mode (L37-38)
- Socket object must have `_makefile_refs` attribute for reference counting
- Mode string restricted to combinations of 'r', 'w', 'b' only

## Architectural Notes
This is a compatibility shim that replicates Python 3.5+ socket behavior for environments that need it. The function operates on any object that can be passed to `SocketIO`, not just actual sockets.