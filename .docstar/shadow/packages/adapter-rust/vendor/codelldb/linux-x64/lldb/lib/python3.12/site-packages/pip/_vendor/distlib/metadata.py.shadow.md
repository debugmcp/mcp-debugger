# packages/adapter-rust/vendor/codelldb/linux-x64/lldb/lib/python3.12/site-packages/pip/_vendor/distlib/metadata.py
@source-hash: a41f5667d9817e64
@generated: 2026-02-09T18:01:45Z

**Primary Purpose**: Implementation of Python package metadata handling, supporting all metadata formats from 1.0 to 2.2 according to various PEPs. Provides unified interface for reading, writing, and validating package metadata in both legacy key-value format and modern JSON format.

**Key Classes**:
- `MetadataMissingError`, `MetadataConflictError`, `MetadataUnrecognizedVersionError`, `MetadataInvalidError` (L28-42): Exception hierarchy for metadata-related errors
- `LegacyMetadata` (L245-603): Handles legacy metadata formats (1.0-2.2) using key-value pairs, supports reading/writing PKG-INFO files
- `Metadata` (L610-1063): Modern metadata implementation using 2.1+ format with JSON serialization, wraps LegacyMetadata when needed

**Key Functions**:
- `_version2fieldlist(version)` (L118-134): Maps metadata version strings to corresponding field lists
- `_best_version(fields)` (L136-204): Auto-detects optimal metadata version based on present fields
- `_get_name_and_version(name, version, for_filename=False)` (L232-242): Formats distribution name-version strings with optional filename escaping

**Field Definitions** (L55-113): Comprehensive field mappings for different metadata versions:
- `_241_FIELDS`, `_314_FIELDS`, `_345_FIELDS`, `_426_FIELDS`, `_566_FIELDS`, `_643_FIELDS`: Version-specific allowed fields
- `_ALL_FIELDS`: Union of all supported fields across versions

**LegacyMetadata Key Methods**:
- `read(filepath)` / `read_file(fileobj)` (L339-374): Parse metadata from files using email.message parser
- `write(filepath)` / `write_file(fileobj)` (L375-407): Serialize metadata to PKG-INFO format
- `set(name, value)` / `get(name, default)` (L436-508): Field access with validation and type coercion
- `check(strict=False)` (L509-551): Validates metadata completeness and field constraints
- `todict(skip_missing=False)` (L553-574): Converts to dictionary with underscore-lowercase keys

**Metadata Key Methods**:
- `__init__(path, fileobj, mapping, scheme)` (L655-698): Multi-source initialization with automatic format detection
- `get_requirements(reqts, extras, env)` (L837-877): Dependency resolution with extras and environment marker evaluation  
- `_to_legacy()` / `_from_legacy()` (L971-956): Bidirectional conversion between modern and legacy formats
- `write(path, fileobj, legacy, skip_unknown)` (L1021-1045): Output to either JSON or legacy format

**Dependencies**:
- `email.message_from_file` for parsing PKG-INFO format
- `json` for modern metadata serialization
- `.markers.interpret` for environment marker evaluation
- `.version.get_scheme` for version validation
- `.util.extract_by_key`, `.util.get_extras` for data manipulation

**Architecture Notes**:
- Field name normalization: hyphen-case â†” underscore_case conversion (L208-211)
- Type coercion for list/tuple fields based on field type definitions (L216-225)
- Automatic version detection prioritizes newer formats when fields are ambiguous
- Lazy loading pattern: `Metadata` wraps `LegacyMetadata` only when needed for compatibility
- Validation occurs at multiple levels: syntax patterns, version constraints, field presence

**Critical Constants**:
- `PKG_INFO_ENCODING = 'utf-8'` (L47): Standard encoding for metadata files
- `PKG_INFO_PREFERRED_VERSION = '1.1'` (L51): Default version when auto-detection is ambiguous
- `METADATA_VERSION = '2.0'` (L627): Target version for new Metadata instances