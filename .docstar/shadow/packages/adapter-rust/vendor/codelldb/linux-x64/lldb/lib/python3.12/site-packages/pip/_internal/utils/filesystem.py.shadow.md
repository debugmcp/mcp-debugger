# packages/adapter-rust/vendor/codelldb/linux-x64/lldb/lib/python3.12/site-packages/pip/_internal/utils/filesystem.py
@source-hash: 4613085d468d54c1
@generated: 2026-02-09T18:01:26Z

**Primary Purpose**: Filesystem utility functions for pip's internal operations, providing secure file operations, permission checking, and file/directory size calculations.

**Key Functions**:

- `check_path_owner(path: str) -> bool` (L16-40): Verifies if current process owns a path by traversing up the directory tree until finding an existing path. Handles Windows compatibility and special root user cases with sudo.

- `adjacent_tmp_file(path: str, **kwargs) -> Generator[BinaryIO, None, None]` (L43-66): Context manager creating a secure temporary file in the same directory as the target path. Ensures data is flushed and synced to disk before cleanup.

- `replace` (L71): Retry-wrapped version of `os.replace` with 1-second timeout and 0.25-second intervals, using tenacity library for robust file replacement operations.

- `test_writable_dir(path: str) -> bool` (L76-91): Cross-platform directory writability test. Uses `os.access()` on POSIX systems, delegates to Windows-specific implementation otherwise.

- `_test_writable_dir_win(path: str) -> bool` (L94-119): Windows-specific writability test that creates and deletes test files due to `os.access()` limitations on Windows.

- `find_files(path: str, pattern: str) -> List[str]` (L122-129): Recursive file finder using UNIX-style glob patterns, returning absolute paths.

- `file_size(path: str) -> Union[int, float]` (L132-136): Returns file size, treating symlinks as zero-sized.

- `format_file_size(path: str) -> str` (L139-140): Human-readable file size formatter wrapper.

- `directory_size(path: str) -> Union[int, float]` (L143-149): Calculates total size of all files in a directory tree recursively.

- `format_directory_size(path: str) -> str` (L152-153): Human-readable directory size formatter wrapper.

**Dependencies**:
- `pip._vendor.tenacity` for retry logic
- `pip._internal.utils.compat.get_path_uid` for cross-platform UID handling
- `pip._internal.utils.misc.format_size` for size formatting

**Architectural Patterns**:
- Cross-platform compatibility layer (Windows vs POSIX)
- Retry pattern with exponential backoff for file operations
- Context manager pattern for secure temporary file handling
- Defensive programming with path traversal and permission checking

**Critical Constraints**:
- Path ownership verification requires absolute paths (assertion at L22)
- Windows writability testing uses random filename generation to avoid collisions
- Temporary files are created with `.tmp` suffix and target file basename as prefix