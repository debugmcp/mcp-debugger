# packages/adapter-rust/vendor/codelldb/linux-x64/lldb/lib/python3.12/site-packages/pip/_internal/locations/_sysconfig.py
@source-hash: 206cddb3ad2ab059
@generated: 2026-02-09T18:01:17Z

## Purpose
Provides sysconfig-based location resolution for pip package installations, handling platform-specific scheme detection and path generation for different installation types (user, home, prefix).

## Core Architecture
- **Scheme Detection**: Platform-aware heuristics to determine appropriate installation schemes when `sysconfig.get_default_scheme()` is unavailable (pre-Python 3.10)
- **Fallback Strategy**: Graceful degradation to POSIX schemes for unsupported platforms
- **Apple Framework Handling**: Special logic for macOS Command Line Tools Python distributions

## Key Functions

### Scheme Inference
- `_infer_prefix()` (L55-83): Determines prefix scheme using hierarchy: preferred API → macOS framework → implementation+OS → implementation → OS+prefix → OS → posix_prefix fallback
- `_infer_user()` (L86-98): Resolves user scheme with macOS framework special case, raises `UserInstallationInvalid` if unavailable
- `_infer_home()` (L101-108): Simple home scheme detection with OS suffix preference

### Platform Detection
- `_should_use_osx_framework_prefix()` (L29-52): Checks for Apple's special `osx_framework_library` scheme (framework build + system prefix + no virtualenv)
- `get_bin_prefix()` (L202-206): Forces `/usr/local/bin` for macOS system framework installs

### Main API
- `get_scheme()` (L124-199): Primary function returning `Scheme` object with platform-appropriate paths
  - Validates mutually exclusive options (user/prefix, home/prefix)
  - Handles custom prefix override for macOS framework
  - Manages virtual environment header path logic
  - Applies root rebasing if specified

### Simple Getters
- `get_purelib()` (L209-210): Pure Python library path
- `get_platlib()` (L213-214): Platform-specific library path

## Dependencies
- `sysconfig`: Python's installation scheme system
- `pip._internal.models.scheme.Scheme`: Target data structure
- `pip._internal.utils.virtualenv.running_under_virtualenv()`: Virtual environment detection
- `.base`: Utility functions for path manipulation and platform detection

## Key Constants
- `_AVAILABLE_SCHEMES` (L24): Set of available sysconfig schemes
- `_PREFERRED_SCHEME_API` (L26): Python 3.10+ preferred scheme API reference
- `_HOME_KEYS` (L112-121): Keys to override when using custom home directory

## Critical Patterns
- **Graceful Degradation**: Multiple fallback layers for scheme detection
- **Platform Awareness**: Special handling for macOS framework builds and PyPy implementations
- **Virtual Environment Compatibility**: Historical header path handling for pip compatibility
- **Validation**: Prevents invalid scheme combinations early