# packages/adapter-rust/vendor/codelldb/linux-x64/lldb/lib/python3.12/site-packages/pip/_vendor/rich/cells.py
@source-hash: 68c9862b80635e18
@generated: 2026-02-09T18:01:46Z

**Primary Purpose:** Unicode text cell width calculation and manipulation for terminal display, handling single-width (1 cell) and double-width (2 cells) characters like CJK ideographs and emojis.

**Key Functions:**

- `cached_cell_len(text: str) -> int` (L14-28): LRU-cached version that calculates total cell width by summing individual character widths. Always caches results which can consume significant memory.

- `cell_len(text: str, _cell_len: Callable = cached_cell_len) -> int` (L31-44): Primary text width calculation function. For strings <512 chars, delegates to cached version; for longer strings, calculates directly to avoid cache pollution.

- `get_character_cell_size(character: str) -> int` (L48-57): Character-level width calculation with LRU cache (4096 entries). Converts character to codepoint and delegates to `_get_codepoint_cell_size`.

- `_get_codepoint_cell_size(codepoint: int) -> int` (L61-86): Core width calculation using binary search through `CELL_WIDTHS` lookup table. Returns 0 (zero-width), 1 (single-width), or 2 (double-width) cells. Returns 1 as fallback for codepoints not in table.

- `set_cell_size(text: str, total: int) -> str` (L89-122): Truncates or pads text to exact cell width. Uses regex optimization for common single-width characters, binary search for complex cases. Handles double-width character splitting by replacing with space.

- `chop_cells(text: str, width: int) -> list[str]` (L124-158): Splits text into lines fitting within specified cell width. Uses character-by-character iteration with width tracking.

**Key Dependencies:**
- `CELL_WIDTHS` from `._cell_widths`: Unicode width lookup table for binary search
- `_is_single_cell_widths` regex (L10): Optimization pattern for common ASCII/Latin ranges

**Architectural Patterns:**
- Multi-level caching strategy: character-level and text-level LRU caches
- Performance optimizations: regex fast-path, cache size thresholds, method aliasing
- Binary search algorithms for both width lookup and text truncation

**Critical Invariants:**
- Cell widths are 0, 1, or 2 only
- Cache sizes fixed at 4096 entries
- 512-character threshold determines caching vs direct calculation
- Zero-width characters represented as -1 in lookup table, converted to 0