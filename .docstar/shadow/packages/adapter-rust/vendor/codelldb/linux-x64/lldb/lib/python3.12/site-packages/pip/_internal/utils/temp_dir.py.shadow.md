# packages/adapter-rust/vendor/codelldb/linux-x64/lldb/lib/python3.12/site-packages/pip/_internal/utils/temp_dir.py
@source-hash: 0d4030db6b85aee4
@generated: 2026-02-09T18:01:31Z

## Primary Purpose
This module manages temporary directories for pip operations, providing lifecycle management, cleanup handling, and global registry for different types of temp directories.

## Key Classes & Functions

### TempDirectory (L93-224)
Main temporary directory wrapper providing context manager interface and automatic cleanup.

**Key methods:**
- `__init__()` (L114-147): Creates temp dir, handles delete logic based on registry/explicit params
- `path` property (L149-152): Returns path with deleted-state assertion 
- `_create()` (L171-179): Creates actual temp dir using `tempfile.mkdtemp` with kind prefix
- `cleanup()` (L181-224): Removes directory with error handling, uses custom `onerror` callback

**Key attributes:**
- `delete`: Controls auto-deletion behavior (can be bool, None, or _Default sentinel)
- `kind`: Directory type for registry lookup
- `globally_managed`: Whether to register with global manager
- `ignore_cleanup_errors`: Whether to suppress/log cleanup failures vs raise

### AdjacentTempDirectory (L226-296)
Specialized subclass that creates temp directories adjacent to existing directories using name generation algorithm.

**Key methods:**
- `_generate_names()` (L252-276): Class method generating filesystem-safe but package-invalid names
- `_create()` (L278-296): Override that tries adjacent names before falling back to standard temp location

**Key attributes:**
- `original`: The target directory to be adjacent to
- `LEADING_CHARS` (L246): Character set for name generation algorithm

### TempDirectoryTypeRegistry (L50-67)
Registry managing auto-delete policies for different temp directory types.

**Key methods:**
- `set_delete()` (L56-60): Configure auto-delete for directory kind
- `get_delete()` (L62-66): Get auto-delete setting (defaults True)

## Global State Management

### Context Managers
- `global_tempdir_manager()` (L39-47): Manages global ExitStack for temp directories
- `tempdir_registry()` (L72-83): Provides scoped registry for delete policies

### Global Variables
- `_tempdir_manager` (L36): Optional ExitStack for globally managed directories
- `_tempdir_registry` (L69): Optional registry instance
- `tempdir_kinds` (L29-33): Enum of predefined directory types (BUILD_ENV, EPHEM_WHEEL_CACHE, REQ_BUILD)

## Architecture Patterns
- **Sentinel Pattern**: `_Default` class (L86-87) and `_default` instance (L90) for parameter defaults
- **Registry Pattern**: Global registry for managing cleanup policies across directory types
- **Context Manager Protocol**: Full support for `with` statements with automatic cleanup
- **Graceful Degradation**: Multiple fallback strategies for cleanup errors and name generation

## Dependencies
- `pip._internal.utils.misc`: For `rmtree` utility and `enum` helper
- Standard library: `tempfile`, `pathlib`, `contextlib`, `errno`, `itertools`

## Critical Constraints
- Path access forbidden after deletion (assertion in path property)
- Adjacent directory names must be filesystem-safe but package-invalid
- Cleanup errors are logged/suppressed by default unless `ignore_cleanup_errors=False`
- Global management requires active `_tempdir_manager` context