# packages/adapter-rust/vendor/codelldb/linux-x64/lldb/lib/python3.12/site-packages/pip/_internal/network/auth.py
@source-hash: 891bb92c110c2bfd
@generated: 2026-02-09T18:01:22Z

## Purpose
Network authentication module for pip's package index access. Provides multi-domain credential management with support for embedded URLs, netrc files, keyring storage, and interactive prompting.

## Core Components

### Data Structures
- **Credentials (L39-43)**: NamedTuple containing url, username, password
- **AuthInfo**: Type alias for username/password tuples from vcs.versioncontrol module

### Keyring Provider Architecture
Abstract base class **KeyRingBaseProvider (L45-57)** defines interface for credential storage backends:
- **KeyRingNullProvider (L59-69)**: Disabled keyring implementation
- **KeyRingPythonProvider (L71-101)**: Uses imported keyring library, supports both get_credential() and get_password() methods
- **KeyRingCliProvider (L103-160)**: Executes keyring CLI commands via subprocess with UTF-8 encoding

### Main Authentication Class
**MultiDomainBasicAuth (L224-562)**: Core authentication handler implementing requests.auth.AuthBase
- Manages credential cache in `self.passwords` dict (L234)
- Supports multiple index URLs for credential matching
- Integrates netrc, keyring, and interactive prompting
- Handles 401 responses with automatic retry

## Key Methods

### Provider Factory
- **get_keyring_provider (L162-222)**: LRU-cached factory with fallback chain: import → subprocess → disabled
- Complex PATH manipulation (L184-214) to avoid pip's own keyring executable

### Credential Resolution
- **_get_new_credentials (L331-387)**: Multi-source credential lookup with precedence: URL embedded → index URL → netrc → keyring
- **_get_url_and_credentials (L388-434)**: Main credential resolution with caching
- **_get_index_url (L283-330)**: Matches request URLs to configured index URLs using longest path prefix

### Authentication Flow
- **__call__ (L436-450)**: Requests auth handler entry point
- **handle_401 (L476-537)**: Retry logic with keyring lookup and optional prompting
- **save_credentials (L547-562)**: Deferred keyring storage after successful auth

## Dependencies
- requests library for HTTP authentication
- keyring library (optional) for credential storage
- subprocess for CLI keyring execution
- pip._internal.utils.misc for user interaction functions

## Configuration
- `KEYRING_DISABLED` global flag (L36) disables keyring on exceptions
- Provider selection: "auto" (default), "import", "subprocess", "disabled"
- Interactive prompting can be disabled via `prompting=False`

## Critical Behaviors
- Credential caching per netloc prevents repeated prompts
- Keyring exceptions globally disable keyring functionality
- 401 handling preserves connection for retry efficiency
- Path prefix matching enables credential inheritance for sub-paths