# packages/adapter-rust/vendor/codelldb/linux-x64/lldb/lib/python3.12/site-packages/pip/_vendor/urllib3/util/wait.py
@source-hash: 7ce5f4fdf6a8cc6d
@generated: 2026-02-09T17:58:05Z

## Purpose
Socket waiting utility for urllib3 that provides cross-platform, timeout-aware socket readiness detection. Handles platform differences between Unix-like systems (poll) and Windows (select), with fallbacks for broken implementations.

## Key Components

### Exception Classes
- **NoWayToWaitForSocketError** (L14-15): Custom exception raised when no socket waiting mechanism is available (e.g., App Engine)

### Platform Compatibility Layer
- **_retry_on_intr** (L42-67): Version-dependent interrupt retry handler
  - Python 3.5+: Simple pass-through (L42-43)
  - Pre-3.5: Manual EINTR retry with deadline tracking (L47-67)
- **monotonic import** (L6-9): Fallback from time.monotonic to time.time for older Python

### Core Socket Waiting Functions
- **select_wait_for_socket** (L70-86): Windows/fallback implementation using select.select()
  - Handles Windows non-blocking connect quirk by monitoring exceptional sockets (L79-83)
- **poll_wait_for_socket** (L89-106): Unix preferred implementation using select.poll()
  - Converts timeout to milliseconds for poll API (L101-104)
- **null_wait_for_socket** (L109-110): No-op that raises exception for unsupported platforms

### Dynamic Implementation Selection
- **_have_working_poll** (L113-123): Runtime detection of working poll() implementation
- **wait_for_socket** (L126-138): Self-replacing function that chooses implementation on first call
  - Priority: poll() > select() > null (App Engine case)
  - Global function replacement pattern to avoid repeated detection

### Public API
- **wait_for_read** (L141-145): Convenience wrapper for read readiness
- **wait_for_write** (L148-152): Convenience wrapper for write readiness

## Dependencies
- select: Core I/O multiplexing primitives
- errno: For EINTR handling in retry logic
- functools.partial: For select parameter binding

## Architecture Patterns
- **Lazy initialization**: Implementation choice deferred until first use
- **Self-modification**: Function replaces itself globally after platform detection
- **Version compatibility**: Conditional behavior based on Python version
- **Platform abstraction**: Unified interface over select/poll differences

## Critical Constraints
- Requires at least one of read/write flags to be True
- Timeout handling differs between select (seconds) and poll (milliseconds)
- Windows exceptional socket handling required for non-blocking connects