# packages/adapter-rust/vendor/codelldb/linux-x64/lldb/lib/python3.12/site-packages/pip/_vendor/pygments/formatters/latex.py
@source-hash: 146cc9f98a924c4f
@generated: 2026-02-09T17:58:00Z

**Primary Purpose & Responsibility**
LaTeX formatter for Pygments syntax highlighting that converts tokenized code into LaTeX markup using fancyvrb and color packages. Transforms tokens into `\PY{style}{text}` commands with customizable styling.

**Key Classes & Functions**

- `LatexFormatter` (L147-438): Main formatter class inheriting from Pygments Formatter
  - `__init__` (L256-277): Configures 15+ formatting options (nowrap, linenos, texcomments, mathescape, etc.)
  - `_create_stylesheet` (L279-322): Builds style mappings from token types to LaTeX commands using `rgbcolor` helper
  - `get_style_defs` (L324-334): Generates LaTeX macro definitions for styling commands
  - `format_unencoded` (L336-437): Core formatting logic handling token processing, escaping, and output generation

- `LatexEmbeddedLexer` (L440-521): Specialized lexer for handling escaped LaTeX code within other languages
  - `get_tokens_unprocessed` (L457-474): Main tokenization with escape handling
  - `_find_safe_escape_tokens` (L476-486): Locates escapes outside strings/comments
  - `_filter_to` (L488-503): Token filtering utility
  - `_find_escape_tokens` (L505-521): Raw escape token detection

**Key Utilities**

- `escape_tex` (L22-40): Escapes special LaTeX characters using placeholder substitution
- `_get_ttype_name` (L135-144): Converts token types to style names using STANDARD_TYPES fallback

**Important Dependencies & Relationships**
- Imports: `pip._vendor.pygments.formatter.Formatter`, `pip._vendor.pygments.lexer.Lexer`, `pip._vendor.pygments.token`
- Uses `do_insertions` for token manipulation
- Relies on STANDARD_TYPES mapping for token classification

**Templates & Constants**
- `DOC_TEMPLATE` (L43-58): Complete LaTeX document template with placeholders
- `STYLE_TEMPLATE` (L98-132): Complex LaTeX macro system for token styling with escape character definitions

**Notable Architectural Decisions**
- Uses placeholder-based escaping strategy (L23-40) to avoid interference during processing
- Implements hierarchical token type resolution with parent fallback (L401-407)
- Supports multiple LaTeX integration modes: texcomments, mathescape, escapeinside
- Style system uses dynamic macro generation rather than static assignments

**Critical Invariants & Constraints**
- `escapeinside` must be exactly 2 characters or empty string (L270-274)
- Command prefix defaults to 'PY' for macro naming consistency
- Line numbering requires positive integers with abs() enforcement (L262-263)
- Token hierarchy traversal terminates at root Token type (L401-407)