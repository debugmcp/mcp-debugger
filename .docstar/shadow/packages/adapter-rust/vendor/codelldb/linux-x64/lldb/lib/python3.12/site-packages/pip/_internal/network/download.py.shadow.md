# packages/adapter-rust/vendor/codelldb/linux-x64/lldb/lib/python3.12/site-packages/pip/_internal/network/download.py
@source-hash: ad9adb8ba39d635f
@generated: 2026-02-09T18:01:15Z

## Purpose
File downloader infrastructure for pip package installation with progress tracking and caching support. Handles HTTP downloads with intelligent progress bar display, filename sanitization, and both single and batch download operations.

## Key Components

### Core Functions
- `_get_http_response_size()` (L24-28): Extracts content-length from HTTP response headers, returns None if unavailable
- `_prepare_download()` (L31-71): Orchestrates download preparation including progress bar logic and chunk streaming
- `_http_get_download()` (L116-121): Performs HTTP GET request with streaming enabled, strips URL fragments
- `sanitize_content_filename()` (L73-77): Security function using `os.path.basename()` to prevent directory traversal
- `parse_content_disposition()` (L80-93): Extracts filename from Content-Disposition headers using email.message parser

### Filename Resolution
`_get_http_response_filename()` (L95-114): Multi-tier filename detection strategy:
1. Uses link.filename as fallback
2. Checks Content-Disposition header
3. Guesses extension from Content-Type MIME type
4. Falls back to response URL extension if link URL differs

### Download Classes
- `Downloader` (L123-152): Single file downloader with session and progress bar configuration
  - `__call__()` (L132-151): Downloads single file, returns (filepath, content_type) tuple
- `BatchDownloader` (L154-187): Multi-file downloader yielding results as generator
  - `__call__()` (L163-187): Processes iterable of links, yields (link, (filepath, content_type)) tuples

## Progress Bar Logic (L53-70)
Sophisticated progress display rules:
- Hidden if log level > INFO or cached response
- Shown if no content-length available or file > 40KB
- Uses `get_download_progress_renderer()` with configurable bar types

## Dependencies
- Uses `pip._vendor.requests` for HTTP operations with CONTENT_CHUNK_SIZE chunks
- Integrates with pip's session management, caching system, and progress bar infrastructure
- Relies on Link model for URL handling and PyPI domain detection

## Security Features
- URL credential redaction in logs via `redact_auth_from_url()`
- Directory traversal prevention in filename sanitization
- Fragment stripping from target URLs

## Error Handling
Both downloader classes catch `NetworkConnectionError`, log critical HTTP errors with status codes, and re-raise exceptions while ensuring proper error propagation.