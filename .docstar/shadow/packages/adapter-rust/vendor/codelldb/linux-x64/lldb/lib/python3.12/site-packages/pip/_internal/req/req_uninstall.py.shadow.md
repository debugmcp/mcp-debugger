# packages/adapter-rust/vendor/codelldb/linux-x64/lldb/lib/python3.12/site-packages/pip/_internal/req/req_uninstall.py
@source-hash: ab30c8c49a3e3844
@generated: 2026-02-09T18:01:27Z

## Purpose
Package uninstallation machinery for pip. Handles safe removal of Python packages by stashing files temporarily before permanent deletion, with rollback capability. Supports multiple installation formats including wheel (.dist-info), egg, setuptools, and editable installs.

## Key Classes & Functions

### Core Path Management
- **`UninstallPathSet` (L295-576)**: Main orchestrator for package uninstallation. Tracks files to remove, handles permissions, and coordinates the stashing/removal process.
  - `from_dist()` (L423-575): Factory method that analyzes distribution type and populates removal paths
  - `remove()` (L349-377): Executes uninstall with user confirmation and file stashing
  - `rollback()` (L406-417): Restores stashed files if uninstall needs reversal
  - `_permitted()` (L310-319): Checks if path can be modified (virtualenv-aware)

- **`StashedUninstallPathSet` (L190-293)**: Manages temporary file stashing during uninstall operations. Creates adjacent temp directories when possible.
  - `stash()` (L243-262): Moves files/directories to temporary locations
  - `commit()` (L264-269): Permanently removes stashed files
  - `rollback()` (L271-288): Restores original files from stash

- **`UninstallPthEntries` (L578-633)**: Handles modification of .pth files (Python path files) during uninstall.

### Path Analysis Utilities
- **`uninstallation_paths()` (L54-86)**: Generates all file paths for uninstall based on RECORD files, including .pyc/.pyo variants
- **`compact()` (L88-104)**: Reduces path sets to minimal representation (removes redundant parent/child paths)  
- **`compress_for_rename()` (L107-138)**: Optimizes paths for atomic directory operations
- **`compress_for_output_listing()` (L141-187)**: Formats paths for user display, separating files vs directories
- **`_script_names()` (L21-38)**: Generates platform-specific script file variants (Windows .exe, .manifest, etc.)

## Installation Type Detection
The `from_dist()` method handles multiple package installation scenarios:
- **Modern wheel installs**: Uses RECORD files for complete file listing
- **Setuptools flat .egg-info**: Reads installed-files.txt or top_level.txt  
- **Easy Install eggs**: Removes .egg directory and updates easy-install.pth
- **Editable installs**: Handles .egg-link files and path entries
- **Distutils legacy**: Raises LegacyDistutilsInstall exception

## Key Dependencies
- `BaseDistribution`: Metadata interface for installed packages
- `TempDirectory`/`AdjacentTempDirectory`: Safe temporary file management
- Platform utilities: Windows-specific handling, virtualenv detection
- Path normalization and filesystem operations

## Critical Constraints
- Only removes files within current Python environment (virtualenv-aware)
- Refuses to modify standard library locations
- Maintains atomicity through stashing mechanism
- Preserves symlinks as files (doesn't follow targets)
- Cross-platform path handling (Windows drive letters, UNC paths)

## Architecture Notes
Uses a two-phase commit pattern: stash → confirm → commit/rollback. Path normalization is heavily cached for performance. The code handles multiple Python packaging standards and their different metadata formats.