# packages/adapter-rust/vendor/codelldb/linux-x64/lldb/lib/python3.12/site-packages/pip/_vendor/cachecontrol/caches/file_cache.py
@source-hash: f4096699325ce9cb
@generated: 2026-02-09T17:57:58Z

## Purpose
File-based HTTP caching implementation for pip's cachecontrol library. Provides two cache variants: standard FileCache storing complete responses in memory, and SeparateBodyFileCache for memory-efficient handling of large downloads by storing response bodies in separate files.

## Key Components

### _secure_open_write Function (L21-60)
Security-focused file opening utility that prevents symlink attacks and race conditions:
- Uses `os.O_CREAT | os.O_EXCL` flags to fail if file exists
- Applies `os.O_NOFOLLOW` to prevent symlink following
- Atomically removes existing files before creation
- Returns binary write file handle with specified permissions

### _FileCacheMixin Class (L62-142)
Shared base implementation for both cache variants:
- **__init__ (L65-92)**: Configures directory, file permissions (default 0o0600), directory permissions (default 0o0700), and file locking mechanism
- **encode (L94-96)**: Static method using SHA224 hashing for key transformation
- **_fn (L98-103)**: Generates hierarchical file paths using first 5 hash characters as subdirectories
- **get (L105-112)**: Retrieves cached data by key, returns bytes or None
- **set (L114-118)**: Stores data with optional expiration (currently unused)
- **_write (L120-133)**: Thread-safe file writing using file locks and secure open
- **_delete (L135-141)**: Conditional file removal (respects forever flag)

### FileCache Class (L144-152)
Traditional cache implementation inheriting from _FileCacheMixin and BaseCache:
- Stores entire HTTP responses in single files
- **delete (L150-151)**: Removes cache entry completely

### SeparateBodyFileCache Class (L154-173)
Memory-efficient variant inheriting from _FileCacheMixin and SeparateBodyBaseCache:
- Separates HTTP headers and body into different files (.body suffix)
- **get_body (L160-165)**: Returns file handle for response body
- **set_body (L167-169)**: Stores response body in separate file
- **delete (L171-173)**: Removes both header and body files

### url_to_file_path Function (L176-181)
Utility function that converts URLs to cache file paths using CacheController.cache_url() for key generation.

## Dependencies
- **hashlib**: SHA224 hashing for cache keys
- **os**: File system operations and security flags
- **pathlib.Path**: Modern path handling
- **filelock**: File locking mechanism (optional import with graceful degradation)
- **pip._vendor.cachecontrol.cache**: Base cache interfaces
- **pip._vendor.cachecontrol.controller**: URL-to-cache-key conversion

## Architecture Patterns
- **Mixin Pattern**: _FileCacheMixin provides shared functionality to both cache variants
- **Security by Design**: Extensive use of OS-level security flags and file locking
- **Hierarchical Storage**: Cache files organized in subdirectories based on hash prefixes
- **Conditional Behavior**: "forever" flag controls whether files are actually deleted

## Critical Constraints
- File permissions strictly controlled (0o0600 for files, 0o0700 for directories)
- Hash-based file naming must remain stable for backward compatibility (L99-100 comment)
- File locking prevents concurrent write conflicts
- Symlink attack prevention through O_NOFOLLOW flag