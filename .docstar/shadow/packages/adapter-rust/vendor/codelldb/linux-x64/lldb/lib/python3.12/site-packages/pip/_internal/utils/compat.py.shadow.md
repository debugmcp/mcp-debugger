# packages/adapter-rust/vendor/codelldb/linux-x64/lldb/lib/python3.12/site-packages/pip/_internal/utils/compat.py
@source-hash: 724905bde0626108
@generated: 2026-02-09T18:01:18Z

## Primary Purpose
Cross-platform and cross-version compatibility utilities for pip. Handles differences in Python versions and platform distributions, providing unified interfaces for filesystem operations, resource access, and platform detection.

## Key Components

### Functions
- **`has_tls()` (L16-26)**: Detects TLS/SSL support by attempting to import `_ssl` module, falling back to PyOpenSSL detection via urllib3
- **`get_path_uid(path)` (L29-53)**: Returns file owner UID without following symlinks. Uses `os.O_NOFOLLOW` when available, otherwise implements manual symlink check for AIX/Jython compatibility. Raises `OSError` for symlinks on platforms without `O_NOFOLLOW` support
- **`open_text_resource()` (L58-67)**: Version-conditional resource opener. Uses deprecated `importlib.resources.open_text` for Python <3.11, modern `files()` API for â‰¥3.11

### Module-Level Constants
- **`stdlib_pkgs` (L75)**: Set of standard library packages that shouldn't be considered 'installed' despite having metadata: `{"python", "wsgiref", "argparse"}`
- **`WINDOWS` (L79)**: Boolean flag detecting Windows platforms, covering CPython (`win*`) and IronPython (`cli` + `nt`)

## Dependencies
- `importlib.resources`: Resource access with version-specific API usage
- `os`, `sys`: Platform and filesystem operations
- `pip._vendor.urllib3.util.IS_PYOPENSSL`: PyOpenSSL detection fallback

## Architectural Patterns
- **Version-based conditional imports**: Runtime Python version detection to use appropriate APIs
- **Platform abstraction**: Unified interfaces hiding OS-specific implementation differences
- **Graceful degradation**: Fallback implementations for platforms lacking certain features

## Critical Constraints
- **Security consideration**: Manual symlink check on AIX/Jython creates time-of-check vulnerability (L46-47)
- **Platform specificity**: AIX and Jython require special handling due to missing `os.O_NOFOLLOW` and `os.fstat`
- **API deprecation handling**: Maintains compatibility across Python 3.11 importlib.resources changes