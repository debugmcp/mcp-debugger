# packages/adapter-rust/vendor/codelldb/linux-x64/lldb/lib/python3.12/site-packages/pip/_internal/resolution/resolvelib/resolver.py
@source-hash: 9cb24eb15304562d
@generated: 2026-02-09T17:57:59Z

## Purpose and Responsibility
Main resolver implementation for pip's dependency resolution system using the resolvelib library. Handles the core dependency resolution process, converts resolved candidates to install requirements, and determines installation order through topological sorting.

## Key Classes and Functions

### `Resolver` Class (L38-183)
Primary dependency resolver inheriting from `BaseResolver`. Orchestrates the entire resolution process:
- **Constructor (L41-71)**: Initializes with factory pattern, accepts upgrade strategies from `{"eager", "only-if-needed", "to-satisfy-only"}`
- **`resolve()` method (L73-183)**: Main resolution entry point that:
  - Collects root requirements via factory
  - Creates `PipProvider` with constraints and upgrade strategy
  - Uses `RLResolver` from resolvelib with 200k round limit (L94-96)
  - Processes candidates with extras last to ensure base packages installed first (L111-113)
  - Handles reinstallation logic based on version differences, editability, and local files (L127-158)
  - Warns about yanked packages (L161-174)
- **`get_installation_order()` method (L185-214)**: Returns topologically sorted installation order using weighted graph traversal

### `get_topological_weights()` Function (L217-303)
Complex graph algorithm for determining installation order weights:
- **Leaf pruning optimization (L270-292)**: Removes packages without dependencies first (optimization for >200 packages)
- **DFS traversal (L248-263)**: Calculates path lengths while avoiding cycles
- **Cycle detection**: Breaks cycles by skipping revisited nodes in current path (L249-251)

### `_req_set_item_sorter()` Function (L306-317)
Sort key function for final installation order using weights and canonical names as tie-breakers.

## Key Dependencies
- `resolvelib`: External resolution library providing `RLResolver` and graph structures
- `Factory`: Creates candidates and handles requirement preparation
- `PipProvider`: Pip-specific provider for resolvelib
- `RequirementSet`: Container for resolved install requirements

## Architecture Patterns
- **Factory Pattern**: Uses `Factory` class to abstract candidate/requirement creation
- **Strategy Pattern**: Configurable upgrade strategies
- **Reporter Pattern**: Debug vs normal reporting via environment variable
- **Graph Algorithms**: Topological sorting with cycle detection for installation ordering

## Critical Invariants
- Must call `resolve()` before `get_installation_order()` (L200 assertion)
- Upgrade strategy must be in allowed set (L56 assertion)
- All requirement keys must appear in topological weights (L300-301 assertion)
- Candidates with extras processed after base packages to ensure proper dependency handling