# packages/adapter-rust/vendor/codelldb/linux-x64/lldb/lib/python3.12/site-packages/pip/_internal/utils/direct_url_helpers.py
@source-hash: af6311b64543002b
@generated: 2026-02-09T18:01:18Z

## Purpose
Utility module for converting between pip's internal DirectUrl objects and PEP 440 direct reference strings. Facilitates package installation from direct sources (VCS, archives, directories) by providing serialization and construction helpers.

## Key Functions

### `direct_url_as_pep440_direct_reference(direct_url, name)` (L9-29)
- **Purpose**: Converts DirectUrl objects to PEP 440 compliant requirement strings
- **Logic**: Builds requirement string `name @ url` with type-specific formatting:
  - VcsInfo: `name @ vcs+url@commit_id` format
  - ArchiveInfo: `name @ url` with optional hash fragment
  - DirInfo: `name @ url` (simple directory reference)
- **Fragments**: Appends hash and subdirectory as URL fragments when present

### `direct_url_for_editable(source_dir)` (L32-36)
- **Purpose**: Creates DirectUrl for editable installs
- **Returns**: DirectUrl with local file URL and DirInfo marked as editable

### `direct_url_from_link(link, source_dir, link_is_in_wheel_cache)` (L39-87)
- **Purpose**: Constructs DirectUrl from pip Link objects
- **VCS handling** (L42-71): 
  - Extracts VCS backend and URL/revision info
  - Determines commit_id based on cache status:
    - Cached wheels: uses requested_revision as commit_id
    - Non-cached: queries VCS backend for actual commit_id from source_dir
- **Directory handling** (L72-77): Creates DirInfo for existing directories
- **Archive handling** (L78-87): Creates ArchiveInfo with optional hash validation

## Dependencies
- `DirectUrl`, `ArchiveInfo`, `DirInfo`, `VcsInfo` from models.direct_url
- `Link` from models.link  
- `path_to_url` from utils.urls
- `vcs` registry from vcs module

## Key Patterns
- Type-based dispatching using isinstance checks
- Fragment-based URL construction for additional metadata
- Cache-aware VCS commit resolution logic
- Assertion-based validation for expected state conditions