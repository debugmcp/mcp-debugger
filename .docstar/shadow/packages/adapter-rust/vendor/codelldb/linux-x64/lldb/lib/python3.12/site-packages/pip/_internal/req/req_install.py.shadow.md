# packages/adapter-rust/vendor/codelldb/linux-x64/lldb/lib/python3.12/site-packages/pip/_internal/req/req_install.py
@source-hash: dbd2cb078a06e888
@generated: 2026-02-09T18:01:28Z

## Primary Purpose
Core pip requirement representation for package installation workflow. Manages the complete lifecycle of a Python package installation request from parsing to actual installation, handling both source distributions and wheels with support for PEP 517/518 build systems.

## Key Classes and Functions

### InstallRequirement (L64-862)
Central class representing a package installation request with comprehensive state management:

**Core Properties:**
- `req` (L90): Optional Requirement object from packaging library
- `link`/`original_link` (L112): Source URLs and links to package artifacts
- `source_dir` (L101): Local directory for source code extraction/building
- `editable` (L93): Whether package should be installed in development mode
- `satisfied_by` (L139): Existing distribution that satisfies this requirement
- `use_pep517` (L181): Build system selection (PEP 517 vs legacy setup.py)

**Build System Integration:**
- `pep517_backend` (L174): BuildBackendHookCaller for PEP 517 builds
- `metadata_directory` (L165): Generated metadata location for builds
- `build_env` (L159): Isolated build environment management

**Key Methods:**
- `load_pyproject_toml()` (L503-529): Configures PEP 517 build backend from pyproject.toml
- `prepare_metadata()` (L552-594): Generates package metadata via backend hooks or legacy setup.py
- `ensure_has_source_dir()` (L635-655): Creates temporary build directories
- `check_if_exists()` (L426-461): Resolves conflicts with installed packages
- `install()` (L806-861): Orchestrates final installation via wheel or editable legacy paths

**Property Accessors:**
- `is_pinned` (L270-277): Checks for exact version constraints (==, ===)
- `supports_pyproject_editable` (L247-257): Tests PEP 660 editable wheel support
- `unpacked_source_directory` (L478-482): Resolves subdirectory fragments in source paths

## Dependencies and Architecture

**External Dependencies:**
- `pip._vendor.packaging.*`: Core packaging utilities (requirements, versions, markers)
- `pip._vendor.pyproject_hooks`: PEP 517 build backend interface
- `pip._internal.operations.*`: Build and installation orchestration modules
- `pip._internal.metadata`: Distribution discovery and management

**Integration Points:**
- Build environment isolation via `BuildEnvironment`
- VCS backend integration through `vcs` registry
- Hash verification via `Hashes` class
- Uninstallation coordination with `UninstallPathSet`

## Critical Patterns

**Build System Detection Flow:**
1. `load_pyproject_toml()` determines PEP 517 vs legacy mode
2. `prepare_metadata()` calls appropriate metadata generation
3. `install()` routes to wheel installation or legacy editable

**State Management:**
- `prepared` flag tracks readiness for installation
- `install_succeeded` indicates completion status
- `needs_more_preparation` handles multi-stage requirements

**Error Handling:**
- `PreviousBuildDirError` prevents contaminated build directories
- Version mismatch warnings in `assert_source_matches_version()` (L617-632)
- Editable validation in `isolated_editable_sanity_check()` (L531-550)

## Utility Functions

- `check_invalid_constraint_type()` (L864-889): Validates constraint format restrictions
- `check_legacy_setup_py_options()` (L901-918): Deprecation warnings for legacy build options
- `_has_option()` (L892-898): Helper for option presence detection

## Notable Constraints

- Editable requirements must have valid source links (L103 assertion)
- PEP 517 backends are required for config-settings usage (L184-191)
- Build directories use UUID suffixes for parallel build isolation (L367-368)
- Archive operations preserve Unix file permissions (L793)