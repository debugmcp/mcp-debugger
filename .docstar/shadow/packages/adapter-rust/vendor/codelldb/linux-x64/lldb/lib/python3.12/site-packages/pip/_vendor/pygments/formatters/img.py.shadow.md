# packages/adapter-rust/vendor/codelldb/linux-x64/lldb/lib/python3.12/site-packages/pip/_vendor/pygments/formatters/img.py
@source-hash: 6e495876cd77998c
@generated: 2026-02-09T17:58:03Z

## Purpose
Pygments image formatter that renders syntax-highlighted source code to raster images (PNG, GIF, JPEG, BMP) using the Python Imaging Library (PIL). Supports font management across platforms and extensive customization of visual output including line numbers, highlighting, and typography.

## Key Components

### Exception Classes
- `PilNotAvailable` (L52-53): Raised when PIL is unavailable
- `FontNotFound` (L56-57): Raised when no usable fonts can be located

### Font Management
- `FontManager` (L60-270): Cross-platform font loading and style management
  - `__init__(L65-91)`: Initializes fonts, handles file paths or system fonts
  - Platform-specific font discovery:
    - `_create_nix(L106-126)`: Linux font discovery via fontconfig
    - `_create_mac(L130-158)`: macOS font discovery from system directories  
    - `_create_win(L174-211)`: Windows font discovery via registry lookup
  - `get_font(L229-252)`: Returns appropriate font for bold/italic combinations
  - `get_text_size(L219-227)`: Compatibility wrapper for PIL text sizing

### Core Formatter
- `ImageFormatter` (L272-640): Main formatter class extending Pygments Formatter
  - `__init__(L392-446)`: Extensive option parsing for visual customization
  - `format(L608-639)`: Primary rendering pipeline - creates drawables, renders to PIL Image
  - Text positioning methods: `_get_text_pos(L476-480)`, `_get_char_x(L470-474)`
  - Drawing pipeline:
    - `_create_drawables(L540-578)`: Processes token stream into drawable elements
    - `_draw_line_numbers(L580-589)`: Generates line number drawables
    - `_paint_line_number_bg(L591-606)`: Renders line number background

### Format-Specific Subclasses
- `GifImageFormatter` (L645-657): GIF output specialization
- `JpgImageFormatter` (L659-671): JPEG output specialization  
- `BmpImageFormatter` (L673-684): BMP output specialization

## Dependencies
- PIL/Pillow for image generation (L21-24)
- Platform-specific font utilities (fontconfig on Linux, registry on Windows)
- Pygments base formatter and utilities (L13-15)

## Key Constants
- `STYLES` (L39-44): Font style name mappings for cross-platform compatibility
- Default font names per platform (L47-49)
- Supported image formats: PNG (default), JPEG, GIF, BMP

## Architecture Notes
- Two-phase rendering: token processing to drawables, then PIL image painting
- Platform abstraction for font discovery with fallbacks
- Extensive customization through formatter options (30+ configurable parameters)
- Backward compatibility handling for PIL API changes (getbbox vs getsize)
- Variable font support with style variation fallbacks