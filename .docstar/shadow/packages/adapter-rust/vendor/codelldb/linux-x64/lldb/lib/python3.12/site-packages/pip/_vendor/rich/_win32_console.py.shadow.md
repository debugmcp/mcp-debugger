# packages/adapter-rust/vendor/codelldb/linux-x64/lldb/lib/python3.12/site-packages/pip/_vendor/rich/_win32_console.py
@source-hash: 3f4bf12367dc9ddc
@generated: 2026-02-09T18:01:49Z

## Primary Purpose
Windows Console API wrapper for the Rich library, providing low-level terminal control on Windows systems. Only imports on Windows platforms and raises ImportError elsewhere (L10-13).

## Key Classes and Structures

### Exception Classes
- `LegacyWindowsError` (L28-29): Custom exception for Windows Console API failures

### Data Structures
- `WindowsCoordinates` (L32-53): NamedTuple wrapper for Windows console coordinates with (row, col) ordering, includes `from_param` classmethod for ctypes conversion
- `CONSOLE_SCREEN_BUFFER_INFO` (L56-63): ctypes Structure for console screen buffer information
- `CONSOLE_CURSOR_INFO` (L66-67): ctypes Structure for cursor size and visibility

### Main Terminal Class
- `LegacyWindowsTerm` (L330-574): Full-featured terminal control class
  - Constructor (L361-373): Initializes with file handle, gets default text attributes
  - Properties: `cursor_position` (L376-383), `screen_size` (L386-395)
  - Text output: `write_text` (L397-404), `write_styled` (L406-443)
  - Cursor movement: `move_cursor_to` (L445-453), directional movement methods (L494-546)
  - Line operations: `erase_line`, `erase_end_of_line`, `erase_start_of_line` (L455-492)
  - Cursor visibility: `hide_cursor` (L548-552), `show_cursor` (L554-558)
  - Window title: `set_title` (L560-567)

## Core API Functions
All functions wrap kernel32.dll calls with proper argument/return type definitions:

- `GetStdHandle` (L77-86): Get standard device handles
- `GetConsoleMode` (L94-113): Retrieve console mode settings
- `FillConsoleOutputCharacter` (L127-154): Fill console area with character
- `FillConsoleOutputAttribute` (L168-192): Set character attributes for console area
- `SetConsoleTextAttribute` (L203-216): Set text color attributes
- `GetConsoleScreenBufferInfo` (L227-240): Get screen buffer information
- `SetConsoleCursorPosition` (L251-263): Move cursor to coordinates
- `GetConsoleCursorInfo`/`SetConsoleCursorInfo` (L274-310): Cursor visibility control
- `SetConsoleTitle` (L318-327): Set console window title

## Important Dependencies
- `ctypes` and `wintypes`: Windows API bindings
- `pip._vendor.rich.color.ColorSystem` and `pip._vendor.rich.style.Style`: Rich styling integration

## Key Constants and Mappings
- `STDOUT = -11`, `ENABLE_VIRTUAL_TERMINAL_PROCESSING = 4` (L22-23)
- `ANSI_TO_WINDOWS` mapping array (L342-359): Converts ANSI color codes to Windows console colors
- `BRIGHT_BIT = 8` (L339): Bit flag for bright/bold colors

## Architectural Decisions
- Uses NamedTuple for coordinate handling to prevent (x,y) vs (y,x) confusion
- Comprehensive ctypes argument/return type definitions for all API calls
- Color system integration with Rich's style system via ANSI-to-Windows color mapping
- Fallback handling for missing color values with sensible defaults

## Demo/Test Code
Executable section (L576-662) demonstrates all functionality with console output examples, cursor movement, and line erasing operations.