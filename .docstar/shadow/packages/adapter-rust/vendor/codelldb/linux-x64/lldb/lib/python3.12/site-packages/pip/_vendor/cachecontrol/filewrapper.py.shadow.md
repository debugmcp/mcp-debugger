# packages/adapter-rust/vendor/codelldb/linux-x64/lldb/lib/python3.12/site-packages/pip/_vendor/cachecontrol/filewrapper.py
@source-hash: 493b6d1a620f06f6
@generated: 2026-02-09T18:01:23Z

## Primary Purpose
A wrapper class that intercepts file reads and executes a callback with accumulated data when the file is closed. Part of pip's cache control system for HTTP response caching.

## Core Architecture
**CallbackFileWrapper (L14-119)**: Main wrapper class that proxies all file operations while tee-ing data to a temporary buffer. Uses double-underscore naming (`__buf`, `__fp`, `__callback`) to avoid attribute conflicts.

### Key Components
- **__init__ (L33-38)**: Initializes with HTTPResponse, callback function, and creates NamedTemporaryFile buffer
- **__getattr__ (L40-50)**: Proxy mechanism that forwards all attribute access to wrapped file object
- **__is_fp_closed (L52-68)**: Multi-fallback detection of file closure state, handles various HTTPResponse implementations

### Core Operations
- **read (L97-106)**: Primary read method that copies data to buffer and triggers cleanup on file closure
- **_safe_read (L108-119)**: Specialized read for chunked transfer encoding, with special handling for CRLF terminators
- **_close (L70-95)**: Executes callback with buffered data using memory-efficient mmap approach

## Memory Management Strategy
Uses NamedTemporaryFile as intermediate storage with mmap for efficient memory usage (L81-83). For small files, data stays in filesystem cache; larger files spill to disk under memory pressure. Explicit reference cycle breaking (L91) prevents deadlock issues.

## Dependencies
- **mmap**: Memory-mapped file access for efficient data handling
- **tempfile.NamedTemporaryFile**: Temporary storage backend
- **http.client.HTTPResponse**: Primary file object being wrapped

## Integration Pattern
Designed as transparent proxy wrapper - all undefined attributes delegated to underlying HTTPResponse object. Callback executed once when file reading completes, enabling cache storage of HTTP response bodies.