# packages/adapter-rust/vendor/codelldb/linux-x64/lldb/lib/python3.12/site-packages/pip/_vendor/urllib3/util/retry.py
@source-hash: 67a5847f9d7c7933
@generated: 2026-02-09T17:58:16Z

## Purpose
HTTP retry logic implementation for urllib3, providing configurable retry policies with exponential backoff, method/status filtering, and deprecation handling for legacy API compatibility.

## Key Components

### RequestHistory (L26-28)
Namedtuple storing retry attempt metadata: method, url, error, status, redirect_location.

### _RetryMeta (L35-89)
Metaclass providing deprecated property aliases with warnings:
- `DEFAULT_METHOD_WHITELIST` → `DEFAULT_ALLOWED_METHODS` 
- `DEFAULT_REDIRECT_HEADERS_BLACKLIST` → `DEFAULT_REMOVE_HEADERS_ON_REDIRECT`
- `BACKOFF_MAX` → `DEFAULT_BACKOFF_MAX`

### Retry Class (L92-617)
Main retry configuration and logic handler.

**Class Constants:**
- `DEFAULT_ALLOWED_METHODS` (L230-232): Idempotent HTTP methods for safe retry
- `RETRY_AFTER_STATUS_CODES` (L235): Status codes [413, 429, 503] that respect Retry-After header
- `DEFAULT_REMOVE_HEADERS_ON_REDIRECT` (L238): Headers to strip on redirect
- `DEFAULT_BACKOFF_MAX` (L241): 120 seconds maximum backoff

**Core Methods:**
- `__init__` (L243-302): Constructor with extensive parameter validation and deprecation handling
- `new` (L304-338): Creates new Retry instance with updated parameters
- `from_int` (L340-352): Backwards-compatibility factory for integer retry counts
- `increment` (L504-596): Core retry logic - decrements counters, validates limits, creates new instance
- `is_retry` (L468-486): Determines if method/status combination should be retried
- `is_exhausted` (L488-502): Checks if any retry counter has reached zero

**Backoff/Sleep Methods:**
- `get_backoff_time` (L354-369): Exponential backoff calculation based on consecutive errors
- `parse_retry_after` (L371-392): Parses Retry-After header (seconds or HTTP date)
- `sleep` (L418-432): Sleeps using Retry-After header or exponential backoff

**Error Classification:**
- `_is_connection_error` (L434-440): Identifies pre-request connection errors
- `_is_read_error` (L442-446): Identifies post-request read errors
- `_is_method_retryable` (L448-466): Validates HTTP method against allowlist

## Dependencies
- urllib3.exceptions: Various error types for retry logic
- email.utils: Retry-After header parsing
- time: Sleep functionality
- six: Python 2/3 compatibility

## Architecture Patterns
- Immutable retry objects (each attempt creates new instance)
- Extensive deprecation handling with warnings
- Metaclass for backwards-compatible property aliases
- Exponential backoff with jitter via consecutive error counting
- Header-based retry timing (Retry-After support)

## Critical Invariants
- Retry counters only decrease, never increase
- Method must be in allowed_methods for retry eligibility
- Total retry count takes precedence over specific counters
- False values disable retry types entirely
- History is append-only tuple tracking all attempts