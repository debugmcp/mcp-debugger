# packages/adapter-rust/vendor/codelldb/linux-x64/lldb/lib/python3.12/site-packages/pip/_vendor/urllib3/_collections.py
@source-hash: a72012249856ef07
@generated: 2026-02-09T18:02:00Z

## Purpose
Provides thread-safe collection implementations for urllib3, including an LRU cache container and a case-insensitive HTTP header dictionary.

## Key Classes

### RecentlyUsedContainer (L31-105)
Thread-safe LRU cache implementing MutableMapping interface. Uses OrderedDict as backing store with RLock for thread safety.
- **Constructor** (L47-52): `maxsize` controls capacity, `dispose_func` called on evicted items
- **Access pattern** (L54-59): `__getitem__` moves accessed items to end (LRU behavior)
- **Storage** (L61-74): `__setitem__` evicts oldest items when capacity exceeded
- **Thread safety**: All operations protected by `self.lock` (RLock instance)
- **Notable**: `__iter__` deliberately raises NotImplementedError for thread safety (L87-90)

### HTTPHeaderDict (L107-355)
Case-insensitive HTTP header container implementing MutableMapping. Stores headers with original case but compares case-insensitively per RFC 7230.
- **Storage model** (L143, L153): `_container[key.lower()] = [original_key, value1, value2, ...]`
- **Case handling** (L152-154, L156-158): Keys normalized to lowercase for storage, original case preserved
- **Multi-value support** (L215-229): `add()` method appends values, `__setitem__` overwrites
- **Iteration methods**:
  - `iteritems()` (L313-318): Returns all key-value pairs including duplicates
  - `itermerged()` (L320-324): Returns merged values joined with ", "
- **HTTP-specific methods**:
  - `_prepare_for_method_change()` (L271-287): Removes content headers for GET/HEAD requests per RFC 9110
  - `from_httplib()` (L329-355): Parses Python 2 httplib message format with multiline header support

## Dependencies
- Collections: OrderedDict, Mapping/MutableMapping (L3-6, L19)
- Threading: RLock with fallback no-op implementation (L7-16)
- Internal: `.exceptions.InvalidHeader`, `.packages.six` utilities (L21-23)

## Architecture Patterns
- **Cross-compatibility**: Handles Python 2/3 differences (L3-6, L178-180)
- **Thread-safe fallback**: RLock implementation for platforms without threading (L10-16)
- **Sentinel objects**: `_Null` (L28) and `__marker` (L182) for distinguishing None values
- **Case-insensitive mapping**: Lowercase keys for lookup while preserving original case

## Critical Invariants
- RecentlyUsedContainer: Container size never exceeds `_maxsize`
- HTTPHeaderDict: Internal storage format `[original_key, value1, value2, ...]` must be maintained
- Thread safety: All RecentlyUsedContainer operations must be lock-protected
- Case preservation: HTTPHeaderDict must preserve original case while enabling case-insensitive access