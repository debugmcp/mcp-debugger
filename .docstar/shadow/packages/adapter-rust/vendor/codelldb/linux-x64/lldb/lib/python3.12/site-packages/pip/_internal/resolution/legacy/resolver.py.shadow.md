# packages/adapter-rust/vendor/codelldb/linux-x64/lldb/lib/python3.12/site-packages/pip/_internal/resolution/legacy/resolver.py
@source-hash: dc766224145dd454
@generated: 2026-02-09T17:58:02Z

## Purpose
Legacy dependency resolver for pip package installations. Implements a "first found, wins" breadth-first resolution strategy for sub-dependencies while enforcing single-spec constraints for top-level requirements.

## Key Classes

### Resolver (L109-597)
Main resolver class inheriting from BaseResolver. Orchestrates the entire dependency resolution process.

**Constructor (L116-153):**
- Accepts preparer, finder, wheel cache, and various installation flags
- Validates upgrade strategy against allowed strategies: "eager", "only-if-needed", "to-satisfy-only"
- Normalizes Python version info for compatibility checking

**Core Resolution Method:**
- `resolve()` (L154-189): Entry point that processes root requirements, prepares files, and handles hash validation
- `_resolve_one()` (L487-568): Resolves a single requirement and its dependencies recursively
- `get_installation_order()` (L570-597): Creates topological installation order, breaking cycles arbitrarily

**Requirement Management:**
- `_add_requirement_to_set()` (L191-304): Core logic for adding requirements, handles conflicts, constraints, and merging
- `_check_skip_installed()` (L326-378): Determines if installed packages should be skipped/upgraded
- `_populate_link()` (L402-439): Finds and caches wheel links for requirements

**Upgrade Logic:**
- `_is_upgrade_allowed()` (L306-313): Implements upgrade strategy decisions
- `_set_req_to_reinstall()` (L315-324): Marks requirements for reinstallation

## Key Functions

### _check_dist_requires_python() (L55-106)
Validates Python version compatibility against distribution's Requires-Python metadata. Handles invalid specifiers gracefully with warnings.

## Important Dependencies
- RequirementSet: Manages collection of requirements to install
- PackageFinder: Locates packages from indexes  
- RequirementPreparer: Downloads and prepares packages
- WheelCache: Caches built wheels
- BaseDistribution: Metadata interface for installed/prepared packages

## Architecture Patterns
- **Legacy Resolution Strategy**: Breadth-first "first found, wins" for sub-dependencies
- **Conflict Detection**: Prevents double requirements for top-level specs
- **Lazy Link Population**: Defers package finding until needed
- **Topological Ordering**: Ensures dependencies install before dependents
- **Cache Integration**: Leverages wheel cache when hash validation not required

## Critical Constraints
- Only one spec allowed per top-level project (enforced at L260-264)
- Top-level requirements override sub-dependency requirements
- Hash validation bypasses wheel cache to ensure integrity
- Python version compatibility checked for all distributions
- Constraints cannot specify installation from paths/URLs (L278-286)

## Type Definitions
- `DiscoveredDependencies` (L52): Maps requirement names to their discovered dependencies