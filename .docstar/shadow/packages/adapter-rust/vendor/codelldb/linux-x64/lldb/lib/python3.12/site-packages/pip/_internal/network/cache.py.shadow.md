# packages/adapter-rust/vendor/codelldb/linux-x64/lldb/lib/python3.12/site-packages/pip/_internal/network/cache.py
@source-hash: e3c03def5a82cca3
@generated: 2026-02-09T18:01:16Z

## Purpose
Implements HTTP cache functionality for pip's network operations, providing a thread-safe file-based cache that gracefully handles filesystem access errors and race conditions.

## Key Components

### Utility Functions
- `is_from_cache()` (L17-18): Checks if a Response object came from cache by examining the `from_cache` attribute
- `suppressed_cache_errors()` (L21-29): Context manager that silently catches OSError exceptions, allowing cache operations to fail gracefully without disrupting the main request flow

### Core Cache Implementation
- `SafeFileCache` (L32-106): Thread-safe file cache extending `SeparateBodyBaseCache` that stores HTTP responses as separate metadata and body files

#### Key Methods:
- `__init__()` (L50-53): Initializes with cache directory validation
- `_get_cache_path()` (L55-61): Generates hierarchical file paths using encoded hash of cache keys (creates 5-level directory structure)
- `get()` (L63-71): Retrieves cached metadata, requires both metadata and body files to exist
- `set()` (L82-86): Stores cache metadata using atomic write operations
- `get_body()` (L95-102): Returns binary file handle for cached response body, validates both files exist
- `set_body()` (L104-106): Stores response body data separately from metadata
- `delete()` (L88-93): Removes both metadata and body files
- `_write()` (L73-80): Atomic write helper using temporary files and atomic replacement

## Dependencies
- `cachecontrol`: Provides base caching infrastructure (`SeparateBodyBaseCache`, `SeparateBodyFileCache`)
- `pip._internal.utils.filesystem`: File operations (`adjacent_tmp_file`, `replace`)
- `pip._internal.utils.misc`: Directory utilities (`ensure_dir`)

## Architecture & Design Patterns
- **Separation of Concerns**: Metadata and body stored in separate files to handle large response bodies efficiently
- **Atomic Operations**: Uses temporary files + atomic rename to prevent corruption during concurrent writes
- **Graceful Degradation**: All cache operations wrapped with error suppression to ensure pip continues working even with cache failures
- **Race Condition Mitigation**: Validates both metadata and body files exist before considering cache entry valid

## Critical Constraints
- **Race Condition Assumption**: Assumes servers return identical data for same URLs (important for PyPI wheel downloads)
- **File System Safety**: Designed to work even when cache directory is not accessible/writable
- **Dual File Requirement**: Cache entries are only valid when both metadata (.cache) and body (.body) files exist