# packages/adapter-rust/vendor/codelldb/linux-x64/lldb/lib/python3.12/site-packages/pip/_vendor/urllib3/util/ssltransport.py
@source-hash: 340faee6b313ac31
@generated: 2026-02-09T17:58:09Z

## Primary Purpose
SSL transport wrapper that enables TLS-in-TLS connections using memory BIOs, providing a socket-like interface over an existing socket connection.

## Key Components

### SSLTransport Class (L11-221)
Main class that wraps an existing socket with SSL/TLS encryption using memory BIOs instead of direct socket wrapping.

**Constructor** (L44-61):
- Initializes incoming/outgoing memory BIOs for SSL data buffering
- Creates SSL object via `ssl_context.wrap_bio()`
- Performs initial handshake automatically
- Parameters: socket, ssl_context, server_hostname, suppress_ragged_eofs

**Core I/O Methods**:
- `read()` (L72-73): Delegates to `_wrap_ssl_read()`
- `recv()` (L75-78): Socket-compatible receive with flags validation
- `recv_into()` (L80-87): Buffer-based receive
- `send()` (L99-103): Single send operation via `_ssl_io_loop()`
- `sendall()` (L89-98): Complete data transmission with retry logic

**SSL Protocol Methods** (L156-176):
- Certificate handling: `getpeercert()`
- Protocol info: `version()`, `cipher()`, `selected_alpn_protocol()`, `selected_npn_protocol()`
- Connection details: `shared_ciphers()`, `compression()`

**Socket Compatibility Methods**:
- `makefile()` (L105-148): Creates file-like objects with buffering support
- `fileno()`, `settimeout()`, `gettimeout()`: Direct socket delegation
- Context manager support: `__enter__()`, `__exit__()` (L63-67)

### Key Internal Methods

**`_validate_ssl_context_for_tls_in_tls()`** (L22-42):
Static method validating SSL context has required `wrap_bio` method. Raises `ProxySchemeUnsupported` for Python 2 or non-native SSL contexts.

**`_ssl_io_loop()`** (L195-221):
Core I/O coordination method managing data flow between memory BIOs and underlying socket:
- Executes SSL operations with retry logic
- Handles `SSL_ERROR_WANT_READ`/`SSL_ERROR_WANT_WRITE` states
- Manages outgoing data transmission and incoming data buffering
- Uses `SSL_BLOCKSIZE` (16384 bytes) for socket reads

**`_wrap_ssl_read()`** (L186-193):
SSL read wrapper with EOF handling - suppresses `SSL_ERROR_EOF` when `suppress_ragged_eofs=True`.

## Dependencies
- `ssl`: Core SSL/TLS functionality and memory BIO operations
- `socket`: Underlying network socket operations  
- `io`: Buffered I/O for makefile() implementation
- `..exceptions.ProxySchemeUnsupported`: Custom exception for unsupported proxy schemes
- `..packages.six`: Python 2/3 compatibility utilities

## Architecture Notes
- Uses memory BIOs (`ssl.MemoryBIO`) for SSL data buffering instead of direct socket wrapping
- Enables TLS-in-TLS scenarios by abstracting SSL layer from underlying transport
- Maintains socket API compatibility for drop-in replacement
- Implements proper I/O loop handling for non-blocking SSL operations