# packages/adapter-rust/vendor/codelldb/linux-x64/lldb/lib/python3.12/site-packages/pip/_vendor/truststore/_api.py
@source-hash: 07d2481e2a730484
@generated: 2026-02-09T18:01:57Z

## Core Purpose
Cross-platform SSL/TLS certificate verification library that integrates system certificate stores (Windows, macOS, Linux) into Python's ssl module. Provides a drop-in replacement for ssl.SSLContext that uses OS-native certificate verification.

## Key Components

### Injection/Extraction Functions
- `inject_into_ssl()` (L32-45): Monkey patches ssl.SSLContext with truststore implementation globally, including urllib3 module
- `extract_from_ssl()` (L47-56): Restores original ssl.SSLContext implementation

### Core SSLContext Implementation  
- `SSLContext` (L58-274): Drop-in replacement for ssl.SSLContext that delegates to OS certificate verification
  - `__init__()` (L68-82): Creates wrapped original SSLContext with custom TruststoreSSLObject
  - `wrap_socket()` (L83-109): Socket wrapping with certificate verification via _verify_peercerts
  - `wrap_bio()` (L111-127): BIO wrapping for memory-based SSL objects
  - Proxy properties/methods (L129-274): Delegates most SSL operations to internal _ctx

### Certificate Verification
- `_verify_peercerts()` (L296-313): Extracts certificate chain and calls platform-specific verification
- `_get_unverified_chain_bytes()` (L282-293): Version-aware certificate chain extraction (Python 3.13+ compatibility)
- `TruststoreSSLObject` (L71-81): Custom SSLObject that performs certificate verification after handshake

### Platform Abstractions
- Platform-specific imports (L17-22): Conditionally imports _configure_context and _verify_peercerts_impl based on OS
- Type aliases (L28-29): Common SSL parameter types for cross-version compatibility

## Architecture Patterns
- **Decorator Pattern**: SSLContext wraps original implementation while adding truststore verification
- **Platform Strategy**: Runtime platform detection determines certificate verification strategy  
- **Monkey Patching**: Global ssl module replacement for transparent integration
- **Context Manager**: _configure_context manages platform-specific SSL configuration state
- **Version Compatibility**: Handles Python 3.10-3.13+ API differences in certificate chain access

## Critical Invariants
- Always calls _verify_peercerts after successful handshake for certificate validation
- Maintains ssl.SSLContext API compatibility for drop-in replacement
- Platform-specific certificate store integration requires corresponding _configure_context implementation
- Exception safety: closes SSL socket on verification failure to prevent resource leaks