# packages/adapter-rust/vendor/codelldb/linux-x64/lldb/lib/python3.12/site-packages/pip/_internal/index/collector.py
@source-hash: 45d3ced092c0966c
@generated: 2026-02-09T18:01:27Z

## Package Index Link Collection

This module implements `LinkCollector.collect_sources()` (L450-494), the main entry point for discovering package download sources from PyPI indexes and find-links URLs. Part of pip's package discovery infrastructure.

### Core Components

**LinkCollector** (L390-494) - Primary orchestrator that:
- Maintains session and search scope configuration (L398-404)  
- Factory method `create()` (L406-438) builds from command-line options
- `collect_sources()` (L450-494) returns deduplicated `CollectedSources` containing find-links and index URL sources
- `fetch_response()` (L444-448) delegates to `_get_index_content()` for page retrieval

**IndexContent** (L252-271) - Frozen dataclass representing a fetched page:
- Contains raw content bytes, content-type, encoding, URL
- `cache_link_parsing` flag controls link parsing optimization
- String representation redacts auth credentials

**HTMLLinkParser** (L273-299) - Custom HTML parser extending `HTMLParser`:
- Extracts base href (L287-290) and anchor element attributes (L291-292)
- Used for parsing HTML simple API responses

### HTTP Response Handling

**_get_simple_response()** (L113-173) - Core HTTP client logic:
- Sends HEAD request first for suspected archives to check content-type
- Makes GET with specific Accept headers preferring JSON over HTML
- Sets Cache-Control: max-age=0 to avoid stale package data (L141-154)
- Validates response has valid Simple API content-type

**_get_index_content()** (L324-382) - Main page fetching with comprehensive error handling:
- Filters VCS schemes that don't support web lookup (L327-335)
- Converts file:// directories to index.html paths (L337-349)
- Handles various network exceptions with appropriate logging

### Link Parsing & Caching

**parse_links()** (L224-249) - Decorated with `@with_cached_index_content`:
- Handles both JSON (PEP 691) and HTML simple API formats
- Returns `Link` objects parsed from page content
- JSON parsing extracts from "files" array, HTML uses `HTMLLinkParser`

**with_cached_index_content()** (L203-220) - Caching decorator:
- Uses `CacheablePageContent` wrapper for cache keys
- LRU cache with unlimited size when `cache_link_parsing=True`
- Bypasses cache for non-cacheable pages (like PyPI index URLs)

### Utility Functions

**_ensure_api_header()** (L69-88) - Validates Content-Type for Simple API responses
**_ensure_api_response()** (L95-111) - HEAD request validation for suspected archives  
**_match_vcs_scheme()** (L51-59) - VCS URL scheme detection
**_get_encoding_from_headers()** (L176-184) - Content-Type charset extraction

### Data Types

**CollectedSources** (L385-387) - NamedTuple containing find-links and index URL sources
**CacheablePageContent** (L187-197) - Cache key wrapper for IndexContent
**_NotAPIContent**, **_NotHTTP** (L62-92) - Exception types for response validation

### Dependencies

- `pip._internal.network.session.PipSession` for HTTP operations
- `pip._internal.models.link.Link` for URL representation  
- `pip._vendor.requests` for HTTP client functionality
- `.sources` module for `build_source()` and related types