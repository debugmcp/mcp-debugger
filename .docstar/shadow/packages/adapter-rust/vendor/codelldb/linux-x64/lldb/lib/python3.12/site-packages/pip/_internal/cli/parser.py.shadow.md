# packages/adapter-rust/vendor/codelldb/linux-x64/lldb/lib/python3.12/site-packages/pip/_internal/cli/parser.py
@source-hash: 400918eacf0df800
@generated: 2026-02-09T18:01:08Z

**Primary Purpose:** Provides custom option parser classes for pip's CLI, extending optparse with pretty formatting, configuration file integration, and environment variable support.

**Key Classes:**

- **PrettyHelpFormatter (L18-98)**: Custom help formatter that improves optparse's default output with better terminal width handling, cleaner option string formatting, and improved heading/description layout. Key methods:
  - `_format_option_strings()` (L31-55): Formats option strings with metavars
  - `format_description()` (L70-86): Handles description formatting with "Commands" vs "Description" labels
  - `indent_lines()` (L95-97): Utility for consistent text indentation

- **UpdatingDefaultsHelpFormatter (L100-130)**: Extends PrettyHelpFormatter to update defaults before displaying help and redact authentication from URLs. Core method `expand_default()` (L109-129) handles URL sanitization for security.

- **CustomOptionParser (L132-152)**: Basic optparse.OptionParser extension adding:
  - `insert_option_group()` (L133-142): Inserts option groups at specific positions
  - `option_list_all` property (L144-151): Aggregates all options including those in groups

- **ConfigOptionParser (L154-294)**: Main parser class integrating configuration files and environment variables. Key functionality:
  - `_get_ordered_configuration_items()` (L178-204): Processes config with precedence order ["global", name, ":env:"]
  - `_update_defaults()` (L206-268): Core logic handling different option types (boolean, count, append, callback)
  - `get_default_values()` (L270-290): Overrides optparse to load configuration and apply defaults

**Dependencies:**
- optparse for base parsing functionality
- Configuration class for config file handling
- logging for debug output
- Terminal utilities (shutil.get_terminal_size) for responsive formatting

**Architecture Decisions:**
- Three-layer inheritance: optparse → CustomOptionParser → ConfigOptionParser
- Configuration precedence: global < command-specific < environment variables
- Late evaluation pattern for callback options to handle complex dependencies
- URL redaction for security in help output

**Critical Constraints:**
- Configuration keys must use long option names (prefixed with "--")
- Boolean config values validated through strtobool()
- Callback options require delayed evaluation stored in late_eval set
- Terminal width dynamically calculated minus 2 characters for margins