# packages/adapter-rust/vendor/codelldb/linux-x64/lldb/lib/python3.12/site-packages/pip/_vendor/rich/_windows.py
@source-hash: 681c1a0ff4b9e926
@generated: 2026-02-09T18:01:42Z

## Primary Purpose
Windows console feature detection module for the Rich terminal library, determining console capabilities for VT100 escape sequences and truecolor support on Windows systems.

## Key Components

### WindowsConsoleFeatures (L6-13)
Dataclass representing Windows console capabilities:
- `vt: bool` - Console supports VT100/ANSI escape codes
- `truecolor: bool` - Console supports 24-bit color

### Platform Detection & Import Logic (L15-31)
Conditional Windows-specific imports wrapped in try/except:
- Imports `ctypes` and `LibraryLoader` for Windows API access
- Platform check for `sys.platform == "win32"` (L19)
- Imports Windows console API functions from `_win32_console` module (L25-30)
- Raises `ImportError` for non-Windows platforms (L23)

### Feature Detection Functions

#### Fallback Implementation (L34-36)
Returns default `WindowsConsoleFeatures()` with both features disabled when Windows APIs unavailable.

#### Windows Implementation (L40-61)
Primary feature detection logic:
1. Gets standard output handle via `GetStdHandle()` (L46)
2. Retrieves console mode with error handling for legacy systems (L47-52)
3. Checks VT support by testing `ENABLE_VIRTUAL_TERMINAL_PROCESSING` flag (L53)
4. Determines truecolor support based on Windows version (L56-59):
   - Requires Windows 10 build 15063 or later
   - Only available when VT support is enabled

### Debug/Testing Entry Point (L64-71)
When run as main module, prints platform information and detected console features.

## Dependencies
- Internal: `pip._vendor.rich._win32_console` for Windows API wrappers
- External: `ctypes`, `sys`, `dataclasses`, `platform`

## Architecture Pattern
Uses try/except import pattern to provide graceful fallback on non-Windows systems or when Windows APIs are unavailable, ensuring cross-platform compatibility.