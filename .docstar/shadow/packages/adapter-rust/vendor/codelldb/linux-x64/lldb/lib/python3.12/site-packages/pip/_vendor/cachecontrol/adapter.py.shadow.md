# packages/adapter-rust/vendor/codelldb/linux-x64/lldb/lib/python3.12/site-packages/pip/_vendor/cachecontrol/adapter.py
@source-hash: 7c1c8efcf77f10e7
@generated: 2026-02-09T18:01:24Z

## Primary Purpose
HTTP adapter that extends requests' HTTPAdapter to provide transparent HTTP response caching functionality. Intercepts HTTP requests/responses to cache responses according to HTTP cache-control semantics and serve cached responses when appropriate.

## Key Components

### CacheControlAdapter Class (L26-161)
Main adapter class inheriting from HTTPAdapter that implements caching logic:

- **invalidating_methods** (L27): Static set of HTTP methods that invalidate cache entries
- **__init__** (L29-48): Initializes cache backend, controller, heuristics, and cacheable methods configuration
- **send** (L50-78): Core request sending logic with cache lookup and conditional request handling
- **build_response** (L80-157): Response building with caching, ETag handling, and cache invalidation
- **close** (L159-161): Cleanup method for cache backend

## Key Dependencies

- **HTTPAdapter** (L11): Base class from requests library
- **CacheController** (L14): Core caching logic and cache management
- **DictCache** (L13): Default in-memory cache backend
- **CallbackFileWrapper** (L15): Stream wrapper for lazy caching

## Architecture Patterns

### Cache-First Strategy
1. Check cache for existing response (L67)
2. Add conditional headers for revalidation (L74)
3. Make network request if cache miss
4. Cache response through stream wrapper (L128-133)

### ETag Handling (L101-121)
- Processes 304 Not Modified responses
- Updates cached responses with fresh headers
- Manages connection lifecycle for 304 responses

### Lazy Caching (L128-144)
- Wraps response streams with CallbackFileWrapper
- Caches response only after stream consumption
- Special handling for chunked transfer encoding

## Critical Behaviors

### Cache Invalidation (L149-152)
Invalidates cache entries for PUT/PATCH/DELETE requests on successful responses

### Error Handling (L68-69)
Gracefully handles zlib decompression errors by treating as cache miss

### Chunked Response Handling (L134-144)
Monkey-patches response objects to trigger caching callback when chunks are fully consumed