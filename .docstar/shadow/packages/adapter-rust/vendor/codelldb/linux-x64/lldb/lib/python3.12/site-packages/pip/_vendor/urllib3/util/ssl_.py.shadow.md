# packages/adapter-rust/vendor/codelldb/linux-x64/lldb/lib/python3.12/site-packages/pip/_vendor/urllib3/util/ssl_.py
@source-hash: 5f8f80a96f756983
@generated: 2026-02-09T17:58:11Z

## Purpose
SSL/TLS utility module for urllib3 that provides cross-platform SSL context creation, socket wrapping, and security configuration. Handles fallbacks for older Python versions and different SSL implementations.

## Key Functions

**_const_compare_digest_backport (L30-40)**: Constant-time digest comparison function for security, prevents timing attacks by XORing bytes and checking result.

**assert_fingerprint (L182-208)**: Certificate fingerprint verification using configurable hash functions (MD5, SHA1, SHA256). Maps digest lengths to hash functions via HASHFUNC_MAP (L27).

**resolve_cert_reqs (L211-231)**: Resolves certificate requirement strings/constants to ssl module values, defaults to CERT_REQUIRED.

**resolve_ssl_version (L234-247)**: Similar resolver for SSL/TLS protocol versions, defaults to PROTOCOL_TLS.

**create_urllib3_context (L250-352)**: Main SSL context factory with secure defaults:
- Disables SSLv2, SSLv3, compression, and tickets
- Sets restricted cipher suite (DEFAULT_CIPHERS L110-127)
- Handles post-handshake authentication for TLS 1.3 (L320-323)
- Configures hostname verification carefully due to SSLContext constraints (L325-343)
- Supports SSL key logging via SSLKEYLOGFILE environment variable (L347-350)

**ssl_wrap_socket (L355-454)**: High-level socket wrapping function with comprehensive parameter support:
- Creates SSL context if not provided
- Handles CA certificate loading from files/directories/data
- Detects encrypted private keys (L413-414)
- Manages SNI (Server Name Indication) logic with IP address detection (L428-446)
- Delegates to _ssl_wrap_socket_impl for actual wrapping

**is_ipaddress (L457-467)**: IPv4/IPv6 address detection using regex patterns from url module, handles bytes input for Python 3.

**_is_key_file_encrypted (L470-478)**: Simple encrypted key file detection by searching for "ENCRYPTED" marker.

**_ssl_wrap_socket_impl (L481-495)**: Low-level socket wrapping implementation, handles TLS-in-TLS via SSLTransport when needed.

## Key Classes

**SSLContext (L133-179)**: Fallback implementation for Python 2/older versions lacking native SSLContext. Provides basic SSL context interface with certificate loading, cipher setting, and socket wrapping. Issues deprecation warning when used (L162-170).

## Dependencies
- ssl module (with extensive fallback handling L45-91)
- hmac for secure comparisons
- hashlib for fingerprint verification  
- binascii for hex operations
- urllib3.exceptions for error types
- urllib3.packages.six for Python 2/3 compatibility
- .url module for IP address patterns
- .ssltransport for TLS-in-TLS support

## Architecture Patterns
- Extensive try/except blocks for SSL feature detection and fallbacks
- Constant definitions with fallback values for missing SSL constants (L74-91)
- Secure defaults approach with explicit security-focused cipher selection
- Cross-platform compatibility layer for different Python/OpenSSL versions

## Security Considerations
- Uses constant-time comparison for certificate fingerprints
- Disables insecure protocols (SSLv2, SSLv3) and compression by default
- Implements secure cipher suite selection prioritizing forward secrecy
- Validates encrypted key files to prevent terminal password prompts
- Proper SNI handling with IP address exclusion per RFC3546