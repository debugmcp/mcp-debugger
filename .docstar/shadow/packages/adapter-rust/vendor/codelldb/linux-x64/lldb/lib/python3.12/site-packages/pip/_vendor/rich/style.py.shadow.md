# packages/adapter-rust/vendor/codelldb/linux-x64/lldb/lib/python3.12/site-packages/pip/_vendor/rich/style.py
@source-hash: de18a8707ff837cb
@generated: 2026-02-09T18:01:57Z

## Style System for Terminal Formatting

A comprehensive terminal styling system that manages colors, text attributes (bold, italic, underline, etc.), and ANSI escape code generation. The main class `Style` represents immutable terminal styles with efficient composition and caching.

### Core Classes

**_Bit (L16-28)**: Descriptor for managing style attribute bits using bitwise operations. Each attribute corresponds to a bit position in the style's attribute mask.

**Style (L31-760)**: The primary styling class that encapsulates:
- Colors: foreground (`_color`) and background (`_bgcolor`) as Color objects
- Attributes: 13 text styling flags (bold, italic, underline, etc.) stored as bitmasks
- Links: hyperlink URLs with unique identifiers
- Meta: arbitrary metadata serialized as bytes
- Caching: ANSI codes (`_ansi`) and string representation (`_style_definition`)

Key attributes use bit positions 0-12 mapped to ANSI SGR parameters via `_style_map` (L81-95).

**StyleStack (L765-796)**: Stack-based style management for nested contexts, combining styles additively when pushed.

### Critical Methods

**Style.__init__ (L122-197)**: Constructs style with color parsing, attribute bitmask calculation, and link ID generation. Uses bitwise operations to efficiently encode 13 boolean attributes.

**Style.parse (L497-561)**: Parses human-readable style definitions like "bold red on blue". Tokenizes input and handles special keywords ("on", "not", "link").

**Style._make_ansi_codes (L335-376)**: Generates ANSI escape sequences by mapping attribute bits to SGR codes and delegating color rendering to Color objects.

**Style._add (L733-755)**: Core composition logic using bitwise operations. New attributes override old ones where set, colors are replaced if specified, metadata is merged.

**Style.render (L694-718)**: Produces final ANSI-formatted strings with escape sequences for terminal output.

### Performance Optimizations

- `NULL_STYLE` singleton (L762) for empty styles
- Extensive `@lru_cache` decorators on parsing, normalization, and composition methods
- Lazy ANSI code generation with caching
- `__slots__` for memory efficiency
- Bitwise operations for attribute management

### Dependencies

- `.color`: Color parsing and ANSI code generation
- `.terminal_theme`: Theme-based color rendering
- `.errors`: Custom exception types for parsing errors
- `marshal`: Efficient metadata serialization

The system supports 13 text attributes, full color management (truecolor/256/16 color systems), hyperlinks with OSC 8 sequences, and CSS generation for HTML export.