# packages/adapter-rust/vendor/codelldb/linux-x64/lldb/lib/python3.12/site-packages/pip/_vendor/urllib3/contrib/appengine.py
@source-hash: 551ebc780544d77e
@generated: 2026-02-09T17:58:04Z

## Primary Purpose
Google App Engine adapter for urllib3 that provides HTTP connectivity using URLFetch API instead of sockets. Enables urllib3 usage in GAE sandbox environments with URLFetch-specific limitations and error handling.

## Key Classes

### AppEnginePlatformWarning (L71-72)
Custom warning class for URLFetch-specific platform warnings.

### AppEnginePlatformError (L75-76) 
Custom error class for URLFetch platform-specific failures (size limits, unsupported methods).

### AppEngineManager (L79-306)
Main connection manager implementing RequestMethods interface for GAE URLFetch API.

**Constructor (L99-123):**
- Validates URLFetch availability, raises AppEnginePlatformError if missing
- Issues deprecation warning about URLFetch usage
- Configures certificate validation and retry behavior
- Sets default retry policy

**Core Methods:**
- `urlopen()` (L131-243): Primary HTTP request method wrapping urlfetch.fetch()
- `_urlfetch_response_to_http_response()` (L245-279): Converts URLFetch response to HTTPResponse
- `_get_absolute_timeout()` (L281-292): Handles timeout conversion with GAE limitations 
- `_get_retries()` (L294-305): Manages retry logic with URLFetch constraints

## Key Dependencies
- `google.appengine.api.urlfetch`: GAE URLFetch service (optional import L62-65)
- `..request.RequestMethods`: Base class providing HTTP method interface
- `..response.HTTPResponse`: Standard urllib3 response object
- `..util.retry.Retry`: Retry logic utilities
- `..util.timeout.Timeout`: Timeout handling
- `._appengine_environ`: Environment detection utilities

## Error Handling Patterns
URLFetch-specific exception mapping (L157-187):
- `DeadlineExceededError` → `TimeoutError`
- `InvalidURLError` with "too large" → `AppEnginePlatformError` (10MB request limit)
- `DownloadError` with "Too many redirects" → `MaxRetryError`
- `ResponseTooLargeError` → `AppEnginePlatformError` (32MB response limit)
- `SSLCertificateError` → `SSLError`
- `InvalidMethodError` → `AppEnginePlatformError`

## Architectural Decisions
- **Response Processing (L245-279)**: Creates two HTTPResponse objects - original and processed versions for proper decoding
- **Encoding Handling (L247-261)**: Special logic for GAE production deflate encoding and chunked transfer removal
- **Retry Strategy**: URLFetch handles some retries internally, warning issued for granular retry settings
- **Redirect Handling (L194-224)**: Manual redirect following when URLFetch retries disabled

## Environment Detection
Function aliases (L310-314) from `_appengine_environ` module:
- `is_appengine()`: Detects any GAE environment  
- `is_appengine_sandbox()`: Detects GAE sandbox (requires URLFetch)
- `is_local_appengine()`: Detects local GAE development
- `is_prod_appengine()`: Detects production GAE
- `is_prod_appengine_mvms()`: Detects production managed VMs

## Critical Constraints
- Request size limit: 10MB
- Response size limit: 32MB
- Limited HTTP method support
- No granular timeout control (connect/read timeouts ignored)
- URLFetch handles some retry logic internally