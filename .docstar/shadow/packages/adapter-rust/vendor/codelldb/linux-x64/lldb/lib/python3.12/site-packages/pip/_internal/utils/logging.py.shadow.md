# packages/adapter-rust/vendor/codelldb/linux-x64/lldb/lib/python3.12/site-packages/pip/_internal/utils/logging.py
@source-hash: c520df20745fcbde
@generated: 2026-02-09T18:01:26Z

## Primary Purpose
Comprehensive logging system for pip package manager, providing indented output, rich formatting via Rich library, and configurable logging levels with specialized handlers for different output streams.

## Core Components

### Thread-Safe Indentation System
- `_log_state` (L31): Thread-local storage for maintaining indentation state
- `indent_log()` (L54-66): Context manager for hierarchical log indentation
- `get_indentation()` (L69-70): Retrieves current thread-local indentation level

### Formatters
- `IndentingFormatter` (L73-122): Custom logging formatter that applies indentation and adds WARNING/ERROR prefixes
  - Handles timestamp prefixes when `add_timestamp=True`
  - Respects deprecation message formatting
  - Applies thread-local indentation to all log lines

### Rich Integration
- `IndentedRenderable` (L124-138): Dataclass wrapping Rich renderables with indentation support
- `RichPipStreamHandler` (L140-198): Custom Rich handler extending RichHandler
  - Handles both rich renderables and standard log messages
  - Applies color styling (red for errors, yellow for warnings)
  - Special broken pipe error handling for stdout streams

### Specialized Handlers & Filters
- `BetterRotatingFileHandler` (L200-203): Enhanced rotating file handler that ensures directory existence
- `MaxLevelFilter` (L206-211): Filters out records above specified level
- `ExcludeLoggerFilter` (L214-222): Inverted filter that excludes specific logger hierarchies

### Error Handling
- `BrokenStdoutLoggingError` (L35-38): Custom exception for broken pipe scenarios
- `_is_broken_pipe_error()` (L41-51): Cross-platform broken pipe detection (handles Windows EINVAL edge case)

### Configuration System
- `setup_logging()` (L225-347): Main configuration function that:
  - Maps verbosity levels (-3 to 2+) to logging levels
  - Configures multiple handlers (console, console_errors, console_subprocess, optional user_log)
  - Sets up filters for subprocess isolation and warning level management
  - Uses logging.config.dictConfig for comprehensive setup

## Key Dependencies
- Rich library for advanced console formatting and rendering
- Threading for thread-local state management
- Custom pip internal utilities (_log, compat, deprecation, misc)

## Critical Patterns
- Thread-local indentation state prevents race conditions in multi-threaded environments
- Broken pipe handling allows graceful degradation when output streams are closed
- Separation of console/error streams with different filtering rules
- Rich integration maintains formatting while supporting pip's indentation system

## Global State
- `subprocess_logger` (L32): Special logger instance for subprocess-related messages