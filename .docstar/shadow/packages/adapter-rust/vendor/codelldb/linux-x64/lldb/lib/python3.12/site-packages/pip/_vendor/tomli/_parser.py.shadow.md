# packages/adapter-rust/vendor/codelldb/linux-x64/lldb/lib/python3.12/site-packages/pip/_vendor/tomli/_parser.py
@source-hash: 83df8435a00b4be0
@generated: 2026-02-09T18:02:07Z

## Primary Purpose
This is the core TOML parser implementation for the `tomli` library. It provides functions to parse TOML (Tom's Obvious Minimal Language) documents from strings or binary file objects into Python dictionaries. The parser implements a complete TOML v1.0.0 compliant parser with proper error handling and validation.

## Key Classes and Functions

### Exception Classes
- **TOMLDecodeError (L53-54)**: Custom exception for TOML parsing errors, inherits from ValueError

### Entry Points
- **load (L57-66)**: Parses TOML from binary file object, decodes to string and delegates to `loads()`
- **loads (L69-132)**: Main parser function that converts TOML string to Python dict, handles complete parsing state machine

### Core Data Structures
- **Flags (L135-190)**: Manages parser state flags for namespaces and keys
  - `FROZEN = 0`: Marks immutable namespaces (inline arrays/tables)  
  - `EXPLICIT_NEST = 1`: Marks explicitly created nests that cannot be reopened with table syntax
  - Key methods: `add_pending()`, `finalize_pending()`, `set()`, `is_()`, `unset_all()`

- **NestedDict (L193-225)**: Manages nested dictionary structure during parsing
  - `get_or_create_nest()` (L198-213): Creates/accesses nested containers
  - `append_nest_to_list()` (L215-224): Handles array of tables syntax

- **Output (L227-229)**: NamedTuple combining NestedDict and Flags for parser state

### Parsing Rules
- **create_dict_rule (L284-299)**: Handles `[table]` declarations
- **create_list_rule (L302-320)**: Handles `[[array.of.tables]]` declarations  
- **key_value_rule (L323-354)**: Processes key-value pairs with validation
- **parse_key_value_pair (L357-370)**: Parses individual key=value statements
- **parse_key (L373-388)**: Parses dotted keys, handles quoted key parts

### Value Parsers
- **parse_value (L584-649)**: Main value parser dispatcher, handles all TOML value types
- **parse_array (L412-433)**: Parses arrays with comma separation and whitespace/comment handling
- **parse_inline_table (L436-465)**: Parses inline tables `{key = value}`

### String Parsers
- **parse_basic_str (L552-581)**: Handles basic strings with escape sequences
- **parse_literal_str (L512-518)**: Handles literal strings (single quotes)
- **parse_multiline_str (L521-549)**: Handles multiline strings (triple quotes)
- **parse_basic_str_escape (L468-494)**: Processes escape sequences in basic strings

### Utility Functions
- **skip_chars (L232-238)**: Advances position past specified characters
- **skip_until (L241-260)**: Finds next occurrence of target string with error checking
- **skip_comment (L263-272)**: Handles comment parsing
- **skip_comments_and_array_ws (L275-281)**: Skips whitespace and comments in arrays
- **suffixed_err (L652-666)**: Creates detailed error messages with source coordinates
- **make_safe_parse_float (L673-691)**: Wraps custom float parsers for safety

## Important Constants
- Character sets for validation: `ASCII_CTRL`, `ILLEGAL_BASIC_STR_CHARS`, `TOML_WS`, `BARE_KEY_CHARS` (L22-38)
- Escape sequence mappings: `BASIC_STR_ESCAPE_REPLACEMENTS` (L40-50)

## Dependencies
- Uses regex patterns from `._re` module for datetime/number matching
- Imports type definitions from `._types` (Key, ParseFloat, Pos)

## Architecture Notes
- Implements single-pass parsing with lookahead
- Uses flag system to prevent redefinition of tables/keys
- Handles TOML's complex namespace rules for tables and arrays of tables
- Supports custom float parsing via `parse_float` parameter
- Provides detailed error messages with line/column coordinates

## Critical Invariants
- Keys cannot be redefined within same namespace
- Inline tables and arrays are immutable after creation
- Table declarations cannot reopen explicitly nested containers
- Array of tables items must be homogeneous dictionaries