# packages/adapter-rust/vendor/codelldb/linux-x64/lldb/lib/python3.12/site-packages/pip/_internal/vcs/mercurial.py
@source-hash: a142ce8732765227
@generated: 2026-02-09T18:01:30Z

## Mercurial VCS Adapter for pip

**Primary Purpose**: Provides Mercurial (hg) version control system integration for pip's package installation and management. Implements the VersionControl interface to handle Mercurial repository operations including cloning, updating, and metadata extraction.

### Key Components

**Mercurial Class (L20-161)**: Main VCS adapter implementing VersionControl interface
- **Configuration**: `name="hg"`, `dirname=".hg"`, `repo_name="clone"` (L21-23)
- **Supported schemes**: hg+file, hg+http, hg+https, hg+ssh, hg+static-http (L24-30)

### Core Operations

**fetch_new() (L36-58)**: Clones new Mercurial repository
- Handles verbosity levels (quiet, normal, verbose, debug) with appropriate flags (L46-53)
- Uses two-step process: clone with `--noupdate` then separate update command
- Logs operation details for user feedback

**switch() (L60-72)**: Changes repository URL and updates to specified revision
- Modifies `.hg/hgrc` configuration file to update default path (L61-67)
- Gracefully handles configuration errors with warning logging (L68-69)
- Performs quiet update to target revision

**update() (L74-77)**: Updates existing repository to latest changes
- Executes `hg pull -q` followed by `hg update -q` with revision options

### Metadata Extraction Methods

**get_remote_url() (L80-89)**: Extracts repository remote URL
- Queries `hg showconfig paths.default` 
- Converts local paths to file:// URLs when needed (L87-88)

**get_revision() (L92-102)**: Returns local changeset revision number as integer
- Uses `hg parents --template={rev}` command

**get_requirement_revision() (L105-116)**: Returns 40-character changeset hash
- Uses `hg parents --template={node}` for full node ID

**get_subdirectory() (L124-135)**: Finds Python project root relative to repo root
- Uses `hg root` to determine repository root (L130-132)
- Handles both relative and absolute paths correctly (L133-134)
- Delegates to shared utility for project root detection

**get_repository_root() (L138-160)**: Determines if location is under Mercurial control
- Falls back to parent implementation first (L139-141)
- Uses `hg root` command with comprehensive error handling
- Handles BadCommand (hg not available) and InstallationError exceptions (L151-159)

### Utility Methods

**get_base_rev_args() (L33-34)**: Static method formatting revision arguments as `--rev={rev}`

**is_commit_id_equal() (L119-121)**: Always returns False - assumes versions don't match for safety

### Dependencies & Integration

- **Core pip modules**: exceptions (BadCommand, InstallationError), utils (HiddenText, display_path, make_command, path_to_url)
- **VCS framework**: Inherits from VersionControl, uses RevOptions, integrates with vcs registry
- **System integration**: Uses configparser for .hgrc manipulation, os for path operations
- **Registration**: Auto-registers with pip's VCS system (L163)

### Architecture Notes

- Follows pip's VCS adapter pattern with standardized method signatures
- Emphasizes error resilience with try/catch blocks and graceful degradation
- Uses command-line hg execution rather than library integration
- Implements quiet operations by default with configurable verbosity
- Maintains separation between local revision numbers and global hashes for different use cases