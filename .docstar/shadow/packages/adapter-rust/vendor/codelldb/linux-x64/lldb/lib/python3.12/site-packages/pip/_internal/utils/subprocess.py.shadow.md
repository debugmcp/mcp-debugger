# packages/adapter-rust/vendor/codelldb/linux-x64/lldb/lib/python3.12/site-packages/pip/_internal/utils/subprocess.py
@source-hash: 12cbea4918923071
@generated: 2026-02-09T18:01:30Z

## Core Purpose
Subprocess execution utilities for pip package installation operations. Provides secure command argument handling with sensitive data redaction, comprehensive logging with spinners, and robust error management for external process calls.

## Key Components

### Type Definitions
- `CommandArgs` (L14): Type alias for command argument lists supporting both strings and `HiddenText` objects for secure data handling

### Command Building Functions
- `make_command()` (L17-31): Variadic command builder that flattens nested lists and preserves HiddenText objects
- `format_command_args()` (L34-46): Shell-escapes arguments for display, automatically redacting HiddenText values using `str()` representation
- `reveal_command_args()` (L49-53): Extracts raw unredacted values from CommandArgs, accessing `.secret` attribute of HiddenText objects

### Core Subprocess Execution
- `call_subprocess()` (L56-221): Primary subprocess execution function with extensive configuration options:
  - Supports both combined (stderrâ†’stdout) and separate stream modes via `stdout_only` parameter
  - Implements adaptive logging levels (INFO vs VERBOSE) based on `show_stdout` flag
  - Integrates spinner UI for long-running operations when output isn't visible to user
  - Handles environment variable manipulation (`extra_environ`, `unset_environ`)
  - Provides flexible error handling via `on_returncode` parameter ("raise", "warn", "ignore")
  - Returns subprocess output as string
  - Uses `subprocess.PIPE` for stdin/stdout with "backslashreplace" error handling

### Execution Flow Patterns
**Standard Mode** (`stdout_only=False`, L145-168):
- Combines stderr into stdout pipe
- Real-time line-by-line processing with immediate logging
- Spinner updates during execution
- Manual process waiting with resource cleanup

**Communication Mode** (`stdout_only=True`, L169-180):
- Separate stdout/stderr pipes using `proc.communicate()`
- Batch processing after completion
- Returns only stdout content

### Error Handling Architecture
- Process failure detection based on return codes and `extra_ok_returncodes` whitelist (L182)
- Conditional spinner state updates ("error" vs "done")
- Rich error reporting with `InstallationSubprocessError` including command details, exit codes, and output capture
- Markup-enabled logging with command and cwd details for debugging

### Utility Factory
- `runner_with_spinner_message()` (L224-244): Creates specialized subprocess runners for BuildBackendHookCaller integration, encapsulating spinner management and common parameter defaults

## Dependencies
- Uses pip's internal logging infrastructure (`subprocess_logger`, `VERBOSE` level)
- Integrates with pip's spinner UI system (`SpinnerInterface`, `open_spinner`)
- Leverages `HiddenText` utility for secure credential handling
- Rich markup support for enhanced terminal output

## Critical Design Decisions
- Security-first approach with automatic credential redaction in logs
- Progressive disclosure: show spinners when subprocess output isn't visible to user
- Dual-mode output handling optimized for different use cases (real-time vs batch)
- Environment isolation through explicit variable management
- Comprehensive error context preservation for debugging