# packages/adapter-rust/vendor/codelldb/linux-x64/lldb/lib/python3.12/site-packages/pip/_vendor/pyproject_hooks/_in_process/_in_process.py
@source-hash: 9b66f7e1cf75ec85
@generated: 2026-02-09T17:58:05Z

## PEP517 Build Backend Subprocess Hook Executor

**Primary Purpose:** Subprocess script that executes PEP517 build backend hooks in isolation, providing JSON-based communication between the main process and build backends.

**Architecture Pattern:** Command-line driven subprocess with JSON I/O protocol. Expects hook name and control directory as args, reads input from `control_dir/input.json`, writes results to `control_dir/output.json`.

### Core Components

**Exception Hierarchy (L40-57):**
- `BackendUnavailable` - Backend import failures with traceback
- `BackendInvalid` - Backend validation errors (e.g., not loaded from backend-path)
- `HookMissing` - Missing required hooks when fallback disabled

**Backend Loading System:**
- `_build_backend()` (L66-91) - Dynamically loads build backend from `PEP517_BUILD_BACKEND` env var
- Supports dotted object paths (module:object.attr syntax)
- Validates backend loaded from correct path when `PEP517_BACKEND_PATH` specified
- Prepends backend paths to sys.path for in-tree backends

**Hook Implementation Functions:**
- `get_requires_for_build_wheel()` (L107-118) - Optional dependency requirements
- `get_requires_for_build_editable()` (L121-132) - Editable install dependencies
- `prepare_metadata_for_build_wheel()` (L135-154) - Metadata preparation with wheel fallback
- `prepare_metadata_for_build_editable()` (L157-181) - Editable metadata with fallback
- `build_wheel()` (L239-252) - Mandatory wheel building with prebuilt optimization
- `build_editable()` (L255-273) - Optional editable wheel building
- `get_requires_for_build_sdist()` (L276-287) - Source distribution dependencies
- `build_sdist()` (L300-306) - Source distribution building with UnsupportedOperation handling

**Wheel Optimization System:**
- `WHEEL_BUILT_MARKER` (L184) - Marker file to track prebuilt wheels
- `_find_already_built_wheel()` (L217-236) - Locates prebuilt wheels to avoid rebuilding
- `_get_wheel_metadata_from_wheel()` (L199-214) - Extracts metadata from built wheels
- `_dist_info_files()` (L187-196) - Identifies .dist-info directories in wheel archives

**Feature Detection:**
- `_supported_features()` (L94-104) - Returns backend capabilities (currently only 'build_editable')

**Main Execution Flow:**
- `main()` (L322-349) - CLI entry point with comprehensive error handling
- Validates hook names against `HOOK_NAMES` set (L309-319)
- JSON-based input/output with structured error reporting
- Maps exceptions to specific output fields (no_backend, backend_invalid, unsupported, hook_missing)

**Key Dependencies:**
- Standard library only (json, os, sys, importlib, zipfile, glob, shutil)
- Embeds JSON utilities from wrappers.py to avoid import issues

**Critical Invariants:**
- Backend must be loadable and from correct path if backend-path specified
- Fallback behavior controlled by `_allow_fallback` parameter
- Single wheel file expected when using prebuilt optimization
- Hook names must be in predefined HOOK_NAMES set