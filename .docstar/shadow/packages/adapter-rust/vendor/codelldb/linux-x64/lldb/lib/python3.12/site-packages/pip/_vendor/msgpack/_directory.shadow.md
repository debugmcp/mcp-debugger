# packages/adapter-rust/vendor/codelldb/linux-x64/lldb/lib/python3.12/site-packages/pip/_vendor/msgpack/
@generated: 2026-02-09T18:16:15Z

## Purpose
Complete Python implementation of the MessagePack serialization protocol, providing high-performance binary serialization with automatic C extension fallback. This module enables cross-platform data exchange using the msgpack format, with comprehensive streaming support and extension type handling.

## Architecture Overview
The module follows a layered architecture with transparent performance optimization:
- **Public API Layer** (`__init__.py`): High-level convenience functions with automatic C/Python fallback
- **Core Implementation** (`fallback.py`): Pure Python msgpack encoder/decoder with streaming capabilities
- **Type System** (`ext.py`): Extension type support including msgpack timestamp handling
- **Error Handling** (`exceptions.py`): Comprehensive exception hierarchy for different failure modes

## Key Components & Integration

### Public API Surface
Primary entry points in `__init__.py`:
- `pack(obj, stream)` / `packb(obj)`: Serialize objects to stream/bytes
- `unpack(stream)` / `unpackb(data)`: Deserialize from stream/bytes
- `load/loads/dump/dumps`: JSON/pickle-compatible aliases
- Core classes: `Packer`, `Unpacker`, `ExtType`, `Timestamp`

### Dynamic Implementation Selection
The module automatically selects the best available implementation:
1. **C Extension** (`_cmsgpack`): High-performance native implementation (preferred)
2. **Pure Python** (`fallback`): Complete fallback implementation
3. **Environment Override**: `MSGPACK_PUREPYTHON` forces pure Python for testing

### Core Serialization Engine (`fallback.py`)
- **Unpacker Class**: Streaming deserializer with configurable limits, hooks, and buffer management
- **Packer Class**: Encoder with type dispatch, extension support, and memory optimization
- **State Machine**: Execution modes (EX_SKIP, EX_CONSTRUCT, etc.) for recursive parsing
- **Buffer Management**: Sophisticated checkpointing system for streaming and error recovery

### Extension Type System (`ext.py`)
- **ExtType**: Generic extension data wrapper (code + data pairs)
- **Timestamp**: Msgpack timestamp extension (-1) with multiple format support
- **Format Conversion**: Handles 32/64/96-bit timestamp encodings and datetime integration

### Exception Hierarchy (`exceptions.py`)
Structured error handling for different failure scenarios:
- **Unpacking Errors**: `UnpackException`, `BufferFull`, `OutOfData`, `FormatError`, `StackError`
- **Extra Data Handling**: `ExtraData` exception with unpacked data preservation
- **Legacy Compatibility**: Deprecated aliases for backward compatibility

## Data Flow Patterns

### Serialization Path
1. High-level functions create temporary `Packer` instances
2. Type dispatch in `_pack()` method handles recursive object encoding
3. Extension types processed through `pack_ext_type()` method
4. Binary output accumulated in internal buffer

### Deserialization Path
1. `unpackb()` creates temporary `Unpacker` with data validation
2. `_read_header()` decodes msgpack type information using lookup table
3. `_unpack()` recursively processes nested structures with execution modes
4. Hook system allows custom deserialization logic
5. Exception translation preserves context for debugging

## Performance Optimizations
- **C Extension Priority**: Automatic fallback ensures optimal performance when available
- **Streaming Support**: File-like object integration with buffer management
- **Type Caching**: Efficient type dispatch through lookup tables
- **Memory Management**: Buffer reuse and configurable limits for resource control
- **Platform Specific**: PyPy-optimized StringIO implementation

## Security Features
- **Configurable Limits**: Buffer size, array length, map size, string length restrictions
- **Nesting Depth Control**: Stack overflow protection via recursion limits
- **Input Validation**: Strict type checking and format validation
- **Buffer Bounds**: Careful memory management prevents buffer overruns

The module serves as a complete msgpack implementation suitable for both high-performance applications (via C extension) and pure Python environments, with comprehensive streaming, extension type support, and security controls.