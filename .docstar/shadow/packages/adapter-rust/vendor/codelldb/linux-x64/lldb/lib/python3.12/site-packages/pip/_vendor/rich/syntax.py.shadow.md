# packages/adapter-rust/vendor/codelldb/linux-x64/lldb/lib/python3.12/site-packages/pip/_vendor/rich/syntax.py
@source-hash: 4e7643b8e0f80de1
@generated: 2026-02-09T18:02:00Z

## Core Purpose
Rich library's syntax highlighting module that provides syntax-aware code rendering with line numbers, themes, and formatting options. Integrates Pygments for lexical analysis and applies Rich's styling system for terminal display.

## Key Components

### Theme System
- **SyntaxTheme (L123-135)**: Abstract base class defining theme interface with `get_style_for_token()` and `get_background_style()` methods
- **PygmentsSyntaxTheme (L137-177)**: Delegates to Pygments themes, caches styles, handles fallback to "default" theme
- **ANSISyntaxTheme (L179-210)**: Uses predefined ANSI color mappings with hierarchical token lookup
- **ANSI_LIGHT/ANSI_DARK (L61-117)**: Predefined color schemes mapping Pygments tokens to Rich styles

### Main Syntax Class
- **Syntax (L227-812)**: Primary class for syntax highlighting with extensive configuration options
  - Constructor (L263-300): Accepts code, lexer, theme, line numbers, highlighting options
  - `from_path()` (L301-363): Class method to create from file with auto-lexer detection
  - `guess_lexer()` (L364-404): Intelligent lexer detection from filename and content
  - `highlight()` (L452-535): Core highlighting logic, returns styled Text object
  - `stylize_range()` (L537-549): Add custom styling to specific code ranges

### Rendering System
- **__rich_console__() (L618-627)**: Rich protocol implementation for console rendering
- **_get_syntax() (L629-761)**: Complex rendering logic handling line numbers, word wrap, highlighting
- **_get_number_styles() (L577-598)**: Generates styles for line number column
- **_apply_stylized_ranges() (L763-791)**: Applies custom range styling to text

### Helper Components
- **_SyntaxHighlightRange (L215-225)**: NamedTuple for custom highlight ranges
- **_get_code_index_for_syntax_position() (L814-838)**: Maps line/column positions to string indices
- **_process_code() (L793-811)**: Normalizes code (dedent, tab expansion, newline handling)

### Command Line Interface
- Lines 841-958: Comprehensive CLI with argparse for standalone usage

## Key Dependencies
- **Pygments**: Lexical analysis (`pip._vendor.pygments.lexer`, `pip._vendor.pygments.lexers`)
- **Rich components**: `Text`, `Style`, `Console`, `Segment` for rendering
- **Standard library**: `re`, `textwrap`, `pathlib` for text processing

## Notable Patterns
- **Theme abstraction**: Unified interface over Pygments and ANSI themes
- **Lazy lexer resolution**: Lexer property (L424-440) resolves string names on demand
- **Token hierarchy handling**: ANSISyntaxTheme walks token hierarchy for style inheritance
- **Range-based styling**: Separate system for custom highlighting overlays
- **Performance optimization**: Style caching and line-range-aware tokenization

## Critical Constraints
- Line numbers are 1-based, column indices are 0-based for position tuples
- Lexer fallback to "text" lexer when specified lexer not found
- Background color inheritance from theme with optional override
- Platform-specific line pointer rendering (Windows vs Unicode)