# packages/adapter-rust/vendor/codelldb/linux-x64/lldb/lib/python3.12/site-packages/pip/_vendor/pygments/regexopt.py
@source-hash: 8e0d402e881c6065
@generated: 2026-02-09T18:01:39Z

**Primary Purpose**: Optimized regex generation for matching lists of literal strings using prefix/suffix analysis and character set optimization.

**Core Algorithm**: The `regex_opt_inner` function (L26-79) implements a recursive algorithm that:
1. Handles base cases (empty list, single string, empty first string)
2. Groups single-character strings into character sets using `make_charset` (L22-23)
3. Extracts common prefixes using `os.path.commonprefix` (L57-64)
4. Finds common suffixes by reversing strings (L66-73)
5. Falls back to grouping by first character and recursing (L76-79)

**Key Functions**:
- `regex_opt(strings, prefix='', suffix='')` (L82-90): Public API that sorts input and wraps result
- `regex_opt_inner(strings, open_paren)` (L26-79): Core recursive optimization logic
- `make_charset(letters)` (L22-23): Creates regex character class with proper escaping

**Important Constants**:
- `CS_ESCAPE` (L18): Regex for escaping special characters in character sets `[\[\^\\\-\]]`
- `FIRST_ELEMENT` (L19): itemgetter(0) for extracting first elements

**Dependencies**:
- `re.escape` for literal string escaping
- `os.path.commonprefix` for finding common string prefixes
- `itertools.groupby` and `operator.itemgetter` for string grouping operations

**Optimization Strategies**:
1. **Character sets**: Groups single-character strings into `[abc]` patterns (L41-56)
2. **Prefix factoring**: Extracts common beginnings like `prefix(?:suffix1|suffix2)` (L57-64)  
3. **Suffix factoring**: Handles common endings by reversing strings (L66-73)
4. **Recursive grouping**: Groups by first character when other optimizations fail (L76-79)

**Output Format**: Generates parenthesized regex groups with proper escaping for literal matching. The `open_paren` parameter controls whether to wrap results in capturing groups.