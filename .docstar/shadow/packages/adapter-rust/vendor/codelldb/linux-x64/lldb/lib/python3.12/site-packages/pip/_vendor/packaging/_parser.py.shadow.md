# packages/adapter-rust/vendor/codelldb/linux-x64/lldb/lib/python3.12/site-packages/pip/_vendor/packaging/_parser.py
@source-hash: b3f4ef4ef0cd2b43
@generated: 2026-02-09T18:01:34Z

**Primary Purpose**: Handwritten recursive descent parser for Python package dependency specifiers and marker expressions using tokenizer-based approach.

**Core Data Structures**:
- `Node` (L15-27): Abstract base class for AST nodes with value storage and serialization interface
- `Variable` (L29-32), `Value` (L34-37), `Op` (L39-42): Concrete Node types for marker variables, quoted values, and operators
- `ParsedRequirement` (L50-55): NamedTuple representing parsed dependency with name, url, extras, specifier, and marker
- Type aliases (L44-47): Complex recursive types for marker expression trees (`MarkerVar`, `MarkerItem`, `MarkerAtom`, `MarkerList`)

**Main Entry Points**:
- `parse_requirement(source: str)` (L61-62): Primary API for parsing dependency specifiers
- `parse_marker(source: str)` (L252-253): Primary API for parsing marker expressions

**Parser Implementation Structure**:

*Requirement Parsing (L65-247)*:
- `_parse_requirement` (L65-83): Top-level requirement parser handling package names and components
- `_parse_requirement_details` (L86-134): Parses URL (@URL) or version specifier with optional markers
- `_parse_requirement_marker` (L137-154): Handles semicolon-separated marker expressions
- `_parse_extras` (L157-173): Parses bracketed extra specifications
- `_parse_extras_list` (L176-200): Comma-separated identifier list parser
- `_parse_specifier` (L203-217): Version specifier parsing with parentheses support
- `_parse_version_many` (L220-246): Multiple comma-separated version constraints

*Marker Expression Parsing (L256-354)*:
- `_parse_marker` (L262-271): Boolean operator chain parsing for marker expressions
- `_parse_marker_atom` (L274-293): Handles parenthesized expressions and marker items
- `_parse_marker_item` (L296-307): Parses variable-operator-variable triplets
- `_parse_marker_var` (L310-321): Variable or quoted string parsing
- `_parse_marker_op` (L336-354): Operator parsing including special 'not in' handling

**Helper Functions**:
- `process_env_var` (L324-328): Normalizes environment variable names (handles python_implementation alias)
- `process_python_str` (L331-333): Converts Python string literals to Value objects using ast.literal_eval

**Key Dependencies**: 
- `_tokenizer.Tokenizer` with DEFAULT_RULES for lexical analysis
- `ast` module for safe string literal evaluation

**Architecture Patterns**:
- Recursive descent parsing with explicit grammar rules in docstrings
- Tokenizer-based approach with lookahead (`peek=True`) and consumption patterns
- Context manager usage for balanced delimiter handling (`enclosing_tokens`)
- Comprehensive error reporting with position tracking and descriptive messages

**Critical Constraints**:
- Version prefix/local label trails only allowed with `==`/`!=` operators (L228-239)
- Marker expressions require proper boolean operator precedence
- Environment variable normalization for python implementation compatibility