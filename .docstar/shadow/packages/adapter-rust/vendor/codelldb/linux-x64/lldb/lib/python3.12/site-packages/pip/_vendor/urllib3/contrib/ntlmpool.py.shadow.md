# packages/adapter-rust/vendor/codelldb/linux-x64/lldb/lib/python3.12/site-packages/pip/_vendor/urllib3/contrib/ntlmpool.py
@source-hash: 3657e45bb58c756f
@generated: 2026-02-09T17:58:03Z

**Primary Purpose**: Deprecated NTLM authentication connection pool implementation for urllib3, providing Windows NTLM authentication support over HTTPS connections.

**Module Status**: DEPRECATED - Will be removed in urllib3 v2.0 due to maintenance issues (L16-22)

## Key Classes

### NTLMConnectionPool (L27-130)
- **Inherits from**: HTTPSConnectionPool 
- **Purpose**: Implements NTLM authentication handshake for HTTPS connections
- **Scheme**: Fixed to "https" (L32)

#### Constructor (__init__, L34-46)
- **Parameters**: `user` (DOMAIN\username format), `pw` (password), `authurl` (NTLM-protected URL)
- **Processing**: Splits user into domain/username components, stores credentials
- **Key attributes**: `authurl`, `rawuser`, `domain`, `user`, `pw`

#### _new_conn Method (L48-113)  
- **Core functionality**: Performs complete NTLM handshake to establish authenticated connection
- **Process**:
  1. Creates NTLM negotiate message using `ntlm.create_NTLM_NEGOTIATE_MESSAGE()` (L66-68)
  2. Sends initial GET request to authurl (L70)
  3. Parses server challenge from www-authenticate header (L82-90)
  4. Creates authentication message using `ntlm.create_NTLM_AUTHENTICATE_MESSAGE()` (L93-98)
  5. Sends final authentication request (L101)
  6. Validates 200 response or raises exceptions for auth failures (L106-109)
- **Socket management**: Explicitly sets `res.fp = None` to prevent socket closure (L79, L111)
- **Error handling**: Custom exceptions for wrong credentials (401) and other server errors

#### urlopen Method (L115-130)
- **Purpose**: Overrides parent urlopen to ensure Keep-Alive headers
- **Key behavior**: Forces "Connection: Keep-Alive" header and delegates to parent

## Dependencies
- **External**: `ntlm` library for NTLM protocol implementation (L11)
- **Internal**: `HTTPSConnectionPool`, `HTTPSConnection` from urllib3 (L13-14)
- **Logging**: Uses module-level logger for debug output (L24)

## Architecture Notes
- **Connection Persistence**: Relies on Keep-Alive to maintain authenticated socket across requests
- **Security Model**: Implements 3-step NTLM handshake (negotiate → challenge → authenticate)
- **Error Semantics**: Throws generic Exception types rather than urllib3-specific errors

## Critical Constraints
- **Socket Lifecycle**: Must prevent response objects from closing the underlying socket
- **Authentication Scope**: Requires pre-authentication via authurl before actual requests
- **Domain Format**: Expects user in "DOMAIN\username" format for proper parsing