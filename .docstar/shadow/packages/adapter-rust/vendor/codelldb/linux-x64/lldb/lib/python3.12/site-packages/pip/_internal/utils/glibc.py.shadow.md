# packages/adapter-rust/vendor/codelldb/linux-x64/lldb/lib/python3.12/site-packages/pip/_internal/utils/glibc.py
@source-hash: 0b28d4cf4c7f034d
@generated: 2026-02-09T18:01:23Z

## Purpose and Responsibility

Detects and provides reliable glibc (GNU C Library) version information on Linux systems. This module was created to work around the unreliable glibc version detection in Python's standard `platform.libc_ver()` function.

## Key Functions

### `glibc_version_string()` (L6-8)
Main entry point that attempts two detection strategies in order:
1. `glibc_version_string_confstr()` (preferred)
2. `glibc_version_string_ctypes()` (fallback)

Returns the glibc version string (e.g., "2.22") or `None` if not using glibc.

### `glibc_version_string_confstr()` (L11-28)
Primary implementation using `os.confstr("CS_GNU_LIBC_VERSION")`. Fast and reliable method that:
- Returns `None` immediately on Windows (L17-18)
- Parses the confstr result which returns format "glibc X.XX" (L24)
- Handles missing support gracefully (L25-27)

### `glibc_version_string_ctypes()` (L31-61)
Fallback implementation using ctypes to call `gnu_get_libc_version()` directly:
- Uses `ctypes.CDLL(None)` to access the main program's namespace (L44)
- Calls the glibc-specific `gnu_get_libc_version` function (L48)
- Handles Python 2/3 string compatibility (L58-59)

### `libc_ver()` (L81-91)
Public API function that returns a tuple `(library_name, version)` format:
- Returns `("glibc", version)` if glibc detected
- Returns `("", "")` if no glibc found

## Dependencies and Architecture

- **Standard library**: `os`, `sys`, `typing`
- **Optional dependency**: `ctypes` (imported only when needed)
- **Platform-specific**: Designed for Unix-like systems, explicitly handles Windows

## Key Design Patterns

- **Graceful degradation**: Two-tier fallback strategy (confstr â†’ ctypes)
- **Platform awareness**: Early Windows detection to avoid unnecessary work
- **Defensive programming**: Extensive exception handling for missing APIs/symbols
- **Compatibility**: Handles Python 2/3 string encoding differences

## Critical Context

The module addresses a specific problem where Python's `platform.libc_ver()` returns incorrect glibc versions (documented in comments L64-80). This affects package compatibility decisions in pip's dependency resolution.