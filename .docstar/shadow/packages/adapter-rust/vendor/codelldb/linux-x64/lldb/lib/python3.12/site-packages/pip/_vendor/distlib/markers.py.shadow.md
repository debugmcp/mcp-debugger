# packages/adapter-rust/vendor/codelldb/linux-x64/lldb/lib/python3.12/site-packages/pip/_vendor/distlib/markers.py
@source-hash: 9f70df3a1d72bd9f
@generated: 2026-02-09T18:01:29Z

**Primary Purpose**: Parser and interpreter for PEP 508 environment markers micro-language used in Python package dependency specifications.

**Core Architecture**:
- **Evaluator class (L45-98)**: Main expression evaluation engine with recursive descent evaluation
- **Context generation (L104-142)**: Platform environment detection and variable population  
- **Public interface**: Single `interpret()` function (L147-167) for marker evaluation

**Key Components**:

**Expression Evaluation**:
- `Evaluator.operations` (L50-63): Operation lookup table supporting comparison (`==`, `!=`, `<`, etc.), version-specific (`~=`, `===`), logical (`and`, `or`), and membership (`in`, `not in`) operators
- `Evaluator.evaluate()` (L65-98): Recursive expression evaluator handling literals, variables, and nested operations with special version comparison logic

**Version Handling**:
- `_VERSION_PATTERN` (L26-27): Regex for extracting version strings from text
- `_VERSION_MARKERS` (L28): Set of marker names that represent version values
- `_get_versions()` (L41-42): Extracts LegacyVersion objects from version strings
- Special version comparison logic (L90-96) converts strings to LegacyVersion objects for proper semantic versioning

**Context Management**:
- `default_context()` (L104-138): Generates platform-specific environment variables including Python version, OS details, platform info, and virtual environment status
- `DEFAULT_CONTEXT` (L141): Pre-computed default environment context
- Context merging in `interpret()` allows custom execution contexts

**Helper Functions**:
- `_is_version_marker()` (L31-32): Identifies version-related marker variables
- `_is_literal()` (L35-38): Detects quoted string literals
- `format_full_version()` (L106-111): Formats Python version info including pre-release identifiers

**Dependencies**:
- Uses `parse_marker()` from `.util` for parsing marker syntax into AST
- Imports `LegacyVersion` from `.version` for version comparison semantics
- Relies on standard library modules (`os`, `platform`, `sys`) for environment detection

**Critical Patterns**:
- Recursive evaluation with context passing for variable resolution
- Special handling of version comparisons using semantic versioning
- Graceful fallback for missing `sys.implementation` (older Python versions)
- Syntax validation for malformed expressions (literal-literal comparisons, unknown variables)

**Error Handling**:
- `SyntaxError` for malformed markers, unknown variables, and invalid comparisons
- `NotImplementedError` for unsupported operations
- Exception chaining in `interpret()` for better error messages