# packages/adapter-rust/vendor/codelldb/linux-x64/lldb/lib/python3.12/site-packages/pip/_internal/network/lazy_wheel.py
@source-hash: d8f5d576e6193c23
@generated: 2026-02-09T18:01:19Z

## Purpose
Implements lazy HTTP-based ZIP file access for wheel metadata extraction, enabling efficient package distribution analysis without downloading complete wheel files.

## Core Components

### HTTPRangeRequestUnsupported Exception (L19-20)
Custom exception raised when HTTP range requests are not supported by the server.

### dist_from_wheel_url Function (L23-37)
Primary entry point that creates a BaseDistribution from a wheel URL. Uses LazyZipOverHTTP to fetch only metadata portions of the wheel file, wrapping it in a MemoryWheel for distribution processing.

### LazyZipOverHTTP Class (L40-210)
File-like object that mimics a complete ZIP file while lazily downloading content via HTTP range requests. Key responsibilities:

**Initialization (L49-63):**
- Validates range request support via HEAD request
- Sets up temporary file with full length
- Initializes download tracking with `_left` and `_right` interval arrays
- Calls `_check_zip()` to ensure valid ZIP structure

**File Interface Methods (L65-132):**
- Implements standard file operations: read, seek, tell, close, etc.
- `mode` always returns "rb" (read binary)
- `writable()` always returns False (read-only)

**Core Download Logic:**
- `_check_zip()` (L153-166): Downloads chunks from end backwards until valid ZIP structure found
- `_download()` (L200-210): Main download orchestrator using interval merging
- `_merge()` (L178-198): Optimizes download ranges by merging overlapping intervals
- `_stream_response()` (L168-176): Creates HTTP range requests with proper headers

## Key Dependencies
- `pip._internal.metadata`: MemoryWheel, BaseDistribution, get_wheel_distribution
- `pip._internal.network.session`: PipSession for HTTP requests
- `pip._vendor.requests`: Response handling and chunk processing
- `zipfile.ZipFile`: ZIP validation and structure checking

## Architecture Patterns
- **Lazy Loading**: Downloads only required ZIP portions on-demand
- **Interval Tracking**: Uses sorted arrays (`_left`, `_right`) to track downloaded ranges
- **Context Manager**: Proper resource cleanup with temporary file management
- **File-like Interface**: Duck-typing compatibility with standard file operations

## Critical Constraints
- Requires HTTP range request support (validates via Accept-Ranges header)
- Uses temporary files for caching downloaded chunks
- Maintains read-only semantics throughout
- ZIP validation occurs incrementally during initialization