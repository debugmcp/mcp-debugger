# packages/adapter-rust/vendor/codelldb/linux-x64/lldb/lib/python3.12/site-packages/pip/_internal/metadata/_json.py
@source-hash: 3f470026b1ff9ad9
@generated: 2026-02-09T18:01:11Z

## Purpose
Converts Python package metadata from RFC 5322 email message format to JSON-compatible dictionaries. This is a utility module extracted from pkg_metadata project, used internally by pip for metadata processing.

## Key Components

### Constants
- **METADATA_FIELDS (L7-34)**: Tuple list defining all standard Python package metadata fields with their multi-value capability flags. Maps field names like "Metadata-Version", "Name", "Requires-Dist" to boolean indicating if they accept multiple values.

### Functions
- **json_name (L37-38)**: Simple field name normalizer that converts hyphenated metadata field names to underscore format (e.g., "Author-email" → "author_email").

- **msg_to_json (L41-84)**: Main conversion function that transforms email.message.Message objects into JSON dictionaries.
  - **sanitise_header (L44-58)**: Nested function handling email header encoding issues, specifically dealing with "unknown-8bit" encoding by attempting UTF-8 fallback then latin1.
  - Iterates through METADATA_FIELDS to extract present fields from message
  - Handles multi-value fields by collecting all values into lists
  - Special case for "keywords" field (L71-77): supports both comma and space-separated formats
  - Extracts message payload as description field (L80-83)

## Dependencies
- `email.header`: For header encoding/decoding operations
- `email.message.Message`: Input format for metadata
- `typing`: Type annotations for Dict, List, Union, Any

## Architecture Notes
- Uses nested function pattern for header sanitization to keep logic localized
- Graceful encoding handling with fallback strategy (UTF-8 → latin1)
- Preserves metadata field semantics (single vs multi-value) through boolean flags
- Keywords field receives special parsing treatment for backward compatibility

## Data Flow
Message object → Field extraction → Header sanitization → JSON normalization → Dictionary output