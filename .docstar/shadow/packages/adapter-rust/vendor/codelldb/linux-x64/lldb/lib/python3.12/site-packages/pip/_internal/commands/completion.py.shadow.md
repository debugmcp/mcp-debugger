# packages/adapter-rust/vendor/codelldb/linux-x64/lldb/lib/python3.12/site-packages/pip/_internal/commands/completion.py
@source-hash: 1d3e250f46e0b1f9
@generated: 2026-02-09T18:01:08Z

## pip Shell Completion Command

**Primary Purpose:** Generates shell-specific auto-completion scripts for pip commands across multiple shell environments (bash, zsh, fish, powershell).

**Core Components:**

### Constants (L10-72)
- `BASE_COMPLETION` (L10-12): Template wrapper that encapsulates completion scripts with shell-specific delimiters
- `COMPLETION_SCRIPTS` (L14-72): Dictionary mapping shell names to their respective completion script templates
  - **bash** (L15-23): Uses `complete -F` with COMP_WORDS/COMP_CWORD environment variables
  - **zsh** (L24-38): Implements compdef with autoload support and zsh_eval_context detection
  - **fish** (L39-49): Uses fish-specific commandline parsing and math functions
  - **powershell** (L50-71): Hooks into TabExpansion with backup mechanism for existing completions

### Command Class
- `CompletionCommand` (L75-130): Inherits from pip's base Command class
  - `ignore_require_venv = True` (L78): Allows execution outside virtual environments
  - `add_options()` (L80-115): Registers mutually exclusive shell options (--bash, --zsh, --fish, --powershell)
  - `run()` (L116-130): Main execution logic that validates shell selection and outputs formatted completion script

**Key Dependencies:**
- `pip._internal.cli.base_command.Command`: Base command infrastructure
- `pip._internal.utils.misc.get_prog`: Retrieves current pip executable name for script templating
- `textwrap.dedent`: Cleans up indentation in multi-line script templates

**Architecture Pattern:**
Uses template-based code generation where shell-specific scripts are stored as string templates with `{prog}` placeholder substitution. All completion scripts follow the pattern of setting environment variables (COMP_WORDS, COMP_CWORD, PIP_AUTO_COMPLETE=1) before invoking pip to generate completions.

**Critical Behavior:**
- Returns SUCCESS (0) even on error cases (L130) - only writes to stderr for validation failures
- Each shell script expects pip to be invoked with PIP_AUTO_COMPLETE=1 environment variable to trigger completion mode
- Scripts are designed to integrate with each shell's native completion system rather than providing direct completions