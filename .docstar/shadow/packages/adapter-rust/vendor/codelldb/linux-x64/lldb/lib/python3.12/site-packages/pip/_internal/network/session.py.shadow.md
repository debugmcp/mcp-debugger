# packages/adapter-rust/vendor/codelldb/linux-x64/lldb/lib/python3.12/site-packages/pip/_internal/network/session.py
@source-hash: 5e66a704a8d5c0f1
@generated: 2026-02-09T18:01:22Z

## Primary Purpose
Core HTTP session management for pip package installer, providing secure network request handling with authentication, caching, SSL context management, and trusted host configuration.

## Key Classes and Functions

### `PipSession` (L320-522)
Main HTTP session class extending `requests.Session` with pip-specific networking behavior:
- **Constructor** (L323-401): Configures retries, caching, trusted hosts, SSL context, and authentication
- **`update_index_urls`** (L403-408): Updates authentication handler with new index URLs
- **`add_trusted_host`** (L410-442): Adds hosts that bypass HTTPS verification with URL mounting
- **`iter_secure_origins`** (L443-446): Generator yielding secure origins from hardcoded list + trusted hosts
- **`is_secure_origin`** (L448-513): Validates if a URL location uses secure transport, with IP network matching
- **`request`** (L515-522): Overrides base request method to apply session-level timeout and proxy defaults

### HTTP Adapters
- **`LocalFSAdapter`** (L212-254): Handles `file://` URLs by serving local filesystem content with proper HTTP responses
- **`_SSLContextAdapterMixin`** (L256-287): Mixin adding SSL context forwarding to pool manager initialization
- **`HTTPAdapter`** (L290-291): Standard HTTPS adapter with SSL context support
- **`CacheControlAdapter`** (L294-295): Caching HTTPS adapter with SSL context support  
- **`InsecureHTTPAdapter`** (L298-307): Forces verification=False for trusted hosts
- **`InsecureCacheControlAdapter`** (L309-318): Caching version that forces verification=False

### Utility Functions
- **`looks_like_ci`** (L100-107): Detects CI environment via environment variables
- **`user_agent`** (L110-209): Generates comprehensive user-agent string with system/Python/tool version info

## Key Dependencies
- `requests`/`urllib3` for HTTP functionality
- `pip._internal.network.auth.MultiDomainBasicAuth` for authentication
- `pip._internal.network.cache.SafeFileCache` for response caching
- `pip._internal.models.link.Link` for URL validation

## Important Configuration
- **`SECURE_ORIGINS`** (L68-78): Hardcoded list of secure protocols/hosts (HTTPS, localhost, file://, ssh)
- **`CI_ENVIRONMENT_VARIABLES`** (L88-97): Environment variables used to detect CI systems
- **Retry Strategy**: 503/500/502/520/527 status codes with 0.25s backoff factor (L351-366)

## Architecture Patterns
- **Adapter Pattern**: Different adapters for secure/insecure/local file access
- **Mixin Pattern**: `_SSLContextAdapterMixin` for SSL context injection
- **Session Mounting**: URL scheme-based adapter routing (`https://`, `http://`, `file://`)
- **Trust Management**: Separate adapters for trusted vs untrusted hosts with caching policies

## Critical Invariants
- Caching only enabled for secure origins and explicitly trusted hosts
- Insecure adapters bypass SSL verification but log warnings
- User agent includes comprehensive environment fingerprinting
- IP network matching supports both hostname and CIDR notation for security validation