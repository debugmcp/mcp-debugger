# packages/adapter-rust/vendor/codelldb/win32-x64/lldb/lib/site-packages/pip/_internal/resolution/resolvelib/found_candidates.py
@source-hash: f61ad3c90a85be5f
@generated: 2026-02-09T18:02:07Z

**Primary Purpose & Responsibility**
This module provides lazy candidate iteration for pip's dependency resolver, optimizing performance by deferring expensive operations (fetching, extracting, building) until candidates are actually needed. The core abstraction is `FoundCandidates`, which presents a sequence-like interface while lazily evaluating package candidates.

**Key Classes & Functions**

- **`FoundCandidates` (L127-174)**: Main lazy sequence class implementing `SequenceCandidate` protocol
  - Constructor (L136-147): Takes candidate info getter, installed candidate, preference flags, and incompatible IDs
  - `__iter__` (L154-162): Core iteration logic that selects appropriate iterator strategy based on installed package preferences
  - `__bool__` (L171-174): Cached boolean check optimized for installed package preference case
  - `__getitem__`/`__len__` (L148-152, L164-168): Deliberately unimplemented to prevent inefficient usage

**Iterator Strategy Functions**
- **`_iter_built` (L42-71)**: Default iterator for packages without installed versions
  - Deduplicates by version, handles `MetadataInvalid` exceptions with user warnings
  - Skips `None` candidates and tracks found versions to avoid duplicates

- **`_iter_built_with_prepended` (L73-93)**: Iterator when preferring installed candidates
  - Always yields installed candidate first, then processes index candidates
  - Skips duplicate versions including the installed version

- **`_iter_built_with_inserted` (L95-125)**: Iterator for upgrade scenarios
  - Inserts installed candidate at appropriate position based on version comparison
  - Handles edge case where installed version is older than all index candidates

**Key Type Definitions**
- **`IndexCandidateInfo` (L24)**: Type alias for (version, candidate_factory) tuples
- **`SequenceCandidate` (L27-39)**: Compatibility wrapper for Python <3.9 generic sequence typing

**Dependencies & Architecture**
- Imports from `pip._vendor.packaging.version` for version handling
- Uses `pip._internal.exceptions.MetadataInvalid` for error handling
- Integrates with resolver base classes via `.base.Candidate`
- Implements lazy evaluation pattern with callable factories rather than eager candidate creation

**Critical Patterns**
- **Lazy Evaluation**: All candidate creation deferred via callable factories until iteration
- **Version Deduplication**: Tracks `versions_found` sets to prevent processing duplicate versions
- **Exception Handling**: Gracefully handles metadata parsing failures with user guidance
- **Performance Optimization**: Incompatible candidates filtered by object ID at iteration boundary

**Performance Constraints**
- `__getitem__` and `__len__` intentionally raise `NotImplementedError` to prevent inefficient sequence operations
- Uses `@functools.lru_cache` on `__bool__` for repeated boolean evaluations
- Generator expressions used throughout to maintain lazy evaluation chain