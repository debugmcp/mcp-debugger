# packages/adapter-rust/vendor/codelldb/win32-x64/lldb/lib/site-packages/pip/_vendor/urllib3/contrib/_securetransport/low_level.py
@source-hash: 076241076fcd44fd
@generated: 2026-02-09T17:58:04Z

## Purpose
Low-level CoreFoundation and Security framework bindings for SecureTransport SSL/TLS implementation on macOS. Provides memory-managed wrappers around native macOS cryptographic APIs with careful CFRetain/CFRelease handling to prevent memory leaks.

## Core Memory Management Functions
- `_cf_data_from_bytes(bytestring)` (L27-34): Creates CFData from Python bytes, caller must CFRelease
- `_cf_dictionary_from_tuples(tuples)` (L37-56): Creates CFDictionary from Python tuple list
- `_cfstr(py_bstr)` (L59-70): Creates CFString from Python binary data, caller must CFRelease
- `_cf_string_to_unicode(value)` (L104-126): Converts CFString to Python unicode with buffer fallback

## Certificate and Keychain Management
- `_cert_array_from_pem(pem_bundle)` (L150-193): Parses PEM bundle using regex `_PEM_CERTS_RE` (L22-24), creates CFArray of SecCertificateRef objects
- `_temporary_keychain()` (L212-244): Creates temporary keychain with random password in temp directory
- `_load_items_from_file(keychain, path)` (L247-299): Imports certificates/identities from file using SecItemImport
- `_load_client_cert_chain(keychain, *paths)` (L302-374): Loads client certificate chain, creates SecIdentityRef if needed

## Type Checking Utilities
- `_is_cert(item)` (L196-201): Checks if CFTypeRef is SecCertificateRef
- `_is_identity(item)` (L204-209): Checks if CFTypeRef is SecIdentityRef

## Error Handling
- `_assert_no_error(error, exception_class=None)` (L129-147): Converts OSStatus codes to Python exceptions using SecCopyErrorMessageString

## Array Creation
- `_create_cfstring_array(lst)` (L73-101): Creates CFMutableArray of CFStrings with proper cleanup on failure

## TLS Protocol Support
- `TLS_PROTOCOL_VERSIONS` (L377-383): Maps protocol names to version tuples
- `_build_tls_unknown_ca_alert(version)` (L386-396): Constructs TLS alert record for unknown CA errors

## Dependencies
- External bindings: `.bindings` (CFConst, CoreFoundation, Security) (L19)
- Standard library: base64, ctypes, itertools, os, re, ssl, struct, tempfile (L10-17)

## Architecture Notes
Critical memory management pattern: All CF* creation functions require caller to CFRelease. Exception handling ensures cleanup on errors. Functions follow create-use-release lifecycle for CoreFoundation objects. Temporary keychain approach works around macOS SecIdentityRef limitations requiring keychain storage.