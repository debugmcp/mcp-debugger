# packages/adapter-rust/vendor/codelldb/win32-x64/lldb/lib/site-packages/pip/_vendor/urllib3/packages/backports/makefile.py
@source-hash: 9dbcedde2d1a80f5
@generated: 2026-02-09T17:58:01Z

**Primary Purpose**: Backports Python 3's `socket.makefile` functionality for creating file-like objects from sockets, enabling compatibility with older Python versions or custom socket implementations.

**Key Function**:
- `backport_makefile` (L13-51): Core backport implementation that wraps socket objects in appropriate IO stream wrappers based on mode parameters

**Functionality Overview**:
The function creates layered IO wrappers around a SocketIO object:
1. **Mode Validation** (L19-20): Ensures mode contains only 'r', 'w', 'b' characters
2. **Mode Analysis** (L21-24): Determines reading/writing/binary flags from mode string
3. **Raw Socket Wrapper** (L30): Creates SocketIO object with appropriate raw mode
4. **Reference Counting** (L31): Increments `_makefile_refs` on socket object
5. **Buffering Logic** (L32-39): Handles buffering parameters with defaults
6. **Stream Creation** (L40-46): Creates appropriate buffered stream based on mode:
   - BufferedRWPair for read+write
   - BufferedReader for read-only  
   - BufferedWriter for write-only
7. **Text Wrapper** (L49-51): Adds TextIOWrapper for non-binary modes with encoding support

**Dependencies**:
- `io` module: Provides buffered stream classes and TextIOWrapper
- `socket.SocketIO`: Low-level socket IO interface

**Key Constraints**:
- Unbuffered streams (buffering=0) must be binary mode (L37-38)
- Socket object must have `_makefile_refs` attribute for reference counting
- Mode validation restricts to read/write/binary combinations only

**Architecture Pattern**: Layered wrapper pattern - progressively wraps raw socket in buffering and text encoding layers based on requested mode and parameters.