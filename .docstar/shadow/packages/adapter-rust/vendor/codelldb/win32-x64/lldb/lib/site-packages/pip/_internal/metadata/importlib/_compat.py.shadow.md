# packages/adapter-rust/vendor/codelldb/win32-x64/lldb/lib/site-packages/pip/_internal/metadata/importlib/_compat.py
@source-hash: 1807bfa6b21f084e
@generated: 2026-02-09T18:01:56Z

**Purpose:** Compatibility layer for importlib.metadata operations in pip's internal metadata handling system. Provides abstractions and utilities to work with distribution metadata across different Python versions and path implementations.

**Key Components:**

- **BadMetadata** (L5-11): Custom ValueError subclass for metadata parsing errors. Stores the problematic distribution and reason for failure, with formatted string representation.

- **BasePath** (L14-32): Protocol defining common interface for path objects. Abstracts over `pathlib.Path` and `zipfile.Path` to handle type hints uniformly. Provides `name` and `parent` properties that both path types implement.

- **get_info_location()** (L34-43): Extracts distribution metadata directory path using private `_path` attribute. Returns Optional[BasePath] since not all distributions exist on disk. Includes explicit HACK comment acknowledging use of private API.

- **get_dist_name()** (L46-55): Safe extraction of distribution name with type validation. Uses cast to work around Mypy limitations for Python 3.10+ features. Raises BadMetadata for invalid name entries.

**Dependencies:**
- `importlib.metadata` for distribution handling
- `typing` for Protocol, Optional, Any, and cast utilities

**Patterns:**
- Protocol-based abstraction for type compatibility across different path implementations
- Defensive programming with explicit type checking and custom exceptions
- Acknowledgment of technical debt through documented use of private APIs

**Critical Constraints:**
- Relies on private `_path` attribute of importlib.metadata.Distribution
- Name attribute access assumes Python 3.10+ behavior
- BasePath protocol is minimal, containing only required common functionality