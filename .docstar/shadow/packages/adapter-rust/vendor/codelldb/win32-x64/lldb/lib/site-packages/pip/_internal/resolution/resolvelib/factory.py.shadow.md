# packages/adapter-rust/vendor/codelldb/win32-x64/lldb/lib/site-packages/pip/_internal/resolution/resolvelib/factory.py
@source-hash: ab334847f62c0b89
@generated: 2026-02-09T18:02:15Z

**Purpose**: Central factory for creating candidates and requirements in pip's dependency resolution system. Manages caching, candidate creation, constraint handling, and error reporting during the resolution process.

**Key Classes**:

- `CollectedRootRequirements` (L89-92): NamedTuple containing requirements list, constraints dict, and user_requested mapping for organizing root-level installation requirements.

- `Factory` (L95-816): Main factory class that creates candidates and requirements for the resolver. Manages multiple caches for different candidate types and handles the complexity of pip's dependency resolution.

**Core Factory Methods**:

- `__init__` (L96-132): Initializes with finder, preparer, and configuration flags. Sets up multiple caches for different candidate types and builds installed distributions mapping when not ignoring installed packages.

- `find_candidates` (L390-464): Primary method for locating installation candidates. Handles explicit candidates, index searches, constraint application, and incompatibility filtering. Returns filtered candidates that satisfy all requirements.

- `collect_root_requirements` (L519-559): Processes initial InstallRequirements into resolver format, separating constraints from requirements and tracking user-requested packages. Sorts requirements to put extras at end for optimization.

**Candidate Creation Methods**:

- `_make_candidate_from_link` (L177-190): Creates candidates from download links, handling extras wrapping around base candidates.

- `_make_base_candidate_from_link` (L192-247): Core candidate factory that creates LinkCandidate or EditableCandidate with caching and build failure tracking.

- `_make_candidate_from_dist` (L162-175): Creates candidates from already-installed distributions with extras support.

- `_make_extras_candidate` (L147-160): Creates ExtrasCandidate wrapper around base candidates with normalized extras caching.

**Requirement Creation Methods**:

- `_make_requirements_from_install_req` (L466-517): Converts InstallRequirement to resolver Requirements, handling marker evaluation, constraint/extras splitting, and link validation.

- `make_requirements_from_spec` (L566-582): Creates requirements from requirement specifications with extras support.

- `make_requires_python_requirement` (L584-593): Creates Python version requirements when not ignored.

**Search and Iteration**:

- `_iter_found_candidates` (L249-344): Searches for candidates using PackageFinder, handling installed candidates, yanked releases, and PEP 592 compliance. Returns FoundCandidates with lazy evaluation.

- `_iter_explicit_candidates_from_base` (L346-366): Generates explicit candidates from base requirements with injected extras.

- `_iter_candidates_from_constraints` (L368-388): Creates candidates from constraint links for explicit candidate lookup.

**Caching System**:

- `_build_failures` (L117): Cache for failed builds to avoid retry attempts
- `_link_candidate_cache` (L118): Cache for LinkCandidate instances by Link
- `_editable_candidate_cache` (L119): Cache for EditableCandidate instances by Link  
- `_installed_candidate_cache` (L120): Cache for AlreadyInstalledCandidate by name
- `_extras_candidate_cache` (L121-123): Cache for ExtrasCandidate by base ID and extras

**Error Handling and Reporting**:

- `get_installation_error` (L716-816): Comprehensive error reporting for ResolutionImpossible, handling Python version conflicts, single requirement conflicts, and multi-cause dependency conflicts with helpful suggestions.

- `_report_requires_python_error` (L642-662): Specialized error reporting for Python version incompatibilities.

- `_report_single_requirement_conflict` (L664-714): Reports distribution not found errors with version information and helpful hints.

**Dependencies**: Integrates with pip's PackageFinder, RequirementPreparer, metadata system, wheel cache, and the resolvelib library for dependency resolution.

**Architectural Patterns**: 
- Factory pattern for candidate/requirement creation
- Caching layer to avoid expensive operations
- Strategy pattern for different candidate types
- Comprehensive error reporting with user guidance