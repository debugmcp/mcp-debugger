# packages/adapter-rust/vendor/codelldb/win32-x64/lldb/lib/site-packages/pip/_vendor/pygments/formatters/html.py
@source-hash: 89ab919942bb2a70
@generated: 2026-02-09T18:02:15Z

**Purpose:** HTML formatter for Pygments syntax highlighting. Converts tokenized source code into styled HTML output with extensive customization options for display, styling, and navigation features.

**Core Class:**
- `HtmlFormatter(Formatter)` (L113-990): Main formatter class that converts tokens to HTML spans with CSS classes or inline styles

**Key Configuration Options (L411-458):**
- Line numbering: `linenos` (table/inline/false), `linenostart`, `linenostep`, `linenospecial` 
- Styling: `noclasses` (inline vs CSS), `classprefix`, `cssclass`, `cssstyles`, `prestyles`
- Document output: `full` (complete HTML doc), `title`, `cssfile`, `noclobber_cssfile`
- Navigation: `lineanchors`, `linespans`, `anchorlinenos`, `hl_lines` (highlighted lines)
- Integration: `tagsfile` (ctags support), `filename` display, `wrapcode` (HTML5 `<code>`)

**Core Methods:**
- `_create_stylesheet()` (L484-506): Builds CSS class-to-style mappings from pygments style definitions
- `get_style_defs(arg)` (L508-520): Generates CSS rules with optional selector prefixes
- `_format_lines(tokensource)` (L831-907): Core tokenization - converts tokens to HTML spans, handles ctags linking
- `format_unencoded(tokensource, outfile)` (L953-990): Main formatting pipeline orchestrator
- `wrap(source)` (L938-951): Applies wrapper generators in sequence

**Wrapper Methods (Generator Pattern):**
- `_wrap_div()` (L790-802): Wraps in `<div>` with CSS class/styles
- `_wrap_pre()` (L804-819): Wraps in `<pre>` tag with filename header
- `_wrap_code()` (L821-824): Adds `<code>` wrapper for HTML5 compliance
- `_wrap_tablelinenos()` (L657-722): Table-based line numbering layout
- `_wrap_inlinelinenos()` (L725-766): Inline line numbering within `<pre>`
- `_wrap_lineanchors()` (L768-778): Adds anchor tags for line linking
- `_wrap_linespans()` (L780-788): Wraps lines in spans with IDs
- `_wrap_full()` (L616-655): Complete HTML document with headers/footers
- `_highlight_lines()` (L916-936): Highlights specified lines with background color

**Utility Functions:**
- `escape_html(text)` (L38-40): HTML entity escaping using translation table
- `webify(color)` (L43-47): CSS color formatting (handles calc/var functions)
- `_get_ttype_class(ttype)` (L50-59): Maps token types to CSS class names
- `_translate_parts(value)` (L826-829): Cached HTML escaping and line splitting

**Templates:**
- `DOC_HEADER` (L71-90): Complete HTML document template with embedded CSS
- `DOC_HEADER_EXTERNALCSS` (L92-105): HTML document template with external CSS file
- `CSSFILE_TEMPLATE` (L62-69): CSS file template with pygments header

**Dependencies:**
- `pygments.formatter.Formatter`: Base formatter class
- `pygments.token`: Token type definitions and constants
- `ctags` (optional): For generating hyperlinks to definitions
- `pygments.util`: Option parsing utilities

**Architecture Pattern:**
Generator-based pipeline architecture where formatting passes through multiple optional wrapper stages. Each wrapper is a generator that yields `(type, content)` tuples where type=1 indicates source code and type=0 indicates wrapper HTML. This allows composable, order-dependent transformations.

**Key Invariants:**
- CSS class names are built hierarchically from token types
- Wrapper order matters: line numbers → highlighting → anchors/spans → pre/div → table → full doc
- Line numbering starts from `linenostart` and increments regardless of step/special settings
- Cache optimization via `@functools.lru_cache` on HTML escaping for performance