# packages/adapter-rust/vendor/codelldb/win32-x64/lldb/lib/site-packages/pip/_vendor/pygments/formatters/terminal256.py
@source-hash: d77489dc3e6915da
@generated: 2026-02-09T18:02:17Z

## Primary Purpose

Provides ANSI terminal formatters for Pygments syntax highlighting that support 256-color and true-color (24-bit) output. Converts RGB colors from Pygments styles to appropriate ANSI escape sequences for terminal display.

## Key Classes

### EscapeSequence (L34-96)
Core utility class for generating ANSI escape sequences.
- `__init__` (L35): Stores color/style attributes (fg, bg, bold, underline, italic)
- `color_string` (L47): Converts to 256-color ANSI sequences, handles ansicolors mapping
- `true_color_string` (L73): Converts to 24-bit RGB ANSI sequences
- `reset_string` (L87): Generates reset sequences to clear formatting

### Terminal256Formatter (L98-290)
Main formatter for 256-color terminals, extends Pygments Formatter.
- `__init__` (L135): Initializes color tables, style mappings, and options
- `_build_color_table` (L152): Creates 256-color palette (16 basic + 6x6x6 cube + 21 grayscale)
- `_closest_color` (L188): Finds nearest color match using Euclidean distance
- `_color_index` (L205): Maps RGB/ansicolor values to 256-color indices with caching
- `_setup_styles` (L224): Pre-processes Pygments style definitions to ANSI sequences
- `format_unencoded` (L252): Main formatting logic with newline handling and line numbers

### TerminalTrueColorFormatter (L293-338)
True-color variant, inherits from Terminal256Formatter.
- `_color_tuple` (L314): Converts hex colors to RGB tuples
- `_setup_styles` (L324): Similar to parent but uses true-color sequences

## Key Dependencies

- `pip._vendor.pygments.formatter.Formatter`: Base formatter class
- `pip._vendor.pygments.console.codes`: ANSI color code mappings  
- `pip._vendor.pygments.style.ansicolors`: Standard ANSI color definitions

## Architecture Patterns

- **Template Method**: `Terminal256Formatter` defines the formatting structure, `TerminalTrueColorFormatter` overrides color handling
- **Strategy Pattern**: Two different color conversion strategies (256-color vs true-color)
- **Caching**: `best_match` dict caches RGB-to-index conversions for performance
- **Lazy Initialization**: Color tables built in `__init__`, styles processed once

## Critical Invariants

- Colors reset at newlines to ensure proper paging behavior
- Token type hierarchy traversal via `.parent` when exact matches not found
- ANSI sequences properly escaped with `\x1b[...m` format
- Line numbering state maintained across `_write_lineno` calls

## Notable Constraints

- 256-color palette fixed at initialization (basic colors + 6Â³ cube + grayscale ramp)
- Style attributes (bold/underline/italic) can be disabled via 'no*' options
- Color distance calculation uses simple Euclidean RGB space (not perceptual)
- Handles both hex colors and predefined ansicolor names