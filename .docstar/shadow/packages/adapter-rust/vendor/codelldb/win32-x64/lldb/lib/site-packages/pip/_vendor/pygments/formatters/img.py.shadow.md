# packages/adapter-rust/vendor/codelldb/win32-x64/lldb/lib/site-packages/pip/_vendor/pygments/formatters/img.py
@source-hash: 6e495876cd77998c
@generated: 2026-02-09T18:02:14Z

## Pygments Image Formatter Module

This module provides image-based formatters for the Pygments syntax highlighting library, converting tokenized source code into pixmap images (PNG, JPEG, GIF, BMP) using the Python Imaging Library (PIL).

### Core Architecture

**Dependencies**: Requires PIL/Pillow for image generation, with graceful fallback handling (L20-24). Platform-specific font handling uses Windows registry access via `winreg` (L26-32) and Unix font configuration via `fc-list` subprocess calls.

**Font Style Management**: The `STYLES` dictionary (L39-44) maps logical font styles to platform-specific font name variations, enabling cross-platform font resolution.

### Key Classes

**FontManager (L60-270)**: Central font management system that handles platform-specific font discovery and loading.
- `__init__` (L65-91): Platform detection and font initialization with fallbacks
- `_create_nix` (L106-126): Unix/Linux font discovery using fontconfig
- `_create_mac` (L130-158): macOS font resolution from standard directories
- `_create_win` (L174-212): Windows registry-based font lookup
- `get_font` (L229-253): Style-based font retrieval with bold/italic support
- Variable font support via `get_style` (L254-270) for modern font formats

**ImageFormatter (L272-640)**: Main formatter class inheriting from Pygments' Formatter base class.
- Extensive configuration via constructor options (L392-447) including fonts, colors, line numbers, highlighting
- `_create_drawables` (L540-579): Tokenizes source and builds drawable elements list
- `format` (L608-640): Main rendering pipeline - creates PIL Image, paints background, renders text and line numbers

**Format-Specific Subclasses**: 
- `GifImageFormatter` (L645-657), `JpgImageFormatter` (L659-671), `BmpImageFormatter` (L673-684): Simple subclasses that set format-specific defaults

### Critical Features

**Line Number Support**: Comprehensive line numbering with configurable positioning, styling, and background coloring (L417-436, L580-606).

**Text Positioning System**: Pixel-perfect coordinate calculation methods (`_get_text_pos`, `_get_char_x`, etc. L470-487) for precise text placement.

**Cross-Platform Font Fallbacks**: Platform-specific defaults - "Courier New" (Windows), "Menlo" (macOS), "DejaVu Sans Mono" (Unix) with automatic detection (L47-49).

**Highlight Support**: Line highlighting functionality (L437-446, L625-633) with configurable colors.

### Error Handling

**Custom Exceptions**: `PilNotAvailable` (L52-53) for missing PIL dependency, `FontNotFound` (L56-57) for font resolution failures.

**Graceful Degradation**: Font style fallbacks when specific variants unavailable (L122-125, L154-157, L191-194).

### Integration Points

Extends Pygments' `Formatter` base class following the plugin architecture. Registered via `__all__` exports (L34-35) and class-level metadata (`name`, `aliases`, `filenames` attributes).