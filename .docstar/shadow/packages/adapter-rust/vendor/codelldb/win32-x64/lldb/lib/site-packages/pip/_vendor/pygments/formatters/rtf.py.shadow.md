# packages/adapter-rust/vendor/codelldb/win32-x64/lldb/lib/site-packages/pip/_vendor/pygments/formatters/rtf.py
@source-hash: 680d2ffe9b16e8a6
@generated: 2026-02-09T18:02:05Z

## Primary Purpose
Pygments RTF formatter that converts syntax-highlighted code tokens into Rich Text Format (RTF) documents suitable for Microsoft Word and other RTF-compatible applications.

## Key Classes and Functions

### RtfFormatter (L18-146)
Main formatter class inheriting from `Formatter`. Converts tokenized source code into full RTF documents with syntax highlighting.

**Constructor** (L50-64):
- Accepts `fontface` and `fontsize` options
- Uses `get_int_opt()` utility for fontsize validation
- Sets default empty fontface if not specified

**Core Methods**:
- `_escape(text)` (L66-69): Escapes RTF special characters (backslash, braces)
- `_escape_text(text)` (L71-93): Comprehensive text escaping with Unicode handling
  - Handles ASCII characters (< 2^7) directly
  - Single Unicode escapes for 2^7 ≤ char < 2^16 
  - Surrogate pairs for chars ≥ 2^16 using `surrogatepair()` utility
  - Converts newlines to RTF paragraph breaks (`\\par\n`)

- `format_unencoded(tokensource, outfile)` (L95-146): Main formatting logic
  - Writes RTF 1.8 header with font table and color table
  - Builds color mapping dictionary for efficient color references
  - Iterates through token stream, applying style formatting
  - Handles token type inheritance via parent traversal (L122-123)

## Dependencies
- `pip._vendor.pygments.formatter.Formatter`: Base formatter class
- `pip._vendor.pygments.util`: Imports `get_int_opt` and `surrogatepair` utilities

## Key Features
- **Unicode Support**: Proper RTF Unicode escaping with surrogate pair handling
- **Color Management**: Dynamic color table generation with offset-based references
- **Style Application**: Supports bold, italic, underline, background/foreground colors, and borders
- **Font Configuration**: Customizable font face and size (in half-points)

## RTF Output Structure
1. RTF 1.8 header with font and color tables
2. Token-by-token formatting with style groups
3. Proper RTF control sequences for text formatting
4. Complete document closure

## Notable Patterns
- Lazy color table building during style iteration
- Token type inheritance resolution for undefined styles  
- Efficient string building with list concatenation and join operations
- RTF-specific escaping separate from general text escaping