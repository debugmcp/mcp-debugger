# packages/adapter-rust/vendor/codelldb/win32-x64/lldb/lib/site-packages/pip/_internal/resolution/legacy/resolver.py
@source-hash: dc766224145dd454
@generated: 2026-02-09T18:02:12Z

## Legacy Dependency Resolver

**Primary Purpose**: Implements pip's legacy dependency resolution algorithm using a "first found, wins" breadth-first strategy. Resolves package dependencies while handling conflicts, constraints, and upgrade scenarios.

**Resolution Strategy**: 
- Top-level requirements: only one spec per project, overrides sub-dependencies
- Sub-dependencies: breadth-first traversal with "first found, wins" policy

### Key Components

**_check_dist_requires_python() (L55-107)**
- Validates Python version compatibility against distribution's "Requires-Python" metadata
- Handles invalid specifiers gracefully with warnings
- Raises UnsupportedPythonVersion for incompatible versions

**Resolver Class (L109-597)**
- Inherits from BaseResolver
- Supports upgrade strategies: "eager", "only-if-needed", "to-satisfy-only" (L114)
- Core state includes preparer, finder, wheel_cache, and discovered_dependencies tracker (L152)

**resolve() (L154-189)**
- Main entry point for dependency resolution
- Returns RequirementSet containing all resolved requirements
- Handles hash validation errors by collecting and re-raising them

**_add_requirement_to_set() (L191-304)**
- Central logic for adding requirements to the resolution set
- Handles marker evaluation, wheel compatibility, and conflict detection
- Manages constraint vs regular requirement logic
- Returns tuple of (requirements_to_scan, added_requirement)

**_check_skip_installed() (L326-378)**
- Determines if installed package should be upgraded/reinstalled
- Considers force_reinstall, ignore_installed, and upgrade_strategy flags
- Returns skip reason string or None if installation should proceed

**_populate_link() (L402-439)**
- Ensures requirement has associated download link
- Integrates with wheel cache when available
- Skips cache when hashes are required due to determinism concerns

**_get_dist_for() (L441-485)**
- Prepares distribution for requirement (editable, installed, or linked)
- Handles upgrade decision logic and user notifications
- Central orchestrator for requirement preparation

**_resolve_one() (L487-568)**
- Processes single requirement and discovers its dependencies
- Validates Python compatibility via _check_dist_requires_python
- Recursively adds sub-requirements through nested add_req function (L516)
- Handles extras validation and missing extra warnings

**get_installation_order() (L570-597)**
- Creates topological installation order
- Dependencies installed before dependents
- Uses recursive schedule() function to build order while handling cycles

### Dependencies
- Integrates with RequirementPreparer for package preparation
- Uses PackageFinder for version/link discovery
- Leverages WheelCache for performance optimization
- Depends on various pip internal utilities for compatibility, logging, and metadata handling

### Key Data Structures
- DiscoveredDependencies: Maps parent requirement names to lists of child requirements (L52)
- Uses RequirementSet to track all requirements being resolved

### Architecture Notes
- Legacy resolver with acknowledged inefficiencies (comments about str->Requirement->str conversions)
- Breadth-first traversal with state tracking in _discovered_dependencies
- Separation of concerns: resolution logic separate from preparation/download logic