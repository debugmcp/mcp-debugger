# packages/adapter-rust/vendor/codelldb/win32-x64/lldb/lib/site-packages/pip/_vendor/urllib3/contrib/pyopenssl.py
@source-hash: 843261e0c87263fa
@generated: 2026-02-09T18:02:16Z

## PyOpenSSL Urllib3 Integration Module

**Primary Purpose**: Provides PyOpenSSL-backed SSL/TLS support for urllib3, enabling SNI and certificate verification in Python 2. This is a deprecated compatibility layer that monkey-patches urllib3 to use PyOpenSSL instead of the standard library's ssl module.

**Key Dependencies**:
- `OpenSSL.SSL` and `OpenSSL.crypto` for PyOpenSSL functionality
- `cryptography.x509` for certificate parsing and validation
- `pip._vendor.idna` for international domain name encoding
- `..util` and `..util.ssl_` from urllib3 for monkey-patching targets

**Core Functions**:

- `inject_into_urllib3()` (L130-141): Monkey-patches urllib3 to use PyOpenSSL context and enables SNI support by replacing util.SSLContext with PyOpenSSLContext
- `extract_from_urllib3()` (L143-152): Reverses the monkey-patching, restoring original urllib3 SSL behavior
- `_validate_dependencies_met()` (L154-178): Validates that required cryptography and PyOpenSSL versions are available
- `get_subj_alt_name()` (L223-273): Extracts Subject Alternative Names from certificates, handling both DNS names and IP addresses with proper IDNA encoding

**Key Classes**:

- `WrappedSocket` (L276-409): API-compatibility wrapper around PyOpenSSL's Connection class that implements Python socket interface. Handles SSL read/write operations, error translation, and connection lifecycle management. Includes PyPy garbage collection support via `_makefile_refs`, `_drop()`, and `_reuse()` methods.

- `PyOpenSSLContext` (L423-514): Wrapper for PyOpenSSL Context that implements Python's SSLContext interface. Maps between stdlib SSL constants and PyOpenSSL equivalents, handles certificate loading, cipher configuration, and socket wrapping with SNI support.

**Protocol/Version Mappings**:
- `_openssl_versions` (L96-109): Maps Python ssl protocol constants to PyOpenSSL method constants
- `_stdlib_to_openssl_verify` (L112-117): Maps certificate verification modes between stdlib and PyOpenSSL

**Critical Constants**:
- `SSL_WRITE_BLOCKSIZE = 16384` (L121): Maximum write block size for SSL operations
- `HAS_SNI = True` (L93): Always true since PyOpenSSL supports SNI

**Error Handling Patterns**:
- Converts PyOpenSSL exceptions to standard library equivalents (SocketError, ssl.SSLError, timeout)
- Handles ragged EOF suppression in SSL connections
- Graceful handling of unsupported certificate extensions

**Architectural Notes**:
- Module emits deprecation warning on import (L82-88) - will be removed in urllib3 2.x
- Platform-specific makefile handling for Python 2 vs 3 compatibility (L411-420)
- Extensive error handling for certificate parsing edge cases
- IDNA encoding/decoding for international domain names in certificates