# packages/adapter-rust/vendor/codelldb/win32-x64/lldb/lib/site-packages/pip/_vendor/urllib3/util/retry.py
@source-hash: 67a5847f9d7c7933
@generated: 2026-02-09T18:02:23Z

## Purpose
Implements a comprehensive HTTP retry mechanism for urllib3, providing configurable retry logic for different types of failures (connection, read, redirect, status errors) with exponential backoff and Retry-After header support.

## Core Components

### RequestHistory (L26-28)
Named tuple for tracking retry attempt metadata: method, URL, error, status code, and redirect location.

### _RetryMeta (L35-89)
Metaclass providing deprecated property aliases with warnings:
- `DEFAULT_METHOD_WHITELIST` → `DEFAULT_ALLOWED_METHODS`
- `DEFAULT_REDIRECT_HEADERS_BLACKLIST` → `DEFAULT_REMOVE_HEADERS_ON_REDIRECT`  
- `BACKOFF_MAX` → `DEFAULT_BACKOFF_MAX`

### Retry (L92-617)
Main retry configuration class with immutable retry objects created for each attempt.

#### Key Configuration Attributes
- `total` (L282): Overall retry limit, overrides other counters
- `connect/read/redirect/status/other` (L283-286): Specific retry counters per error type
- `allowed_methods` (L294): HTTP methods eligible for retry (default: idempotent methods)
- `status_forcelist` (L293): Status codes that trigger retries
- `backoff_factor` (L295): Exponential backoff multiplier
- `respect_retry_after_header` (L299): Whether to honor server Retry-After headers

#### Core Methods
- `new()` (L304-338): Creates new Retry instance with updated parameters
- `from_int()` (L340-352): Backwards-compatible constructor from integer
- `increment()` (L504-596): Core retry logic - decrements counters and creates new instance
- `is_retry()` (L468-486): Determines if request should be retried based on method/status
- `is_exhausted()` (L488-502): Checks if any retry counter is depleted
- `sleep()` (L418-432): Implements retry delay with backoff and Retry-After support

#### Backoff Logic
- `get_backoff_time()` (L354-369): Calculates exponential backoff duration
- `parse_retry_after()` (L371-392): Parses Retry-After header (seconds or HTTP date)
- `_sleep_backoff()` (L412-416): Applies calculated backoff delay

#### Error Classification
- `_is_connection_error()` (L434-440): Pre-request errors (safe to retry)
- `_is_read_error()` (L442-446): Post-request errors (may have side effects)
- `_is_method_retryable()` (L448-466): Checks if HTTP method allows retries

## Key Constants
- `DEFAULT_ALLOWED_METHODS` (L230-232): Idempotent HTTP methods
- `RETRY_AFTER_STATUS_CODES` (L235): Status codes that respect Retry-After (413, 429, 503)
- `DEFAULT_REMOVE_HEADERS_ON_REDIRECT` (L238): Security headers stripped on redirect
- `DEFAULT_BACKOFF_MAX` (L241): 120 second backoff ceiling

## Architectural Patterns
- Immutable retry objects - each attempt creates new instance
- Comprehensive deprecation handling with warnings for v2.0 migration
- Pluggable error classification system
- Separation of backoff calculation from sleep execution
- History tracking for debugging and consecutive error analysis