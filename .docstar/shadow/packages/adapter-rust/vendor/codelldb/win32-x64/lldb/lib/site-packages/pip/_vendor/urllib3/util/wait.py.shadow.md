# packages/adapter-rust/vendor/codelldb/win32-x64/lldb/lib/site-packages/pip/_vendor/urllib3/util/wait.py
@source-hash: 7ce5f4fdf6a8cc6d
@generated: 2026-02-09T18:02:15Z

## Primary Purpose
Socket I/O readiness waiting utility for urllib3. Provides cross-platform abstraction over select() and poll() system calls with automatic fallback behavior and interrupt handling. Designed for single-socket waiting scenarios rather than high-volume multiplexing.

## Key Classes and Functions

### Exception Classes
- `NoWayToWaitForSocketError` (L14-15): Custom exception raised when no socket waiting mechanism is available (e.g., on AppEngine)

### Core Implementation Functions
- `select_wait_for_socket(sock, read=False, write=False, timeout=None)` (L70-86): Windows-optimized implementation using select(). Handles Windows' non-standard exceptional socket signaling for connection success
- `poll_wait_for_socket(sock, read=False, write=False, timeout=None)` (L89-106): Unix-optimized implementation using poll(). Converts timeout from seconds to milliseconds internally
- `null_wait_for_socket(*args, **kwargs)` (L109-110): Fallback that always raises NoWayToWaitForSocketError

### Platform Detection and Retry Logic
- `_have_working_poll()` (L113-123): Runtime check for functional poll() support, accounting for broken implementations from eventlet/greenlet monkeypatching
- `_retry_on_intr(fn, timeout)` (L42-67): EINTR signal handling wrapper. Modern Python (3.5+) version is pass-through; older versions implement manual retry with deadline tracking

### Public API
- `wait_for_socket(*args, **kwargs)` (L126-138): Lazy-initialized dispatcher that selects optimal implementation on first call. Global function replacement pattern
- `wait_for_read(sock, timeout=None)` (L141-145): Convenience wrapper for read readiness checking
- `wait_for_write(sock, timeout=None)` (L148-152): Convenience wrapper for write readiness checking

## Architecture Decisions

### Platform Strategy
- **Windows**: Uses select() (poll() unavailable, select() doesn't have fd limit issues)
- **Unix-like**: Prefers poll() over select() to avoid file descriptor number limitations
- **Fallback chain**: poll() → select() → exception for unsupported platforms

### Lazy Initialization Pattern
The `wait_for_socket` function replaces itself globally on first invocation (L131-137) to avoid import-time decisions that could be invalidated by runtime monkeypatching.

### Python Version Compatibility
Handles Python < 3.5 lack of automatic syscall retry on EINTR interrupts through manual deadline-based retry logic with monotonic time tracking.

## Dependencies
- **Standard library**: errno, select, sys, functools.partial
- **Time handling**: Attempts monotonic time import, falls back to time.time (L6-9)

## Critical Constraints
- Both read and write parameters cannot be False simultaneously (L71-72, L90-91)
- Timeout handling differs between select (seconds) and poll (milliseconds) - internal conversion required
- Windows-specific workaround: checks exceptional sockets for write readiness detection (L79-83)