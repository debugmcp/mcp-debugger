# packages/adapter-rust/vendor/codelldb/win32-x64/lldb/lib/site-packages/pip/_vendor/pyproject_hooks/_in_process/_in_process.py
@source-hash: 9b66f7e1cf75ec85
@generated: 2026-02-09T18:02:16Z

## Purpose
Subprocess script that executes PEP 517 build backend hooks in isolated environments. Acts as a communication bridge between pip/build tools and Python package build systems, handling JSON-based input/output and proper error reporting.

## Key Components

### Exception Classes (L40-57)
- `BackendUnavailable` (L40-44): Backend import failures with traceback preservation
- `BackendInvalid` (L46-50): Invalid backend configuration errors  
- `HookMissing` (L52-57): Missing hook functions with hook name tracking

### Core Backend Management
- `_build_backend()` (L66-92): Loads build backend from `PEP517_BUILD_BACKEND` env var, handles module path resolution and backend-path validation
- `contained_in()` (L59-64): Security check ensuring backend files are loaded from allowed paths

### Hook Implementation Functions
- `get_requires_for_build_wheel()` (L107-119): Returns build dependencies for wheels
- `get_requires_for_build_editable()` (L121-133): Returns build dependencies for editable installs
- `prepare_metadata_for_build_wheel()` (L135-155): Prepares wheel metadata with fallback to full wheel build
- `prepare_metadata_for_build_editable()` (L157-182): Prepares editable wheel metadata with fallback support
- `build_wheel()` (L239-253): Builds wheels with optimization for pre-built wheels
- `build_editable()` (L255-274): Builds editable wheels with pre-built wheel detection
- `build_sdist()` (L300-307): Builds source distributions with UnsupportedOperation handling
- `_supported_features()` (L94-105): Reports backend capabilities (currently only 'build_editable')

### Wheel Processing Utilities
- `_get_wheel_metadata_from_wheel()` (L199-215): Extracts metadata from built wheels using zipfile
- `_dist_info_files()` (L187-197): Locates .dist-info directories in wheel archives
- `_find_already_built_wheel()` (L217-237): Detects pre-built wheels using `WHEEL_BUILT_MARKER` (L184)

### Process Control
- `main()` (L322-353): Entry point handling command-line args, JSON I/O, and comprehensive error handling
- `HOOK_NAMES` (L309-320): Whitelist of valid hook functions
- JSON utilities: `read_json()` (L35-38) and `write_json()` (L30-33) for control file I/O

## Architecture Patterns
- **Subprocess isolation**: Runs in separate process to avoid contaminating parent environment
- **Fallback mechanisms**: Graceful degradation when optional hooks are missing
- **Pre-built wheel optimization**: Avoids rebuilding wheels when metadata extraction already built them
- **Comprehensive error handling**: Structured JSON error responses with traceback preservation
- **Security validation**: Backend path containment checks prevent loading from unauthorized locations

## Dependencies
Uses standard library: `json`, `os`, `sys`, `traceback`, `glob`, `importlib`, `zipfile`, `shutil`, `re`

## Communication Protocol
- Input: Command line args (hook_name, control_dir) + environment variables + `control_dir/input.json`
- Output: `control_dir/output.json` with structured results/errors
- Environment variables: `PEP517_BUILD_BACKEND`, `PEP517_BACKEND_PATH`