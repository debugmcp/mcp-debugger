# packages/adapter-rust/vendor/codelldb/win32-x64/lldb/lib/site-packages/pip/_vendor/cachecontrol/caches/file_cache.py
@source-hash: f4096699325ce9cb
@generated: 2026-02-09T18:02:04Z

## Purpose
File-based cache implementation for HTTP caching in pip's vendored cachecontrol library. Provides secure, persistent storage of cached HTTP responses using filesystem operations with file locking and proper permissions.

## Key Classes

### `_FileCacheMixin` (L62-142)
Shared implementation base class providing core file cache functionality:
- **Constructor** (L65-92): Configures directory, permissions (filemode=0o600, dirmode=0o700), and file locking
- **`encode()`** (L95-96): Static method that SHA224-hashes keys to filesystem-safe names
- **`_fn()`** (L98-103): Generates hierarchical file paths using hash prefixes for distribution
- **`get()`** (L105-112): Retrieves cached data by reading from computed file path
- **`set()`** (L114-118): Stores data using secure write operations
- **`_write()`** (L120-133): Thread-safe file writing with directory creation and file locking
- **`_delete()`** (L135-141): Conditional file deletion (respects `forever` flag)

### `FileCache` (L144-151)
Traditional cache storing entire response body in memory:
- Inherits from `_FileCacheMixin` and `BaseCache`
- **`delete()`** (L150-151): Removes main cache file

### `SeparateBodyFileCache` (L154-173)
Memory-efficient cache storing response body in separate files:
- Inherits from `_FileCacheMixin` and `SeparateBodyBaseCache`
- **`get_body()`** (L160-165): Returns file handle for streaming body content
- **`set_body()`** (L167-169): Stores body in `.body` suffix file
- **`delete()`** (L171-173): Removes both main cache file and body file

## Key Functions

### `_secure_open_write()` (L21-59)
Security-focused file opening with atomic operations:
- Uses `O_CREAT | O_EXCL` flags to prevent race conditions
- Includes `O_NOFOLLOW` to prevent symlink attacks
- Removes existing files before creation to ensure proper permissions
- Platform-specific binary mode handling for Windows

### `url_to_file_path()` (L176-181)
Utility function converting URLs to cache file paths using `CacheController.cache_url()` and the mixin's `_fn()` method.

## Dependencies
- **External**: `filelock` (required dependency with helpful error message)
- **Internal**: `BaseCache`, `SeparateBodyBaseCache` from cachecontrol.cache
- **Standard**: `hashlib`, `os`, `pathlib`

## Security Features
- File permissions enforced via filemode/dirmode parameters
- Atomic file operations prevent race conditions
- Symlink attack prevention via O_NOFOLLOW
- File locking prevents concurrent write conflicts

## Architecture Patterns
- Mixin pattern for shared cache functionality
- Template method pattern for different cache strategies
- Factory pattern for lock class selection
- Hierarchical file organization using hash prefixes for performance