# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_internal/utils/glibc.py
@source-hash: 0b28d4cf4c7f034d
@generated: 2026-02-09T17:58:37Z

## Purpose
Utility module for detecting glibc version on Unix-like systems. Provides reliable glibc version detection as an alternative to Python's `platform.libc_ver()`, which is known to return incorrect results.

## Key Functions

### `glibc_version_string()` (L6-8)
Main entry point that returns glibc version string or None if not using glibc. Implements fallback strategy: tries `os.confstr` first, then falls back to ctypes approach.

### `glibc_version_string_confstr()` (L11-28) 
Primary implementation using `os.confstr("CS_GNU_LIBC_VERSION")`. Fast and reliable method that:
- Returns None on Windows (L17-18)
- Parses "glibc X.Y" format string to extract version (L24)
- Handles various failure modes gracefully (L25-27)

### `glibc_version_string_ctypes()` (L31-61)
Fallback implementation using ctypes to call `gnu_get_libc_version()` directly:
- Uses `ctypes.CDLL(None)` to access main program's symbols (L44)
- Calls glibc's `gnu_get_libc_version` function if available (L48-52)
- Handles string encoding for Python 2/3 compatibility (L57-59)

### `libc_ver()` (L81-91)
Public API function that returns standardized tuple format `(lib_name, version)`. Returns `("glibc", version)` if glibc detected, otherwise `("", "")`.

## Dependencies
- `os` - for confstr system call
- `sys` - for platform detection
- `ctypes` - for fallback glibc detection (imported conditionally)
- `typing` - for type annotations

## Architecture Notes
- Dual-strategy approach prioritizes speed (confstr) over compatibility (ctypes)
- Extensive error handling for missing APIs and malformed data
- Cross-platform aware (explicitly handles Windows)
- Designed to replace unreliable `platform.libc_ver()` functionality

## Critical Context
The module exists because Python's built-in `platform.libc_ver()` returns incorrect glibc versions, as documented in the detailed comment block (L64-80). This causes issues for pip's dependency resolution and wheel compatibility checking.