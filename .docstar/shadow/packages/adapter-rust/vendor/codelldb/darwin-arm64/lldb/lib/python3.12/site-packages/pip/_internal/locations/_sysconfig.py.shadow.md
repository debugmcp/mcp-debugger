# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_internal/locations/_sysconfig.py
@source-hash: 206cddb3ad2ab059
@generated: 2026-02-09T17:58:41Z

## Purpose and Responsibility

This module provides platform-aware Python installation path resolution using sysconfig, handling cross-platform differences and edge cases for pip's internal location management. It abstracts away platform-specific scheme selection and path computation for different installation contexts (user, home, prefix, system).

## Key Functions and Their Roles

### Scheme Inference Functions
- `_should_use_osx_framework_prefix()` (L29-52): Detects Apple's special `osx_framework_library` scheme used by Command Line Tools Python in framework builds when installing to system prefix (not virtualenv)
- `_infer_prefix()` (L55-83): Primary scheme selection logic with fallback hierarchy: preferred API → OSX framework → implementation+OS → implementation → OS+prefix → OS → posix_prefix
- `_infer_user()` (L86-98): User scheme inference with OSX framework special case and UserInstallationInvalid exception for unavailable user schemes
- `_infer_home()` (L101-108): Home scheme inference with OS-specific suffixed schemes falling back to posix_home

### Main Public Interface
- `get_scheme()` (L124-199): Primary entry point that orchestrates scheme selection, validates parameter combinations, handles custom prefix/home/root rebasing, and applies virtualenv-specific header path logic
- `get_bin_prefix()` (L202-206): Returns binary/script installation directory with hardcoded `/usr/local/bin` override for standard macOS framework installs
- `get_purelib()` (L209-210): Returns pure Python library installation path
- `get_platlib()` (L213-214): Returns platform-specific library installation path

## Important Dependencies and Relationships

### Internal Dependencies
- `pip._internal.exceptions`: InvalidSchemeCombination, UserInstallationInvalid for error handling
- `pip._internal.models.scheme`: Scheme dataclass and SCHEME_KEYS constant
- `pip._internal.utils.virtualenv.running_under_virtualenv()`: Virtualenv detection affecting path logic
- `.base` module: change_root, get_major_minor_version, is_osx_framework utilities

### System Dependencies
- `sysconfig` module: Core Python installation path discovery
- `sys`, `os`: Platform and implementation detection

## Notable Patterns and Architectural Decisions

### Scheme Selection Strategy
Uses hierarchical fallback approach prioritizing newer sysconfig APIs (`_PREFERRED_SCHEME_API` at L26) over custom inference logic, with platform-specific edge cases handled explicitly.

### OSX Framework Handling
Complex logic (L160-161) switches from `osx_framework_library` to `posix_prefix` when custom prefix specified, maintaining compatibility between stdlib and custom implementations.

### Virtualenv Header Path Override
Special case logic (L177-183) uses custom header path format in virtual environments for historical compatibility, ignoring standard sysconfig paths.

## Critical Invariants and Constraints

### Parameter Validation
- `get_scheme()` enforces mutual exclusivity: user+prefix and home+prefix combinations raise InvalidSchemeCombination
- Missing user scheme support triggers UserInstallationInvalid exception

### Path Computation Constants
- `_HOME_KEYS` (L112-121): Defines sysconfig variables overridden by custom home/prefix, conditionally includes userbase if available
- `_AVAILABLE_SCHEMES` (L24): Cached set of platform-available schemes for validation

### Platform-Specific Behavior
- Darwin framework detection affects scheme selection and binary path resolution
- Windows uses scheme name `nt` while POSIX uses `posix_prefix`
- PyPy implementations get implementation-specific schemes (pypy, pypy_nt)