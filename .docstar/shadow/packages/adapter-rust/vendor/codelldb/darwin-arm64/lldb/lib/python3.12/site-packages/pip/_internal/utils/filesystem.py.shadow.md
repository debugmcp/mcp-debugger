# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_internal/utils/filesystem.py
@source-hash: 4613085d468d54c1
@generated: 2026-02-09T17:58:41Z

## Purpose
Filesystem utilities for pip's internal operations, providing secure file operations, path validation, and directory/file size calculations with cross-platform compatibility.

## Key Functions

### Path Ownership & Security
- `check_path_owner(path)` (L16-41): Verifies if current user owns a path by traversing up directory tree until existing path found. Returns True on Windows/systems without geteuid. Special handling for root user to check actual path ownership rather than just write access.
- `test_writable_dir(path)` (L76-92): Cross-platform directory write permission check. Uses os.access() on POSIX, delegates to Windows-specific implementation.
- `_test_writable_dir_win(path)` (L94-120): Windows-specific write test that creates temporary files with random names since os.access() is unreliable on Windows.

### Safe File Operations
- `adjacent_tmp_file(path, **kwargs)` (L43-66): Context manager creating temporary file in same directory as target path. Ensures data is flushed and synced to disk before cleanup. Uses NamedTemporaryFile with delete=False for manual cleanup control.
- `replace` (L71): Retry-wrapped version of os.replace() with 1-second timeout and 0.25-second intervals for handling transient filesystem issues.

### File Discovery & Sizing
- `find_files(path, pattern)` (L122-129): Recursive file search using Unix shell glob patterns via fnmatch. Returns absolute paths.
- `file_size(path)` (L132-136): Gets file size, returns 0 for symlinks to avoid following links.
- `format_file_size(path)` (L139-140): Human-readable file size formatting.
- `directory_size(path)` (L143-149): Recursive directory size calculation, handles symlinks via file_size().
- `format_directory_size(path)` (L152-153): Human-readable directory size formatting.

## Dependencies
- External: fnmatch, os, sys, tempfile, contextlib
- Internal: pip._vendor.tenacity for retry logic, pip._internal.utils.compat.get_path_uid, pip._internal.utils.misc.format_size

## Architecture Notes
- Cross-platform abstraction with platform-specific implementations
- Retry mechanism for filesystem operations using tenacity library
- Security-conscious design (temp files in same directory, ownership checks)
- Symlink-aware size calculations