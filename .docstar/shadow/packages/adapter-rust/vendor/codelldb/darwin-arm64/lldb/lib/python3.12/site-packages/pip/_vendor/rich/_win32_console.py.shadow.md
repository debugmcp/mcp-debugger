# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/rich/_win32_console.py
@source-hash: 3f4bf12367dc9ddc
@generated: 2026-02-09T17:59:08Z

**Purpose:** Windows Console API wrapper module providing cross-platform console functionality for the Rich text library. Only imports on Windows systems and raises ImportError otherwise (L10-13).

**Key Dependencies:**
- ctypes for Windows API bindings (L5)
- Rich color system and style modules (L19-20)
- Windows-specific types from wintypes (L16)

**Core Data Structures:**

**WindowsCoordinates (L32-53):** NamedTuple converting (row, col) to Windows Console API's (y, x) coordinate system. Includes `from_param()` classmethod for automatic ctypes conversion.

**CONSOLE_SCREEN_BUFFER_INFO (L56-63):** ctypes Structure for console screen buffer metadata including size, cursor position, attributes, and window bounds.

**CONSOLE_CURSOR_INFO (L66-67):** ctypes Structure for cursor size and visibility state.

**Exception Classes:**
- LegacyWindowsError (L28-29): Custom exception for Windows Console API failures

**Windows API Function Wrappers:**
- GetStdHandle() (L77-86): Retrieves standard device handles (default: stdout)
- GetConsoleMode() (L94-113): Gets console input/output mode with error handling
- FillConsoleOutputCharacter() (L127-154): Writes characters repeatedly at coordinates
- FillConsoleOutputAttribute() (L168-192): Sets text attributes for character ranges
- SetConsoleTextAttribute() (L203-216): Sets color attributes for subsequent text
- GetConsoleScreenBufferInfo() (L227-240): Retrieves console buffer information
- SetConsoleCursorPosition() (L251-263): Positions cursor at coordinates
- GetConsoleCursorInfo()/SetConsoleCursorInfo() (L274-310): Cursor visibility/size control
- SetConsoleTitle() (L318-327): Sets console window title

**LegacyWindowsTerm Class (L330-574):**
Primary interface for legacy Windows console operations when virtual terminal processing unavailable.

**Key Features:**
- ANSI_TO_WINDOWS color mapping array (L342-359) converting ANSI color codes to Windows console colors
- Constructor initializes handle, default colors, and delegates write/flush to file object (L361-373)
- Properties: cursor_position (L376-383), screen_size (L386-395)
- Text output: write_text() (L397-404), write_styled() with Rich Style support (L406-443)
- Cursor movement: move_cursor_to(), move_cursor_up/down/forward/backward() (L445-546)
- Line editing: erase_line(), erase_end_of_line(), erase_start_of_line() (L455-492)
- Cursor visibility: hide_cursor(), show_cursor() (L548-558)
- Window management: set_title() (L560-567)

**Architecture Notes:**
- Uses composition pattern delegating write/flush to underlying file object
- Maintains default color state for restoration after styled text
- Handles coordinate boundary checking and line wrapping
- Color processing includes bold/dim/reverse style support

**Demo Script (L576-662):** Complete example demonstrating color output, cursor movement, and line erasing capabilities with timing delays for visual effect.