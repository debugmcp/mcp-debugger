# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/tenacity/_asyncio.py
@source-hash: 422eb0810b066bd3
@generated: 2026-02-09T17:59:17Z

## Purpose
Provides async/await support for the tenacity retry library, implementing asynchronous retry patterns that work with coroutines and async context managers.

## Key Components

### AsyncRetrying Class (L33-94)
Main async retry orchestrator extending `BaseRetrying`. Manages retry logic for async functions with configurable sleep behavior.

**Constructor (L36-38)**: Accepts custom async sleep function (defaults to `asyncio.sleep`)

**Async Call Method (L40-59)**: Core retry loop implementation
- Creates `RetryCallState` to track retry attempts
- Executes retry decision logic via `self.iter()`
- Handles `DoAttempt`: executes target function, captures results/exceptions
- Handles `DoSleep`: waits specified duration before next attempt
- Returns final result or raises exception when retry conditions exhausted

**Async Iterator Protocol (L64-80)**:
- `__aiter__` (L64-67): Initializes retry state for async iteration
- `__anext__` (L69-80): Yields `AttemptManager` instances for manual retry control
- `__iter__` (L61-62): Explicitly disabled to prevent sync iteration confusion

**Function Wrapper (L82-94)**: Creates async-aware decorated functions
- Wraps sync decorators to preserve coroutine semantics
- Maintains retry attributes (`retry`, `retry_with`) on wrapped function

### Type Definitions (L29-30)
- `WrappedFnReturnT`: Generic return type for wrapped functions
- `WrappedFn`: Type constraint for async callable functions

## Dependencies
- Core tenacity classes: `BaseRetrying`, `AttemptManager`, `DoAttempt`, `DoSleep`, `RetryCallState`
- `asyncio.sleep` for default async sleep implementation
- Standard library: `functools`, `sys`, `typing`

## Architectural Patterns
- **Adapter Pattern**: Adapts sync tenacity retry logic for async contexts
- **Iterator Protocol**: Supports both function decoration and manual iteration patterns
- **State Management**: Uses `RetryCallState` to track attempt history and context
- **Exception Handling**: Preserves full exception info via `sys.exc_info()`

## Critical Constraints
- Only works with async functions (`t.Awaitable` return types)
- Requires async sleep function compatible with event loop
- Iterator protocol enforces async-only usage (sync iteration raises `TypeError`)
- Wrapper preserves original function attributes for retry configuration