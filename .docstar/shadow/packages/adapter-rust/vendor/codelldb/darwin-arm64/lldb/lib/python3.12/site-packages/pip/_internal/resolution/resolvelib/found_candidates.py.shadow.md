# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_internal/resolution/resolvelib/found_candidates.py
@source-hash: f61ad3c90a85be5f
@generated: 2026-02-09T17:57:30Z

## Purpose
Provides lazy evaluation utilities for pip's dependency resolution system. Implements deferred candidate creation and visitation to avoid costly operations (fetching, extracting, building) until absolutely necessary.

## Key Components

### Type Aliases & Compatibility (L24-39)
- `IndexCandidateInfo`: Type alias for tuple of version and candidate factory function
- `SequenceCandidate`: Compatibility wrapper for Python <3.9 generic sequence typing

### Core Iterator Functions
- **`_iter_built(infos)` (L42-71)**: Base iterator for fresh installations. Deduplicates versions, handles metadata validation errors, logs warnings for invalid packages with pip version guidance.
- **`_iter_built_with_prepended(installed, infos)` (L73-93)**: Iterator for prefer-installed mode. Yields installed candidate first, then index candidates excluding already-installed version.
- **`_iter_built_with_inserted(installed, infos)` (L95-125)**: Iterator for upgrade-preferred mode. Inserts installed candidate at appropriate position based on version comparison, handles edge case where installed is older than all candidates.

### FoundCandidates Class (L127-174)
Lazy sequence implementation satisfying `SequenceCandidate` protocol:
- **Constructor (L136-147)**: Accepts candidate info factory, optional installed candidate, preference flag, and incompatible IDs set
- **`__iter__()` (L154-162)**: Core method selecting appropriate iterator strategy based on installation state and preferences, filters incompatible candidates by ID
- **`__getitem__()` & `__len__()` (L148-168)**: Deliberately unimplemented to prevent performance-degrading random access
- **`__bool__()` (L170-174)**: LRU-cached boolean evaluation, optimized for prefer-installed case

## Architecture Patterns
- **Lazy evaluation**: All candidate creation deferred via factory functions
- **Strategy pattern**: Different iteration strategies based on installation preferences
- **Performance optimization**: Version deduplication, early termination, caching
- **Error resilience**: Graceful handling of metadata validation failures

## Dependencies
- `pip._vendor.packaging.version._BaseVersion` for version handling
- `pip._internal.exceptions.MetadataInvalid` for error handling
- `pip._internal.resolution.resolvelib.base.Candidate` as base candidate type

## Critical Invariants
- Version deduplication prevents redundant candidate evaluation
- Incompatible candidates filtered by object ID
- Iterator selection based on installation state and preference flags
- Performance-critical operations cached or avoided