# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/packaging/markers.py
@source-hash: 756292aa7e52a7e8
@generated: 2026-02-09T17:58:53Z

## Primary Purpose
Python packaging markers parser and evaluator for PEP 508 environment markers. Enables conditional dependencies based on platform/Python version constraints.

## Key Classes and Functions

### Exception Classes (L30-47)
- `InvalidMarker(ValueError)` (L30-34): Raised for malformed marker syntax
- `UndefinedComparison(ValueError)` (L36-40): Invalid operations on incompatible values
- `UndefinedEnvironmentName(ValueError)` (L42-47): Referenced environment variable doesn't exist

### Environment Definition
- `Environment(TypedDict)` (L49-119): Complete specification of system environment variables used in marker evaluation, including Python version, platform details, and implementation info

### Core Marker Class
- `Marker` (L260-325): Main class for parsing and evaluating PEP 508 markers
  - `__init__(marker: str)` (L261-284): Parses marker string using `_parse_marker`, normalizes extra values
  - `evaluate(environment)` (L301-325): Evaluates marker against current or provided environment

### Utility Functions
- `default_environment()` (L242-257): Constructs current system environment dict using platform/sys modules
- `format_full_version(info)` (L234-239): Formats sys.version_info into PEP 440 compliant string
- `_evaluate_markers(markers, environment)` (L204-231): Core recursive evaluation logic handling AND/OR groups
- `_eval_op(lhs, op, rhs)` (L177-189): Evaluates individual comparison operations, supports version specifiers
- `_normalize_extra_values(results)` (L121-134): Canonicalizes "extra" names per PEP 685
- `_format_marker(marker, first)` (L137-162): Converts parsed marker structure back to string representation

### Constants
- `_operators` (L165-174): Maps operator strings to callable functions (in, ==, >=, etc.)
- `Operator` type alias (L27): `Callable[[str, str], bool]`

## Dependencies
- `._parser`: MarkerAtom, MarkerList, Op, Value, Variable types and `_parse_marker`
- `._tokenizer`: ParserSyntaxError for parsing failures  
- `.specifiers`: Specifier and InvalidSpecifier for version comparisons
- `.utils`: canonicalize_name for PEP 503 name normalization

## Architecture Patterns
- Recursive descent parsing with normalization pipeline
- Two-phase evaluation: parse-time normalization + runtime evaluation
- Environment variable abstraction with default detection
- Operator dispatch pattern for comparison operations

## Critical Invariants
- Extra names must be canonicalized per PEP 685 (L197-198)
- Environment dict must contain all required keys from Environment TypedDict
- Marker evaluation groups use AND within groups, OR between groups (L231)
- Python version strings get "+local" suffix for non-tagged builds (L316-317)