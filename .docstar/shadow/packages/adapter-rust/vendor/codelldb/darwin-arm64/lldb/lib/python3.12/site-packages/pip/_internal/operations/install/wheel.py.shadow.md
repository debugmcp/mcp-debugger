# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_internal/operations/install/wheel.py
@source-hash: c2c8435009f1b8f5
@generated: 2026-02-09T17:57:43Z

## Purpose
Core wheel installation functionality for pip, handling extraction, file placement, script generation, and RECORD file management during Python package installation from wheel format.

## Key Functions

### File Operations
- `rehash(path, blocksize=1048576)` (L80-84): Computes SHA256 hash and file size for RECORD entries
- `csv_io_kwargs(mode)` (L87-91): Returns standardized CSV file opening parameters with UTF-8 encoding
- `fix_script(path)` (L94-111): Updates shebang lines in scripts to use current Python executable

### Wheel Metadata Processing
- `wheel_root_is_purelib(metadata)` (L114-115): Determines if wheel contains pure Python code vs platform-specific
- `get_entrypoints(dist)` (L118-126): Extracts console and GUI script entry points from distribution metadata
- `parse_wheel()` dependency handles wheel validation and metadata extraction

### Path Management
- `_record_to_fs_path(record_path, lib_dir)` (L227-228): Converts RECORD paths to filesystem paths
- `_fs_to_record_path(path, lib_dir)` (L231-238): Converts filesystem paths to RECORD format, handling Windows drive letters

### Script Generation
- `get_console_script_specs(console)` (L273-345): Handles special pip/setuptools versioning logic and ENSUREPIP_OPTIONS environment variable processing
- `message_about_scripts_not_on_PATH(scripts)` (L129-198): Generates warnings for scripts installed outside PATH directories

### RECORD File Management
- `get_csv_rows_for_installed()` (L241-270): Updates RECORD entries for installed files, handling file changes and new generated files
- `_normalized_outrows(outrows)` (L201-224): Normalizes and sorts RECORD file entries for consistent output

## Key Classes

### File Abstraction
- `ZipBackedFile` (L348-386): Handles extraction of files from wheel ZIP archives, with path traversal protection and executable bit preservation
- `ScriptFile` (L388-398): Wrapper for script files that applies shebang fixing after extraction
- `File` Protocol (L65-71): Interface for file objects with save capability

### Script Generation
- `PipScriptMaker` (L416-421): Extends distlib's ScriptMaker with entry point validation
- `MissingCallableSuffix` (L400-407): Exception for invalid entry point specifications

## Core Installation Logic

### Main Installation Function
- `install_wheel()` (L714-735): Public interface - opens wheel ZIP and delegates to internal implementation
- `_install_wheel()` (L424-703): Core implementation handling:
  - File categorization (root scheme vs data scheme vs scripts)
  - Path traversal security validation
  - File extraction and placement
  - Python bytecode compilation
  - Entry point script generation
  - RECORD file creation
  - Metadata file generation (INSTALLER, DIRECT_URL, REQUESTED)

### File Processing Pipeline
1. **Categorization**: Separates wheel contents into root files, data files, and scripts (L534-547)
2. **Security**: Validates all paths to prevent traversal attacks (L476-484)
3. **Extraction**: Uses factory pattern for file makers based on scheme type (L486-529)
4. **Script Processing**: Filters out setuptools-generated entry point wrappers (L560-581)
5. **Compilation**: Optional Python bytecode compilation with error handling (L604-620)
6. **Record Generation**: Creates comprehensive installation record (L684-702)

## Dependencies
- `pip._vendor.distlib`: Script generation and entry point parsing
- `pip._internal.metadata`: Wheel distribution handling
- `pip._internal.utils.unpacking`: File extraction utilities
- `pip._internal.models.scheme`: Installation path schemes

## Security Features
- Path traversal prevention in `assert_no_path_traversal()` (L476-484)
- Safe file replacement using temporary files and atomic moves (L655-660)
- Proper file permissions handling with umask consideration (L653)

## Notable Patterns
- Factory pattern for file makers based on installation scheme
- Iterator chaining for processing different file categories
- Context manager for error enrichment (`req_error_context`, L705-711)
- Special handling for pip/setuptools versioned entry points based on environment variables