# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_internal/metadata/importlib/_envs.py
@source-hash: f001a88db7fb122f
@generated: 2026-02-09T17:57:26Z

**Purpose:** Implements importlib.metadata-based Python package environment discovery for pip, providing distribution finding and environment management capabilities.

**Core Classes:**

- `_DistributionFinder` (L34-147): Distribution discovery engine with memoization to prevent duplicates
  - `_found_names` (L50): Set tracking discovered package names to enforce uniqueness
  - `_find_impl()` (L52-72): Core distribution discovery logic, skips wheels and handles metadata errors
  - `find()` (L74-84): Main interface for finding distributions in directories/ZIP archives
  - `find_linked()` (L86-108): Handles egg-link files for development installations
  - `find_eggs()` (L134-146): Legacy egg format support using pkg_resources backend

- `Environment` (L159-189): Main environment interface implementing BaseEnvironment
  - `_paths` (L161): Sequence of search paths for package discovery
  - `default()` (L164-165): Creates environment from sys.path
  - `from_paths()` (L167-171): Creates environment from custom path list
  - `_iter_distributions()` (L173-181): Orchestrates all discovery methods with proper precedence
  - `get_distribution()` (L183-189): Retrieves specific distribution by normalized name

**Key Functions:**

- `_looks_like_wheel()` (L24-31): Validates wheel file format and integrity
- `_emit_egg_deprecation()` (L149-156): Cached deprecation warning for egg format usage

**Dependencies:**
- importlib.metadata for modern distribution discovery
- pip._vendor.pkg_resources for legacy egg support
- pip._internal.metadata.base for interface contracts
- Custom ._compat and ._dists modules for compatibility and distribution wrapping

**Architecture Patterns:**
- Memoization strategy prevents duplicate distributions from multiple paths
- Precedence ordering: regular distributions → eggs → linked packages
- Graceful fallback from modern importlib.metadata to legacy pkg_resources
- Error resilience with BadMetadata exception handling and logging

**Critical Invariants:**
- Only one distribution returned per normalized package name
- Wheel files are excluded from distribution discovery
- egg-link resolution follows setuptools compatibility rules
- Path order determines installation precedence