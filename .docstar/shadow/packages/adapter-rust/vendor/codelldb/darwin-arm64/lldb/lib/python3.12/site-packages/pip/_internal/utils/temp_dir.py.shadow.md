# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_internal/utils/temp_dir.py
@source-hash: 0d4030db6b85aee4
@generated: 2026-02-09T17:58:45Z

**Primary Purpose**: Provides temporary directory management utilities for pip's internal operations, including automatic cleanup, global lifecycle management, and specialized directory creation patterns.

**Core Classes**:

- **TempDirectoryTypeRegistry (L50-67)**: Manages deletion policies for different temp directory types. Key methods:
  - `set_delete()` (L56): Configure auto-deletion for specific directory kinds
  - `get_delete()` (L62): Retrieve deletion policy (defaults to True)

- **TempDirectory (L93-224)**: Main temporary directory abstraction with context manager support. Constructor (L114-147) accepts path, delete behavior, kind, global management flag, and cleanup error handling. Key features:
  - `path` property (L149-152): Access to directory path with deletion safety check
  - `cleanup()` (L181-223): Robust removal with error handling and logging
  - Context manager support (L157-169) with configurable deletion on exit

- **AdjacentTempDirectory (L226-296)**: Specialized subclass for creating temporary directories next to existing ones. Uses name generation algorithm (L253-276) to avoid conflicts by rotating through valid filesystem characters.

**Global State Management**:
- `_tempdir_manager` (L36): Global ExitStack for managing temporary directories
- `global_tempdir_manager()` (L39-47): Context manager for scoped global temp directory management
- `tempdir_registry()` (L72-83): Provides scoped registry for deletion policies
- `tempdir_kinds` enum (L29-33): Predefined directory types (BUILD_ENV, EPHEM_WHEEL_CACHE, REQ_BUILD)

**Key Dependencies**:
- `pip._internal.utils.misc.rmtree`: Enhanced directory removal with retry logic
- Standard library: `tempfile`, `os.path`, `contextlib`, `pathlib`

**Architectural Patterns**:
- Context manager pattern for automatic cleanup
- Global state management with scoped overrides
- Fallback strategies for directory creation
- Comprehensive error handling with optional error suppression
- Name generation algorithms for conflict avoidance

**Critical Invariants**:
- Path access forbidden after deletion (enforced by assertion in L151)
- Global manager must exist when `globally_managed=True` (L146)
- Deletion behavior resolved at exit time based on registry or explicit setting
- Directory paths are canonicalized using `os.path.realpath()` to handle symlinks