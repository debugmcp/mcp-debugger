# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_internal/network/auth.py
@source-hash: 891bb92c110c2bfd
@generated: 2026-02-09T17:58:42Z

**Primary Purpose**
Network authentication helpers for pip that provide multi-domain credential management with keyring integration, netrc support, and interactive prompting. Core component for handling HTTP authentication during package downloads and repository access.

**Key Classes & Functions**

- `Credentials` (L39-43): NamedTuple storing URL, username, password triplet
- `KeyRingBaseProvider` (L45-57): Abstract base class defining keyring interface with `get_auth_info()` and `save_auth_info()` methods
- `KeyRingNullProvider` (L59-68): No-op keyring implementation when keyring is disabled/unavailable
- `KeyRingPythonProvider` (L71-101): Uses imported `keyring` library, supports both legacy `get_password()` and modern `get_credential()` interfaces (L85-90)
- `KeyRingCliProvider` (L103-159): Executes keyring CLI commands via subprocess, includes PATH manipulation to avoid circular dependencies (L184-218)
- `get_keyring_provider()` (L162-221): LRU-cached factory function that selects appropriate keyring provider based on availability and configuration
- `MultiDomainBasicAuth` (L224-562): Main authentication handler implementing requests `AuthBase` interface

**MultiDomainBasicAuth Core Methods**
- `__call__()` (L436-450): Request preprocessor that extracts/applies credentials and registers 401 handler
- `_get_new_credentials()` (L331-386): Credential resolution cascade: URL auth → index URL auth → netrc → keyring
- `_get_url_and_credentials()` (L388-434): Combines new credential lookup with cached credentials
- `handle_401()` (L476-537): Response hook for authentication failures, handles interactive prompting and credential caching
- `_prompt_for_password()` (L453-464): Interactive credential collection with keyring lookup
- `save_credentials()` (L547-562): Response hook to persist successful credentials to keyring

**Dependencies & Architecture**
- Integrates with requests authentication via `AuthBase` and `HTTPBasicAuth`
- Uses `urllib.parse` for URL manipulation and credential extraction
- Leverages pip's internal utilities for user interaction (`ask`, `ask_input`, `ask_password`)
- Supports multiple keyring backends: Python import, CLI subprocess, or disabled
- Global `KEYRING_DISABLED` flag (L36) for runtime keyring disabling on errors

**Key Patterns**
- Credential precedence: URL embedded → index URL → netrc → keyring → interactive prompt
- Lazy keyring provider initialization with error handling and fallback chains
- Response hook pattern for handling authentication failures and success callbacks
- Caching at multiple levels: provider selection (LRU), credential storage (dict), keyring queries
- PATH manipulation to prevent keyring circular dependencies in subprocess mode (L184-218)

**Critical Constraints**
- Credentials must be both present or both None (assertion L427-432)
- Keyring operations wrapped in exception handling to prevent authentication failures
- Interactive prompting only enabled when `prompting=True` and specific conditions met
- CLI keyring provider requires UTF-8 encoding and proper subprocess error handling