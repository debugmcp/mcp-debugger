# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_internal/req/req_install.py
@source-hash: dbd2cb078a06e888
@generated: 2026-02-09T17:58:43Z

**Primary Purpose & Responsibility**
Core pip requirement representation and installation management. The `InstallRequirement` class (L64-862) encapsulates everything needed to install a Python package - from parsing requirements to building, uninstalling, and archiving packages. Handles both PEP 517 (modern) and legacy (setup.py) build systems.

**Key Classes & Functions**

- `InstallRequirement.__init__()` (L71-198): Massive constructor accepting requirement specs, links, build configs, and installation options. Sets up source directories, links, extras, markers, and build environments.

- `InstallRequirement.load_pyproject_toml()` (L503-529): Loads PEP 517 build configuration from pyproject.toml, determining whether to use modern or legacy build path. Sets `use_pep517`, `pyproject_requires`, and `pep517_backend`.

- `InstallRequirement.prepare_metadata()` (L552-594): Central orchestration for metadata generation. Routes to PEP 517 (`generate_metadata`/`generate_editable_metadata`) or legacy (`generate_metadata_legacy`) based on `use_pep517` flag.

- `InstallRequirement.install()` (L806-861): Main installation entry point. Handles editable vs wheel installs, delegates to `install_editable_legacy()` or `install_wheel()`.

- `InstallRequirement.check_if_exists()` (L426-461): Conflict detection logic - checks for existing installations and determines whether to reinstall based on version compatibility and user site preferences.

- `check_invalid_constraint_type()` (L864-889): Validates constraint requirements format, ensuring they follow package name + version specifier pattern.

**Critical Properties & State**

- `source_dir` (L101): Local directory containing unpacked source code
- `use_pep517` (L181): Flag determining build system (modern vs legacy)
- `satisfied_by` (L139): Existing distribution that satisfies this requirement
- `should_reinstall` (L142): Whether to force reinstallation
- `metadata_directory` (L165): PEP 517 metadata location
- `pep517_backend` (L174): Build backend hook caller for PEP 517

**Important Dependencies**

- `pip._vendor.packaging.*`: Requirement parsing, version handling, markers
- `pip._internal.operations.build.*`: Metadata generation strategies
- `pip._internal.operations.install.*`: Installation implementations
- `pip._internal.metadata.*`: Distribution metadata access
- `pip._internal.build_env.BuildEnvironment`: Isolated build environments

**Architectural Patterns**

- **State Machine**: Requirements progress through states (unprepared → metadata generated → installed)
- **Strategy Pattern**: Build system selection (PEP 517 vs legacy) based on `use_pep517`
- **Template Method**: `prepare_metadata()` orchestrates different metadata generation strategies
- **Builder Pattern**: Complex requirement construction through extensive constructor parameters

**Critical Invariants**

- `req` must be valid `Requirement` object or None (L89)
- Editable requirements must have a link (L103)
- Source directory required for source-based operations (assertions throughout)
- PEP 517 backend required when `use_pep517=True` (L562)
- Wheel files must exist locally before installation (L849)