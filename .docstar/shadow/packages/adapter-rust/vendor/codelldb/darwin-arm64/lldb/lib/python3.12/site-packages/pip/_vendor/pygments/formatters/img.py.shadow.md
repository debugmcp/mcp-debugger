# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/pygments/formatters/img.py
@source-hash: 6e495876cd77998c
@generated: 2026-02-09T17:57:36Z

## Purpose
Pygments image formatter module that converts syntax-highlighted source code into PNG, GIF, JPEG, or BMP images using PIL/Pillow. Provides cross-platform font management and extensive customization options for visual output.

## Key Components

### Exception Classes
- `PilNotAvailable(ImportError)` (L52-53): Raised when PIL/Pillow is not installed
- `FontNotFound(Exception)` (L56-57): Raised when specified fonts cannot be located

### FontManager Class (L60-269)
Core font management system supporting Windows registry, macOS font directories, and Linux fontconfig.

**Initialization** (L65-90): Auto-detects platform and sets up fonts using file paths or system fonts with platform-specific defaults
- Windows: "Courier New" via registry lookup
- macOS: "Menlo" via filesystem scanning  
- Linux: "DejaVu Sans Mono" via fontconfig

**Platform-specific Font Loading:**
- `_create_nix()` (L106-125): Uses `fc-list` subprocess to query fontconfig
- `_create_mac()` (L130-157): Scans system font directories for TTF/TTC files
- `_create_win()` (L174-211): Queries Windows registry keys for font paths

**Font Access Methods:**
- `get_font(bold, oblique)` (L229-252): Returns appropriate font variant based on style flags
- `get_style()` (L254-269): Handles variable font style variations
- `get_char_size()` (L213-217): Returns character dimensions for layout calculations

### ImageFormatter Class (L272-640)
Main formatter class extending Pygments' `Formatter` base class.

**Configuration** (L392-446): Extensive options processing including:
- Image format, padding, font settings
- Line number display and styling
- Syntax highlighting color extraction from Pygments styles
- Line highlighting capabilities

**Core Rendering Pipeline:**
1. `_create_drawables(tokensource)` (L540-578): Processes tokenized source into drawable objects, handling text positioning and style mapping
2. `_draw_line_numbers()` (L580-589): Generates line number drawables if enabled
3. `format(tokensource, outfile)` (L608-639): Main entry point that orchestrates image creation and saves result

**Layout Calculations:** Helper methods (L452-519) for pixel positioning, coordinate mapping, and size determination

### Format-Specific Subclasses
- `GifImageFormatter` (L645-656): GIF-specific variant
- `JpgImageFormatter` (L659-670): JPEG-specific variant  
- `BmpImageFormatter` (L673-684): BMP-specific variant

## Dependencies
- `PIL` (Pillow): Required for image generation and text rendering
- `subprocess`: Used for fontconfig queries on Linux
- `winreg`: Windows registry access for font discovery
- Pygments core: `Formatter` base class and utility functions

## Architecture Notes
- Platform abstraction through conditional imports and method dispatch
- Graceful fallback font handling (uses normal font for missing bold/italic variants)
- Supports both system fonts and file-based fonts
- Memory-efficient drawable caching before final image rendering
- Compatible with both legacy PIL and modern Pillow APIs (getsize vs getbbox)