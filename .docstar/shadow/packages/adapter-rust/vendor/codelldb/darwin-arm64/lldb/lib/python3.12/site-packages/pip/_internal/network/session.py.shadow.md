# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_internal/network/session.py
@source-hash: 5e66a704a8d5c0f1
@generated: 2026-02-09T17:58:37Z

## Purpose
Core networking module for pip's HTTP session management, providing secure request handling, authentication, caching, and custom adapters for various URL schemes.

## Key Components

### Core Session Class
- `PipSession` (L320-522): Main HTTP session class extending `requests.Session`
  - Handles retries, caching, authentication, and trusted hosts
  - Configures adapters for different URL schemes (http, https, file)
  - Implements security checks for repository origins
  - Key methods:
    - `__init__` (L323-402): Sets up adapters, auth, retries, and trusted hosts
    - `add_trusted_host` (L410-442): Adds hosts that bypass HTTPS verification
    - `is_secure_origin` (L448-513): Validates if a URL origin is secure
    - `iter_secure_origins` (L443-446): Yields all secure origins including trusted ones

### HTTP Adapters
- `LocalFSAdapter` (L212-254): Handles `file://` URLs by serving local files
  - `send` (L213-250): Converts file paths to HTTP responses with proper headers
- `_SSLContextAdapterMixin` (L256-288): Mixin adding SSL context support to adapters
- `HTTPAdapter` (L290-291): Standard HTTPS adapter with SSL context support
- `CacheControlAdapter` (L294-295): Caching adapter with SSL context support
- `InsecureHTTPAdapter` (L298-307): HTTP adapter that disables SSL verification
- `InsecureCacheControlAdapter` (L309-318): Caching adapter that disables SSL verification

### Utility Functions
- `user_agent()` (L110-209): Generates detailed user agent string with system info
  - Cached with `@lru_cache` for performance
  - Includes Python version, OS, architecture, CI detection, Rust version
- `looks_like_ci()` (L100-107): Detects if running in CI environment

### Security Configuration
- `SECURE_ORIGINS` (L68-78): Hardcoded list of secure protocols/hosts
  - Includes HTTPS, localhost, loopback addresses, file URLs, SSH
- `CI_ENVIRONMENT_VARIABLES` (L88-97): Environment variables indicating CI execution

### Type Definitions
- `SecureOrigin` (L61): Type alias for secure origin tuples (protocol, host, port)

## Dependencies
- Extends `requests.Session` for HTTP functionality
- Uses `urllib3` for connection pooling and retries
- Integrates `CacheControl` for HTTP response caching
- Leverages pip's internal auth, cache, and utility modules

## Architecture Patterns
- Adapter pattern for different URL schemes and security levels
- Mixin pattern for SSL context injection
- Session-based configuration with customizable timeouts and proxies
- Security-first approach with explicit trusted host management

## Critical Invariants
- All HTTPS requests use certificate verification unless explicitly trusted
- File URLs only serve existing local files with proper MIME types
- Trusted hosts bypass SSL verification but are explicitly tracked
- User agent includes comprehensive system fingerprinting for debugging