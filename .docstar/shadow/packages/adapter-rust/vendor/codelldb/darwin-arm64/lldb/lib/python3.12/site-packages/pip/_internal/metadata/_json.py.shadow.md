# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_internal/metadata/_json.py
@source-hash: 3f470026b1ff9ad9
@generated: 2026-02-09T17:58:30Z

## Purpose
Converts Python package metadata from email.message.Message format to JSON-compatible dictionaries. Extracted from the pkg_metadata library for pip's internal metadata processing.

## Key Components

**METADATA_FIELDS (L7-34)**: Static list defining all standard Python package metadata fields with their multiple-use flags. Includes core fields like Name, Version, Author, as well as dependency specifications (Requires-Dist, Provides-Extra) and classifiers.

**json_name() (L37-38)**: Simple field name transformer that converts hyphenated metadata field names to underscore format for JSON compatibility (e.g., "Author-email" â†’ "author_email").

**msg_to_json() (L41-84)**: Primary conversion function that transforms email.message.Message objects into JSON dictionaries.

**sanitise_header() (L44-58)**: Nested function handling email header encoding issues. Attempts UTF-8 decoding for "unknown-8bit" encodings, falling back to latin1 to prevent decode failures.

## Processing Logic

1. **Field Processing (L61-78)**: Iterates through METADATA_FIELDS, extracting values from the Message object
   - Multi-use fields become lists via `msg.get_all()`
   - Single-use fields are scalar values
   - Special handling for "keywords" field (L71-77) supporting both comma and space separation

2. **Payload Handling (L80-82)**: Extracts message payload as description content

## Dependencies
- email.header: Header encoding/decoding utilities
- email.message: Message parsing
- typing: Type annotations

## Key Patterns
- Robust encoding handling with fallback strategies
- Flexible keyword parsing for backward compatibility
- Type-safe conversion with explicit casting
- Standardized field name normalization