# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/cachecontrol/serialize.py
@source-hash: 1d0776225950d391
@generated: 2026-02-09T17:58:45Z

## Primary Purpose
HTTP response serialization/deserialization for cachecontrol using MessagePack format. Enables persistent caching of HTTP responses with proper header validation and vary header handling.

## Key Components

### Serializer Class (L17-146)
Core serialization engine for HTTP cache entries with version 4 format support.

**Key Methods:**
- `dumps(request, response, body=None)` (L20-60): Serializes HTTPResponse and PreparedRequest into bytes
  - Reads response body if not provided (L30-36)
  - Constructs data dict with response metadata (L38-47)
  - Processes Vary headers for cache validation (L49-58)
  - Returns versioned binary format: `b"cc=4," + msgpack_data`

- `serialize(data)` (L62-63): MessagePack encoding wrapper with binary type support

- `loads(request, data, body_file=None)` (L65-81): Entry point for deserialization
  - Version checking with format prefix (L77-78)
  - Delegates to `_loads_v4()` for actual deserialization

- `prepare_response(request, cached, body_file=None)` (L83-133): Reconstructs HTTPResponse from cached data
  - Vary header validation against current request (L96-103)
  - Body handling with optional external body file (L105, L117-120)
  - Legacy Python 2/3 compatibility for string encoding (L121-128)
  - Removes deprecated `strict` parameter (L131)

- `_loads_v4(request, data, body_file=None)` (L135-146): MessagePack deserialization for v4 format

## Dependencies
- `msgpack`: Binary serialization format
- `urllib3.HTTPResponse`: HTTP response objects
- `requests.structures.CaseInsensitiveDict`: Header management
- `requests.PreparedRequest`: Request objects (TYPE_CHECKING)

## Architecture Patterns
- **Version Management**: Uses `serde_version = "4"` class attribute and format prefixes
- **Vary Header Processing**: Implements HTTP caching semantics for conditional responses
- **Body Separation**: Supports storing response bodies separately from metadata
- **Backward Compatibility**: Handles legacy format detection and Python 2/3 transitions

## Critical Invariants
- Serialized data always prefixed with version string (`cc=4,`)
- Vary header `*` means uncacheable response
- Response body can be stored inline or in separate file
- Headers converted to case-insensitive dict for processing