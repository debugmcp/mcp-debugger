# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/cachecontrol/caches/file_cache.py
@source-hash: f4096699325ce9cb
@generated: 2026-02-09T17:57:30Z

## Primary Purpose
File-based cache implementation for pip's HTTP response caching system. Provides secure, thread-safe file storage with two variants optimized for different memory usage patterns.

## Key Components

### Utility Functions
- `_secure_open_write()` (L21-59): Creates secure file handles with atomic write semantics, preventing race conditions and symlink attacks through O_CREAT|O_EXCL flags and O_NOFOLLOW
- `url_to_file_path()` (L176-181): Maps URLs to cache file paths using CacheController.cache_url()

### Core Classes

#### `_FileCacheMixin` (L62-142)
Base implementation providing shared functionality for both cache variants:
- `__init__()` (L65-92): Configures directory, permissions, and file locking with filelock dependency validation
- `encode()` (L94-96): SHA224 hash generation for cache keys
- `_fn()` (L98-103): Maps cache keys to filesystem paths using 5-char directory structure + full hash filename
- `get()` (L105-112): Retrieves cached data by key, returns None if not found
- `set()` (L114-118): Stores data using secure write operations
- `_write()` (L120-133): Thread-safe file writing with directory creation and file locking
- `_delete()` (L135-141): Conditional file deletion (respects forever flag)

#### `FileCache` (L144-151)
Traditional cache storing complete responses in memory:
- Inherits from `_FileCacheMixin` and `BaseCache`
- `delete()` (L150-151): Removes main cache file

#### `SeparateBodyFileCache` (L154-173)
Memory-efficient variant storing response bodies separately:
- Inherits from `_FileCacheMixin` and `SeparateBodyBaseCache`
- `get_body()` (L160-165): Returns file handle for body data (.body suffix)
- `set_body()` (L167-169): Stores body data in separate file
- `delete()` (L171-173): Removes both main cache file and body file

## Dependencies
- `hashlib`: SHA224 hashing for cache keys
- `os`, `pathlib`: File system operations
- `filelock` (optional): Thread-safe file locking
- `pip._vendor.cachecontrol.cache`: Base cache interfaces
- `pip._vendor.cachecontrol.controller`: URL-to-key mapping

## Architecture Patterns
- **Mixin Pattern**: `_FileCacheMixin` provides shared functionality
- **Secure File Operations**: Atomic writes with race condition prevention
- **Directory Sharding**: 5-character prefix directories prevent filesystem performance issues
- **Lock-based Concurrency**: File-level locking for thread safety
- **Optional Dependencies**: Graceful fallback with informative error messages

## Critical Invariants
- Cache file paths must not change (L99-100 comment references external dependency)
- File permissions: 0o0600 (files), 0o0700 (directories) by default
- Thread safety requires filelock dependency
- `forever` flag prevents deletion when enabled