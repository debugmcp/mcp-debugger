# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/urllib3/connectionpool.py
@source-hash: 05eeaaeb9491f656
@generated: 2026-02-09T17:59:25Z

## ConnectionPool - HTTP/HTTPS Connection Pool Management

**Primary Purpose**: Provides thread-safe HTTP/HTTPS connection pooling for urllib3, managing connection lifecycle, retries, redirects, and proxies.

### Core Classes

**ConnectionPool (L69-107)**
- Base abstract class for all connection pools
- Provides context manager support (`__enter__`/`__exit__`)
- Defines basic host/port validation and normalization
- Key attributes: `scheme`, `QueueCls = LifoQueue`

**HTTPConnectionPool (L113-911)**
- Main HTTP connection pool implementation extending ConnectionPool and RequestMethods
- Thread-safe connection management with configurable pooling behavior
- Key attributes:
  - `scheme = "http"`, `ConnectionCls = HTTPConnection`, `ResponseCls = HTTPResponse`
  - Connection pool (`self.pool`) using LIFO queue
  - Retry logic, timeout handling, proxy support
- Core methods:
  - `_new_conn()` (L241-260): Creates fresh HTTP connections
  - `_get_conn()` (L262-299): Retrieves connections from pool or creates new ones
  - `_put_conn()` (L301-330): Returns connections to pool
  - `_make_request()` (L379-496): Executes HTTP requests with timeout/error handling
  - `urlopen()` (L534-910): Main request method with retry/redirect logic
  - `is_same_host()` (L513-532): Validates URL belongs to same host

**HTTPSConnectionPool (L913-1081)**
- HTTPS-specific pool extending HTTPConnectionPool
- Additional SSL/TLS configuration and certificate handling
- Key attributes: `scheme = "https"`, `ConnectionCls = HTTPSConnection`
- SSL-specific methods:
  - `_prepare_conn()` (L979-997): Configures SSL certificates and validation
  - `_prepare_proxy()` (L999-1012): Sets up HTTPS proxy tunneling
  - `_validate_conn()` (L1050-1080): Validates SSL certificates with warnings

### Key Dependencies
- Connection classes from `.connection` module (HTTPConnection, HTTPSConnection, VerifiedHTTPSConnection)
- Exception hierarchy from `.exceptions` module
- Utility modules: timeout, retry, URL parsing, SSL handling
- Queue implementation (`LifoQueue` from `.util.queue`)

### Critical Functionality

**Connection Lifecycle**:
1. Connection acquisition via `_get_conn()` with pool timeout support
2. Connection validation and dropped connection detection
3. Request execution via `_make_request()` with comprehensive error handling
4. Connection return to pool via `_put_conn()` or disposal on errors

**Retry/Redirect Logic**:
- Configurable retry policies with exponential backoff
- Automatic redirect handling (301, 302, 303, 307, 308)
- Method transformation on 303 redirects (â†’ GET)
- Exception mapping and retry decision logic

**Error Handling**:
- Timeout detection and conversion (`_raise_timeout()` L354-377)
- SSL error detection and proxy misconfiguration hints
- Connection cleanup in finally blocks
- Comprehensive exception mapping to urllib3 exception types

### Utility Functions
- `connection_from_url()` (L1083-1108): Factory function for creating pools from URLs
- `_normalize_host()` (L1111-1126): IPv6 bracket handling for httplib compatibility
- `_close_pool_connections()` (L1129-1137): Pool cleanup helper

### Architecture Patterns
- Template method pattern (base class defines structure, subclasses specialize)
- Object pooling with LIFO queue for connection reuse
- Decorator pattern for SSL enhancement of HTTP connections
- Weak reference cleanup to prevent memory leaks (L239)