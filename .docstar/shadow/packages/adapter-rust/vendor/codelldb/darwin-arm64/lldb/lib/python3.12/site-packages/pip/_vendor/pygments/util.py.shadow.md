# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/pygments/util.py
@source-hash: 004558d2aa27cb21
@generated: 2026-02-09T17:59:01Z

## Primary Purpose
Core utility module for Pygments syntax highlighter providing general-purpose helper functions for option parsing, text analysis, format detection, encoding handling, and data formatting.

## Key Components

### Exception Classes
- **ClassNotFound** (L30-31): ValueError subclass for lookup function failures
- **OptionError** (L34-38): Exception for option processing validation errors

### Option Processing Functions
- **get_choice_opt** (L40-51): Validates option values against allowed choices with optional case normalization
- **get_bool_opt** (L54-82): Converts string/int options to boolean, supporting multiple string representations ('1'/'yes'/'true'/'on' for True, '0'/'no'/'false'/'off' for False)
- **get_int_opt** (L85-97): Converts option values to integers with proper error handling
- **get_list_opt** (L99-113): Converts string options to lists via whitespace splitting or validates existing sequences

### Text Analysis & Detection
- **make_analysator** (L128-142): Decorator that wraps text analysis functions to return normalized float values (0.0-1.0)
- **shebang_matches** (L145-187): Checks if shebang line matches regex pattern, handles Unix/Windows executables and ignores CLI flags
- **doctype_matches** (L190-200): Matches DOCTYPE declarations against regex patterns
- **html_doctype_matches** (L203-205): Specialized HTML DOCTYPE detection
- **looks_like_xml** (L211-224): XML detection via XML declarations, DOCTYPE, or tag patterns with caching

### String & Data Utilities  
- **docstring_headline** (L116-125): Extracts first paragraph from docstrings
- **surrogatepair** (L227-233): Converts Unicode codepoints >16 bits to UTF-16 surrogate pairs
- **format_lines** (L236-252): Formats string sequences for code output with proper indentation
- **duplicates_removed** (L255-268): Removes duplicates from iterables while preserving order

### Encoding Utilities
- **guess_decode** (L281-299): Multi-stage text decoding (UTF-8 → locale → latin-1 fallback)
- **guess_decode_from_terminal** (L302-316): Terminal-specific decoding with encoding precedence
- **terminal_encoding** (L319-324): Determines terminal encoding preference
- **UnclosingTextIOWrapper** (L327-330): TextIOWrapper that doesn't close underlying buffer

### Regex Patterns
- **split_path_re** (L15): Path/space splitting pattern
- **doctype_lookup_re** (L16-24): DOCTYPE declaration matcher with verbose syntax
- **tag_re** (L25-26): XML/HTML tag pattern matcher  
- **xml_decl_re** (L27): XML declaration pattern

### Support Classes
- **Future** (L271-278): Abstract deferred computation class for lazy evaluation (used by RegexLexerMeta)

### Global Cache
- **_looks_like_xml_cache** (L208): Hash-based cache for XML detection results

## Key Dependencies
- `re`: Regular expression operations
- `io.TextIOWrapper`: Text stream wrapping
- `locale`: System locale detection (imported dynamically)

## Architectural Patterns
- Defensive programming with comprehensive exception handling
- Multi-stage fallback strategies for encoding detection
- Caching for expensive XML detection operations
- Factory pattern via make_analysator decorator
- Static analysis approach for text format detection