# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_internal/distributions/sdist.py
@source-hash: 3e570fe1aebe47a7
@generated: 2026-02-09T17:58:36Z

## Source Distribution Management for Python Package Installation

**Primary Responsibility:** Handles source distributions (sdist) in pip's installation pipeline, specifically managing metadata preparation and build environment isolation for packages that require compilation or complex setup procedures.

### Core Architecture

**SourceDistribution Class (L16-158):** Extends `AbstractDistribution` to implement source-specific installation logic. Manages the complex process of preparing source distributions for installation, including PEP 517/518 build backend handling and dependency resolution.

### Key Methods and Their Roles

**build_tracker_id Property (L23-27):** Returns unique identifier for build tracking using the requirement's link URL without fragment. Critical for preventing concurrent builds of the same package.

**get_metadata_distribution (L29-30):** Simple accessor returning the requirement's distribution metadata.

**prepare_distribution_metadata (L32-69):** Core orchestration method that:
- Loads `pyproject.toml` to determine PEP 517 usage (L39)
- Sets up build isolation if required (L42-56)  
- Validates editable installation requirements (L54)
- Installs dynamic build requirements (L56)
- Performs build dependency validation (L58-68)

**Build Environment Management:**
- `_prepare_build_backend (L71-95)`: Creates isolated BuildEnvironment and installs static build dependencies
- `_get_build_requires_wheel (L97-103)`: Retrieves dynamic wheel build requirements via PEP 517 backend
- `_get_build_requires_editable (L105-113)`: Retrieves dynamic editable build requirements  
- `_install_build_reqs (L115-132)`: Installs backend-requested build dependencies, choosing between wheel/editable modes

**Error Handling:**
- `_raise_conflicts (L134-149)`: Formats and raises InstallationError for conflicting build dependencies
- `_raise_missing_reqs (L151-158)`: Formats and raises InstallationError for missing build requirements

### Critical Dependencies

- **BuildEnvironment (L4):** Provides isolated Python environment for build operations
- **PackageFinder (L11):** Locates and retrieves packages during build dependency resolution
- **PEP 517 Backend Integration:** Interfaces with build backends through `self.req.pep517_backend`
- **subprocess runner (L8):** Executes build backend operations with progress indication

### Architecture Patterns

**Two-Phase Build Dependency Installation:** Static requirements (from pyproject.toml) installed first, then dynamic requirements (from backend queries) installed second. This ordering is essential because the backend must be available before it can be queried for additional requirements.

**Conditional Build Isolation:** Build isolation only occurs when both PEP 517 is used AND `build_isolation=True`. Legacy setup.py installations bypass isolation.

**Editable Installation Logic:** Special handling for editable installs, checking PEP 660 support and falling back to wheel builds when editable builds aren't supported.

### Critical Invariants

- `pyproject_requires` must not be None when PEP 517 is used (assertions L61, L75)
- PEP 517 backend must be available when calling build requirement methods (assertions L101, L111)
- Build environment context must be active when querying backends (L98, L106)