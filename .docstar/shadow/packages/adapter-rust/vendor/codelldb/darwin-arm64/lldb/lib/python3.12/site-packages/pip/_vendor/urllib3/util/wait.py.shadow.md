# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/urllib3/util/wait.py
@source-hash: 7ce5f4fdf6a8cc6d
@generated: 2026-02-09T17:57:29Z

**Purpose**: Platform-agnostic socket waiting utilities for urllib3, providing non-blocking I/O readiness detection with automatic fallback between polling mechanisms.

**Core Architecture**: Implements a lazy-loading strategy that defers platform-specific implementation selection until first use to handle runtime monkeypatchings.

**Key Components**:

- `NoWayToWaitForSocketError` (L14-15): Exception for platforms without socket waiting capabilities
- `_retry_on_intr` (L42-67): Python version-aware EINTR retry wrapper, with full implementation for Python <3.5 and no-op for â‰¥3.5
- `select_wait_for_socket` (L70-86): Windows-optimized implementation using select.select, handles Windows' exceptional socket signaling for non-blocking connects
- `poll_wait_for_socket` (L89-106): Unix-optimized implementation using select.poll, converts timeout to milliseconds
- `null_wait_for_socket` (L109-110): Fallback that raises exception for unsupported platforms (e.g., AppEngine)
- `_have_working_poll` (L113-123): Runtime detection of functional poll() availability, guards against broken monkeypatching
- `wait_for_socket` (L126-138): Self-modifying dispatcher that replaces itself on first call with optimal implementation
- `wait_for_read`/`wait_for_write` (L141-152): Convenience wrappers for common use cases

**Implementation Selection Logic**:
1. Prefer `poll()` on Unix systems for better high-FD performance
2. Fallback to `select()` on Windows or when poll() unavailable/broken  
3. Use null implementation on platforms like AppEngine without socket support

**Dependencies**: 
- `select` module for I/O multiplexing primitives
- `time.monotonic` with fallback to `time.time` for timeout calculations
- `errno` for EINTR signal handling

**Critical Patterns**:
- Global function replacement pattern for lazy platform detection
- Timeout deadline calculation with monotonic time to handle system clock changes
- Exception socket signaling handling for Windows compatibility (L79-83)
- Millisecond timeout conversion for poll() API compliance (L101-104)