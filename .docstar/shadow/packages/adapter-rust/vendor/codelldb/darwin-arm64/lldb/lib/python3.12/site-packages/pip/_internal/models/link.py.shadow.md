# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_internal/models/link.py
@source-hash: 8c76b1f4efbdce54
@generated: 2026-02-09T17:58:44Z

## Primary Purpose
Models for representing and parsing package distribution links in pip's internal system. Handles URL parsing, hash validation, metadata extraction, and link equivalence checking for PyPI and repository indexes.

## Key Classes

### LinkHash (L43-95)
Frozen dataclass for parsing and validating embedded hash values in URLs. Supports sha512, sha384, sha256, sha224, sha1, md5 algorithms (precedence order in `_SUPPORTED_HASHES` L40).

Key methods:
- `find_hash_url_fragment()` (L72-79): Cached classmethod to extract hash from URL fragment using regex
- `as_hashes()` (L84-86): Converts to Hashes instance for validation
- `is_hash_allowed()` (L88-94): Validates hash against allowed hashes schema

### MetadataFile (L97-106)  
Frozen dataclass containing hash information for core metadata files associated with distributions. Validates all hash names against `_SUPPORTED_HASHES` in `__post_init__`.

### Link (L181-527)
Main class representing parsed package index links with comprehensive metadata and validation.

**Initialization** (L197-259):
- Handles UNC Windows paths by converting to file:// URLs
- Extracts hashes from URL fragments and merges with provided hashes
- Stores parsed URL components and metadata

**Factory Methods**:
- `from_json()` (L261-309): Creates Link from PyPI JSON API response, handles PEP 714 metadata fields
- `from_element()` (L312-361): Creates Link from HTML anchor attributes in simple repository pages

**Core Properties**:
- `url`, `filename`, `scheme`, `netloc`, `path` (L389-424): URL component accessors
- `is_wheel`, `is_vcs`, `is_file`, `is_yanked` (L504-515): Type detection
- `hash`, `hash_name`, `has_hash` (L485-519): Hash access and validation

**Key Methods**:
- `metadata_link()` (L472-479): Creates link to associated `.metadata` file
- `is_hash_allowed()` (L521-527): Validates link hashes against schema
- `_egg_fragment()` (L445-461): Extracts and validates PEP 508 project names from egg fragments

### _CleanResult (L530-560)
NamedTuple for link normalization in equivalence checking. Strips auth info, normalizes query parameters, preserves only subdirectory and hash fragments.

## Key Functions

### URL Processing
- `_ensure_quoted_url()` (L166-178): Ensures proper URL encoding without double-quoting
- `_clean_url_path()` (L144-163): Handles VCS revision strings and reserved characters
- `supported_hashes()` (L108-116): Filters hash mapping to supported algorithms only

### Link Equivalence  
- `_clean_link()` (L562-585): Normalizes links for comparison by removing auth, normalizing query params, filtering fragments
- `links_equivalent()` (L588-589): Cached function determining if two links point to equivalent resources

## Dependencies
- `pip._internal.utils.hashes.Hashes`: Hash validation system
- `pip._internal.utils.filetypes.WHEEL_EXTENSION`: Wheel file detection  
- `pip._internal.vcs`: VCS scheme detection
- `pip._internal.index.collector.IndexContent`: Type hint for link sources

## Architecture Patterns
- Extensive use of `@functools.lru_cache` for performance on URL parsing operations
- Frozen dataclasses for immutable hash and metadata representations
- Factory pattern for Link creation from different sources (JSON, HTML)
- Property-based interface for URL component access
- Total ordering support for Link sorting

## Critical Invariants
- Hash algorithms must be in `_SUPPORTED_HASHES` constant (enforced in assertions)
- URLs are normalized and properly quoted to prevent parsing inconsistencies
- Link equivalence ignores auth credentials and non-semantic URL differences
- Metadata file links append `.metadata` suffix to base URL without fragment