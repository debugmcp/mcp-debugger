# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_internal/metadata/importlib/_compat.py
@source-hash: 1807bfa6b21f084e
@generated: 2026-02-09T17:57:17Z

## Purpose and Responsibility
Compatibility layer for pip's internal metadata handling with `importlib.metadata`. Provides error handling for bad distribution metadata and utilities for accessing private attributes that are not exposed in the public API.

## Key Components

### BadMetadata Exception (L5-11)
- Custom ValueError subclass for handling malformed distribution metadata
- Stores the problematic distribution and reason for failure
- Provides formatted error messages indicating which distribution has bad metadata

### BasePath Protocol (L14-32)
- Type protocol defining common interface for path-like objects
- Abstracts over both `pathlib.Path` and `zipfile.Path` used by importlib.metadata
- Contains minimal interface (`name` and `parent` properties) needed by pip
- Exists to avoid Union type complexity with zipfile.Path compatibility

### Utility Functions

#### get_info_location (L34-43)
- Extracts metadata directory path from distribution using private `_path` attribute
- Returns Optional[BasePath] since not all distributions exist on disk
- Acknowledged hack due to relying on private importlib.metadata internals
- Avoids major refactoring of pip's legacy codebase

#### get_dist_name (L46-55)
- Safely extracts project name from distribution metadata
- Uses type casting to access `name` attribute (available Python 3.10+)
- Validates name is string type, raises BadMetadata if invalid
- Handles Mypy type checking limitations for newer Python features

## Dependencies
- `importlib.metadata`: Core metadata handling
- `typing`: Type hints and protocols
- Uses private `_path` attribute from importlib.metadata.Distribution

## Architectural Notes
- Compatibility shim between pip's internal needs and importlib.metadata's public API
- Intentionally accesses private attributes as documented technical debt
- Protocol-based design for path abstraction across different implementations