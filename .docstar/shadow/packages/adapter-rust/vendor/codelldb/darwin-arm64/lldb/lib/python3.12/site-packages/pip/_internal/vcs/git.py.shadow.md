# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_internal/vcs/git.py
@source-hash: deda5cf4b400fc9e
@generated: 2026-02-09T17:58:52Z

## Primary Purpose
Git version control adapter implementation for pip's internal VCS abstraction layer. Provides comprehensive Git repository management including cloning, updating, revision resolution, and URL handling for pip package installations.

## Key Classes and Functions

### Git Class (L60-525)
Main Git VCS adapter inheriting from `VersionControl`. Defines Git-specific operations with:
- **Class attributes**: `name="git"`, `dirname=".git"`, supported schemes (L64-70)
- **Environment isolation**: Unsets `GIT_DIR` and `GIT_WORK_TREE` to prevent interference (L73)

### Core Repository Operations
- **`fetch_new()`** (L262-323): Clones repositories with partial clone optimization for Git 2.17+, handles revision checkout and submodule updates
- **`update()`** (L335-347): Updates existing repositories via fetch + hard reset, includes tag fetching for Git 1.9+
- **`switch()`** (L325-333): Changes remote URL and checks out specified revision

### Revision Management
- **`resolve_revision()`** (L202-245): Resolves revision names to SHA1 commits, handles branches/tags/refs with remote fetching
- **`get_revision_sha()`** (L133-176): Returns commit SHA and branch status for given revision using `git show-ref`
- **`is_commit_id_equal()`** (L248-260): Compares current commit with target revision
- **`get_current_branch()`** (L108-130): Extracts current branch name from symbolic-ref

### Version and Validation
- **`get_git_version()`** (L94-105): Parses Git version using regex `GIT_VERSION_REGEX` (L30-36)
- **`looks_like_hash()`** (L56-57): Validates 40-character hex SHA1 format using `HASH_REGEX` (L38)
- **`has_commit()`** (L411-424): Checks local commit availability via `rev-parse`

### URL Processing
- **`_git_remote_to_pip_url()`** (L380-408): Converts Git remote URLs to pip-compatible format:
  - Handles fully qualified URLs (ssh://), local paths, and SCP shorthand
  - Uses `SCP_REGEX` (L41-53) for git@host:path format detection
- **`get_url_rev_and_auth()`** (L457-485): Processes URLs with SSH stub handling and file:// path normalization

### Repository Introspection
- **`get_remote_url()`** (L350-377): Extracts remote URL from Git config, prefers origin remote
- **`get_subdirectory()`** (L439-454): Finds Python project root relative to repository root
- **`get_repository_root()`** (L497-519): Determines Git repository root via `--show-toplevel`

## Important Dependencies
- Inherits from `pip._internal.vcs.versioncontrol.VersionControl`
- Uses `pip._internal.utils.subprocess.make_command` for Git command construction
- Leverages `RevOptions`, `AuthInfo` for revision and authentication handling
- Imports `urllib.parse` components for URL manipulation

## Critical Patterns
- **Immutable revision detection**: `is_immutable_rev_checkout()` (L80-92) prevents caching when revisions could change
- **Smart fetching**: `_should_fetch()` (L179-199) optimizes remote operations by checking local availability
- **Submodule support**: Automatic submodule initialization in all repository operations
- **Error handling**: Graceful degradation with return code checking and exception catching

## Key Invariants
- Git commands executed with environment variable isolation
- Partial clone used for Git 2.17+ to improve performance
- Branch tracking setup for specific branch checkouts
- URL normalization ensures consistent pip-compatible formats