# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/pygments/scanner.py
@source-hash: 6ff9eee7f7f71c28
@generated: 2026-02-09T17:58:56Z

## Purpose
Text scanning utility for context-sensitive lexical analysis in Pygments. Provides regex-based pattern matching with position tracking for languages that require stateful parsing (e.g., Pascal/Delphi where keywords depend on context).

## Core Components

### EndOfText Exception (L20-25)
- **Purpose**: Signals attempt to match beyond text boundaries
- **Usage**: Raised by Scanner methods when pos >= data_length
- **Inheritance**: RuntimeError subclass

### Scanner Class (L27-104)
- **Purpose**: Stateful regex scanner with position tracking and pattern caching
- **Architecture**: Maintains current position, match history, and compiled regex cache

#### Key State Variables
- `data` (L40): Input text string
- `pos` (L43): Current scanning position
- `start_pos` (L42): Position before last successful match
- `match` (L46): Last matched text content
- `last` (L45): Previous match value
- `_re_cache` (L47): Compiled regex pattern cache for performance

#### Core Methods

**__init__(text, flags=0) (L35-47)**
- Initializes scanner with text and optional regex flags
- Sets up position tracking and empty cache

**eos Property (L49-52)**
- Returns boolean indicating if scanner reached end of text
- Critical for preventing out-of-bounds access

**check(pattern) (L54-64)**
- **Purpose**: Lookahead matching without advancing position
- **Behavior**: Compiles and caches regex patterns, returns match object or None
- **Exception**: Raises EndOfText if at end of input

**test(pattern) (L66-70)**
- **Purpose**: Boolean lookahead check
- **Implementation**: Wrapper around check() returning match success

**scan(pattern) (L72-93)**
- **Purpose**: Primary scanning method with state updates
- **Behavior**: 
  - Advances position on successful match
  - Updates start_pos, pos, match, and last fields
  - Returns boolean success indicator
- **State Management**: Preserves previous match in last field

**get_char() (L95-97)**
- **Purpose**: Convenience method for single character consumption
- **Implementation**: Uses scan('.') pattern

## Dependencies
- `re` module for regex compilation and matching

## Key Patterns
- **Pattern Caching**: Compiled regexes stored in _re_cache to avoid recompilation
- **State Preservation**: last field maintains previous match for backtracking scenarios  
- **Position Tracking**: Separate start_pos and pos enable range-based operations
- **Lookahead Support**: check() and test() methods enable context-sensitive parsing

## Constraints
- Text must be provided at initialization (immutable after creation)
- Patterns must be valid regex strings
- Position tracking assumes sequential forward scanning
- EndOfText exceptions must be handled by calling code