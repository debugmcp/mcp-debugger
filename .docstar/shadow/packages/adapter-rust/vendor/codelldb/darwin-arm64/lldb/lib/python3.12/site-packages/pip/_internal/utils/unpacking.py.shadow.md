# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_internal/utils/unpacking.py
@source-hash: 7b20e44ac9389d6f
@generated: 2026-02-09T17:58:45Z

## Primary Purpose
Archive extraction utilities for pip's package installation system. Handles unpacking of ZIP and TAR archives with security protections and proper permission handling.

## Key Components

### Constants & Configuration (L26-42)
- **SUPPORTED_EXTENSIONS**: Dynamically built list of supported archive formats based on available compression modules
- Conditional imports for `bz2` and `lzma` modules with graceful fallback when unavailable

### Security & Path Utilities
- **is_within_directory()** (L78-86): Path traversal protection - validates extracted files stay within target directory
- **split_leading_dir()** (L51-60): Cross-platform path splitting that handles both forward and backslashes
- **has_leading_dir()** (L63-75): Detects if archive contents share common root directory

### Permission Management
- **current_umask()** (L44-48): Gets system umask by temporarily setting it to 0
- **_get_default_mode_plus_executable()** (L89-90): Calculates default file mode with execute permissions
- **set_extracted_file_to_default_mode_plus_executable()** (L93-98): Applies execute permissions to extracted files
- **zip_item_is_executable()** (L101-105): Determines if ZIP entry has execute permissions

### Archive Extraction Functions
- **unzip_file()** (L108-151): ZIP extraction with optional flattening, path traversal protection, and permission preservation
- **untar_file()** (L154-248): TAR extraction with compression detection and modern tarfile filtering (PEP 706)
- **_untar_without_filter()** (L251-306): Fallback TAR extraction for older Python versions without data_filter
- **unpack_file()** (L309-337): Main entry point that auto-detects archive format and delegates to appropriate extractor

### Key Features
- **Security**: Path traversal protection in both ZIP and TAR extraction
- **Compatibility**: Handles Python versions with and without tarfile.data_filter (PEP 706)
- **Cross-platform**: Proper handling of file permissions on Unix/Windows
- **Robustness**: Graceful error handling for corrupt archives
- **Format Detection**: Auto-detection via file extensions, magic bytes, and content-type headers

### Dependencies
- Standard library: `tarfile`, `zipfile`, `os`, `shutil`, `stat`
- Internal: `InstallationError`, file type constants, `ensure_dir()` utility

## Architecture Notes
The module follows a layered approach: low-level utilities → format-specific extractors → high-level unified interface. Security is embedded throughout with consistent path validation and permission handling.