# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/rich/_windows.py
@source-hash: 681c1a0ff4b9e926
@generated: 2026-02-09T17:59:00Z

## Purpose
Windows console capability detection module for the Rich library. Detects VT100 escape sequence support and truecolor capability on Windows terminals through Win32 API calls, with graceful fallback for non-Windows platforms.

## Key Components

### WindowsConsoleFeatures (L6-13)
Dataclass representing Windows console capabilities:
- `vt: bool` - VT100/ANSI escape sequence support flag
- `truecolor: bool` - 24-bit color support flag

### get_windows_console_features() (L34-36, L40-61)
Core function with two implementations based on platform availability:

**Fallback implementation (L34-36):** Returns default WindowsConsoleFeatures with all features disabled when Windows APIs are unavailable.

**Windows implementation (L40-61):** 
- Gets stdout handle via GetStdHandle()
- Queries console mode using GetConsoleMode()
- Checks ENABLE_VIRTUAL_TERMINAL_PROCESSING flag for VT support
- Determines truecolor support based on Windows version (â‰¥10.0.15063)
- Returns populated WindowsConsoleFeatures instance

### Platform Detection Logic (L15-23)
Conditional Windows DLL loading:
- Only loads `ctypes.WinDLL` on `win32` platform
- Raises ImportError on non-Windows systems to trigger fallback

### Dependencies
- `pip._vendor.rich._win32_console` - Win32 API wrappers (L25-30)
- Standard library: `sys`, `dataclasses`, `ctypes`

## Architectural Patterns
- **Graceful degradation**: Try/except block (L15-32) ensures non-Windows platforms get working fallback
- **Feature detection**: Runtime capability probing rather than hardcoded assumptions
- **Version-aware logic**: Truecolor support tied to specific Windows 10 build number

## Entry Point (L64-71)
Debug script that prints platform info and detected console features when run directly.