# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/rich/traceback.py
@source-hash: 094a7160b8d05886
@generated: 2026-02-09T17:59:30Z

**Rich Traceback Module**

Primary purpose: Provides enhanced traceback rendering with syntax highlighting, local variable display, and rich formatting for Python exceptions through the Rich console library.

## Core Components

**install() (L48-172)**: Entry point function that installs a rich traceback handler globally. Replaces sys.excepthook with enhanced traceback rendering. Includes special handling for IPython/Jupyter environments (L122-161) with custom exception hooks that integrate with IPython's traceback system. Returns the previous exception handler.

**Data Classes (L175-205)**:
- `Frame` (L176-181): Represents a single stack frame with filename, line number, function name, source line, and optional local variables
- `_SyntaxError` (L185-190): Specialized container for syntax error information including offset, filename, line content, line number, and error message
- `Stack` (L194-199): Collection of frames with exception type/value and optional syntax error info
- `Trace` (L203-204): Top-level container holding multiple stacks for chained exceptions

**PathHighlighter (L207-208)**: Regex-based highlighter for file paths, emphasizing filenames while dimming directory paths.

**Traceback Class (L211-719)**: Main rendering engine with several key methods:

- `__init__` (L241-290): Constructor accepting trace data and formatting options. Handles suppress list conversion from modules/paths to normalized absolute paths (L279-289). Enforces minimum of 4 frames when max_frames is set.

- `from_exception()` (L292-360): Class method factory creating Traceback instances from exception info. Extracts trace data and constructs instance with formatting parameters.

- `extract()` (L362-485): Core trace extraction logic that walks exception chains (__cause__ and __context__). Processes each stack frame, handles syntax errors specially (L411-418), and respects frame filtering via `_rich_traceback_omit` and `_rich_traceback_guard` locals (L442, L461). Uses walk_tb() to iterate frames and safely converts objects to strings.

- `__rich_console__()` (L487-563): Main rendering method yielding Console renderables. Creates custom theme mapping Pygments tokens to Rich styles (L494-514). Renders each stack with frames in panels, handles syntax errors with special formatting, and shows exception chain messages.

- `_render_syntax_error()` (L565-586): Specialized renderer for syntax errors, highlighting the error location with underline and caret pointer.

- `_guess_lexer()` (L588-602): Determines appropriate Pygments lexer based on file extension or hashbang detection. Falls back to 'text' if detection fails.

- `_render_stack()` (L604-718): Renders individual stack frames with source code syntax highlighting, local variables display, and frame suppression. Handles frame limiting with "... N frames hidden ..." message (L631-650). Uses Syntax class for code highlighting with configurable line ranges.

## Key Features

- **Exception Chain Support**: Handles __cause__ and __context__ exception chaining
- **IPython Integration**: Special handling for Jupyter notebook environments  
- **Frame Suppression**: Can exclude frames from specific modules/paths
- **Local Variables**: Optional display with length/string truncation controls
- **Syntax Highlighting**: Pygments-based code highlighting with theme support
- **Frame Limiting**: Configurable maximum frames with middle frame elision

## Dependencies

Heavy reliance on Rich ecosystem (Console, Syntax, Panel, Text, Theme) and Pygments for syntax highlighting. Uses standard library traceback.walk_tb() for frame iteration and linecache for source code retrieval.

## Constants

- `LOCALS_MAX_LENGTH = 10` (L44): Default container abbreviation threshold
- `LOCALS_MAX_STRING = 80` (L45): Default string truncation length  
- `LEXERS` dict (L233-239): File extension to lexer name mapping