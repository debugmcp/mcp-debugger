# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_internal/utils/compat.py
@source-hash: 724905bde0626108
@generated: 2026-02-09T17:58:36Z

## Primary Purpose
Compatibility utilities for pip that handle platform and Python version differences, providing cross-platform abstractions for file operations, TLS detection, resource access, and platform detection.

## Key Functions and Components

### `has_tls()` (L16-26)
Detects TLS/SSL support availability by attempting to import `_ssl` module, falling back to checking `IS_PYOPENSSL` from urllib3 if native SSL is unavailable.

### `get_path_uid(path: str)` (L29-53) 
Returns file owner's UID while preventing symlink traversal attacks. Uses `os.O_NOFOLLOW` on supported platforms, falls back to manual symlink checking on AIX/Jython. Raises `OSError` for symlinks to maintain security.

### `open_text_resource()` (L58-67)
Version-adaptive text resource opener. Uses deprecated `importlib.resources.open_text` for Python <3.11, implements modern `importlib.resources.files()` approach for Python â‰¥3.11.

### `stdlib_pkgs` (L75)
Hard-coded set of standard library package names (`{"python", "wsgiref", "argparse"}`) that should not be considered "installed" packages despite having metadata.

### `WINDOWS` (L79)
Cross-implementation Windows detection boolean, covering CPython (`sys.platform.startswith("win")`) and IronPython (`sys.platform == "cli" and os.name == "nt"`).

## Dependencies
- `importlib.resources` - Resource access
- `logging` - Error reporting  
- `os`, `sys` - Platform operations
- `pip._vendor.urllib3.util.IS_PYOPENSSL` - TLS fallback detection

## Architectural Patterns
- **Version branching**: Conditional logic based on `sys.version_info` to handle API changes
- **Platform abstraction**: Unified interfaces hiding OS-specific implementations
- **Graceful degradation**: Fallback mechanisms when preferred APIs unavailable
- **Security-first design**: Explicit symlink prevention in `get_path_uid()`

## Critical Invariants
- `get_path_uid()` never follows symlinks (security requirement)
- TLS detection prioritizes native `_ssl` over PyOpenSSL
- Resource opening maintains encoding/error handling compatibility across Python versions