# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/urllib3/packages/backports/makefile.py
@source-hash: 9dbcedde2d1a80f5
@generated: 2026-02-09T17:56:52Z

## Purpose
Provides a backport of Python 3.5's `socket.makefile()` method for creating file-like objects from socket objects, enabling compatibility with older Python versions or custom socket implementations.

## Key Components

### `backport_makefile()` (L13-51)
Core function that recreates the Python 3.5 socket makefile behavior. Takes a socket-like object (`self`) and file parameters to create appropriate IO wrappers.

**Parameters:**
- `mode`: File mode string (r/w/b combinations only)
- `buffering`: Buffer size (-1 for default, 0 for unbuffered, >0 for specific size)
- `encoding`, `errors`, `newline`: Text mode parameters

**Logic Flow:**
- Mode validation (L19-20): Ensures only 'r', 'w', 'b' characters
- Mode parsing (L21-24): Determines reading/writing/binary flags
- Raw socket creation (L30): Creates `SocketIO` wrapper with appropriate rawmode
- Reference counting (L31): Increments `_makefile_refs` on socket object
- Buffer handling (L32-39): Sets up buffering, validates binary requirement for unbuffered streams
- IO layer selection (L40-46): Creates appropriate buffered wrapper based on read/write needs
- Text wrapper (L47-51): Adds text encoding layer for non-binary modes

## Dependencies
- `io` module: For buffer and text wrapper classes (`BufferedReader`, `BufferedWriter`, `BufferedRWPair`, `TextIOWrapper`)
- `socket.SocketIO`: Low-level socket IO wrapper

## Architecture Notes
- Follows Python 3.5+ socket makefile API exactly
- Layered IO approach: SocketIO → Buffered wrapper → Optional text wrapper
- Maintains socket reference counting for proper cleanup
- Supports all standard file modes with proper validation