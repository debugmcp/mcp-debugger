# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/packaging/metadata.py
@source-hash: 28836e4a4275daef
@generated: 2026-02-09T17:59:03Z

## Python Package Metadata Parser

**Primary Purpose**: Parses and validates Python package metadata from email-header format (RFC 5322), primarily used for reading METADATA files in Python packages. Provides both raw parsing and validated object representations.

### Key Components

**RawMetadata TypedDict (L64-130)**
- Comprehensive mapping of all core metadata fields across metadata versions 1.0-2.3
- Fields organized by metadata version with comments indicating PEP origins
- Keys use snake_case (underscores) vs hyphenated names in actual metadata files
- Supports string, list, and dict field types based on metadata specification

**Exception Handling**
- `ExceptionGroup` compatibility shim (L24-46) for Python <3.11
- `InvalidMetadata` exception (L49-57) with field context for validation errors

**Core Parsing Functions**
- `parse_email()` (L276-449): Main parser converting email headers to RawMetadata
  - Handles encoding issues, mojibake, and header decoding
  - Returns tuple of (parsed_data, unparsed_data)
  - Uses email module with compat32 policy for RFC compliance
- `_parse_keywords()` (L169-171): Splits comma-separated keyword strings
- `_parse_project_urls()` (L174-211): Converts label,URL pairs to dict mapping
- `_get_payload()` (L214-228): Extracts message body with encoding handling

**Field Mappings**
- `_EMAIL_TO_RAW_MAPPING` (L243-272): Maps hyphenated email headers to snake_case keys
- `_STRING_FIELDS`, `_LIST_FIELDS`, `_DICT_FIELDS` (L132-166): Field type classification

**Validation System**
- `_Validator` descriptor class (L462-635): Generic field validator with caching
  - `__get__` method implements lazy validation and caching
  - Processor methods (`_process_*`) for each field type
  - Version-aware validation (fields introduced in specific metadata versions)
- Key validators:
  - `_process_name()` (L529-540): Canonicalizes package names
  - `_process_version()` (L542-550): Parses version strings
  - `_process_requires_dist()` (L623-634): Parses requirement specifications
  - `_process_description_content_type()` (L558-588): Validates content types

**Metadata Class (L637-803)**
- High-level validated metadata representation
- `from_raw()` (L649-703): Creates instance from RawMetadata with validation
- `from_email()` (L706-731): Parses directly from email format
- Comprehensive field definitions (L733-803) with validation descriptors
- Supports metadata versions 1.0-2.3 with version-specific field availability

### Architecture Patterns

- **Descriptor Pattern**: `_Validator` uses descriptor protocol for lazy validation and caching
- **Two-Phase Parsing**: Raw parsing followed by optional validation phase
- **Error Aggregation**: Uses ExceptionGroup to collect and report multiple validation errors
- **Type Safety**: Extensive use of TypedDict and generics for type checking

### Critical Constraints

- Metadata version compatibility enforced during validation
- Required fields: metadata_version, name, version (L459)
- UTF-8 encoding required for description content types
- Field names are case-insensitive during parsing but normalized to lowercase
- Project URL labels must be unique within a package

### Dependencies

- `requirements`, `specifiers`, `utils` from same package for validation
- `version` module for version parsing
- Standard library `email` module for RFC 5322 parsing