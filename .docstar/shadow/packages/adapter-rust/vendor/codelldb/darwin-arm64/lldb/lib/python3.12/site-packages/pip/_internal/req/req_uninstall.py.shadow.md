# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_internal/req/req_uninstall.py
@source-hash: ab30c8c49a3e3844
@generated: 2026-02-09T17:58:46Z

## Package Uninstallation Management

This module handles the uninstallation of Python packages by tracking files, managing removals, and providing rollback capabilities for pip operations.

### Core Classes

**UninstallPathSet (L295-576)**: Primary class for managing package uninstallation. Tracks all files to be removed, handles permissions, and orchestrates the removal process. Key methods:
- `add()` (L321-338): Adds file paths to removal set, handles symlinks and pycache
- `remove()` (L349-377): Executes removal with user confirmation
- `from_dist()` (L423-575): Factory method that analyzes distribution type and builds appropriate path set
- `rollback()` (L406-417): Reverts uninstallation by restoring moved files

**StashedUninstallPathSet (L190-293)**: Manages temporary file stashing during uninstallation for rollback capability. Creates temporary directories and tracks file moves:
- `stash()` (L243-262): Moves files to temporary locations
- `commit()` (L264-269): Permanently removes stashed files
- `rollback()` (L271-288): Restores files from stash

**UninstallPthEntries (L578-633)**: Handles removal of entries from .pth files (Python path files):
- `remove()` (L599-624): Removes entries from .pth file while preserving format
- `rollback()` (L626-633): Restores original .pth file content

### Utility Functions

**uninstallation_paths() (L54-86)**: Generator that yields all files to uninstall based on RECORD metadata, including Python bytecode files (.pyc/.pyo).

**_script_names() (L21-37)**: Generates script file names for console/GUI scripts, handling Windows-specific extensions (.exe, .manifest, .py/.pyw).

**compact() (L88-104)**: Path compression algorithm that removes redundant paths (e.g., if both `/path` and `/path/file` exist, keeps only `/path`).

**compress_for_rename() (L107-138)**: Advanced path compression for file operations, using wildcards when entire directories are being removed.

**compress_for_output_listing() (L141-187)**: Creates user-friendly display of what will be removed vs skipped, marking package directories with `*`.

### Installation Type Detection

The module handles multiple Python package installation formats:
- Modern .dist-info installations (L516-518)
- Legacy .egg-info flat installations (L462-500) 
- Easy-install egg installations (L504-514)
- Editable/development installations (L520-538)
- Distutils installations (L501-502)

### Key Dependencies

- **pip._internal.metadata.BaseDistribution**: Core distribution interface
- **pip._internal.utils.temp_dir**: Temporary directory management
- **pip._internal.exceptions**: Custom exception types for uninstall failures
- **pip._internal.locations**: Binary directory resolution

### Architecture Patterns

- **Factory Pattern**: `UninstallPathSet.from_dist()` creates appropriate uninstaller based on installation type
- **Command Pattern**: Stashing operations can be committed or rolled back
- **Strategy Pattern**: Different removal strategies for different installation types
- **Generator Pattern**: Lazy evaluation for path iteration and script name generation

### Critical Invariants

- Files are stashed before removal to enable rollback
- Permission checks prevent removal outside virtual environments (L310-319)
- Path normalization ensures consistent handling across platforms (L308, L326)
- Symlinks are treated as files, not followed to targets (L247)
- Platform-specific handling for Windows script extensions and path separators