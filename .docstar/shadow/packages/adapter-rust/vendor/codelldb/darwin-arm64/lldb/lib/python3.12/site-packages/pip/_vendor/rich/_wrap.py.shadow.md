# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/rich/_wrap.py
@source-hash: 1654aca26e445f42
@generated: 2026-02-09T17:59:02Z

## Purpose
Text wrapping utilities for the Rich library that handle word-aware line breaking with proper Unicode/CJK cell width calculations.

## Core Functions

### `words(text: str)` (L12-23)
Generator that tokenizes text into words with their positions. Uses regex `re_word` (L9) to match word patterns including trailing whitespace. Yields tuples of `(start_index, end_index, word)`.

### `divide_line(text: str, width: int, fold: bool = True)` (L26-78)
Main line-breaking algorithm that determines optimal break positions for text fitting within specified cell width. Returns list of character indices where breaks should occur.

**Key Logic:**
- Iterates through words using `words()` generator
- Tracks `cell_offset` for current line position using `cell_len()` from `.cells` module
- Handles three scenarios:
  1. Word fits in remaining space (L49-51)
  2. Word exceeds line width entirely (L54-71):
     - If `fold=True`: uses `chop_cells()` to split across multiple lines (L59-66)  
     - If `fold=False`: crops word and starts new line (L68-71)
  3. Word doesn't fit remaining space but fits on new line (L72-76)

## Dependencies
- `._loop.loop_last`: Iterator utility for detecting last items
- `.cells.cell_len, chop_cells`: Unicode-aware cell width calculations and text chopping
- Built-in `re` module for word pattern matching

## Key Patterns
- Uses local variable caching (`_cell_len = cell_len`) for performance optimization (L42)
- Distinguishes between character length and display cell width for proper Unicode/CJK support
- Word boundary detection includes trailing whitespace in word definitions

## Test Code (L81-93)  
Manual testing section demonstrating usage with Console output, including CJK text examples.