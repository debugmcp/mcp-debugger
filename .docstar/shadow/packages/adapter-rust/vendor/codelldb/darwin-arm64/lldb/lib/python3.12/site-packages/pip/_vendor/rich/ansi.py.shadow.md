# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/rich/ansi.py
@source-hash: 883eb9df6418aa70
@generated: 2026-02-09T17:59:06Z

## Purpose

ANSI escape sequence parser and decoder for the Rich library. Converts terminal ANSI codes into Rich's styled Text objects, enabling proper rendering of colored and formatted terminal output.

## Key Components

### Core Parsing

- `re_ansi` (L10-16): Regular expression matching ANSI escape sequences, supporting both OSC (Operating System Command) and SGR (Select Graphic Rendition) codes
- `_AnsiToken` (L19-25): NamedTuple representing parsed ANSI tokens with fields for plain text, SGR codes, and OSC codes
- `_ansi_tokenize()` (L27-56): Generator function that tokenizes ANSI-encoded strings into plain text and escape code components

### Style Mapping

- `SGR_STYLE_MAP` (L58-116): Comprehensive mapping of SGR numeric codes to Rich style strings, covering:
  - Text formatting (bold, italic, underline, etc.)
  - Standard 16-color palette (codes 30-37, 90-97 for foreground; 40-47, 100-107 for background)
  - Style negation codes (22-29)
  - Special effects (frame, encircle, overline)

### ANSI Decoder

- `AnsiDecoder` class (L119-211): Main decoder converting ANSI sequences to Rich Text objects
  - `__init__()` (L122-123): Initializes with null style state
  - `decode()` (L125-135): Processes multi-line terminal text, yielding Text objects per line
  - `decode_line()` (L137-210): Core decoding logic handling:
    - Plain text preservation with current style
    - OSC hyperlink processing (codes starting with "8;")
    - SGR code interpretation including 256-color (code 38/48 + 5) and RGB (code 38/48 + 2) support
    - Style state management with reset (code 0) and accumulation

## Architecture Patterns

- **State Machine**: AnsiDecoder maintains style state across tokens, accumulating styles until reset
- **Iterator-based Processing**: Uses generator functions for memory-efficient streaming of large terminal output
- **Defensive Parsing**: Gracefully handles malformed codes with `suppress(StopIteration)` and numeric validation

## Dependencies

- Rich components: `.color.Color`, `.style.Style`, `.text.Text`
- Standard library: `re`, `contextlib.suppress`, `typing`

## Platform-Specific Features

- Conditional execution block (L213-240): Unix-only terminal spawning utility for testing ANSI decoding with real terminal output