# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_internal/network/utils.py
@source-hash: e80e52ad42441141
@generated: 2026-02-09T17:58:32Z

## Purpose and Responsibility
Provides network utilities for handling HTTP responses in pip's internal networking layer. Focuses on proper error handling and chunked data streaming while avoiding compression-related issues.

## Key Components

### HEADERS Constant (L26)
Defines default HTTP headers with `Accept-Encoding: identity` to prevent server-side compression issues. Critical for ensuring pip can properly verify checksums of downloaded files by avoiding double compression scenarios.

### raise_for_status Function (L29-54)
Enhanced version of requests' raise_for_status that:
- Handles byte-encoded reason strings with UTF-8/ISO-8859-1 fallback decoding (L31-41)
- Maps 4xx client errors and 5xx server errors to NetworkConnectionError (L43-51)
- Provides detailed error messages including status code, reason, and URL

### response_chunks Function (L57-96)
Generator that yields response data in chunks while preserving raw bytes:
- Uses urllib3's stream method with `decode_content=False` to prevent automatic decompression (L63-88)
- Falls back to standard file-like object reading for non-urllib3 responses (L90-96)
- Configurable chunk size (defaults to requests' CONTENT_CHUNK_SIZE)

## Dependencies
- `pip._vendor.requests.models`: Response object and CONTENT_CHUNK_SIZE constant
- `pip._internal.exceptions.NetworkConnectionError`: Custom exception for network errors

## Architectural Decisions
1. **Compression Avoidance**: Both HEADERS and response_chunks deliberately avoid automatic compression handling to maintain data integrity for checksum verification
2. **Encoding Robustness**: Graceful handling of different reason string encodings in error responses
3. **Dual Streaming Strategy**: Primary urllib3 streaming with fallback for other response types

## Critical Constraints
- Must preserve raw bytes for checksum verification
- Cannot rely on automatic decompression due to potential double-compression scenarios
- Error messages must include full context (status, reason, URL) for debugging