# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_internal/cli/parser.py
@source-hash: 400918eacf0df800
@generated: 2026-02-09T17:58:30Z

## Primary Purpose
This module provides option parser setup for pip's command-line interface, implementing custom help formatters and configuration-aware option parsing. It extends Python's optparse module with pip-specific functionality for handling configuration files, environment variables, and improved help formatting.

## Key Classes

### PrettyHelpFormatter (L18-98)
Custom optparse help formatter that provides cleaner, more readable help output:
- **__init__ (L21-26)**: Sets terminal-aware formatting parameters (max_help_position=30, width=terminal_width-2)
- **_format_option_strings (L31-55)**: Formats option strings with metavars, handling both short and long options
- **format_heading (L57-60)**: Suppresses "Options" heading for cleaner output
- **format_usage (L62-68)**: Ensures consistent newline spacing in usage messages
- **format_description (L70-86)**: Dynamically labels descriptions as "Commands" or "Description" based on parser type
- **indent_lines (L95-97)**: Utility method for consistent text indentation

### UpdatingDefaultsHelpFormatter (L100-130)
Extends PrettyHelpFormatter with configuration-aware default expansion:
- **expand_default (L109-129)**: Updates defaults from configuration before displaying, redacts auth credentials from URL options

### CustomOptionParser (L132-152)
Basic optparse.OptionParser extension with utility methods:
- **insert_option_group (L133-142)**: Inserts option groups at specific positions
- **option_list_all (L144-151)**: Property returning all options including those in groups

### ConfigOptionParser (L154-294)
Main configuration-aware option parser that integrates pip's configuration system:
- **__init__ (L158-169)**: Takes name and isolated parameters, initializes Configuration instance
- **check_default (L171-176)**: Validates option values with error handling (exits with code 3 on failure)
- **_get_ordered_configuration_items (L178-204)**: Yields configuration items in priority order: global → command-specific → environment
- **_update_defaults (L206-268)**: Core method that applies configuration values to option defaults, handling various action types (store_true/false, count, append, callback)
- **get_default_values (L270-290)**: Loads configuration and applies defaults, overriding optparse behavior
- **error (L292-294)**: Custom error handling that prints usage and exits with UNKNOWN_ERROR code

## Dependencies
- **optparse**: Standard library option parsing (extended throughout)
- **pip._internal.configuration**: Configuration file and environment variable handling
- **pip._internal.cli.status_codes**: Error code constants (UNKNOWN_ERROR)
- **pip._internal.utils.misc**: URL credential redaction and boolean parsing utilities

## Architectural Patterns
- **Formatter Chain**: PrettyHelpFormatter → UpdatingDefaultsHelpFormatter for progressive enhancement
- **Parser Inheritance**: optparse.OptionParser → CustomOptionParser → ConfigOptionParser for layered functionality
- **Configuration Integration**: Seamlessly merges file/environment config with command-line options
- **Priority System**: Global config < command-specific config < environment variables

## Critical Invariants
- Configuration loading happens in get_default_values(), not during parser initialization
- Option validation failures result in immediate sys.exit(3)
- URL options automatically redact authentication credentials in help text
- Configuration keys use only long option names (prefixed with '--')
- Late evaluation options (callbacks) are processed after regular defaults