# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/urllib3/util/retry.py
@source-hash: 67a5847f9d7c7933
@generated: 2026-02-09T17:57:42Z

## Purpose
HTTP retry logic and configuration for urllib3. Provides sophisticated retry handling with exponential backoff, method-specific retry rules, and header management during redirects.

## Key Classes & Functions

### RequestHistory (L26-28)
`namedtuple` storing metadata for retry attempts: method, url, error, status, redirect_location. Used to track retry history.

### _RetryMeta (L35-89)
Metaclass providing deprecated property aliases with warnings:
- `DEFAULT_METHOD_WHITELIST` → `DEFAULT_ALLOWED_METHODS` (L37-52)
- `DEFAULT_REDIRECT_HEADERS_BLACKLIST` → `DEFAULT_REMOVE_HEADERS_ON_REDIRECT` (L55-70)
- `BACKOFF_MAX` → `DEFAULT_BACKOFF_MAX` (L73-88)

### Retry (L92-617)
Core retry configuration class with immutable semantics - each retry attempt creates new instance.

**Class Constants:**
- `DEFAULT_ALLOWED_METHODS` (L230-232): HTTP methods safe to retry (HEAD, GET, PUT, DELETE, OPTIONS, TRACE)
- `RETRY_AFTER_STATUS_CODES` (L235): Status codes that honor Retry-After header (413, 429, 503)
- `DEFAULT_REMOVE_HEADERS_ON_REDIRECT` (L238): Headers stripped on redirect (Cookie, Authorization)
- `DEFAULT_BACKOFF_MAX` (L241): Maximum backoff time (120s)

**Key Methods:**
- `__init__` (L243-302): Constructor with extensive parameter validation and deprecation handling
- `new` (L304-338): Creates new instance with updated parameters, preserves immutability
- `from_int` (L340-352): Factory for backward compatibility with integer retry counts
- `get_backoff_time` (L354-369): Calculates exponential backoff based on consecutive errors
- `parse_retry_after` (L371-392): Parses Retry-After header (seconds or HTTP date)
- `sleep` (L418-432): Orchestrates sleep between retries (Retry-After vs exponential backoff)
- `increment` (L504-596): Core retry logic - decrements counters, updates history, raises MaxRetryError when exhausted

**Error Classification:**
- `_is_connection_error` (L434-440): Connection-level errors safe to retry
- `_is_read_error` (L442-446): Read errors that may have side effects
- `_is_method_retryable` (L448-466): Method allowlist checking

## Dependencies
- urllib3 exceptions (L11-19): MaxRetryError, timeout/protocol errors
- Standard library: email, time, warnings, re, collections, itertools
- six library for Python 2/3 compatibility (L20)

## Architectural Patterns
- **Immutable Objects**: Each retry attempt creates new Retry instance
- **Builder Pattern**: `new()` method for creating modified copies
- **Strategy Pattern**: Different retry strategies for connection/read/redirect/status errors
- **Deprecation Management**: Extensive backward compatibility with warnings

## Critical Invariants
- Retry counts never modified in place - always create new instance
- Total retry count takes precedence over specific error type counts
- Method allowlist enforced for all retry types except connection errors
- History maintains chronological order of all retry attempts
- Exponential backoff capped at DEFAULT_BACKOFF_MAX (120s)