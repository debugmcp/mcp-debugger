# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/urllib3/_collections.py
@source-hash: a72012249856ef07
@generated: 2026-02-09T17:59:23Z

## Purpose
Collection utilities for urllib3, providing thread-safe data structures for HTTP header management and LRU caching functionality. Implements case-insensitive HTTP header handling according to RFC standards.

## Key Components

### RecentlyUsedContainer (L31-105)
Thread-safe LRU (Least Recently Used) cache implementation extending MutableMapping.

**Key Methods:**
- `__init__(maxsize=10, dispose_func=None)` (L47): Initialize with capacity limit and optional cleanup callback
- `__getitem__(key)` (L54): Access item and move to end (most recent position)  
- `__setitem__(key, value)` (L61): Insert/update with automatic eviction of oldest items
- `clear()` (L92): Remove all items with proper disposal callback execution

**Architecture:**
- Uses OrderedDict as underlying container (L45, L51)
- RLock for thread safety (L52) with fallback implementation for threadless platforms (L11-16)
- Automatic cleanup via dispose_func callback on eviction (L73-74, L80-81, L98-100)
- Deliberately prohibits iteration due to thread safety concerns (L87-90)

### HTTPHeaderDict (L107-355)
Case-insensitive HTTP header dictionary with multi-value support.

**Core Features:**
- Case-insensitive header name storage and lookup (L153, L157, L161, L164)
- Multi-value header support with comma-separated string representation (L158)
- RFC 7230 compliant header handling (L118-120)

**Key Methods:**
- `add(key, val)` (L215): Append values without overwriting existing ones
- `extend(*args, **kwargs)` (L231): Bulk import from various header sources
- `getlist(key, default=__marker)` (L259): Return all values as list
- `_prepare_for_method_change()` (L271): Remove content headers for GET/HEAD requests
- `from_httplib(cls, message)` (L329): Parse Python 2 httplib message objects

**Storage Format:**
Internal container stores `[original_key, value1, value2, ...]` lists keyed by lowercase names (L153, L224-229).

## Dependencies
- `collections.OrderedDict` for ordered key-value storage
- `threading.RLock` with platform fallback for thread safety  
- `.exceptions.InvalidHeader` for malformed header validation
- `.packages.six` for Python 2/3 compatibility utilities

## Critical Patterns
- **Thread Safety**: RecentlyUsedContainer uses RLock for all container operations
- **Case Preservation**: HTTPHeaderDict maintains original case while using lowercase for lookups
- **Multi-value Headers**: Automatic comma-joining of duplicate headers per HTTP standards
- **Memory Management**: LRU eviction with cleanup callbacks prevents memory leaks

## Invariants
- RecentlyUsedContainer never exceeds maxsize capacity
- HTTPHeaderDict preserves first-seen case for header names
- All header operations are case-insensitive for lookups but case-preserving for storage
- Disposal functions are always called outside of lock context to prevent deadlocks