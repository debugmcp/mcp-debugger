# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_internal/utils/packaging.py
@source-hash: e569baff1ee52ab9
@generated: 2026-02-09T17:58:37Z

## Purpose and Responsibility

Utility module for Python packaging operations in pip's internal codebase. Provides validation, parsing, and normalization functions for Python version requirements and package extras.

## Key Components

### Type Definitions
- **NormalizedExtra** (L9): NewType wrapper around str for type safety of normalized extra names

### Core Functions

**check_requires_python** (L14-34): Validates Python version compatibility against "Requires-Python" specifiers
- Parameters: requires_python (Optional[str]), version_info (Tuple[int, ...])
- Returns: bool indicating compatibility
- Uses packaging.specifiers.SpecifierSet for validation logic
- Handles None case (no requirement) as always compatible

**get_requirement** (L37-45): Cached factory for packaging.Requirement objects
- Decorated with @functools.lru_cache(maxsize=512) for performance
- Reduces expensive parsing overhead for repeated requirement strings
- Single parameter: req_string (str)

**safe_extra** (L48-57): Normalizes arbitrary strings to standard 'extra' names
- Replaces non-alphanumeric runs with single underscore
- Converts to lowercase
- Uses regex pattern "[^A-Za-z0-9.-]+" for character matching
- Returns NormalizedExtra type for type safety

## Dependencies
- **functools**: For LRU caching decorator
- **logging**: Standard logging setup (logger at L11)
- **re**: Regular expressions for string normalization
- **typing**: Type hints including NewType, Optional, Tuple, cast
- **pip._vendor.packaging**: Core packaging utilities (specifiers, version, requirements)

## Architectural Patterns
- **Performance optimization**: LRU cache on requirement parsing reduces computational overhead
- **Type safety**: Custom NewType for normalized extras prevents string confusion
- **Error handling**: Delegates InvalidSpecifier exceptions to caller
- **Immutable operations**: All functions are pure with no side effects

## Critical Invariants
- safe_extra always returns lowercase strings with normalized separators
- get_requirement cache assumes requirement strings have low diversity
- check_requires_python treats None requirements as universally compatible
- Version comparison uses semantic versioning through packaging.version.parse