# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/cachecontrol/caches/redis_cache.py
@source-hash: f6b9aac2d62efe58
@generated: 2026-02-09T17:57:26Z

## Purpose
Redis-backed cache implementation for pip's HTTP caching system, providing persistent storage through Redis key-value store.

## Key Components

### RedisCache Class (L16-48)
Concrete implementation of `BaseCache` that wraps a Redis connection for HTTP response caching.

**Constructor (L17-18)**: Takes a `Redis[bytes]` connection object and stores it as instance variable.

**Core Cache Operations**:
- `get(key: str)` (L20-21): Direct passthrough to Redis GET command
- `set(key: str, value: bytes, expires: int | datetime | None)` (L23-35): Handles three expiration scenarios:
  - No expiration: uses Redis SET (L27)  
  - DateTime expiration: calculates TTL from current UTC time, handles timezone-naive datetimes (L28-33)
  - Integer expiration: direct TTL in seconds using SETEX (L35)
- `delete(key: str)` (L37-38): Direct Redis DELETE operation
- `clear()` (L40-44): Dangerous operation that deletes ALL keys in the Redis database
- `close()` (L46-48): No-op since Redis uses connection pooling

## Dependencies
- `pip._vendor.cachecontrol.cache.BaseCache` (L10): Parent abstract class
- `redis.Redis` (L13): Redis client library (TYPE_CHECKING import)
- `datetime` module (L7): For expiration time calculations

## Architecture Notes
- Follows adapter pattern, wrapping Redis client to conform to cachecontrol interface
- Timezone handling for datetime expiration is defensive - converts timezone-aware datetimes to naive if needed to match current time format
- Clear operation iterates over all keys rather than using FLUSHDB, allowing selective clearing in multi-tenant scenarios

## Critical Invariants
- All values stored as bytes (enforced by type hints)
- Expiration times calculated as positive integers (seconds)
- Connection lifecycle managed externally due to Redis connection pooling