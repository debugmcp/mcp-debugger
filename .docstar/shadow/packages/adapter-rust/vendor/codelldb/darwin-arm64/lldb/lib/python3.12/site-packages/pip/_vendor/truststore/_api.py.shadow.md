# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/truststore/_api.py
@source-hash: 07d2481e2a730484
@generated: 2026-02-09T17:59:20Z

## Purpose
Main API module for the truststore package that provides system-native certificate verification by replacing Python's ssl.SSLContext with a custom implementation that uses OS trust stores on Windows, macOS, and OpenSSL-based systems.

## Key Classes

### SSLContext (L58-274)
Custom SSL context implementation that wraps the original ssl.SSLContext while adding system certificate verification. Key features:
- **Constructor (L68-81)**: Creates wrapped original SSLContext and defines TruststoreSSLObject for certificate verification
- **TruststoreSSLObject (L71-80)**: Inner class that overrides do_handshake() to add peer certificate verification
- **wrap_socket() (L83-109)**: Wraps sockets with context configuration and peer certificate verification
- **wrap_bio() (L111-127)**: Wraps BIO objects for memory-based SSL operations
- **Property delegation (L186-274)**: Extensive property delegation to underlying _ctx for SSL configuration
- **Unimplemented methods**: cert_store_stats() (L169) and get_ca_certs() (L183) raise NotImplementedError

## Key Functions

### inject_into_ssl() (L32-44)
Monkey-patches the ssl module to replace ssl.SSLContext with truststore's SSLContext. Also patches urllib3's reference to prevent conflicts.

### extract_from_ssl() (L47-55)
Restores original ssl.SSLContext, reversing the injection for cleanup.

### _verify_peercerts() (L296-313)
Core verification function that extracts certificate chain from SSL objects and delegates to platform-specific verification implementation.

### _get_unverified_chain_bytes() (L282-293)
Version-aware helper that handles Python 3.13+ API changes for certificate chain extraction, returning DER-encoded certificate bytes.

## Platform Abstraction
Platform-specific imports (L17-22) provide _configure_context and _verify_peercerts_impl from:
- _windows module for Windows
- _macos module for Darwin/macOS  
- _openssl module for other systems

## Dependencies
- **ssl constants (L10-15)**: Original SSL classes and truststore-specific replacements
- **Type definitions (L28-29)**: Path and password type aliases for SSL operations
- **Platform modules**: OS-specific certificate verification implementations

## Architectural Patterns
- **Wrapper pattern**: SSLContext wraps original ssl.SSLContext while adding system trust store verification
- **Monkey patching**: Runtime replacement of ssl module classes for transparent integration
- **Platform abstraction**: Conditional imports based on operating system detection
- **Context manager usage**: _configure_context used in wrap_socket/wrap_bio for proper state management