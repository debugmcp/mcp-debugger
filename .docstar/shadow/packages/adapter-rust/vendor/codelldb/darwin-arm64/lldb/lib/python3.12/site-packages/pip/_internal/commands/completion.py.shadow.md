# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_internal/commands/completion.py
@source-hash: 1d3e250f46e0b1f9
@generated: 2026-02-09T17:58:25Z

**Primary Purpose**: Implements pip's shell completion command that generates auto-completion scripts for various shells (bash, zsh, fish, powershell).

**Core Components**:

- **BASE_COMPLETION** (L10-12): Template string that wraps generated completion scripts with shell-specific start/end markers
- **COMPLETION_SCRIPTS** (L14-72): Dictionary mapping shell names to their respective completion script templates:
  - `bash` (L15-23): Uses COMP_WORDS/COMP_CWORD environment variables with bash's complete builtin
  - `zsh` (L24-38): Uses zsh's compdef system with autoload detection
  - `fish` (L39-49): Implements fish shell completion using commandline and math functions
  - `powershell` (L50-71): Hooks into PowerShell's TabExpansion with environment variable setup

**Main Class**:
- **CompletionCommand** (L75-130): Inherits from pip's base Command class
  - `ignore_require_venv = True` (L78): Bypasses virtual environment requirements
  - `add_options()` (L80-114): Registers shell-specific CLI options (--bash/-b, --zsh/-z, --fish/-f, --powershell/-p)
  - `run()` (L116-130): Main execution logic that validates shell selection and outputs formatted completion script

**Key Dependencies**:
- `pip._internal.cli.base_command.Command`: Base command infrastructure
- `pip._internal.utils.misc.get_prog`: Retrieves current pip program name for script interpolation
- `textwrap.dedent`: Cleans up indentation in multi-line script templates

**Execution Flow**:
1. Parse shell option from command line
2. Validate shell is supported (bash/zsh/fish/powershell)
3. Format completion script template with current program name
4. Output wrapped script to stdout or error message to stderr
5. Always returns SUCCESS status code (even on validation failure)

**Architecture Notes**:
- All completion scripts use PIP_AUTO_COMPLETE=1 environment variable to trigger pip's internal completion mode
- Scripts are designed to be sourced/evaluated in respective shell environments
- PowerShell implementation includes fallback mechanism to existing TabExpansion function