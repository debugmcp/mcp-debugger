# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/urllib3/util/ssltransport.py
@source-hash: 340faee6b313ac31
@generated: 2026-02-09T17:57:32Z

## Purpose
SSL transport wrapper that enables TLS-in-TLS connections by wrapping existing sockets with SSL/TLS encryption using memory BIOs instead of direct socket SSL wrapping.

## Key Components

**SSLTransport class (L11-221)** - Main SSL transport implementation
- Wraps existing sockets with SSL encryption using memory BIOs
- Supports chaining multiple TLS connections (TLS-in-TLS)
- Implements most socket API operations with SSL encryption

**Key Methods:**
- `_validate_ssl_context_for_tls_in_tls()` (L22-42) - Static method validating SSL context has `wrap_bio` capability, raises `ProxySchemeUnsupported` on Python 2 or non-native contexts
- `__init__()` (L44-61) - Constructor creating incoming/outgoing MemoryBIOs, wrapping with SSL context, performing initial handshake
- `_ssl_io_loop()` (L195-221) - Core I/O loop handling SSL read/write operations with WANT_READ/WANT_WRITE states
- `_wrap_ssl_read()` (L186-193) - SSL read wrapper handling SSL_ERROR_EOF with optional suppression

**Socket API Implementation:**
- `read()`, `recv()`, `recv_into()` (L72-87) - Read operations delegating to `_wrap_ssl_read`
- `send()`, `sendall()` (L89-103) - Write operations using `_ssl_io_loop` with SSL write
- `makefile()` (L105-148) - File-like object creation using `socket.SocketIO` with buffering support

**SSL Information Methods:**
- `getpeercert()`, `version()`, `cipher()` (L156-163) - SSL certificate and connection info
- `selected_alpn_protocol()`, `selected_npn_protocol()` (L165-169) - Protocol negotiation info
- `shared_ciphers()`, `compression()` (L171-175) - SSL connection details

## Dependencies
- `ssl` module for MemoryBIO and SSL operations
- `socket` module for SocketIO and underlying socket operations  
- `io` module for buffered I/O in makefile implementation
- `..exceptions.ProxySchemeUnsupported` for TLS-in-TLS validation errors
- `..packages.six` for Python 2/3 compatibility checks

## Architecture Patterns
- Memory BIO pattern: Uses `ssl.MemoryBIO` for incoming/outgoing buffers instead of direct socket SSL
- I/O loop pattern: `_ssl_io_loop` handles SSL state machine with WANT_READ/WANT_WRITE states
- Socket API mimicking: Implements standard socket methods to act as drop-in replacement
- Context manager support: `__enter__`/`__exit__` for resource management

## Constants
- `SSL_BLOCKSIZE = 16384` (L8) - Buffer size for SSL I/O operations

## Critical Constraints
- Requires SSL context with `wrap_bio` method (validated in constructor)
- Does not support non-zero flags in recv/send operations (raises ValueError)
- Suppresses ragged EOF errors by default (`suppress_ragged_eofs=True`)