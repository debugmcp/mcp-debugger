# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/truststore/
@generated: 2026-02-09T18:16:07Z

## Overview
The `truststore` package provides cross-platform SSL certificate verification using native system trust stores instead of bundled CA certificates. It offers a drop-in replacement for Python's `ssl.SSLContext` that transparently integrates with Windows CryptoAPI, macOS Security framework, and OpenSSL on Unix systems.

## Architecture

### Core Components
- **`__init__.py`**: Package entry point exposing the public API (`SSLContext`, `inject_into_ssl`, `extract_from_ssl`)
- **`_api.py`**: Main API layer providing the custom SSLContext implementation and monkey-patching functionality
- **Platform-specific modules**: OS-specific certificate verification backends
  - **`_windows.py`**: Windows CryptoAPI integration using ctypes bindings
  - **`_macos.py`**: macOS Security/CoreFoundation framework integration
  - **`_openssl.py`**: OpenSSL-based verification for Unix-like systems
- **`_ssl_constants.py`**: SSL utilities handling CPython vs non-CPython differences and original SSL preservation

### Platform Abstraction Pattern
The package uses conditional imports to select the appropriate backend based on the operating system. Each platform module implements two key functions:
- `_configure_context()`: Context manager for SSL configuration
- `_verify_peercerts_impl()`: Certificate chain verification logic

## Public API

### SSLContext Class
Drop-in replacement for `ssl.SSLContext` that wraps the original implementation while adding system trust store verification. Key features:
- Transparent certificate verification using OS trust stores
- Full property delegation to underlying SSL context
- Custom `wrap_socket()` and `wrap_bio()` with peer certificate verification

### Integration Functions
- **`inject_into_ssl()`**: Monkey-patches the ssl module to use truststore's SSLContext globally
- **`extract_from_ssl()`**: Restores original ssl.SSLContext for cleanup

## Internal Data Flow

1. **SSL Context Creation**: SSLContext wraps original ssl.SSLContext
2. **Socket Wrapping**: Custom TruststoreSSLObject intercepts handshake operations
3. **Certificate Extraction**: Platform-agnostic certificate chain extraction from SSL objects
4. **Platform Verification**: Delegates to OS-specific verification implementation
5. **Error Handling**: Converts platform-specific errors to Python ssl.SSLError

## Platform-Specific Implementations

### Windows (_windows.py)
- Uses Windows CryptoAPI via extensive ctypes bindings
- Implements fallback verification: system trust store â†’ custom CA certificates
- Handles certificate stores, chain engines, and policy verification

### macOS (_macos.py)
- Integrates with Security.framework and CoreFoundation
- Requires macOS 10.8+
- Comprehensive memory management for CoreFoundation objects
- Native error message extraction from OSStatus codes

### OpenSSL (_openssl.py)
- Discovers system CA certificate bundles across Linux distributions
- Validates certificate directories using OpenSSL hashed naming convention
- Delegates to built-in SSL verification rather than custom implementation

## Key Patterns
- **Wrapper Pattern**: SSLContext wraps original while adding functionality
- **Platform Abstraction**: Unified interface with OS-specific backends
- **Monkey Patching**: Runtime SSL module replacement for transparent integration
- **Resource Management**: Proper cleanup of native platform resources
- **Fallback Chains**: Multiple verification strategies per platform

## Dependencies
- Python 3.10+ requirement enforced at import time
- Platform-specific system libraries (Security.framework on macOS, CryptoAPI on Windows)
- Standard library modules: ssl, ctypes, contextlib, re, os, sys

## Critical Constraints
- Version enforcement prevents usage on Python < 3.10
- Platform-specific requirements (macOS 10.8+, Windows API availability)
- Memory management requirements for native resource cleanup