# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_internal/utils/subprocess.py
@source-hash: 12cbea4918923071
@generated: 2026-02-09T17:58:44Z

## Purpose
Subprocess execution utilities for pip with support for secure command argument handling, logging, and progress indication via spinners. Handles command construction, output capture, and error management for pip's installation processes.

## Key Types & Functions

**CommandArgs (L14)**: Type alias for `List[Union[str, HiddenText]]` - represents command arguments that may contain sensitive data

**make_command() (L17-31)**: Flattens mixed command arguments (strings, HiddenText, lists) into a single CommandArgs list. Handles nested list expansion for flexible command building.

**format_command_args() (L34-46)**: Formats command arguments for display, automatically redacting HiddenText objects using their string representation while preserving shell quoting.

**reveal_command_args() (L49-53)**: Converts CommandArgs to raw strings, extracting secrets from HiddenText objects for actual subprocess execution.

**call_subprocess() (L56-221)**: Core subprocess execution function with comprehensive error handling, logging, and progress indication:
- Supports two output modes: combined stderr/stdout (default) or separate pipes (stdout_only=True)
- Configurable logging levels (show_stdout controls INFO vs VERBOSE logging)
- Environment variable manipulation (extra_environ, unset_environ)
- Return code handling with custom acceptable codes
- Spinner integration for long-running operations
- Rich markup support for error reporting

**runner_with_spinner_message() (L224-244)**: Factory function creating subprocess runners with spinner messages, designed for BuildBackendHookCaller integration.

## Dependencies
- `pip._vendor.rich.markup`: For safe string escaping in error output
- `pip._internal.cli.spinners`: Progress indication during subprocess execution
- `pip._internal.exceptions.InstallationSubprocessError`: Specialized exception for subprocess failures
- `pip._internal.utils.misc.HiddenText`: Secure handling of sensitive command arguments

## Key Patterns
- **Security-first design**: HiddenText objects ensure sensitive data (passwords, tokens) are not logged
- **Dual logging strategy**: Real-time DEBUG/VERBOSE logging during execution, with ERROR-level logging on failure
- **Spinner coordination**: Automatic spinner management based on logging visibility
- **Flexible error handling**: Configurable responses to subprocess failures (raise/warn/ignore)

## Critical Behaviors
- stdin is always closed after process start (L148) to prevent hanging
- Output is captured line-by-line for real-time logging in non-stdout_only mode
- Environment variables are copied and modified rather than inherited directly
- Process cleanup is guaranteed via try/finally blocks (L165-167)