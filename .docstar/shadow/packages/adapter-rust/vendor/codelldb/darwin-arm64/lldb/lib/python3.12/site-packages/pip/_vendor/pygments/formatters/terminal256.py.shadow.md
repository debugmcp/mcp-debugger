# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/pygments/formatters/terminal256.py
@source-hash: d77489dc3e6915da
@generated: 2026-02-09T17:57:37Z

## Primary Purpose
Provides ANSI terminal formatters for syntax highlighting with 256-color and true-color (16M) support. Converts Pygments style colors to appropriate terminal escape sequences for colored output.

## Key Classes and Functions

### EscapeSequence (L34-96)
Core utility class for building ANSI escape sequences:
- **Constructor (L35-40)**: Accepts fg/bg colors, bold, underline, italic attributes
- **color_string() (L47-71)**: Generates 256-color ANSI sequences, handles both ANSI color names and numeric indices
- **true_color_string() (L73-85)**: Generates 24-bit RGB ANSI sequences 
- **reset_string() (L87-95)**: Creates reset sequences to clear formatting
- **escape() (L42-45)**: Helper to wrap attributes in ANSI escape format

### Terminal256Formatter (L98-289)
Main 256-color terminal formatter inheriting from Pygments Formatter:
- **__init__ (L135-150)**: Initializes color tables, style mappings, and formatting options
- **_build_color_table() (L152-186)**: Constructs 256-color palette (16 basic + 216 cube + 24 grayscale)
- **_closest_color() (L188-203)**: Finds nearest xterm color using Euclidean distance in RGB space
- **_color_index() (L205-222)**: Maps hex colors to xterm indices with caching
- **_setup_styles() (L224-243)**: Converts Pygments style definitions to escape sequences
- **format_unencoded() (L252-286)**: Main formatting logic with line number support and newline handling

### TerminalTrueColorFormatter (L293-338)
24-bit RGB formatter extending Terminal256Formatter:
- **_build_color_table() (L311-312)**: No-op override (no quantization needed)
- **_color_tuple() (L314-322)**: Converts hex colors to RGB tuples
- **_setup_styles() (L324-338)**: Uses true color sequences instead of indexed colors

## Key Dependencies
- `pip._vendor.pygments.formatter.Formatter`: Base formatter class
- `pip._vendor.pygments.console.codes`: ANSI color code mappings  
- `pip._vendor.pygments.style.ansicolors`: Named ANSI color constants

## Architecture Patterns
- **Color quantization**: RGB-to-xterm-256 mapping with distance-based matching
- **Caching**: `best_match` dict caches color conversion results for performance
- **Inheritance**: True-color formatter reuses 256-color logic, overriding color handling
- **Newline handling**: Resets formatting at line breaks to support pagers
- **Token traversal**: Walks up token type hierarchy until style match found

## Critical Constraints
- Colors terminated at newlines for pager compatibility
- ANSI color names handled specially (mapped to basic 16 colors)
- Style attributes (bold/underline/italic) can be disabled via options
- Line numbering affects output format significantly