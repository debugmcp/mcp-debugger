# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/cachecontrol/adapter.py
@source-hash: 7c1c8efcf77f10e7
@generated: 2026-02-09T17:58:43Z

## Primary Purpose

HTTP adapter that adds caching capabilities to requests sessions using the `requests` library. Extends `HTTPAdapter` to intercept HTTP requests/responses and implement HTTP caching semantics including conditional requests, cache invalidation, and response storage.

## Key Classes and Functions

### CacheControlAdapter (L26-161)
Main adapter class extending `requests.HTTPAdapter` that orchestrates HTTP caching:

- **Constructor (L29-48)**: Initializes with configurable cache backend, controller, serializer, heuristics, and cacheable methods (defaults to GET only)
- **send() (L50-78)**: Intercepts outgoing requests, checks cache for existing responses, adds conditional headers (ETags)
- **build_response() (L80-157)**: Post-processes responses for caching, handles 304 Not Modified responses, implements cache invalidation for write operations
- **close() (L159-161)**: Cleanup method that closes underlying cache

### Class Properties
- **invalidating_methods (L27)**: Set of HTTP methods that invalidate cache entries (`PUT`, `PATCH`, `DELETE`)

## Core Dependencies

- `requests.adapters.HTTPAdapter`: Base HTTP adapter functionality
- `cachecontrol.controller.CacheController`: Cache decision logic and HTTP semantics
- `cachecontrol.cache.DictCache`: Default in-memory cache implementation
- `cachecontrol.filewrapper.CallbackFileWrapper`: Stream wrapper for lazy caching

## Architectural Patterns

### Response Caching Strategy
- **Conditional caching**: Only caches cacheable methods (configurable, defaults to GET)
- **Lazy caching**: Uses `CallbackFileWrapper` (L128-133) to cache response body only after consumption
- **304 handling**: Updates cached responses when server returns Not Modified (L101-121)
- **Permanent redirects**: Always cache 301/302 responses (L122-124)

### Chunked Transfer Handling
Dynamically patches `_update_chunk_length` method (L137-144) to trigger cache closure when chunked transfer completes.

### Cache Invalidation
Write operations (PUT/PATCH/DELETE) on successful responses automatically invalidate corresponding cache entries (L149-152).

## Key Behaviors

- Gracefully handles zlib decompression errors in cached responses (L68-69)
- Adds `from_cache` attribute to response objects for client introspection (L155)
- Supports method-specific caching overrides via `cacheable_methods` parameter
- Integrates with heuristic policies for cache expiration decisions (L97-98)