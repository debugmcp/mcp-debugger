# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/pygments/modeline.py
@source-hash: 785daf3b82e9386a
@generated: 2026-02-09T17:58:52Z

## Purpose
Modeline parser for extracting filetype information from vi/vim editor modelines in text buffers. Used by Pygments syntax highlighting library to automatically detect file types from editor directives.

## Key Components

### Regular Expression Pattern (L16-19)
- `modeline_re`: Compiled regex that matches vi/vim/ex modeline syntax
- Captures filetype/syntax declarations in the format `ft=type` or `syntax=type`
- Uses verbose mode for readability with whitespace and comments ignored

### Core Functions

#### `get_filetype_from_line(l)` (L22-25)
- Single-line modeline parser
- Returns extracted filetype string if modeline pattern matches, None otherwise
- Uses the compiled regex to search for modeline patterns

#### `get_filetype_from_buffer(buf, max_lines=5)` (L28-42)
- Buffer-wide modeline scanner with configurable search depth
- Scans both end and beginning of buffer (common modeline locations)
- **Search strategy**: First scans last `max_lines` in reverse order (L33), then scans first `max_lines` forward (L37-41)
- Returns first found filetype or None if no modelines detected

## Architecture Notes
- Follows vim's modeline convention where modelines typically appear at file start/end
- Two-pass scanning ensures compatibility with different modeline placement practices
- Designed as utility module for Pygments' lexer selection system

## Dependencies
- `re` module for regex compilation and matching
- No external dependencies beyond Python standard library

## Public API
- `get_filetype_from_buffer()` - Primary entry point exported in `__all__` (L13)