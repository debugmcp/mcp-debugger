# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_internal/metadata/pkg_resources.py
@source-hash: 534ec44c020d4867
@generated: 2026-02-09T17:58:44Z

## Primary Purpose
This file implements a pkg_resources-based metadata adapter for pip's internal metadata abstraction layer. It provides concrete implementations of `BaseDistribution` and `BaseEnvironment` that wrap pkg_resources functionality, enabling pip to query package metadata from various sources (directories, wheels, in-memory) while maintaining a consistent interface.

## Key Classes and Functions

### EntryPoint (L42-46)
Simple NamedTuple representing package entry points with `name`, `value`, and `group` attributes.

### InMemoryMetadata (L48-81)
IMetadataProvider implementation that reads metadata from a dictionary rather than files. Key methods:
- `get_metadata(name)` (L61-68): Retrieves and decodes metadata, mapping UnicodeDecodeError to UnsupportedWheel
- `has_metadata(name)` (L58-59): Checks metadata existence
- Directory operations return False/empty (L73-77) since this is in-memory only

### Distribution (L83-251)
Core wrapper around pkg_resources.Distribution implementing BaseDistribution interface:

**Factory Methods:**
- `from_directory(directory)` (L99-117): Creates from .egg-info or .dist-info directories
- `from_metadata_file_contents(metadata_contents, filename, project_name)` (L119-134): Creates from raw metadata bytes
- `from_wheel(wheel, name)` (L136-155): Extracts metadata from wheel files, handles zip errors

**Key Properties:**
- `location` (L157-159): Physical location of distribution
- `installed_location` (L161-170): Handles egg-link resolution and path normalization
- `canonical_name` (L186-188): Normalized package name using packaging.utils
- `version` (L190-192): Parsed version object
- `installed_by_distutils` (L176-184): Introspects provider type via attribute checking

**Metadata Operations:**
- `read_text(path)` (L204-211): Reads metadata files with proper error handling
- `_metadata_impl()` (L219-239): Loads METADATA/PKG-INFO using email.parser, handles missing metadata gracefully
- `iter_dependencies(extras)` (L241-247): Resolves dependencies with extra normalization
- `iter_entry_points()` (L213-217): Parses entry points from distribution

**Private Attributes:**
- `_extra_mapping` (L90-97): Lazy-loaded mapping of normalized extra names to original names

### Environment (L253-301)
Wrapper around pkg_resources.WorkingSet implementing BaseEnvironment:

**Factory Methods:**
- `default()` (L257-259): Uses global pkg_resources.working_set
- `from_paths(paths)` (L261-263): Creates WorkingSet from custom paths

**Core Methods:**
- `_iter_distributions()` (L265-267): Yields wrapped Distribution objects
- `_search_distribution(name)` (L269-279): Linear search through all distributions
- `get_distribution(name)` (L281-301): Two-phase lookup with working set refresh on failure

## Important Dependencies
- `pkg_resources`: Core dependency providing WorkingSet, Distribution, and metadata providers
- `packaging.requirements/version/utils`: For requirement parsing, version handling, and name canonicalization
- `pip._internal.exceptions`: Custom exception types (InvalidWheel, UnsupportedWheel, NoneMetadataError)
- `pip._internal.utils.wheel`: Wheel parsing and metadata extraction utilities

## Architectural Patterns
- **Adapter Pattern**: Wraps pkg_resources classes to implement pip's internal interfaces
- **Lazy Loading**: Extra mapping is computed on first access to avoid unnecessary work
- **Error Translation**: Converts pkg_resources/zipfile exceptions to pip's internal exception hierarchy
- **Factory Methods**: Multiple construction pathways for different metadata sources

## Critical Invariants
- Distribution names are always canonicalized using packaging.utils.canonicalize_name
- Metadata encoding errors are consistently mapped to UnsupportedWheel exceptions
- Working set refresh is attempted when initial distribution lookup fails
- In-memory metadata providers never report directories (always return False/empty)

## Notable Implementation Details
- Distutils detection relies on provider having a 'path' attribute (L182)
- Entry point parsing manually splits on '=' character (L216)
- Wheel metadata extraction handles nested directory structures via path prefix matching (L144)
- Missing metadata results in warning log and empty string fallback (L235-236)