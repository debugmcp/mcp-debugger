# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/distlib/metadata.py
@source-hash: a41f5667d9817e64
@generated: 2026-02-09T17:59:02Z

## Purpose
Core metadata handling for Python packages, implementing support for all metadata specification versions (1.0-2.2). Provides unified API for reading/writing package metadata in both legacy key-value format and modern JSON format.

## Key Classes

### LegacyMetadata (L245-603)
Handles legacy metadata formats (1.0, 1.1, 1.2, 2.0, 1.3/2.1). Main interface for key-value PKG-INFO files.

Key methods:
- `read(filepath)` (L339): Load metadata from file path
- `read_file(fileobj)` (L347): Parse email-format metadata from file object  
- `write_file(fileobj)` (L383): Write PKG-INFO format with version-appropriate fields
- `set(name, value)` (L436): Validate and set metadata field with type coercion
- `get(name, default)` (L480): Retrieve field with proper type handling
- `check(strict=False)` (L509): Validate metadata completeness and field values
- `todict()` (L553): Export as dict with underscore field names

### Metadata (L610-1063) 
Modern metadata class supporting 2.0+ specifications. Wraps LegacyMetadata for backward compatibility.

Key methods:
- `__init__(path/fileobj/mapping)` (L655): Auto-detect format and parse accordingly
- `get_requirements(reqts, extras, env)` (L837): Resolve conditional dependencies
- `validate()` (L913): Ensure metadata compliance
- `write(path, legacy=False)` (L1021): Output in JSON or legacy format
- `add_requirements(requirements)` (L1047): Append to run requirements

## Key Functions

### Version Detection
- `_best_version(fields)` (L136): Auto-detect optimal metadata version from field usage
- `_version2fieldlist(version)` (L118): Get valid fields for metadata version

### Utilities  
- `_get_name_and_version(name, version, for_filename)` (L232): Format distribution identifier

## Critical Constants

### Field Specifications (L55-114)
Version-specific field lists: `_241_FIELDS`, `_314_FIELDS`, `_345_FIELDS`, `_426_FIELDS`, `_566_FIELDS`, `_643_FIELDS`

### Field Categories (L213-226)
- `_LISTFIELDS`: Multi-value fields like Platform, Classifier
- `_UNICODEFIELDS`: Text fields requiring encoding handling  
- `_PREDICATE_FIELDS`: Dependency specification fields
- `_VERSION_FIELDS`: Version constraint fields

## Dependencies
- `email.message_from_file`: Parse PKG-INFO format
- `json`: Handle modern JSON metadata
- `.markers.interpret`: Evaluate environment markers
- `.version.get_scheme`: Version validation
- `.util.extract_by_key`, `get_extras`: Utility functions

## Key Patterns
- **Dual Format Support**: Metadata class delegates to LegacyMetadata when needed
- **Field Validation**: Type coercion and syntax validation on set operations
- **Version Negotiation**: Auto-detect best metadata version from field usage
- **Conditional Dependencies**: Support for extras and environment markers

## Encoding
All metadata uses UTF-8 encoding (`PKG_INFO_ENCODING = 'utf-8'`)