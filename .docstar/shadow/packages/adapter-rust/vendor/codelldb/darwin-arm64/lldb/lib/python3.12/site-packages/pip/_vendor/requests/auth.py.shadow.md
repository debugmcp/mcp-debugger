# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/requests/auth.py
@source-hash: 905ef9b6a9cb72d6
@generated: 2026-02-09T17:59:04Z

## Purpose and Responsibility
Implements HTTP authentication mechanisms for the Requests library, providing Basic, Proxy Basic, and Digest authentication handlers. Each handler modifies request headers to include proper authentication credentials.

## Key Classes and Functions

### `AuthBase` (L69-74)
Abstract base class defining the authentication interface. All concrete auth handlers inherit from this and must implement `__call__(self, r)` to modify requests.

### `HTTPBasicAuth` (L76-97)
Implements HTTP Basic Authentication using username/password credentials.
- `__init__(username, password)` (L79-81): Stores credentials
- `__call__(r)` (L94-96): Adds "Authorization" header with base64-encoded credentials
- `__eq__/__ne__` (L83-92): Enables comparison of auth instances

### `HTTPProxyAuth` (L99-105)
Extends HTTPBasicAuth for proxy authentication. Only difference is using "Proxy-Authorization" header instead of "Authorization" (L103).

### `HTTPDigestAuth` (L107-314)
Complex digest authentication implementation with thread-safe state management.
- `__init__(username, password)` (L110-114): Sets up threading.local() for per-thread state
- `init_per_thread_state()` (L116-124): Initializes thread-local variables (nonce tracking, challenge data)
- `build_digest_header(method, url)` (L126-234): Core digest computation supporting MD5, SHA-1, SHA-256, SHA-512 algorithms
- `handle_401(r, **kwargs)` (L241-283): Processes 401 responses, extracts challenge, rebuilds request with digest
- `handle_redirect(r, **kwargs)` (L236-239): Resets auth attempt counter on redirects
- `__call__(r)` (L285-303): Sets up response hooks and handles request body positioning

### Helper Functions

### `_basic_auth_str(username, password)` (L25-66)
Creates Basic Auth header string with backward compatibility handling for non-string inputs. Includes deprecation warnings for Requests 3.0.0 breaking changes.

## Key Dependencies
- `hashlib`: Cryptographic hashing for digest auth
- `threading`: Thread-local storage for digest auth state
- `base64.b64encode`: Basic auth credential encoding
- `.utils.parse_dict_header`: Parsing WWW-Authenticate challenges
- `.cookies.extract_cookies_to_jar`: Cookie handling in auth redirects

## Important Patterns

### Thread Safety
HTTPDigestAuth uses `threading.local()` to maintain separate state per thread, preventing race conditions in concurrent usage.

### Authentication Flow
Digest auth implements a two-request flow: initial request triggers 401, handler parses challenge and resends with proper digest.

### Request Modification
All auth handlers follow the callable pattern - they receive a request object, modify it (usually headers), and return it.

## Critical Invariants
- Digest auth limits to 2 authentication attempts per request (`num_401_calls < 2`)
- Basic auth encodes credentials as latin1 before base64 encoding
- Thread-local state must be initialized before use in digest auth
- Request body position tracking for digest auth retry mechanism