# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/cachecontrol/heuristics.py
@source-hash: 2187b84261c4456b
@generated: 2026-02-09T17:58:45Z

## Purpose
HTTP cache control heuristics implementation for pip's cachecontrol system. Provides strategies for automatically adding cache headers to responses that lack explicit caching directives.

## Key Components

**Utility Functions:**
- `expire_after(delta, date)` (L18-20): Calculates expiration datetime by adding timedelta to current or provided date
- `datetime_to_header(dt)` (L23-24): Converts datetime to HTTP date header format using RFC compliant formatting

**Base Class:**
- `BaseHeuristic` (L27-57): Abstract base for all caching heuristics
  - `warning(response)` (L28-37): Returns HTTP warning header for cached responses
  - `update_headers(response)` (L39-46): Hook for adding cache headers (returns empty dict by default)  
  - `apply(response)` (L48-57): Main entry point that applies headers and warning to response

**Heuristic Implementations:**

- `OneDayCache` (L60-74): Simple 1-day cache strategy
  - Only adds expires/cache-control if no existing expires header
  - Uses response date header as baseline for expiration calculation

- `ExpiresAfter` (L77-91): Configurable fixed-duration caching
  - Constructor accepts timedelta kwargs for flexible duration
  - Always adds expires/cache-control headers regardless of existing headers
  - Custom warning message includes configured duration

- `LastModified` (L94-151): RFC 7234 compliant freshness heuristic
  - `cacheable_by_default_statuses` (L107-119): Set of HTTP status codes eligible for caching
  - Complex freshness calculation based on last-modified age (L121-151)
  - Uses 10% of last-modified age as freshness lifetime, capped at 24 hours
  - Multiple validation checks: existing headers, status code, required headers presence
  - No warning header (returns None from warning method)

## Dependencies
- Standard library: `calendar`, `time`, `datetime`, `email.utils`
- External: `pip._vendor.urllib3.HTTPResponse` (type checking only)

## Key Patterns
- Template method pattern: BaseHeuristic defines skeleton, subclasses implement specifics
- Defensive programming: Multiple validation checks before applying heuristics
- HTTP specification compliance: Follows RFC 7234 caching guidelines

## Constants
- `TIME_FMT` (L15): Standard HTTP date format string for header formatting