# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_internal/utils/logging.py
@source-hash: c520df20745fcbde
@generated: 2026-02-09T17:58:45Z

## Purpose
Provides pip's internal logging infrastructure with advanced formatting, indentation, rich text support, and comprehensive logging configuration. Manages thread-safe log indentation and robust error handling for broken stdout streams.

## Core Components

### Exception Handling
- `BrokenStdoutLoggingError` (L35-38): Custom exception for stdout pipe breaks during logging
- `_is_broken_pipe_error()` (L41-51): Cross-platform broken pipe detection with Windows-specific EINVAL/EPIPE handling

### Thread-Safe Indentation System
- `_log_state` (L31): Thread-local storage for indentation state
- `indent_log()` (L54-66): Context manager for nested log indentation with automatic cleanup
- `get_indentation()` (L69-70): Thread-safe indentation level retrieval

### Formatters
- `IndentingFormatter` (L73-121): Custom formatter that respects indentation context and adds optional timestamps
  - `get_message_start()` (L91-105): Adds appropriate prefixes (WARNING:/ERROR:) while avoiding duplication with deprecation messages
  - `format()` (L107-121): Applies indentation and timestamps to all log lines

### Rich Text Support
- `IndentedRenderable` (L124-137): Dataclass wrapper for Rich renderables with indentation support
- `RichPipStreamHandler` (L140-197): Custom Rich-based handler with pip-specific styling
  - `emit()` (L153-179): Handles both rich renderables and standard messages with color coding (red for errors, yellow for warnings)
  - `handleError()` (L181-197): Converts broken stdout pipes to `BrokenStdoutLoggingError` for graceful handling

### File Handling
- `BetterRotatingFileHandler` (L200-203): Enhanced rotating file handler that auto-creates parent directories

### Filters
- `MaxLevelFilter` (L206-211): Excludes messages above specified level
- `ExcludeLoggerFilter` (L214-222): Inverted filter that excludes specific logger hierarchies

## Configuration System
- `setup_logging()` (L225-346): Comprehensive logging configuration function
  - Maps verbosity levels (-3 to 2+) to logging levels (CRITICAL to DEBUG)
  - Configures multiple handlers: console (stdout), console_errors (stderr), console_subprocess (stderr), optional user_log file
  - Sets up filters to route subprocess logs separately and control message levels
  - Uses dictConfig for complex handler/filter/formatter relationships

## Dependencies
- `pip._vendor.rich.*`: Rich text rendering and console output
- `pip._internal.utils._log`: Custom VERBOSE level and logger
- `pip._internal.utils.compat`: Platform detection (WINDOWS)
- `pip._internal.utils.deprecation`: Deprecation message prefix handling

## Key Globals
- `subprocess_logger` (L32): Dedicated logger for subprocess output routing

## Architecture Notes
- Thread-local storage ensures indentation safety in concurrent scenarios
- Rich integration provides enhanced terminal output with color and formatting
- Separate handlers for different output streams and log sources
- Robust error handling prevents logging failures from crashing pip