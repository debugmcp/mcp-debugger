# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_internal/locations/
@generated: 2026-02-09T18:16:15Z

## Overall Purpose and Responsibility

The `locations` module provides pip's core file system path resolution infrastructure, abstracting installation directory determination across different Python implementations, platforms, and distribution environments. It serves as a unified interface between legacy distutils and modern sysconfig backends while handling extensive platform-specific compatibility issues and distribution patches.

## Key Components and Architecture

### Layered Backend Architecture

**Base Layer (`base.py`)**
- Provides fundamental platform utilities and Python environment detection
- Handles cross-platform path manipulation via `change_root()`
- Determines installation contexts (virtualenv vs system Python)
- Caches expensive platform detection operations (macOS framework detection)

**Backend Implementations**
- **`_sysconfig.py`**: Modern sysconfig-based path resolution with sophisticated scheme inference
- **`_distutils.py`**: Legacy distutils-based resolution with setuptools conflict handling

**Unified Interface (`__init__.py`)**
- Orchestrates backend selection using `_should_use_sysconfig()` logic
- Provides extensive distribution-specific compatibility shims
- Implements facade pattern with comprehensive error handling and logging

### Distribution Compatibility Layer

The module contains extensive detection logic for handling distribution-specific Python patches:
- **Red Hat/CentOS**: lib64 directory handling and prefix patching
- **Debian/Ubuntu**: APT package detection and purelib/platlib path corrections  
- **Slackware**: lib64 inconsistency management
- **MSYS2 MINGW**: Windows subsystem path handling
- **macOS Framework**: Command Line Tools vs system Python differentiation

## Public API Surface

### Primary Entry Points

**`get_scheme(dist_name, user=False, home=None, root=None, isolated=False, prefix=None)`**
- Central path resolution function returning complete `Scheme` object
- Handles all installation contexts with parameter validation
- Applies distribution-specific compatibility fixes

**Individual Path Functions**
- `get_bin_prefix()`: Binary/script installation directories
- `get_bin_user()`: User-specific binary directories (sysconfig only)
- `get_purelib()`: Pure Python library installation paths
- `get_platlib()`: Platform-specific library installation paths

### Key Data Structures

**`Scheme` Object (from `pip._internal.models.scheme`)**
- Contains: platlib, purelib, headers, scripts, data paths
- Unified representation across backend implementations

## Internal Organization and Data Flow

### Backend Selection Flow
1. `_should_use_sysconfig()` determines backend based on Python version and environment
2. Routes calls to appropriate backend (`_sysconfig.py` or `_distutils.py`)
3. Applies compatibility shims and distribution-specific fixes
4. Returns standardized `Scheme` objects

### Path Resolution Strategy
1. **Scheme Inference**: Platform-aware scheme selection with fallback hierarchy
2. **Distribution Detection**: Extensive platform and distribution-specific detection
3. **Path Computation**: Backend-specific path calculation with override logic
4. **Compatibility Fixes**: Post-processing for known distribution issues
5. **Caching**: LRU caching for expensive detection and path operations

### Special Case Handling
- **Virtual Environments**: Custom header path logic and prefix detection
- **macOS Framework**: Special scheme switching between framework and posix
- **Windows**: Script directory resolution with fallback patterns
- **User Installations**: Platform-specific user directory determination

## Important Patterns and Conventions

### Error Handling Strategy
- Graceful degradation with comprehensive logging via `_warn_if_mismatch()`
- Exception types: `InvalidSchemeCombination`, `UserInstallationInvalid`, `InstallationError`
- Defensive programming against encoding issues and missing directories

### Caching and Performance
- Extensive use of `@functools.lru_cache` for expensive operations
- Cached detection functions for distribution and platform identification
- Single computation of global backend selection flag

### Compatibility Philosophy
- Maintains backward compatibility with distutils while migrating to sysconfig
- Handles multiple Python implementation quirks (CPython, PyPy)
- Extensive platform-specific workarounds with detailed documentation

This module is essential for pip's cross-platform functionality, ensuring consistent package installation behavior across the diverse Python ecosystem while accommodating numerous distribution-specific modifications and edge cases.