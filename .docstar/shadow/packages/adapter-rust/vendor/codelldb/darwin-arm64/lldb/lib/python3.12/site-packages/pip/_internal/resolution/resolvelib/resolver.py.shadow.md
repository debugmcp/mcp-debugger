# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_internal/resolution/resolvelib/resolver.py
@source-hash: 9cb24eb15304562d
@generated: 2026-02-09T17:57:25Z

**Primary Purpose**: Implements pip's dependency resolver using the resolvelib library for determining the correct versions and installation order of Python packages.

**Core Architecture**:
- **Resolver (L38-183)**: Main resolver class inheriting from BaseResolver
  - Orchestrates dependency resolution by coordinating Factory, PipProvider, and resolvelib's RLResolver
  - Supports three upgrade strategies: "eager", "only-if-needed", "to-satisfy-only" (L39)
  - Key method: `resolve()` (L73-183) - transforms root requirements into a RequirementSet
  - Key method: `get_installation_order()` (L185-214) - returns topologically sorted install order

**Key Dependencies**:
- `pip._vendor.resolvelib`: Third-party constraint satisfaction solver
- `Factory`: Creates candidates and handles package metadata
- `PipProvider`: Adapts pip's requirements model to resolvelib interface
- `RequirementSet`: Container for resolved install requirements

**Resolution Process** (L73-183):
1. Collect root requirements via factory (L76)
2. Create PipProvider with constraints and upgrade strategy (L77-83)
3. Select reporter based on PIP_RESOLVER_DEBUG env var (L84-87)
4. Run resolvelib solver with 200,000 round limit (L94-97)
5. Handle ResolutionImpossible exceptions (L99-104)
6. Process candidates, handling extras and reinstallation logic (L111-176)
7. Prepare linked requirements and mark as prepared (L179-182)

**Reinstallation Logic** (L129-158):
- Force reinstall if `--force-reinstall` flag set
- Reinstall if version differs from installed
- Reinstall if editable status differs
- Special handling for local wheels vs other file:// sources

**Topological Sorting**:
- `get_topological_weights()` (L217-303): Assigns depth-based weights for installation ordering
- Uses leaf-pruning optimization for large graphs (performance fix for 200+ packages)
- `_req_set_item_sorter()` (L306-317): Sort key function using weights and canonical names

**Critical Constraints**:
- Resolution complexity limited to 200,000 rounds to prevent infinite loops
- Packages with extras processed after base packages to ensure proper dependency handling
- Topological ordering ensures dependencies installed before dependents