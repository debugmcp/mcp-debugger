# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/distlib/manifest.py
@source-hash: dea7e6026570c51a
@generated: 2026-02-09T17:59:02Z

## File Purpose
A file manifest system for Python package distributions, providing functionality to collect, filter, and manage lists of files based on glob patterns and MANIFEST.in-style directives. This is distlib's improved replacement for distutils.filelist.

## Key Dependencies
- `fnmatch` (L11): Pattern matching for glob operations
- `os`, `re`, `sys` (L13-15): File system operations, regex compilation, Python version detection
- `.compat.fsdecode` (L18): File system path decoding utility
- `.util.convert_path` (L19): Path normalization utility

## Core Class: Manifest (L38-384)

**Purpose**: Maintains a collection of files discovered through filesystem traversal and filtered via pattern-based directives.

**Key Attributes**:
- `base` (L50): Absolute base directory for file discovery
- `prefix` (L51): Base directory with trailing separator for path operations
- `allfiles` (L52): Complete list of discovered files (lazy-loaded)
- `files` (L53): Filtered set of selected files

### Public Methods

**`__init__(base=None)` (L44-53)**: Initializes manifest with optional base directory (defaults to cwd).

**`findall()` (L59-84)**: Recursively discovers all regular files under base directory using stack-based traversal. Populates `allfiles` with absolute paths. Skips symbolic links to directories to avoid loops.

**`add(item)` (L86-94)**: Adds single file path to manifest, normalizing relative paths against base directory.

**`add_many(items)` (L96-103)**: Batch addition of multiple file paths.

**`sorted(wantdirs=False)` (L105-125)**: Returns lexicographically sorted file list. If `wantdirs=True`, includes parent directories via recursive `add_dir` helper (L110-116).

**`clear()` (L127-130)**: Resets both `files` and `allfiles` collections.

**`process_directive(directive)` (L132-194)**: Core directive processor supporting MANIFEST.in commands:
- `include/exclude` (L152-159): Pattern-based file selection/removal with anchoring
- `global-include/global-exclude` (L161-169): Unanchored pattern matching
- `recursive-include/recursive-exclude` (L171-179): Directory-scoped pattern matching
- `graft/prune` (L181-189): Directory tree inclusion/exclusion

### Private Methods

**`_parse_directive(directive)` (L200-245)**: Parses and validates directive syntax, returning tuple of (action, patterns, thedir, dir_pattern). Supports default 'include' action for bare patterns.

**`_include_pattern(pattern, anchor=True, prefix=None, is_regex=False)` (L247-286)**: Adds matching files from `allfiles` to `files`. Lazy-loads `allfiles` if needed. Returns boolean indicating if files were found.

**`_exclude_pattern(pattern, anchor=True, prefix=None, is_regex=False)` (L288-306)**: Removes matching files from `files`. Iterates over copy to allow safe modification during iteration.

**`_translate_pattern(pattern, anchor=True, prefix=None, is_regex=False)` (L308-361)**: Converts shell patterns to compiled regex objects. Handles Python version differences in fnmatch.translate behavior (L323-332). Complex prefix handling for directory-scoped patterns (L335-353).

**`_glob_to_re(pattern)` (L363-384)**: Enhanced glob-to-regex conversion that prevents '*' and '?' from matching path separators, unlike standard fnmatch.translate.

## Global Constants
- `_COLLAPSE_PATTERN` (L27): Regex for collapsing line continuations
- `_COMMENTED_LINE` (L28): Regex for removing comments
- `_PYTHON_VERSION` (L35): Python version tuple for compatibility handling

## Architecture Notes
- Lazy loading of file discovery for performance
- Version-specific regex handling for Python 2.7/3.2+ compatibility
- Platform-aware path separator handling in regex patterns
- Stack-based directory traversal avoids recursion depth issues
- Defensive copying in exclusion operations prevents iteration errors

## Critical Invariants
- All paths stored as absolute, normalized paths
- `files` is always a subset of `allfiles` after pattern operations
- Base directory must be absolute and normalized
- Pattern anchoring respects filesystem boundaries (no separator matching)