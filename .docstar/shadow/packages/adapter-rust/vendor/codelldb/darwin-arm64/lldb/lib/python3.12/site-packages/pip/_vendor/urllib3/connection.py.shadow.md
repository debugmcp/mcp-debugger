# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/urllib3/connection.py
@source-hash: f7693db5dff2e0f1
@generated: 2026-02-09T17:59:28Z

## Purpose
Provides HTTP and HTTPS connection classes for urllib3, extending Python's standard httplib/http.client with additional features like SSL verification, proxy support, chunked encoding, and connection configuration options.

## Core Classes

### HTTPConnection (L76-284)
Enhanced HTTP connection class extending http.client.HTTPConnection with backward compatibility and additional configuration:

**Key Attributes:**
- `default_port = 80` (L102)
- `default_socket_options` - TCP_NODELAY enabled by default (L106)  
- `is_verified = False` (L109) - SSL verification status
- `proxy_is_verified = None` (L113) - Proxy SSL verification status

**Key Methods:**
- `__init__()` (L115-130) - Accepts socket_options, source_address, proxy config
- `host` property (L132-159) - Strips trailing dots from FQDN for SSL compatibility
- `_new_conn()` (L161-190) - Creates socket connection with timeout/error handling
- `connect()` (L204-206) - Establishes connection via _new_conn() and _prepare_conn()
- `putrequest()` (L208-219) - Validates HTTP method for control characters
- `putheader()` (L221-229) - Handles SKIP_HEADER functionality  
- `request()` (L231-244) - Adds default User-Agent header if missing
- `request_chunked()` (L246-283) - Implements HTTP chunked transfer encoding

### HTTPSConnection (L286-533)
HTTPS connection class extending HTTPConnection with SSL/TLS support:

**Key Attributes:**
- `default_port = 443` (L292)
- SSL certificate configuration: `cert_reqs`, `ca_certs`, `ssl_version` etc. (L294-300)
- `tls_in_tls_required = False` (L300) - For proxy tunneling

**Key Methods:**
- `__init__()` (L302-326) - Accepts SSL context, certificates, server hostname
- `set_cert()` (L328-359) - Configures SSL certificates and verification (one-time call)
- `connect()` (L361-477) - Complex SSL connection with certificate verification, system time checks, hostname matching
- `_connect_tls_proxy()` (L479-533) - Establishes TLS connection through proxy

## Key Functions

### `_match_hostname()` (L536-555)
Performs SSL certificate hostname verification with IP address normalization. Catches CertificateError and attaches peer certificate for inspection.

### `_get_default_user_agent()` (L558-559)
Returns default User-Agent string "python-urllib3/{version}".

## Important Constants

- `port_by_scheme` (L67) - Default ports for HTTP/HTTPS
- `RECENT_DATE` (L71) - System time validation threshold (2022-01-01)
- `_CONTAINS_CONTROL_CHAR_RE` (L73) - Regex for HTTP method validation

## Architecture Patterns

**Cross-Platform Compatibility:** Handles Python 2/3 differences and SSL availability gracefully (L17-44)

**SSL Context Management:** Creates default SSL contexts when none provided, loads OS default certificates on supported platforms

**Proxy Support:** Handles both HTTP and TLS-in-TLS proxy connections with separate verification states

**Error Handling:** Converts socket errors to urllib3-specific exceptions (ConnectTimeoutError, NewConnectionError)

**Header Management:** Implements SKIP_HEADER pattern for conditional header inclusion

## Dependencies
- `ssl_wrap_socket` from util.ssl_ for SSL socket wrapping
- `create_urllib3_context` for default SSL contexts  
- `connection.create_connection` for socket creation
- Various urllib3.exceptions for error handling