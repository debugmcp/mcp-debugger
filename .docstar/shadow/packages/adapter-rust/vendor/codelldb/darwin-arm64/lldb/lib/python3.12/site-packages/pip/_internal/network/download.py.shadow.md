# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_internal/network/download.py
@source-hash: ad9adb8ba39d635f
@generated: 2026-02-09T17:58:35Z

## Primary Purpose
HTTP file download functionality for pip package manager with progress indicators, content-disposition parsing, and batch downloading capabilities.

## Key Components

### Utility Functions
- `_get_http_response_size()` (L24-28): Extracts content-length from HTTP response headers, returns None if unavailable
- `sanitize_content_filename()` (L73-77): Security function that strips directory paths from filenames using `os.path.basename`
- `parse_content_disposition()` (L80-92): Parses Content-Disposition headers to extract filenames, with fallback to default
- `_get_http_response_filename()` (L95-113): Determines optimal filename from HTTP response headers, Content-Disposition, MIME types, or URL extensions
- `_http_get_download()` (L116-120): Creates streaming HTTP GET request with pip headers

### Core Download Logic
- `_prepare_download()` (L31-70): Central orchestration function that:
  - Handles PyPI vs external URL display logic (L38-41)
  - Manages progress bar display conditions based on log level, cache status, and file size (L53-62)
  - Returns either raw chunks or progress-wrapped chunks (L64-70)

### Download Classes
- `Downloader` (L123-151): Single file downloader
  - `__call__()` (L132-151): Downloads one link to specified location, handles NetworkConnectionError
  - Returns tuple of (filepath, content_type)

- `BatchDownloader` (L154-187): Multiple file downloader
  - `__call__()` (L163-187): Generator that yields (link, (filepath, content_type)) tuples
  - Identical error handling and download logic to single downloader

## Key Dependencies
- `pip._vendor.requests`: HTTP client functionality and CONTENT_CHUNK_SIZE constant
- `pip._internal.network.session.PipSession`: Configured HTTP session with pip-specific settings
- `pip._internal.cli.progress_bars`: Progress rendering system
- `pip._internal.models.link.Link`: URL/link abstraction with PyPI domain detection

## Architectural Patterns
- **Strategy Pattern**: Progress bar rendering based on conditions (file size >40KB, cache status, log level)
- **Template Method**: Both downloader classes share identical download workflow but differ in iteration/yielding
- **Security**: Content-Disposition filename sanitization prevents directory traversal attacks
- **Streaming**: Uses chunked downloads to handle large files without memory exhaustion

## Critical Constraints
- Progress bars only shown for files >40KB that aren't cached and when log level â‰¤ INFO
- PyPI files use `show_url` for logging while others use `url_without_fragment`
- All downloads are streamed with configurable chunk size
- NetworkConnectionError assertions expect non-None response objects