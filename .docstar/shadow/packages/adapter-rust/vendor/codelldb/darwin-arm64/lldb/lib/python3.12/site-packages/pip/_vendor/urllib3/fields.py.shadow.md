# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/urllib3/fields.py
@source-hash: 92f2c30a0fc9987d
@generated: 2026-02-09T17:59:21Z

## Purpose
HTTP form field formatting utilities for multipart/form-data encoding in urllib3. Handles content-type detection, header parameter formatting per RFC standards, and request field construction.

## Key Functions

**guess_content_type(filename, default) (L10-21)**
- Determines MIME type from filename using Python's mimetypes module
- Falls back to "application/octet-stream" if detection fails
- Returns first element of mimetypes.guess_type() tuple or default

**format_header_param_rfc2231(name, value) (L24-63)**
- Formats header parameters according to RFC 2231 for non-ASCII values
- Handles Python 2/3 compatibility with six.binary_type checks
- First attempts simple quoting, falls back to RFC 2231 encoding for special chars
- Uses email.utils.encode_rfc2231 for proper encoding

**format_header_param_html5(name, value) (L95-119)**
- Alternative formatting using HTML5 multipart strategy
- Escapes problematic characters using _HTML5_REPLACEMENTS mapping
- More permissive than RFC 2231, matches modern browser behavior

**_replace_multiple(value, needles_and_replacements) (L82-92)**
- Internal utility for bulk string replacements using regex
- Builds single pattern from replacement keys, applies via substitution function

## Key Classes

**RequestField (L126-274)**
- Container for multipart form field data and metadata
- Stores name, data, filename, headers, and header formatter
- Key methods:
  - `from_tuples()` (L159-193): Factory method supporting tuple formats (filename, data, content_type)
  - `_render_part()` (L195-206): Delegates to header_formatter for parameter formatting
  - `_render_parts()` (L208-228): Formats multiple header parameters with semicolon separation
  - `render_headers()` (L230-247): Generates complete header block with specific ordering
  - `make_multipart()` (L249-274): Configures headers for multipart/form-data encoding

## Constants

**_HTML5_REPLACEMENTS (L66-79)**
- Character escape mapping for HTML5 header formatting
- Includes quote escaping (%22) and backslash doubling
- Auto-generates control character escapes (0x00-0x1F except 0x1B)

## Dependencies
- email.utils: RFC 2231 parameter encoding
- mimetypes: Content-type detection
- re: Pattern matching for replacements
- .packages.six: Python 2/3 compatibility layer

## Architecture Notes
- Dual formatting strategies: RFC 2231 (strict) vs HTML5 (permissive)
- format_header_param aliased to HTML5 version for backward compatibility (L123)
- Extensive Python 2/3 compatibility handling throughout
- Header ordering prioritizes Content-Disposition, Content-Type, Content-Location