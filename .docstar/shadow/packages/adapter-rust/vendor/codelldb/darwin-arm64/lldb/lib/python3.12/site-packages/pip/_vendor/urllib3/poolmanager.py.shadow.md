# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/urllib3/poolmanager.py
@source-hash: 696ca15d1b4d3b82
@generated: 2026-02-09T17:59:24Z

## Purpose
High-level HTTP connection pool management for urllib3, providing transparent pool caching and proxy support. Manages multiple ConnectionPool instances automatically based on host/scheme/port combinations.

## Key Classes

### PoolManager (L140-422)
Primary connection pool manager that inherits from RequestMethods. Automatically creates, caches, and reuses HTTP/HTTPS connection pools based on request destinations.

**Key Methods:**
- `__init__(num_pools=10, headers=None, **connection_pool_kw)` (L171): Initializes with RecentlyUsedContainer for pool caching
- `connection_from_host(host, port=None, scheme="http", pool_kwargs=None)` (L225): Gets/creates pool for specific host/port/scheme
- `connection_from_context(request_context)` (L248): Gets pool from normalized request context dictionary
- `connection_from_pool_key(pool_key, request_context=None)` (L263): Core pool retrieval with thread-safe caching
- `urlopen(method, url, redirect=True, **kw)` (L353): Main request method with redirect handling and proxy awareness
- `_new_pool(scheme, host, port, request_context=None)` (L189): Factory method for creating new connection pools
- `clear()` (L216): Empties all cached pools

### ProxyManager (L424-536)
Extends PoolManager for proxy-aware requests. Routes all traffic through specified proxy with CONNECT tunnel support for HTTPS.

**Key Methods:**
- `__init__(proxy_url, num_pools=10, headers=None, proxy_headers=None, proxy_ssl_context=None, use_forwarding_for_https=False, **connection_pool_kw)` (L464): Configures proxy settings and validates proxy URL
- `connection_from_host(host, port=None, scheme="http", pool_kwargs=None)` (L501): Overrides to route HTTP through proxy, HTTPS through target
- `urlopen(method, url, redirect=True, **kw)` (L526): Adds proxy-specific headers when not using CONNECT tunnels

## Key Data Structures

### PoolKey (L73)
Named tuple containing all fields needed to uniquely identify a connection pool: scheme, host, port, SSL config, timeouts, etc. Used as cache key.

### ProxyConfig (L76)
Named tuple with proxy-specific configuration: `ssl_context` and `use_forwarding_for_https`.

## Important Functions

### _default_key_normalizer (L79-125)
Normalizes request context into PoolKey for cache lookup. Lowercases scheme/host per RFC 3986, converts mutable objects (dicts, lists) to immutable equivalents (frozensets, tuples).

### proxy_from_url (L539)
Convenience factory function that creates ProxyManager from URL string.

## Global Configuration

- `SSL_KEYWORDS` (L28): Tuple of SSL-related parameter names
- `key_fn_by_scheme` (L132): Maps schemes to key normalization functions
- `pool_classes_by_scheme` (L137): Maps schemes to ConnectionPool classes
- `_key_fields` (L42): Complete list of PoolKey fields with type annotations

## Key Dependencies
- RecentlyUsedContainer for LRU pool caching
- HTTPConnectionPool/HTTPSConnectionPool for actual connections  
- RequestMethods mixin for HTTP method support
- parse_url for URL parsing and validation
- connection_requires_http_tunnel for proxy tunnel logic

## Threading
Thread-safe pool access via `self.pools.lock` in `connection_from_pool_key` (L271).

## Redirect Handling
Complex redirect logic in `urlopen` with RFC 9110 compliance (method changes, header stripping, retry management).