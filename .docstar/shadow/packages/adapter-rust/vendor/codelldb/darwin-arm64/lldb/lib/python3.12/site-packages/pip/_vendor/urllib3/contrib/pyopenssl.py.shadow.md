# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/urllib3/contrib/pyopenssl.py
@source-hash: 843261e0c87263fa
@generated: 2026-02-09T17:57:36Z

## Purpose
Provides PyOpenSSL-based TLS/SSL support for urllib3 as an alternative to Python's standard SSL library, enabling SNI support and certificate verification in older Python versions. **DEPRECATED**: Module is marked for removal in urllib3 2.x.

## Key Components

### Public API
- `inject_into_urllib3()` (L130): Monkey-patches urllib3 to use PyOpenSSL instead of standard SSL
- `extract_from_urllib3()` (L143): Reverts the monkey-patching to restore original SSL behavior
- `HAS_SNI = True` (L93): Constant indicating SNI support is always available with PyOpenSSL

### Core Classes

#### `PyOpenSSLContext` (L423-514)
SSL context wrapper that translates Python's SSLContext interface to PyOpenSSL calls.
- `__init__(protocol)` (L430): Creates OpenSSL context with protocol mapping
- `wrap_socket()` (L485): Creates SSL connections with SNI support
- Properties: `options` (L436), `verify_mode` (L445)
- Methods: `set_ciphers()` (L456), `load_verify_locations()` (L461), `load_cert_chain()` (L473)

#### `WrappedSocket` (L276-409)
Compatibility wrapper around PyOpenSSL's Connection class to match Python socket API.
- `recv()` (L300): Handles various SSL exceptions and timeouts
- `recv_into()` (L325): Alternative receive method with buffer
- `sendall()` (L362): Chunked sending with SSL_WRITE_BLOCKSIZE (16KB limit)
- `getpeercert()` (L384): Returns certificate info including subject alternative names
- Reference counting for PyPy GC: `_reuse()` (L401), `_drop()` (L404)

### Utility Functions
- `get_subj_alt_name(peer_cert)` (L223): Extracts Subject Alternative Names from certificates using cryptography library
- `_dnsname_to_stdlib(name)` (L180): Converts DNS names to stdlib format with IDNA encoding
- `_validate_dependencies_met()` (L154): Verifies cryptography and pyOpenSSL versions

## Protocol Mappings
- `_openssl_versions` (L96): Maps urllib3/ssl protocols to PyOpenSSL methods
- `_stdlib_to_openssl_verify` (L112): Certificate verification mode translations
- Dynamic protocol support detection for TLS 1.1/1.2 and SSLv3 (L102-109)

## Dependencies
- OpenSSL.crypto, OpenSSL.SSL: PyOpenSSL bindings
- cryptography: X.509 certificate handling and IDNA support
- Fallback UnsupportedExtension class for cryptography >= 2.1.0 compatibility (L55-60)

## Architecture Patterns
- Monkey-patching strategy to transparently replace urllib3's SSL backend
- Adapter pattern wrapping PyOpenSSL to match Python SSL API
- Cross-platform compatibility handling for Python 2/3 file objects (L67-71, L411-420)
- Exception translation between PyOpenSSL and Python SSL error types