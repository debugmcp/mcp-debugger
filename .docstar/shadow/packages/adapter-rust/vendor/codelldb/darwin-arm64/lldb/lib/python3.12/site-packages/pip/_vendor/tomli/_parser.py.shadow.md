# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/tomli/_parser.py
@source-hash: 83df8435a00b4be0
@generated: 2026-02-09T17:59:24Z

## TOML Parser Implementation

Core TOML parser module providing parsing functionality for TOML configuration files. Implements the complete TOML specification with comprehensive error handling and position tracking.

### Primary Components

**Main Parser Functions (L57-133)**
- `load()` (L57): Parses TOML from binary file, handles encoding detection
- `loads()` (L69): Main parsing function, processes TOML string with statement-by-statement parsing loop
- Uses character-level parsing with position tracking for precise error reporting

**Parser State Management**
- `Flags` class (L135): Tracks namespace states (FROZEN, EXPLICIT_NEST) to prevent redefinition violations
- `NestedDict` class (L193): Manages nested dictionary structure with list handling
- `Output` class (L227): Named tuple combining data and flags for parser state

**Key Parsing Functions**
- `parse_key()` (L373): Handles dotted keys with whitespace skipping
- `parse_key_part()` (L391): Parses individual key components (bare, quoted)
- `parse_key_value_pair()` (L357): Complete key=value parsing with validation
- `key_value_rule()` (L323): Validates and applies key-value assignments with namespace checks

**Value Type Parsers**
- `parse_value()` (L584): Central dispatcher for all value types with performance-optimized ordering
- `parse_array()` (L412): Handles arrays with comma separation and trailing comma support
- `parse_inline_table()` (L436): Parses inline tables with immutability enforcement
- String parsers: `parse_basic_str()` (L552), `parse_literal_str()` (L512), `parse_multiline_str()` (L521)
- `parse_basic_str_escape()` (L468): Handles escape sequences including Unicode

**Table/Array of Tables**
- `create_dict_rule()` (L284): Creates [table] sections with conflict detection
- `create_list_rule()` (L302): Creates [[array.of.tables]] with namespace management

### Character Sets and Constants (L22-50)
Defines TOML-specific character validation sets:
- Illegal characters for strings, comments
- Whitespace definitions (TOML_WS, TOML_WS_AND_NEWLINE)
- Key character sets (BARE_KEY_CHARS, KEY_INITIAL_CHARS)
- Escape sequence mappings (BASIC_STR_ESCAPE_REPLACEMENTS)

### Utility Functions
- `skip_chars()`, `skip_until()` (L232, L241): Position advancement with validation
- `skip_comment()`, `skip_comments_and_array_ws()` (L263, L275): Comment and whitespace handling
- `suffixed_err()` (L652): Creates positioned error messages with line/column info
- `make_safe_parse_float()` (L673): Decorator preventing float parser from returning invalid types

### Error Handling
- `TOMLDecodeError` (L53): Custom exception with position information
- Comprehensive validation at each parsing step with descriptive error messages
- Position tracking throughout parsing for precise error location reporting

### Dependencies
- Regex patterns from `._re` module for datetime/number matching
- Type definitions from `._types` (Key, ParseFloat, Pos)
- Uses `MappingProxyType` for immutable mappings

### Architecture Notes
- Single-pass parser with lookahead for syntax disambiguation
- Immutability enforcement for inline structures prevents modification after creation
- Namespace conflict detection prevents TOML specification violations
- Performance-optimized value type detection order in `parse_value()`