# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_internal/network/cache.py
@source-hash: e3c03def5a82cca3
@generated: 2026-02-09T17:58:33Z

## Primary Purpose
Thread-safe HTTP cache implementation for pip's network layer. Provides a file-based cache that gracefully handles filesystem access failures and race conditions between concurrent processes.

## Key Components

### Utility Functions
- `is_from_cache(response)` (L17-18): Checks if Response object came from cache via `from_cache` attribute
- `suppressed_cache_errors()` (L22-29): Context manager that catches and suppresses OSError exceptions to allow graceful cache failures

### SafeFileCache Class (L32-106)
Main cache implementation extending `SeparateBodyBaseCache`. Stores cache entries as separate metadata and body files to handle large responses efficiently.

**Key Methods:**
- `__init__(directory)` (L50-53): Initializes with cache directory path, asserts non-None directory
- `_get_cache_path(name)` (L55-61): Generates hierarchical file paths using first 5 chars of encoded name as subdirectories
- `get(key)` (L63-71): Retrieves metadata, validates both metadata and body files exist before returning
- `set(key, value, expires=None)` (L82-86): Stores metadata using atomic write operations
- `get_body(key)` (L95-102): Returns body file handle, validates both files exist
- `set_body(key, body)` (L104-106): Stores response body separately
- `delete(key)` (L88-93): Removes both metadata and body files
- `_write(path, data)` (L73-80): Atomic write using temporary file and replace operation

## Dependencies
- `cachecontrol`: Third-party HTTP cache library (SeparateBodyBaseCache, SeparateBodyFileCache)
- `requests`: HTTP library for Response objects
- Internal pip utilities: `filesystem.adjacent_tmp_file`, `filesystem.replace`, `misc.ensure_dir`

## Architecture Patterns
- **Atomic Operations**: Uses temporary files + rename for crash-safe writes
- **Graceful Degradation**: All cache operations wrapped with error suppression
- **Race Condition Mitigation**: Validates both metadata and body files exist before considering entry valid
- **Hierarchical Storage**: Creates subdirectory structure based on cache key hash

## Critical Invariants
- Cache entries are only valid when BOTH metadata and body files exist
- All filesystem operations must be wrapped with `suppressed_cache_errors()`
- Cache directory must not be None
- Assumes server returns identical data for same URL (immutable content assumption for pip packages)