# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/distlib/compat.py
@source-hash: 527fae201bf2d36c
@generated: 2026-02-09T17:58:55Z

## Purpose
Compatibility shim module for pip's distlib package that provides unified APIs across Python 2/3 versions. Handles import differences, missing standard library features, and provides fallback implementations for older Python versions.

## Key Architecture
- **Version Detection**: Uses `sys.version_info[0] < 3` (L19) to branch between Python 2 and 3 imports
- **Fallback Pattern**: Try/except ImportError blocks provide backport implementations when standard library features are unavailable
- **Unified Interface**: Exposes consistent names regardless of underlying Python version

## Core Compatibility Areas

### URL/HTTP Libraries (L19-88)
- **Python 2**: Imports from `urllib`, `urllib2`, `urlparse`, `httplib` (L20-48)
- **Python 3**: Imports from `urllib.parse`, `urllib.request`, `urllib.error`, `http.client` (L63-87)
- **quote() wrapper** (L30-33): Handles Unicode encoding for Python 2

### SSL Certificate Validation (L89-186)
- **CertificateError** (L93-94): Exception class when ssl module lacks it
- **_dnsname_match()** (L96-143): RFC 6125 compliant DNS name matching with wildcard support
- **match_hostname()** (L145-185): Certificate hostname verification following RFC 2818/6125

### Container Classes (L187-909)
- **Container** (L192-198): SimpleNamespace alternative for older Python versions
- **ZipFile Context Manager** (L271-302): Adds context manager support to ZipFile for Python 2.6
- **ChainMap** (L525-627): Backport of collections.ChainMap for older Python versions
- **OrderedDict** (L660-909): Full backport implementation using doubly-linked list

### Utility Functions (L203-474)
- **which()** (L205-266): Command location utility with Windows PATHEXT support
- **python_implementation()** (L308-316): Detects Python implementation (CPython, PyPy, Jython, IronPython)
- **callable()** (L322-327): Fallback for removed Python 3.0-3.1 builtin
- **fsencode/fsdecode** (L331-362): Filesystem encoding conversion with fallback encoding detection
- **detect_encoding()** (L383-473): PEP 263 encoding detection for source files

### Logging Configuration (L911-1138)
- **ConvertingDict/List/Tuple** (L931-1003): Self-converting containers for configuration
- **BaseConfigurator** (L1005-1138): Configuration value converter with ext:// and cfg:// protocol support

## Dependencies
- Standard library modules: `os`, `re`, `shutil`, `sys`, `ssl` (optional)
- Conditional imports based on Python version and availability

## Key Patterns
- **Progressive Fallbacks**: Multiple try/except blocks for different Python versions
- **Protocol Unification**: Same interface names across Python 2/3 despite different underlying modules
- **Backport Completeness**: Full implementations (not stubs) of missing stdlib features

## Critical Constraints
- **Thread Safety**: OrderedDict uses thread-local state via `_get_ident()` (L651-653)
- **SSL Validation**: Certificate matching enforces max 1 wildcard per DNS fragment (L108-115)
- **Encoding Robustness**: Filesystem encoding defaults to 'utf-8' when system returns None (L340)