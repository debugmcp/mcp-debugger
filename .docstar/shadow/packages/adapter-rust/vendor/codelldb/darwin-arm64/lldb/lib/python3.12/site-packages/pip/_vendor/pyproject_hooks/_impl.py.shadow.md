# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/pyproject_hooks/_impl.py
@source-hash: eb5189c73422a742
@generated: 2026-02-09T17:59:00Z

## Purpose
Implementation of PEP 517/518 build backend hook caller that executes Python packaging build backends in isolated subprocess environments. Provides a standardized interface for invoking build system hooks like `build_wheel`, `build_sdist`, and metadata preparation.

## Key Classes and Functions

### Exception Classes (L23-48)
- `BackendUnavailable` (L23-27): Raised when build backend cannot be imported
- `BackendInvalid` (L29-35): Raised for invalid backend configurations  
- `HookMissing` (L37-42): Raised when required hooks are missing from backend
- `UnsupportedOperation` (L44-48): Raised when backend doesn't support requested operation

### Subprocess Runners (L50-72)
- `default_subprocess_runner` (L50-60): Standard subprocess execution with output
- `quiet_subprocess_runner` (L62-72): Suppresses subprocess output using STDOUT redirect

### Path Validation (L74-96)
- `norm_and_check` (L74-96): Validates and normalizes backend paths, ensuring they remain within source tree boundaries using `os.path.commonprefix` comparison

### Core Class: BuildBackendHookCaller (L98-330)
Primary orchestrator for build backend interactions.

**Constructor** (L102-132):
- Accepts source directory, build backend spec, optional backend path, subprocess runner, and Python executable
- Validates and normalizes backend paths using `norm_and_check`
- Defaults to `sys.executable` and `default_subprocess_runner`

**Context Manager** (L133-149):
- `subprocess_runner`: Temporarily overrides subprocess runner for specific operations

**Build Hook Methods** (L155-295):
- `get_requires_for_build_wheel/editable/sdist`: Returns dependency requirements
- `prepare_metadata_for_build_wheel/editable`: Prepares dist-info metadata with fallback support
- `build_wheel/editable/sdist`: Executes actual build operations
- `_supported_features` (L151-153): Queries backend capabilities

**Core Hook Execution** (L297-330):
- `_call_hook`: Manages subprocess communication via temporary JSON files
- Sets environment variables `PEP517_BUILD_BACKEND` and `PEP517_BACKEND_PATH`
- Uses `_in_process._in_proc_script_path()` for script execution
- Parses JSON responses and raises appropriate exceptions based on error conditions

## Dependencies
- `_in_process`: Provides `_in_proc_script_path()` for subprocess script execution
- Standard library: `json`, `tempfile`, `subprocess`, `os`, `contextlib`

## Architecture Patterns
- **Subprocess Isolation**: All backend operations execute in separate Python processes
- **JSON Communication**: Input/output via temporary JSON files in `tempfile.TemporaryDirectory`
- **Fallback Support**: Metadata preparation methods support fallback to full wheel builds
- **Environment Isolation**: Custom environment variables for backend configuration
- **Path Security**: Strict validation prevents directory traversal attacks

## Critical Constraints
- Backend paths must be relative and within source tree
- All directory paths are converted to absolute paths before subprocess calls
- Error handling maps JSON response fields to specific exception types
- Temporary directories automatically cleaned up via context managers