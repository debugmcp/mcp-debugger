# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/pygments/lexer.py
@source-hash: 2077bd79988a4c5c
@generated: 2026-02-09T17:59:14Z

## Core Lexer Infrastructure for Pygments Syntax Highlighting

This module provides the foundational lexer classes that power Pygments' syntax highlighting system. It implements a hierarchical lexer architecture with metaclass-driven token preprocessing and state machine capabilities.

### Primary Classes

**LexerMeta (L37-46)**: Metaclass that automatically wraps `analyse_text` methods as static methods returning floats, enabling lexer confidence scoring for automatic language detection.

**Lexer (L49-284)**: Abstract base lexer class providing core functionality:
- Text preprocessing with encoding detection and normalization (L202-249)
- Filter chain support for token post-processing (L177-183) 
- Configuration options: stripnl, stripall, ensurenl, tabsize, encoding (L160-165)
- Abstract `get_tokens_unprocessed()` method that subclasses must implement (L275-284)
- `get_tokens()` method that applies preprocessing and filters (L251-273)

**RegexLexerMeta (L496-661)**: Complex metaclass for regex-based lexers that:
- Processes token definitions into compiled regex patterns (L502-506)
- Handles state inheritance and combination across class hierarchies (L601-648)
- Validates token types and state transitions (L508-547)
- Supports special state actions: #pop, #push, combined states (L514-547)

**RegexLexer (L664-759)**: Stateful regex-based lexer using a state stack:
- Maintains state stack starting with 'root' (L675-697)
- Token definitions as `{state: [(regex, token, new_state), ...]}` format (L697)
- State machine execution in `get_tokens_unprocessed()` (L699-759)
- Automatic error token generation for unmatched text (L747-758)

**ExtendedRegexLexer (L777-846)**: Context-aware variant using LexerContext objects for position tracking, enabling more sophisticated parsing scenarios.

**DelegatingLexer (L287-318)**: Composite lexer that processes text with two lexers - a language lexer first, then a root lexer for unmatched tokens.

### Helper Classes and Functions

**LexerContext (L761-774)**: Position tracking helper storing text, position, end, and state stack.

**State Manipulation Classes**:
- `include(str)` (L326-330): References rules from another state
- `_inherit/_inherit()` (L333-340): Inherits superclass state definitions  
- `combined(tuple)` (L343-354): Combines multiple states into one
- `default` (L468-477): Default state action when no patterns match
- `words(Future)` (L480-493): Optimized regex generation for word lists

**Action Functions**:
- `bygroups(*args)` (L383-406): Applies different actions to regex groups
- `using(_other, **kwargs)` (L418-465): Delegates to another lexer
- `_PseudoMatch` (L356-381): Mock match object for recursive lexing

**Utility Functions**:
- `do_insertions(insertions, tokens)` (L849-910): Merges token streams from sublexers

### Profiling Support

**ProfilingRegexLexer (L935-961)**: Drop-in replacement that instruments regex execution timing for performance analysis.

### Key Architecture Patterns

1. **Metaclass-driven preprocessing**: Token definitions are processed at class creation time for optimal runtime performance
2. **State inheritance**: Subclasses can inherit and extend parent lexer states using special markers
3. **Pluggable filters**: Token streams can be post-processed through filter chains
4. **Encoding flexibility**: Automatic encoding detection with BOM handling and fallbacks
5. **Recursive lexing**: Support for embedding one lexer within another via `using()` and `DelegatingLexer`

### Dependencies

Core dependencies: re, sys, time, plus Pygments modules for filters, tokens, utilities, and regex optimization.

### Critical Invariants

- State stacks must never be empty (minimum 'root' state maintained)
- Token types must be _TokenType instances or callables
- Regex compilation errors are wrapped with context information
- Position tracking must be maintained for proper token stream generation