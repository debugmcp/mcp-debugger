# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/rich/cells.py
@source-hash: 68c9862b80635e18
@generated: 2026-02-09T17:59:04Z

## Purpose and Responsibility

This module provides Unicode-aware cell width calculations for terminal display, handling East Asian characters that occupy two cells and combining/control characters that occupy zero cells. Essential for Rich library's terminal text layout and alignment.

## Key Functions

### Core Cell Width Functions
- `get_character_cell_size(character)` (L48-57): Returns cell count (0, 1, or 2) for a single character using Unicode codepoint lookup
- `_get_codepoint_cell_size(codepoint)` (L61-86): Core binary search implementation against CELL_WIDTHS lookup table
- `cached_cell_len(text)` (L14-28): LRU-cached version that calculates total cell width for strings
- `cell_len(text)` (L31-44): Primary API for getting text cell width with performance optimization for strings <512 chars

### Text Manipulation Functions  
- `set_cell_size(text, total)` (L89-122): Truncates or pads text to exact cell width using binary search for precision
- `chop_cells(text, width)` (L124-158): Splits text into lines that fit within specified cell width

## Dependencies and Data

- `CELL_WIDTHS` from `._cell_widths`: Lookup table of Unicode ranges with their cell widths
- `_is_single_cell_widths` (L10): Regex for fast-path detection of common single-cell characters

## Performance Patterns

- Heavy use of `@lru_cache` decorators (L13, L47, L60) with 4096 entry limits for character-level caching
- Fast-path optimization in `cell_len` for strings under 512 characters
- Fast-path optimization in `set_cell_size` for ASCII-range text using regex check
- Binary search algorithms for both Unicode lookup and text truncation

## Critical Invariants

- Cell widths: 0 (combining/control), 1 (normal), 2 (East Asian wide)
- Width -1 in lookup table maps to 0 cells (control characters)
- Default fallback is 1 cell for characters not in lookup table
- Binary search maintains bounds correctly with inclusive range checks