# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/urllib3/contrib/ntlmpool.py
@source-hash: 3657e45bb58c756f
@generated: 2026-02-09T17:57:30Z

## Purpose and Responsibility

Implements NTLM authentication for HTTPS connection pools in urllib3. This deprecated module provides Windows domain authentication capabilities by extending HTTPSConnectionPool with NTLM handshake functionality. **Module is deprecated and will be removed in urllib3 v2.0** (L16-22).

## Key Components

### NTLMConnectionPool (L27-130)
Main class extending HTTPSConnectionPool to provide NTLM authentication:

**Constructor** `__init__(self, user, pw, authurl, *args, **kwargs)` (L34-46):
- Parses domain\username format into separate domain and user fields (L43-45)
- Stores authentication URL, raw user, domain (uppercase), username, and password
- Calls parent HTTPSConnectionPool constructor

**Connection Creation** `_new_conn(self)` (L48-113):
- Implements full NTLM authentication handshake
- Creates HTTPS connection and performs 3-step authentication:
  1. Sends NTLM negotiation message (L66-68)
  2. Parses server challenge response (L82-90, L93-95)
  3. Sends authentication response with credentials (L96-99)
- Validates authentication success (200 response) or raises exceptions (L106-109)
- Manipulates response objects to keep sockets open (L79, L111)
- Extensive debug logging throughout process

**URL Opening** `urlopen()` (L115-130):
- Overrides parent method to ensure "Keep-Alive" connection header
- Delegates to parent implementation with modified headers

## Dependencies and Relationships

- **Parent Class**: HTTPSConnectionPool from `..` (urllib3 core)
- **NTLM Library**: `ntlm.ntlm` for cryptographic operations (L11)
- **HTTP Client**: HTTPSConnection from six.moves.http_client (L14)
- **Logging**: Uses module-level logger (L24)

## Architectural Patterns

- **Template Method**: Overrides `_new_conn()` to inject NTLM authentication before connection use
- **State Management**: Maintains authentication state through persistent connection sockets
- **Error Handling**: Specific exception handling for authentication failures vs. other HTTP errors

## Critical Constraints

- **Socket Lifecycle**: Must keep sockets open between authentication and actual requests (L78-79, L111)
- **Authentication Flow**: Requires exact 3-step NTLM handshake sequence
- **Domain Format**: Expects Windows domain\username format for user parameter
- **HTTPS Only**: Hardcoded scheme="https" (L32)
- **Deprecation**: Module scheduled for removal, not recommended for new implementations