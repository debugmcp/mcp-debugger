# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/rich/segment.py
@source-hash: 854d6e79e5ea23a6
@generated: 2026-02-09T17:59:22Z

## Rich Terminal Segment Core Module

**Primary Purpose**: Core implementation of terminal text segments with styling and control codes for the Rich text rendering library. Provides the fundamental building blocks for console output with ANSI escape sequences.

### Key Classes

**ControlType (L35-53)**: IntEnum defining terminal control codes (BELL, cursor movement, screen control, etc.) that map to ANSI escape sequences.

**Segment (L64-534)**: NamedTuple representing a piece of styled text with optional control codes. Core rendering unit containing:
- `text` (str): The actual text content
- `style` (Optional[Style]): Visual styling information
- `control` (Optional[Sequence[ControlCode]]): Terminal control sequences

Key methods:
- `cell_length` (L82-89): Calculates terminal cell width, returns 0 for control segments
- `split_cells()` (L148-168): Splits segment at specified column, handling wide characters
- `_split_cells()` (L111-146): Cached internal splitting logic with wide character support
- `apply_style()` (L176-214): Applies base and post styles to segment iterables
- `filter_control()` (L217-233): Filters segments by control flag
- `split_lines()` (L236-262): Splits segments on newlines into line lists
- `split_and_crop_lines()` (L265-309): Splits and crops lines to specified length
- `adjust_line_length()` (L312-354): Crops/pads lines to exact width
- `get_line_length()` (L357-367): Calculates total cell length of segment line
- `get_shape()` (L370-381): Returns (width, height) of segment grid
- `set_shape()` (L384-417): Adjusts segment grid to specified dimensions
- `align_top/bottom/middle()` (L420-506): Vertical alignment utilities
- `simplify()` (L509-533): Combines adjacent segments with same style
- `strip_links/styles()` (L536-563): Removes styling attributes
- `remove_color()` (L566-585): Strips color while preserving other styles
- `divide()` (L588-654): Divides segments at specified cell positions

**Segments (L657-679)**: Simple renderable wrapper for segment iterables with optional newlines.

**SegmentLines (L682-704)**: Renderable wrapper for lists of segment lines with optional newlines.

### Dependencies
- `.cells`: Cell width calculation and Unicode handling
- `.style`: Style objects for text formatting
- `.repr`: Rich representation support

### Architecture Notes
- Heavy use of caching (`@lru_cache`) for performance on split operations
- Cell-aware text handling for proper Unicode/wide character support
- Functional style with many classmethods for segment processing
- Optimized fast paths for single-cell width text
- Control segments bypass normal text length calculations

### Critical Invariants
- Control segments always report 0 cell length
- Wide character splits preserve display width by padding with spaces
- Style combination follows precedence: base + segment.style + post_style
- Line processing preserves segment boundaries and styling