# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/urllib3/contrib/_securetransport/
@generated: 2026-02-09T18:16:10Z

## Purpose
The `_securetransport` package provides a complete Apple SecureTransport backend implementation for urllib3's SSL/TLS operations on macOS platforms. This is a low-level adapter that enables urllib3 to leverage native macOS cryptographic frameworks instead of OpenSSL, providing better system integration and potentially enhanced security through platform-native APIs.

## Key Components and Architecture

### Package Structure
- **`__init__.py`**: Package marker enabling importability
- **`bindings.py`**: Core ctypes bindings to Security and CoreFoundation frameworks
- **`low_level.py`**: High-level wrapper functions and utilities built on top of bindings

### Component Relationships
The package follows a layered architecture:
1. **`bindings.py`** provides direct ctypes access to ~50 macOS C APIs from Security.framework and CoreFoundation.framework
2. **`low_level.py`** builds Python-friendly utilities on top of these bindings, handling memory management, data conversion, and error handling
3. Higher-level urllib3 components (not in this directory) consume the low-level utilities

### Platform Integration
- **Platform Lock**: Strict macOS-only operation with version validation (10.8+ required)
- **Framework Access**: Direct binding to system Security.framework and CoreFoundation.framework
- **Dynamic Loading**: Handles macOS version differences in library paths, with special handling for Big Sur (10.16+)

## Public API Surface

### Primary Entry Points (from low_level.py)
- **Certificate Operations**: `_cert_array_from_pem()`, `_load_client_cert_chain()`
- **Data Conversion**: `_cf_data_from_bytes()`, `_cfstr()`, `_cf_string_to_unicode()`
- **Keychain Management**: `_temporary_keychain()`, `_load_items_from_file()`
- **Error Handling**: `_assert_no_error()`, `_build_tls_unknown_ca_alert()`
- **Protocol Support**: `TLS_PROTOCOL_VERSIONS` mapping

### Low-Level Bindings (from bindings.py)
- **SSL Context Management**: `SSLCreateContext`, `SSLHandshake`, `SSLRead`/`SSLWrite`
- **Certificate Operations**: `SecCertificateCreateWithData`, `SecTrustEvaluate`
- **Memory Management**: `CFRetain`/`CFRelease` with proper reference counting
- **Constants**: Comprehensive SSL protocol versions, error codes, and cipher suites

## Internal Organization and Data Flow

### Memory Management Pattern
Critical architecture feature: All CoreFoundation objects require explicit memory management. The package implements exception-safe cleanup using try/finally blocks and automatic CFRelease calls. Objects are retained when added to collections and properly released to prevent memory leaks.

### Certificate Processing Flow
1. PEM certificates parsed via regex extraction
2. Base64 decoded and converted to CFData objects  
3. SecCertificate objects created from CFData
4. Certificates loaded into temporary keychains for SecIdentity creation
5. Complete certificate chains assembled for SSL context usage

### Error Translation
Security framework errors are translated to Python exceptions through `_assert_no_error()`, providing meaningful error messages while preserving error code information.

## Important Patterns and Conventions

### Exception Safety
All functions that create CoreFoundation objects implement proper cleanup paths to prevent memory leaks, even when exceptions occur during processing.

### Temporary Resources
The package uses temporary keychains with random passwords for certificate operations, ensuring isolation and automatic cleanup of sensitive cryptographic material.

### Type Safety  
Extensive use of ctypes type definitions ensures proper C API interaction, with explicit argument and return type specifications for all bound functions.

### Platform Validation
Runtime platform and version checks ensure the module only operates on supported macOS versions, failing fast with descriptive errors on unsupported platforms.

This package serves as the foundation for urllib3's native macOS SSL/TLS support, providing a complete abstraction over Apple's cryptographic frameworks while maintaining the security and performance benefits of platform-native implementations.