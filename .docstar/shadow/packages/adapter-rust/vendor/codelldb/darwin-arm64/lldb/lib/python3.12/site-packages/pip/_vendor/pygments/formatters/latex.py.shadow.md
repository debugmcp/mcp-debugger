# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/pygments/formatters/latex.py
@source-hash: 146cc9f98a924c4f
@generated: 2026-02-09T17:57:37Z

## Primary Purpose
LaTeX formatter for Pygments syntax highlighting library, converting tokenized source code into LaTeX markup suitable for the `fancyvrb` and `color` packages.

## Core Components

### Text Escaping
- `escape_tex(text, commandprefix)` (L22-40): Escapes LaTeX special characters by replacing them with custom command sequences using temporary placeholders to avoid conflicts during substitution.

### Template System
- `DOC_TEMPLATE` (L43-58): Complete LaTeX document template with configurable docclass, encoding, preamble, and content sections.
- `STYLE_TEMPLATE` (L98-132): Complex LaTeX macro system defining `\PY` command and style resolution mechanism. Uses token chaining with `+` separators and recursive macro expansion.

### Token Name Resolution
- `_get_ttype_name(ttype)` (L135-144): Maps Pygments token types to short names using STANDARD_TYPES lookup, with fallback to parent token hierarchy traversal.

### Main Formatter Class
**LatexFormatter** (L147-438):
- Inherits from Pygments Formatter base class
- **Configuration** (L256-277): Extensive option parsing including nowrap, full document mode, line numbers, command prefix, math/TeX escape modes
- **Style Generation** (L279-323): Creates LaTeX command definitions based on token styles, handling bold/italic/underline, colors, borders, and backgrounds using RGB color conversion
- **Style Output** (L324-334): `get_style_defs()` generates the complete macro definition block
- **Core Formatting** (L336-437): `format_unencoded()` processes token stream with special handling for:
  - Comments with TeX markup support (L360-397)
  - Math escape mode for `$...$` delimiters (L374-382)  
  - Custom escape sequences (L383-395)
  - Token hierarchy traversal and style application (L400-418)

### Embedded Lexer
**LatexEmbeddedLexer** (L440-521):
- Wraps another lexer to handle escaped LaTeX segments within code
- **Token Processing** (L457-474): Buffers and processes escape tokens separately from language tokens
- **Escape Detection** (L476-486): Identifies escape sequences outside of strings/comments
- **Token Filtering** (L488-503): Merges non-matching tokens while preserving structure
- **Escape Extraction** (L505-521): Partitions text on left/right delimiters, marking escaped content as Token.Escape

## Key Dependencies
- `pygments.formatter.Formatter`: Base formatter class
- `pygments.token`: Token types and STANDARD_TYPES mapping
- `pygments.util`: Option parsing utilities
- `pygments.lexer`: Lexer base and token insertion utilities

## Architecture Notes
- Uses two-phase character escaping to avoid conflicts during LaTeX special character replacement
- Implements hierarchical token style resolution similar to CSS class inheritance
- Supports multiple output modes: raw tokens, Verbatim environment, or complete document
- Complex macro system enables style customization while maintaining backward compatibility