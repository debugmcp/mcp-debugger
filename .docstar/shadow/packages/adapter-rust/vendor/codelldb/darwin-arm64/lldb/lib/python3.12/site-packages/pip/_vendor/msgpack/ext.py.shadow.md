# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/msgpack/ext.py
@source-hash: 7caa74d01a832e35
@generated: 2026-02-09T17:58:50Z

## Purpose
Extension types module for msgpack serialization, implementing MessagePack's extension type mechanism for custom data encoding. Provides `ExtType` for general extensions and `Timestamp` for msgpack timestamp extension type (-1).

## Key Classes

### ExtType (L6-16)
Immutable namedtuple representing msgpack extension types with validation:
- **Fields**: `code` (int 0-127), `data` (bytes) 
- **Validation**: Type checking and range validation in `__new__`
- **Purpose**: Container for arbitrary extension data in msgpack protocol

### Timestamp (L19-168)
Immutable timestamp representation for msgpack timestamp extension type:
- **Fields**: `seconds` (int, Unix epoch), `nanoseconds` (int, 0-999999999)
- **Slots**: `__slots__ = ["seconds", "nanoseconds"]` (L29) for memory efficiency
- **Equality/Hashing**: Full comparison and hash support (L57-68)

## Core Methods

### Serialization (Pure Python)
- `to_bytes()` (L97-116): Packs timestamp into 4/8/12 byte formats based on value ranges
- `from_bytes(b)` (L70-95): Unpacks timestamp from msgpack ext payload, handles 32/64/96-bit formats

### Unix Time Conversion
- `from_unix(unix_sec)` (L118-127): Creates from float/int Unix timestamp
- `to_unix()` (L129-135): Returns float Unix timestamp
- `from_unix_nano(unix_ns)` (L137-144): Creates from nanosecond precision
- `to_unix_nano()` (L146-152): Returns nanosecond precision integer

### DateTime Integration
- `to_datetime()` (L154-160): Converts to UTC datetime object
- `from_datetime(dt)` (L162-168): Creates from datetime with timezone

## Dependencies
- `collections.namedtuple`: Base for ExtType
- `datetime`: Timezone and datetime conversion support
- `struct`: Binary packing/unpacking for timestamp serialization

## Architecture Notes
- **Dual Implementation**: Code supports both Cython (C methods) and pure Python serialization
- **Format Optimization**: Timestamp uses variable-length encoding (32/64/96 bits) based on value ranges
- **Immutability**: Both classes designed as immutable value objects with validation
- **MessagePack Spec**: Implements official timestamp extension type (-1) specification