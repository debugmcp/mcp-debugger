# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/idna/core.py
@source-hash: 972869a1edafba51
@generated: 2026-02-09T17:58:56Z

## Primary Purpose
Core IDNA (Internationalized Domain Names in Applications) encoding/decoding implementation for handling Unicode domain names. Provides validation, normalization, and conversion between Unicode labels (U-labels) and ASCII-compatible encoding (A-labels) using Punycode.

## Key Classes and Exceptions
- **IDNAError (L12-14)**: Base exception for all IDNA-related problems
- **IDNABidiError (L17-19)**: Exception for bidirectional text requirements violations
- **InvalidCodepoint (L22-24)**: Exception for disallowed/unallocated codepoints
- **InvalidCodepointContext (L27-29)**: Exception for contextually invalid codepoints

## Core Functions

### Label Validation
- **check_label (L228-252)**: Main label validation orchestrator - checks NFC normalization, hyphen rules, combining characters, codepoint validity, and bidirectional requirements
- **check_bidi (L61-117)**: Implements Unicode bidirectional algorithm rules for RTL/LTR text mixing
- **check_nfc (L134-136)**: Ensures labels are in Unicode Normalization Form C
- **check_hyphen_ok (L126-131)**: Validates hyphen placement rules (no consecutive hyphens in positions 3-4, no leading/trailing hyphens)
- **check_initial_combiner (L120-123)**: Prevents labels from starting with combining characters

### Context Validation
- **valid_contextj (L139-183)**: Validates CONTEXTJ codepoints (Zero Width Non-Joiner 0x200C, Zero Width Joiner 0x200D) based on surrounding character joining properties
- **valid_contexto (L186-225)**: Validates CONTEXTO codepoints including middle dot (0x00B7), Greek lower numeral sign (0x0375), Hebrew punctuation, Japanese punctuation, and Arabic-Indic digits

### Encoding/Decoding
- **alabel (L255-271)**: Converts Unicode label to ASCII-compatible A-label using Punycode with 'xn--' prefix
- **ulabel (L274-300)**: Converts A-label back to Unicode U-label, handling Punycode decoding
- **encode (L335-365)**: High-level domain encoding - splits domain on dots, processes each label through alabel()
- **decode (L368-395)**: High-level domain decoding - splits domain and processes each label through ulabel()

### UTS46 Processing
- **uts46_remap (L303-332)**: Implements UTS46 Unicode mapping for transitional/non-transitional processing with STD3 rules support

### Utility Functions
- **_combining_class (L32-37)**: Gets Unicode combining class for codepoint validation
- **_is_script (L39-40)**: Checks if codepoint belongs to specified script using idnadata ranges
- **_punycode (L42-43)**: Simple Punycode encoding wrapper
- **_unot (L45-46)**: Formats codepoint as Unicode notation (U+XXXX)
- **valid_label_length (L49-52)**: Checks 63-byte label length limit
- **valid_string_length (L55-58)**: Checks 253/254-byte domain length limit

## Key Dependencies
- **idnadata module**: Contains codepoint classification tables, scripts, and joining types
- **uts46data module**: UTS46 mapping data for character remapping
- **intranges module**: Efficient codepoint range checking utilities
- **unicodedata**: Standard library for Unicode character properties
- **bisect**: Binary search for UTS46 data lookup

## Constants
- **_virama_combining_class = 9 (L8)**: Unicode combining class for virama characters
- **_alabel_prefix = b'xn--' (L9)**: Punycode A-label prefix
- **_unicode_dots_re (L10)**: Regex matching various Unicode dot characters for domain splitting

## Architecture Notes
- Follows RFC 5891 IDNA2008 specification with UTS46 compatibility
- Two-phase approach: validation then encoding/decoding
- Context-sensitive validation for ambiguous codepoints
- Supports both strict (ASCII dots only) and non-strict (Unicode dots) processing
- Bidirectional text handling per Unicode Bidirectional Algorithm
- Length validation at both label (63 bytes) and domain (253/254 bytes) levels