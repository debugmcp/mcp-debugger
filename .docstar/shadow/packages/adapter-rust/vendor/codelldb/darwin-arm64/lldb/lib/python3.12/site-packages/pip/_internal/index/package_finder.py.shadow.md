# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_internal/index/package_finder.py
@source-hash: 5c71d09b54e6c38c
@generated: 2026-02-09T17:58:39Z

This module implements pip's package finding and evaluation system for PyPI indexes.

**Core Purpose**: Finds, evaluates, and selects the best installation candidates for Python packages from PyPI repositories and other sources.

## Key Classes

### LinkEvaluator (L109-249)
Primary link evaluation engine that determines if a download link is a valid installation candidate.
- `evaluate_link()` (L157-249): Core method returning `(LinkType, detail)` tuple
- Validates format compatibility, wheel tags, Python version requirements
- Handles yanked packages, platform mismatches, and requires-python constraints
- Uses regex `_py_version_re` (L114) to parse embedded Python versions

### CandidateEvaluator (L377-578) 
Filters and ranks installation candidates based on compatibility and preferences.
- `create()` classmethod (L383-417): Factory with sensible defaults
- `get_applicable_candidates()` (L445-479): Filters by version specifiers and hashes
- `_sort_key()` (L481-548): Complex sorting logic prioritizing hashes, yanked status, binary preference
- `compute_best_candidate()` (L563-578): Returns `BestCandidateResult` with ranked candidates

### PackageFinder (L581-978)
Main facade orchestrating package discovery and candidate selection.
- `create()` classmethod (L627-657): Factory from `SelectionPreferences`
- `find_all_candidates()` (L799-850): LRU-cached discovery from indexes and find-links
- `find_best_candidate()` (L869-890): LRU-cached best candidate resolution
- `find_requirement()` (L892-977): High-level requirement resolution with upgrade logic

### BestCandidateResult (L337-375)
Container for candidate selection results with iteration methods for all/applicable candidates.

## Key Functions

- `_check_link_requires_python()` (L52-96): Validates Python version compatibility
- `filter_unallowed_hashes()` (L252-323): Hash-based candidate filtering
- `_find_name_version_sep()` (L980-1003): Canonical name matching for version extraction
- `_extract_version_from_fragment()` (L1006-1021): Version parsing from filenames

## Critical Data Structures

- `LinkType` enum (L99-106): Classification of link evaluation results
- `CandidatePreferences` dataclass (L326-335): Binary/prerelease preferences
- `CandidateSortingKey` type alias (L49): Complex tuple for candidate ranking
- `BuildTag` type alias (L48): Wheel build tag representation

## Architecture Patterns

**Separation of Concerns**: Link evaluation, candidate filtering, and package finding are distinct responsibilities.

**Caching Strategy**: LRU caches on `find_all_candidates()` and `find_best_candidate()` for performance.

**Factory Pattern**: Both `CandidateEvaluator.create()` and `PackageFinder.create()` provide convenient construction.

**Result Objects**: `BestCandidateResult` encapsulates complex selection outcomes.

## Dependencies

- Heavy reliance on `packaging` library for version parsing, specifiers, and wheel tags
- Integration with pip's internal models (`Link`, `InstallationCandidate`, `TargetPython`)
- Uses `LinkCollector` for fetching package index pages

## Critical Invariants

- Yanked packages only considered when `allow_yanked=True`
- Hash validation takes precedence over all other preferences
- File candidates prioritized over page candidates (L849-850)
- Version specifier compliance required for applicability