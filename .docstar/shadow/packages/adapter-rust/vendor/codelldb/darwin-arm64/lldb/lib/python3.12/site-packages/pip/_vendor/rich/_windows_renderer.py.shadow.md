# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/rich/_windows_renderer.py
@source-hash: b7be192f7c6e0c23
@generated: 2026-02-09T17:59:02Z

## Primary Purpose
Windows Console API renderer that translates Rich library segments into legacy Windows terminal operations. Bridges the gap between Rich's cross-platform rendering system and Windows-specific console APIs.

## Key Function
**`legacy_windows_render` (L7-56)**: Main rendering function that processes an iterable of Segment objects and translates them into appropriate Windows Console API calls via LegacyWindowsTerm.

### Processing Logic
- **Text Rendering (L14-19)**: Handles regular text segments, applying styles when present via `term.write_styled()` or plain text via `term.write_text()`
- **Control Code Processing (L20-56)**: Processes control sequences for cursor movement, line operations, and terminal state changes

### Supported Control Operations
- **CURSOR_MOVE_TO (L24-26)**: Absolute cursor positioning with 1-based to 0-based coordinate conversion
- **CARRIAGE_RETURN (L27-28)**: Writes literal "\r" character
- **HOME (L29-30)**: Moves cursor to top-left (0,0)
- **Directional Movement (L31-38)**: Up, down, forward, backward cursor operations
- **CURSOR_MOVE_TO_COLUMN (L39-41)**: Column positioning with 1-based to 0-based conversion
- **Cursor Visibility (L42-45)**: Hide/show cursor operations
- **Line Erasure (L46-53)**: Supports three modes - end of line (0), start of line (1), entire line (2)
- **SET_WINDOW_TITLE (L54-56)**: Updates terminal window title

## Key Dependencies
- **LegacyWindowsTerm**: Windows console API abstraction layer
- **WindowsCoordinates**: Coordinate system for Windows console positioning
- **Segment**: Rich library's rendering primitive containing text, style, and control data
- **ControlCode/ControlType**: Enums defining terminal control operations

## Architectural Decisions
- Uses tuple unpacking with type casting for control code parameter extraction
- Implements 1-based to 0-based coordinate system conversion for Windows compatibility
- Separates text rendering from control code processing for clarity
- Relies on external LegacyWindowsTerm for actual Windows API calls

## Critical Invariants
- Coordinate conversion: Display coordinates (1-based) â†’ Windows coordinates (0-based)
- Control codes are processed as sequences, allowing multiple operations per segment
- Style application is conditional on style presence to avoid unnecessary API calls