# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/urllib3/util/ssl_.py
@source-hash: 5f8f80a96f756983
@generated: 2026-02-09T17:57:38Z

## Primary Purpose
SSL/TLS utilities for urllib3 providing backward compatibility across Python versions and SSL implementations. Handles SSL context creation, socket wrapping, certificate verification, and platform-specific SSL feature detection.

## Key Components

### Module-Level SSL Feature Detection (L19-90)
- **SSLContext, SSLTransport, HAS_SNI, IS_PYOPENSSL, IS_SECURETRANSPORT** (L19-23): Platform capability flags set during import
- **HASHFUNC_MAP** (L27): Maps digest lengths to hash functions for fingerprint verification
- **PROTOCOL_TLS/PROTOCOL_SSLv23** (L62-77): TLS protocol version constants with fallback handling
- **SSL Option Constants** (L80-90): OpenSSL options like OP_NO_SSLv2, OP_NO_COMPRESSION with fallback values

### Cipher Configuration (L93-127)
- **DEFAULT_CIPHERS** (L110-127): Secure cipher suite string prioritizing forward secrecy (ECDHE/DHE), AES-GCM, and ChaCha20

### Core SSL Classes & Functions

#### SSLContext Backport (L133-179)
Fallback SSLContext implementation for older Python versions lacking native ssl.SSLContext:
- **__init__** (L134-143): Initializes with default SSL settings
- **load_cert_chain** (L145-147): Sets client certificate and key files
- **load_verify_locations** (L149-156): Sets CA certificate file (raises SSLError for unsupported capath/cadata)
- **wrap_socket** (L161-179): Wraps socket with warning about insecure platform

#### Certificate & Security Functions
- **_const_compare_digest_backport** (L30-40): Constant-time digest comparison for older Python versions
- **assert_fingerprint** (L182-208): Validates certificate fingerprints using configurable hash algorithms
- **resolve_cert_reqs** (L211-231): Converts string certificate requirements to ssl constants
- **resolve_ssl_version** (L234-247): Converts string SSL versions to protocol constants

#### SSL Context Creation
- **create_urllib3_context** (L250-352): Creates secure SSLContext with:
  - Disabled SSLv2/SSLv3/compression by default
  - Custom cipher suite configuration
  - Post-handshake authentication for TLS 1.3
  - SSL keylog file support via SSLKEYLOGFILE environment variable
  - Complex hostname verification logic

#### Socket Wrapping
- **ssl_wrap_socket** (L355-454): Main SSL socket wrapping function with:
  - SSL context creation or reuse
  - CA certificate loading from files/directories/data
  - Encrypted key file detection and handling
  - ALPN protocol negotiation
  - SNI hostname validation and IP address detection
  - TLS-in-TLS support via SSLTransport

### Utility Functions
- **is_ipaddress** (L457-467): Detects IPv4/IPv6 addresses using regex patterns, handles IDN A-labels
- **_is_key_file_encrypted** (L470-478): Detects encrypted private key files by searching for "ENCRYPTED" marker
- **_ssl_wrap_socket_impl** (L481-495): Internal wrapper handling TLS-in-TLS vs regular SSL socket creation

## Dependencies
- **ssl module**: Core SSL functionality with extensive import error handling
- **hashlib, hmac**: Cryptographic functions for fingerprint verification
- **urllib3.exceptions**: Custom exception types (SSLError, warnings)
- **urllib3.util.url**: IP address regex patterns
- **ssltransport**: Optional TLS-in-TLS transport layer

## Architecture Patterns
- **Progressive feature detection**: Extensive try/except blocks for SSL feature availability
- **Backward compatibility**: Fallback implementations for missing SSL features
- **Security-first defaults**: Secure cipher suites, disabled weak protocols, constant-time comparisons
- **Platform abstraction**: Unified interface across different Python/OpenSSL versions