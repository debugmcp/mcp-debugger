# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/packaging/_parser.py
@source-hash: b3f4ef4ef0cd2b43
@generated: 2026-02-09T17:58:53Z

## Purpose
Handwritten recursive descent parser for Python dependency specifiers and marker expressions using tokenization. Provides structured parsing of pip requirement strings into their components (name, version constraints, extras, URLs, environment markers).

## Key Classes & Data Structures

### AST Node Hierarchy (L15-42)
- `Node` (L15-27): Base class for AST nodes with value storage and serialization interface
- `Variable` (L29-31): Environment marker variables, serializes without quotes
- `Value` (L34-36): Literal values, serializes with quotes  
- `Op` (L39-41): Operators, serializes as-is

### Type Definitions (L44-47)
- `MarkerVar`: Union of Variable or Value nodes
- `MarkerItem`: Tuple representing marker comparison (var, op, var)
- `MarkerAtom`: Either MarkerItem or sequence of MarkerAtoms (recursive)
- `MarkerList`: Complex nested structure for marker expressions

### ParsedRequirement (L50-55)
NamedTuple containing parsed requirement components:
- `name`: Package identifier
- `url`: Direct URL if specified with @
- `extras`: List of optional dependencies
- `specifier`: Version constraints string
- `marker`: Environment marker expression or None

## Core Parsing Functions

### Requirement Parsing (L61-134)
- `parse_requirement()` (L61-62): Main entry point, creates tokenizer
- `_parse_requirement()` (L65-83): Parses full requirement structure
- `_parse_requirement_details()` (L86-134): Handles URL vs specifier branching
- `_parse_requirement_marker()` (L137-154): Parses semicolon-prefixed markers

### Component Parsers (L157-246)
- `_parse_extras()` (L157-173): Handles bracket-enclosed extra lists
- `_parse_extras_list()` (L176-200): Comma-separated identifier parsing
- `_parse_specifier()` (L203-217): Version specifier with optional parentheses
- `_parse_version_many()` (L220-246): Multiple comma-separated version constraints

### Marker Expression Parsing (L252-354)
- `parse_marker()` (L252-253): Entry point for standalone marker parsing
- `_parse_marker()` (L262-271): Handles boolean operators between atoms
- `_parse_marker_atom()` (L274-293): Parenthesized expressions or items
- `_parse_marker_item()` (L296-307): Variable-operator-variable triplets
- `_parse_marker_var()` (L310-321): Variables vs quoted strings
- `_parse_marker_op()` (L336-354): Comparison and membership operators

## Processing Functions (L324-333)
- `process_env_var()` (L324-328): Normalizes environment variable names
- `process_python_str()` (L331-333): Evaluates quoted string literals using ast.literal_eval

## Dependencies
- `._tokenizer`: Provides Tokenizer class and DEFAULT_RULES
- `ast`: For safe string literal evaluation
- `typing`: Type hints for complex nested structures

## Architecture Notes
- Uses recursive descent parsing with lookahead via peek operations
- Tokenizer handles low-level lexical analysis with context managers for paired tokens
- Error handling includes position tracking for meaningful syntax errors
- Grammar documented in EBNF-style comments within parsing functions
- Supports both URL-based and version-specifier-based requirements
- Environment markers use complex nested list structure for boolean expressions