# packages/adapter-rust/vendor/codelldb/darwin-arm64/lldb/lib/python3.12/site-packages/pip/_vendor/pygments/formatters/html.py
@source-hash: 89ab919942bb2a70
@generated: 2026-02-09T17:57:44Z

## HTML Formatter for Pygments Syntax Highlighting

This module implements HTML output formatting for syntax-highlighted code. It's the core HTML formatter in the Pygments library, providing comprehensive HTML generation with extensive customization options.

### Primary Components

**HtmlFormatter (L113-990)** - Main formatter class extending `Formatter`. Converts tokenized source code into styled HTML with configurable wrapping, line numbers, and CSS generation. Supports both inline styles and CSS classes.

**Utility Functions:**
- `escape_html(text, table)` (L38-40) - HTML entity escaping using translation table
- `webify(color)` (L43-47) - Converts color values to CSS format, handles calc() and var() functions  
- `_get_ttype_class(ttype)` (L50-59) - Maps token types to CSS class names using hierarchical naming

**Template Constants:**
- `CSSFILE_TEMPLATE` (L62-69) - CSS file wrapper template
- `DOC_HEADER` (L71-90) - Full HTML document header with embedded CSS
- `DOC_HEADER_EXTERNALCSS` (L92-105) - HTML header for external CSS files
- `DOC_FOOTER` (L107-110) - HTML document footer

### Key Methods

**Initialization & Configuration:**
- `__init__(**options)` (L411-458) - Processes 20+ formatting options including line numbers, CSS classes, ctags integration
- `_create_stylesheet()` (L484-506) - Builds internal CSS mappings from style definitions

**CSS Generation:**
- `get_style_defs(arg)` (L508-520) - Returns complete CSS definitions for highlighting
- `get_token_style_defs(arg)` (L522-537) - Generates CSS for token-specific styles
- `get_background_style_defs(arg)` (L539-560) - Creates background and highlight color CSS
- `get_linenos_style_defs()` (L562-571) - Line number styling CSS

**HTML Generation Pipeline:**
- `format_unencoded(tokensource, outfile)` (L953-990) - Main formatting orchestrator using generator pipeline
- `_format_lines(tokensource)` (L831-907) - Core tokenization to HTML conversion with ctags linking
- `wrap(source)` (L938-951) - Customizable wrapping point for subclassing

**Wrapper Methods (Generator Chain):**
- `_wrap_full(inner, outfile)` (L616-655) - Full HTML document generation with CSS file handling
- `_wrap_tablelinenos(inner)` (L657-722) - Table-based line numbering with filename support
- `_wrap_inlinelinenos(inner)` (L725-766) - Inline line number integration
- `_wrap_lineanchors(inner)` (L768-778) - Anchor tag generation for line linking
- `_wrap_linespans(inner)` (L780-788) - Span wrapper for JavaScript line access
- `_wrap_div(inner)` (L790-802) - Main container div with CSS classes/styles
- `_wrap_pre(inner)` (L804-819) - Pre-formatted code block wrapper
- `_wrap_code(inner)` (L821-824) - HTML5 code element wrapper

**Special Features:**
- `_highlight_lines(tokensource)` (L916-936) - Line highlighting for specified line numbers
- `_lookup_ctag(token)` (L909-914) - Ctags integration for definition linking
- `_translate_parts(value)` (L827-829) - Cached HTML escaping and line splitting

### Architecture Patterns

Uses **generator pipeline pattern** where each wrapper method takes an inner generator and yields `(code, text)` tuples. The `code` flag (0/1) distinguishes between source code lines and HTML wrapper content, enabling multiple sequential transformations.

**Caching strategy** with `@functools.lru_cache` on `_translate_parts` for performance optimization of repeated HTML escaping operations.

**Option validation** using utility functions (`get_bool_opt`, `get_int_opt`, `get_list_opt`) for robust configuration parsing.

### Dependencies

- `pip._vendor.pygments.formatter.Formatter` - Base formatter interface
- `pip._vendor.pygments.token` - Token type definitions and standards
- `ctags` (optional) - Code definition linking support
- Standard library: `functools`, `os`, `sys`, `io.StringIO`

### Critical Constraints

- Line number calculations must account for `linenostart` offset and `linenostep` intervals
- CSS class generation follows hierarchical token type inheritance
- Generator pipeline order affects final HTML structure (line numbers before highlighting)
- Ctags integration requires specific command-line options (`-n`) and UTF-8 encoding
- HTML entity escaping mandatory for all user-provided content