# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_internal/network/lazy_wheel.py
@source-hash: d8f5d576e6193c23
@generated: 2026-02-09T17:59:31Z

**Purpose:** Implements lazy HTTP-based ZIP file access for pip wheel installation, enabling efficient metadata extraction from remote wheel files without downloading entire packages.

**Core Components:**

- **HTTPRangeRequestUnsupported (L19-20):** Exception raised when HTTP range requests are not supported by the server
- **dist_from_wheel_url (L23-37):** Main entry point that creates a BaseDistribution from a wheel URL using lazy loading. Returns distribution metadata without full wheel download
- **LazyZipOverHTTP (L40-210):** File-like object that implements lazy ZIP access over HTTP using range requests

**LazyZipOverHTTP Key Methods:**
- **__init__ (L49-63):** Validates range request support, creates temporary file, checks ZIP validity
- **File I/O Interface (L66-132):** Implements standard file operations (read, seek, tell, truncate) with lazy downloading
- **_check_zip (L153-166):** Downloads chunks from end of file backward until valid ZIP structure is found
- **_download (L200-210):** Core download logic with interval merging to minimize HTTP requests
- **_merge (L178-198):** Optimizes download ranges by merging overlapping/adjacent intervals
- **_stream_response (L168-176):** Creates HTTP range request with proper headers

**Key Dependencies:**
- `pip._internal.metadata.MemoryWheel` for in-memory wheel representation
- `pip._internal.network.session.PipSession` for HTTP operations
- `zipfile.ZipFile` for ZIP file parsing
- `tempfile.NamedTemporaryFile` for local caching

**Architecture Pattern:**
Uses binary search (`bisect_left`/`bisect_right`) with interval tracking (`_left`/`_right` arrays) to efficiently manage downloaded byte ranges and minimize redundant HTTP requests.

**Critical Constraints:**
- Requires HTTP range request support (RFC 7233)
- Assumes ZIP files have metadata at the end (standard ZIP format)
- Uses temporary files for caching downloaded segments