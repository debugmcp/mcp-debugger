# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_vendor/rich/traceback.py
@source-hash: 094a7160b8d05886
@generated: 2026-02-09T18:00:21Z

## Primary Purpose

Rich's advanced traceback rendering system for Python exceptions. Provides enhanced, syntax-highlighted, customizable exception displays with local variable inspection and intelligent formatting.

## Key Components

### Core Classes

**Traceback (L211-720)**: Main renderable class for displaying enhanced tracebacks
- `__init__(L241-291)`: Configures rendering options (width, theme, locals display, frame limits)
- `from_exception(L292-360)`: Class method to create from exception info
- `extract(L362-485)`: Extracts structured traceback data from Python exceptions
- `__rich_console__(L487-563)`: Renders traceback with rich formatting and themes
- `_render_stack(L604-718)`: Renders individual stack frames with syntax highlighting
- `_render_syntax_error(L565-586)`: Special handling for SyntaxError display
- `_guess_lexer(L588-602)`: Determines appropriate Pygments lexer for syntax highlighting

### Data Structures

**Frame (L175-181)**: Represents single stack frame
- Contains filename, line number, function name, source line, and optional locals

**Stack (L184-199)**: Collection of frames for one exception
- Includes exception type/value, optional syntax error info, causality flag

**_SyntaxError (L184-190)**: Structured syntax error information
- Offset, filename, line content, line number, error message

**Trace (L202-204)**: Container for multiple exception stacks (for chained exceptions)

**PathHighlighter (L207-208)**: Regex highlighter for file paths

### Installation Function

**install(L48-172)**: Global exception handler installer
- Replaces `sys.excepthook` with rich traceback rendering
- Special IPython integration (L122-172) with custom traceback hooks
- Returns previous exception handler for restoration

## Key Features

- **Syntax Highlighting**: Uses Pygments for code syntax coloring
- **Local Variables**: Optional display of frame-local variables with pretty printing
- **Frame Filtering**: Supports suppressing specific modules/paths from display
- **Frame Limits**: Configurable maximum frames with ellipsis for large tracebacks
- **Chained Exceptions**: Handles `__cause__` and `__context__` exception chains
- **IPython Integration**: Specialized hooks for Jupyter/IPython environments
- **Rich Formatting**: Leverages Rich's rendering system for panels, columns, themes

## Architecture Patterns

- **Dataclass-based models** for structured exception data
- **Rich Console rendering protocol** via `__rich_console__`
- **Recursive exception traversal** for chained exceptions in `extract()`
- **Lazy code loading** using `linecache` for file content
- **Theme-based styling** with Pygments token mapping

## Critical Dependencies

- `pip._vendor.pygments`: Syntax highlighting lexers and tokens
- `pip._vendor.rich`: Console rendering, panels, syntax, themes
- `traceback.walk_tb`: Standard library traceback walking
- `linecache`: File content caching for source display

## Constants & Configuration

- `LOCALS_MAX_LENGTH = 10` (L44): Default container abbreviation limit
- `LOCALS_MAX_STRING = 80` (L45): Default string truncation limit  
- `LEXERS` dict (L233-239): File extension to lexer mapping
- `WINDOWS` flag (L42): Platform detection for rendering adjustments