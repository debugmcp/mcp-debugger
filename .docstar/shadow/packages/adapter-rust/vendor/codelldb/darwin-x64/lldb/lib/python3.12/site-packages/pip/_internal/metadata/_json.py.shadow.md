# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_internal/metadata/_json.py
@source-hash: 3f470026b1ff9ad9
@generated: 2026-02-09T17:59:25Z

## Purpose
Converts Python package metadata from RFC 5322 email message format to JSON-compatible dictionary format. Part of pip's internal metadata processing system, extracted from the pkg_metadata project.

## Key Components

### Constants
- **METADATA_FIELDS** (L7-34): Defines standard Python package metadata fields with their multiple-use flags. Maps to Core Metadata specification fields like Name, Version, Requires-Dist, etc.

### Functions
- **json_name(field)** (L37-38): Converts hyphenated field names to underscore format for JSON keys (e.g., "Metadata-Version" â†’ "metadata_version")

- **msg_to_json(msg)** (L41-84): Main conversion function that transforms email.message.Message objects to dictionaries
  - **sanitise_header(h)** (L44-58): Nested function handling encoding issues in message headers, with fallback UTF-8/latin1 decoding for "unknown-8bit" encoding
  - Processes both single-value and multi-value fields based on METADATA_FIELDS configuration
  - Special handling for keywords field (L71-77): accepts both comma and space-separated formats
  - Extracts message payload as description (L80-82)

## Dependencies
- `email.header`: Header decoding and encoding utilities
- `email.message`: Message object handling
- `typing`: Type annotations for Union, Dict, List, Any, cast

## Key Patterns
- Uses email module's RFC 5322 parsing capabilities for metadata extraction
- Defensive encoding handling with UTF-8/latin1 fallbacks
- Field normalization through json_name conversion
- Conditional processing based on multiple-use field flags
- Type casting for payload extraction

## Critical Behavior
- Maintains backwards compatibility with both comma and space-separated keywords
- Handles encoding edge cases in package metadata headers
- Only processes fields defined in METADATA_FIELDS constant
- Preserves multi-value semantics for applicable fields (Classifier, Requires-Dist, etc.)