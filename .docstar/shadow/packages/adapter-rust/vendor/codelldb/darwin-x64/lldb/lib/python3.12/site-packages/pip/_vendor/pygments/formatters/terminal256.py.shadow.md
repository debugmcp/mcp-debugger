# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_vendor/pygments/formatters/terminal256.py
@source-hash: d77489dc3e6915da
@generated: 2026-02-09T17:57:43Z

## Purpose
Terminal color formatters for Pygments syntax highlighting that output ANSI color sequences for 256-color and true-color terminals. Converts RGB colors from styles to nearest ANSI color codes or direct RGB sequences.

## Key Classes

### EscapeSequence (L34-96)
ANSI escape sequence builder with fg/bg colors and text attributes (bold, underline, italic).
- `color_string()` (L47): Generates 256-color ANSI sequences, handles special ansi* color names
- `true_color_string()` (L73): Generates 24-bit RGB ANSI sequences
- `reset_string()` (L87): Creates reset sequences to clear formatting

### Terminal256Formatter (L98-290)
Main formatter for 256-color terminals, extends Pygments Formatter.
- `_build_color_table()` (L152): Constructs RGB palette for 256 colors (16 basic + 216 cube + 24 grayscale)
- `_closest_color()` (L188): Finds nearest xterm color using Euclidean distance in RGB space
- `_color_index()` (L205): Maps style colors to xterm color indices, caches results
- `_setup_styles()` (L224): Pre-processes style definitions into cached ANSI sequences
- `format_unencoded()` (L252): Core formatting logic with token type inheritance fallback

### TerminalTrueColorFormatter (L293-338)  
Extends Terminal256Formatter for 24-bit color terminals.
- `_color_tuple()` (L314): Parses hex colors to RGB tuples
- `_setup_styles()` (L324): Uses true color sequences instead of palette mapping

## Architecture Patterns

**Color Conversion Pipeline**: Style color → hex parsing → RGB extraction → nearest palette match (256-color) or direct RGB (true-color)

**Token Type Inheritance**: Format loop tries exact token type match, falls back to parent types via `ttype.parent` until match found

**Line-by-Line Processing**: Handles newlines specially to reset ANSI codes for proper terminal paging

## Dependencies
- `pip._vendor.pygments.formatter.Formatter`: Base formatter class
- `pip._vendor.pygments.console.codes`: ANSI color code mappings  
- `pip._vendor.pygments.style.ansicolors`: Standard ANSI color name definitions

## Key Invariants
- Colors always reset at newlines for terminal compatibility
- Unstyled tokens output as plain text
- Color caching in `best_match` dict for performance
- Style attribute flags (`usebold`, `useunderline`, `useitalic`) control feature availability