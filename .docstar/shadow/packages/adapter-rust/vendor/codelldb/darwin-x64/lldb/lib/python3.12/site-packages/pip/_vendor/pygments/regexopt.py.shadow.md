# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_vendor/pygments/regexopt.py
@source-hash: 8e0d402e881c6065
@generated: 2026-02-09T17:59:55Z

## Purpose
Regex optimization module that generates efficient regular expressions for matching large sets of literal strings. Uses tree-based optimization techniques to minimize regex complexity by identifying common prefixes, suffixes, and character classes.

## Core Functions

### `regex_opt(strings, prefix='', suffix='')` (L82-90)
Main entry point that generates optimized regex pattern from string list. Sorts input strings and delegates to `regex_opt_inner` with appropriate grouping parentheses. Returns concatenated pattern with optional prefix/suffix.

### `regex_opt_inner(strings, open_paren)` (L26-79)
Recursive optimization engine implementing multiple strategies:
- **Empty list handling** (L30-32): Returns empty string
- **Single string** (L34-36): Direct regex escape
- **Empty string handling** (L37-40): Makes preceding group optional with `?`
- **Character class optimization** (L41-56): Groups single-character strings into charset `[abc]`
- **Common prefix optimization** (L57-64): Extracts shared prefixes, recurses on suffixes
- **Common suffix optimization** (L65-73): Reverses strings to find suffixes, processes prefixes
- **Fallback grouping** (L74-79): Groups by first character when no other optimization applies

### `make_charset(letters)` (L22-23)
Constructs regex character class `[...]` from letter list, escaping special regex characters using `CS_ESCAPE` pattern.

## Key Constants
- `CS_ESCAPE` (L18): Regex pattern for escaping charset special characters `[\^\\-\]]`
- `FIRST_ELEMENT` (L19): itemgetter(0) for accessing first element in tuples

## Dependencies
- `re`: Regex compilation and escaping
- `os.path.commonprefix`: Finding common string prefixes
- `itertools.groupby`: Grouping strings by criteria
- `operator.itemgetter`: Tuple element access

## Optimization Strategy
Algorithm recursively applies transformations in priority order: single strings → character classes → common prefixes → common suffixes → first-character grouping. Generates minimal alternation groups `(?:...)` and uses `|` for choices.