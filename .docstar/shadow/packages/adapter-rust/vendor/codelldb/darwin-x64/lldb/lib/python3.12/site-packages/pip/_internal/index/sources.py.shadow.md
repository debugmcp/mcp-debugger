# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_internal/index/sources.py
@source-hash: 7497a0891f5ff3a9
@generated: 2026-02-09T17:59:30Z

## Purpose
Defines link sources for pip package discovery, handling different types of locations (directories, files, URLs) for finding installation candidates through `--find-links` and `--[extra-]index-url` options.

## Core Architecture

**Type Aliases (L23-26):**
- `FoundCandidates` - Iterable of InstallationCandidate objects
- `FoundLinks` - Iterable of Link objects  
- `CandidatesFromPage` - Function to extract candidates from HTML pages
- `PageValidator` - Function to validate remote pages

**Abstract Base Class:**
- `LinkSource` (L29-42) - Abstract interface defining:
  - `link` property - Returns underlying Link or None
  - `page_candidates()` - Returns candidates from HTML parsing
  - `file_links()` - Returns direct file links

## Link Source Implementations

**`_FlatDirectorySource` (L95-133)** - Handles `--find-links=<path-to-dir>`:
- Uses cached `_FlatDirectoryToUrls` instances via class variable `_paths_to_urls` (L104)
- Scans directory for HTML files (page candidates) and package archives (file candidates)
- Filters files by valid wheel/sdist naming conventions

**`_LocalFileSource` (L135-166)** - Handles local file:// URLs and paths:
- Returns page candidates if file is HTML, file links otherwise
- Uses `_is_html_file()` (L44-45) for content type detection

**`_RemoteFileSource` (L168-198)** - Handles remote URLs:
- Includes page validation step via `PageValidator` callback
- Always returns file link, but validates pages before parsing

**`_IndexDirectorySource` (L200-224)** - Handles index directory URLs:
- Treats directories as remote indexes (appends index.html internally)
- Only provides page candidates, no direct file links

## Helper Classes

**`_FlatDirectoryToUrls` (L48-93)** - Directory scanner with caching:
- Lazy scanning via `_scanned_directory` flag (L55, L82, L89)
- Separates HTML files (`page_candidates`) from package files (`project_name_to_urls`)
- Validates filenames using packaging library parsers (L69-75)

## Factory Function

**`build_source()` (L226-285)** - Creates appropriate LinkSource:
- Determines location type (local path, file: URL, remote URL)
- Returns tuple of (url, source) or (None, None) for invalid locations
- Uses `expand_dir` parameter to choose between flat directory vs index directory handling

## Key Dependencies
- `pip._vendor.packaging.utils` - Filename parsing and validation
- `pip._internal.models.{candidate,link}` - Core data structures
- `pip._internal.utils.urls` - Path/URL conversion utilities
- `pip._internal.vcs.is_url` - URL detection

## Design Patterns
- Strategy pattern for different source types
- Lazy initialization for directory scanning
- Class-level caching for directory scanners
- Factory pattern for source creation