# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_vendor/distlib/metadata.py
@source-hash: a41f5667d9817e64
@generated: 2026-02-09T17:59:54Z

**Python Package Metadata Handling Library**

Core implementation for parsing, validating, and manipulating Python package metadata across all standardized formats (1.0, 1.1, 1.2, 1.3/2.1, and 2.2).

## Key Classes

**LegacyMetadata (L245-603)**
- Primary class for handling traditional PKG-INFO metadata formats
- Supports all legacy metadata versions (1.0, 1.1, 1.2, 2.0, 1.3/2.1)
- Key methods:
  - `__init__()` (L257-271): Accepts path, fileobj, or mapping input
  - `read_file()` (L347-373): Parses email-format metadata from file objects
  - `write_file()` (L383-406): Serializes metadata to PKG-INFO format
  - `set()` (L436-478): Validates and sets metadata fields with type checking
  - `get()` (L480-507): Retrieves metadata fields with proper type conversion
  - `check()` (L509-551): Validates metadata compliance
  - `todict()` (L553-574): Converts to dictionary format
- Implements dict-like interface with `__getitem__`, `__setitem__`, `keys()`, etc.

**Metadata (L610-1062)**
- Modern metadata class preferring 2.1+ formats, falls back to LegacyMetadata
- Uses `__slots__` for memory efficiency: `_legacy`, `_data`, `scheme`
- Key methods:
  - `__init__()` (L655-698): Auto-detects format and delegates to appropriate handler
  - `get_requirements()` (L837-877): Complex dependency resolution with extras and environment markers
  - `write()` (L1021-1045): Outputs in either modern JSON or legacy PKG-INFO format
  - `_to_legacy()` (L971-1019): Converts modern metadata to legacy format
  - `_from_legacy()` (L929-956): Converts legacy metadata to modern format

## Version Detection & Field Mapping

**Version Detection Functions**
- `_version2fieldlist()` (L118-133): Maps version strings to valid field sets
- `_best_version()` (L136-204): Auto-detects appropriate metadata version based on field usage

**Field Constants**
- `_241_FIELDS`, `_314_FIELDS`, `_345_FIELDS`, `_426_FIELDS`, `_566_FIELDS`, `_643_FIELDS` (L55-105): Version-specific field definitions
- `_ATTR2FIELD`, `_FIELD2ATTR` (L208-211): Bidirectional field name mapping
- Field categorization: `_LISTFIELDS`, `_UNICODEFIELDS`, `_PREDICATE_FIELDS`, etc. (L213-225)

## Key Dependencies
- `email.message_from_file`: Parsing PKG-INFO format
- `json`: Modern metadata serialization
- `.markers.interpret`: Environment marker evaluation
- `.version.get_scheme`: Version validation
- `.util.extract_by_key`, `get_extras`: Utility functions

## Architecture Patterns
- **Dual-mode design**: Seamlessly handles both legacy and modern metadata formats
- **Field validation**: Comprehensive regex-based validation for names, versions, summaries
- **Lazy conversion**: Only converts between formats when necessary
- **Environment marker support**: Full PEP 508 environment marker interpretation

## Critical Constraints
- Metadata 2.0 is explicitly rejected (L128-129)
- Field names are case-sensitive and follow hyphen-to-underscore conversion rules
- List fields require special handling for serialization/deserialization
- Unicode fields need proper encoding handling (UTF-8 for PKG-INFO)

## Exception Hierarchy
- `MetadataMissingError` (L28): Required fields missing
- `MetadataConflictError` (L32): Incompatible field combinations
- `MetadataUnrecognizedVersionError` (L36): Unknown version
- `MetadataInvalidError` (L40): Invalid field values