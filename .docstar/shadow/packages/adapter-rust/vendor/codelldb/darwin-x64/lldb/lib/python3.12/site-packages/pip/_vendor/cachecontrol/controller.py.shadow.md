# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_vendor/cachecontrol/controller.py
@source-hash: a3e7a31899419a92
@generated: 2026-02-09T17:59:42Z

## HTTP Cache Controller

Core HTTP response caching controller implementing RFC 7234 cache-control semantics for requests library. Manages cache storage, retrieval, validation, and freshness determination.

### Primary Components

**CacheController (L48-499)** - Main cache management class
- `__init__` (L51-61): Configures cache backend, ETag handling, serialization, and cacheable status codes
- `cached_request` (L167-275): Primary cache retrieval method implementing full freshness logic
- `cache_response` (L322-457): Cache storage method with comprehensive caching rules
- `conditional_headers` (L277-290): Generates If-None-Match/If-Modified-Since headers for validation
- `update_cached_response` (L459-499): Updates cached responses on 304 Not Modified

**Cache URL Processing**
- `parse_uri` (L37-45): RFC 3986 URI parsing using regex
- `_urlnorm` (L64-81): URL normalization for consistent cache keys
- `cache_url` (L84-85): Public interface for URL normalization

**Cache-Control Header Processing**
- `parse_cache_control` (L87-139): Parses cache-control directives with validation
- Handles max-age, no-cache, no-store, must-revalidate, etc. per RFC 7234

### Key Dependencies
- `pip._vendor.cachecontrol.cache.{DictCache, SeparateBodyBaseCache}`: Cache backend abstraction
- `pip._vendor.cachecontrol.serialize.Serializer`: Response serialization/deserialization
- `pip._vendor.requests.structures.CaseInsensitiveDict`: HTTP header handling

### Critical Cache Logic

**Freshness Calculation (L218-267)**:
1. Calculates current_age from Date header
2. Determines freshness_lifetime from max-age or expires
3. Applies request-level max-age/min-fresh overrides
4. Returns cached response if fresh, otherwise marks stale

**Storage Rules (L322-457)**:
- Only caches responses with approved status codes (200, 203, 300, 301, 308)
- Respects no-store directives in request/response
- Handles ETags with extended expiration (14 days minimum)
- Caches permanent redirects (301, 308) indefinitely
- Validates Content-Length against body size

**Range Request Handling**: Explicitly excludes partial content requests (L147-148)

### Constants
- `PERMANENT_REDIRECT_STATUSES` (L34): HTTP 301 and 308 status codes
- `URI` (L32): RFC 3986 URI parsing regex
- Default cacheable status codes: 200, 203, 300, 301, 308

### Cache Storage Patterns
Supports both unified cache backends and separate body storage via `SeparateBodyBaseCache` interface for large response optimization.