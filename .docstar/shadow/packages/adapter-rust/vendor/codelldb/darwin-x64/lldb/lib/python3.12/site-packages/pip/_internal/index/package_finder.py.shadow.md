# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_internal/index/package_finder.py
@source-hash: 5c71d09b54e6c38c
@generated: 2026-02-09T17:59:32Z

**Primary Purpose**: Core package finding and candidate evaluation system for pip's PyPI integration. Responsible for discovering, filtering, and selecting the best installation candidates for Python packages based on compatibility, preferences, and constraints.

## Key Components

### LinkEvaluator (L109-249)
Evaluates individual links for installation candidacy. Main method `evaluate_link()` (L157-249) returns tuple of `(LinkType, detail)` indicating whether link is viable candidate or reason for rejection. Validates:
- Project name matching via canonical names
- File format support (wheels, source distributions)  
- Platform compatibility using wheel tags
- Python version requirements via PEP 503 "data-requires-python"
- Yanked package handling per PEP 592

### CandidateEvaluator (L377-578)
Filters and sorts installation candidates based on version specifiers, hashes, and preferences. Key methods:
- `get_applicable_candidates()` (L445-479): Filters by version specifiers and allowed hashes
- `_sort_key()` (L481-548): Complex sorting algorithm prioritizing allowed hashes, non-yanked versions, binary preference, version numbers, and platform compatibility
- `compute_best_candidate()` (L563-578): Returns `BestCandidateResult` with optimal candidate

### PackageFinder (L581-977)
Main orchestrator class for package discovery and selection. Core workflow methods:
- `find_all_candidates()` (L800-850): Discovers all available candidates from indexes and find-links, cached with `@functools.lru_cache`
- `find_best_candidate()` (L870-890): Returns best candidate matching specifiers and hashes, also cached
- `find_requirement()` (L892-977): High-level method handling upgrade logic and installed version checks

## Data Models

### BestCandidateResult (L337-375)
Container for candidate search results with separate collections for all candidates vs applicable candidates. Provides iterators for both sets.

### CandidatePreferences (L326-335) 
Simple dataclass encapsulating binary preference and prerelease allowance flags.

### LinkType (L99-107)
Enum categorizing link evaluation outcomes (candidate, yanked, format issues, platform mismatches, etc.).

## Key Algorithms

**Candidate Sorting Priority** (L481-548):
1. Allowed hash matches (highest priority)
2. Non-yanked packages  
3. Binary vs source preference
4. Version numbers (semantic versioning)
5. Platform tag compatibility ranking
6. Build tag precedence

**Version Extraction** (L1006-1021): Parses version strings from filenames using canonical name separation logic.

## Dependencies
- `pip._vendor.packaging`: Version parsing, specifiers, wheel tags
- `pip._internal.index.collector`: Link collection from indexes
- `pip._internal.models.*`: Core data models (Link, InstallationCandidate, etc.)
- `pip._internal.utils.*`: Hash validation, platform detection, logging utilities

## Architecture Notes
- Extensive use of caching via `@functools.lru_cache` for performance
- Clear separation between link evaluation, candidate filtering, and final selection
- Robust error handling for malformed packages and compatibility issues
- Comprehensive logging for debugging package resolution issues