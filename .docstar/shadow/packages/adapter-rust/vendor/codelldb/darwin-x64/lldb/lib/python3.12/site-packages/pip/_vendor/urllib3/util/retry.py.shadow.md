# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_vendor/urllib3/util/retry.py
@source-hash: 67a5847f9d7c7933
@generated: 2026-02-09T17:57:52Z

## Purpose
HTTP retry mechanism implementation for urllib3 with configurable retry policies, backoff strategies, and error handling. Manages retry attempts for different types of HTTP errors with exponential backoff and Retry-After header support.

## Core Components

### RequestHistory (L26-28)
Namedtuple storing metadata for each retry attempt: `method`, `url`, `error`, `status`, and `redirect_location`. Used to track retry history and calculate consecutive error sequences.

### _RetryMeta Metaclass (L35-89)
Provides backward compatibility through deprecated property aliases with deprecation warnings:
- `DEFAULT_METHOD_WHITELIST` → `DEFAULT_ALLOWED_METHODS`
- `DEFAULT_REDIRECT_HEADERS_BLACKLIST` → `DEFAULT_REMOVE_HEADERS_ON_REDIRECT`  
- `BACKOFF_MAX` → `DEFAULT_BACKOFF_MAX`

### Retry Class (L92-617)
Main retry configuration and execution engine. Creates new instances for each retry attempt to maintain immutability.

**Key Attributes:**
- `DEFAULT_ALLOWED_METHODS` (L230-232): Idempotent HTTP methods safe for retry
- `RETRY_AFTER_STATUS_CODES` (L235): Status codes that respect Retry-After header
- `DEFAULT_REMOVE_HEADERS_ON_REDIRECT` (L238): Headers stripped on redirect
- `DEFAULT_BACKOFF_MAX` (L241): Maximum backoff time (120 seconds)

**Constructor (L243-303):** Configures retry counts by type (connect, read, redirect, status, other), allowed methods, backoff factor, and behavior flags. Handles deprecated `method_whitelist` parameter.

**Core Methods:**
- `new()` (L304-338): Creates new Retry instance with updated parameters
- `from_int()` (L340-352): Backwards compatibility for integer retry counts
- `get_backoff_time()` (L354-369): Exponential backoff calculation based on consecutive errors
- `parse_retry_after()` (L371-392): Parses Retry-After header (seconds or HTTP date)
- `sleep()` (L418-432): Sleeps between retries, respecting Retry-After or using backoff
- `increment()` (L504-596): Core retry logic - decrements counters, categorizes errors, creates new retry instance

**Decision Logic:**
- `_is_connection_error()` (L434-440): Identifies connection-level errors
- `_is_read_error()` (L442-446): Identifies read/protocol errors  
- `_is_method_retryable()` (L448-466): Checks if HTTP method allows retry
- `is_retry()` (L468-486): Determines if request should be retried
- `is_exhausted()` (L488-502): Checks if retry limits exceeded

## Dependencies
- `urllib3.exceptions`: Various HTTP exception types for error categorization
- `email.utils`: HTTP date parsing for Retry-After headers
- `time`: Sleep functionality and timestamp operations
- `six`: Python 2/3 compatibility utilities

## Key Patterns
- **Immutable design**: Each retry creates new instance rather than modifying state
- **Error categorization**: Distinguishes connection, read, redirect, status, and other errors
- **Graceful degradation**: Continues with available retry types when others exhausted  
- **Header compliance**: Respects HTTP Retry-After semantics
- **Backward compatibility**: Maintains deprecated interfaces with warnings

## Critical Invariants
- Retry counts never go negative (checked in `is_exhausted()`)
- New instances preserve all configuration except updated counters/history
- Connection errors assumed safe to retry; read errors may have side effects
- Exponential backoff capped at `DEFAULT_BACKOFF_MAX` seconds