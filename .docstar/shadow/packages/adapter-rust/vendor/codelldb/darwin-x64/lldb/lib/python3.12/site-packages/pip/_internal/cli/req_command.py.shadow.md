# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_internal/cli/req_command.py
@source-hash: 0ea78586650cb3aa
@generated: 2026-02-09T17:59:22Z

## Primary Purpose
Base command class for pip commands that handle package requirements and dependency resolution. Provides common infrastructure for requirement parsing, package finding, and resolver instantiation while avoiding unnecessary imports for commands that don't need PackageFinder capabilities.

## Key Components

### RequirementCommand (L78-329)
Main base class extending IndexGroupCommand. Provides core functionality for commands dealing with package requirements:
- Adds `--no-clean` command option (L82)
- Resolver variant determination (legacy vs resolvelib) (L85-90)
- RequirementPreparer factory method (L92-145)
- BaseResolver factory method (L147-204)
- Command-line argument parsing to requirements (L206-290)
- Package finder creation (L303-329)

### with_cleanup Decorator (L50-75)
Manages temporary directory cleanup behavior:
- Configures temp directory registry based on `--no-clean` option
- Handles PreviousBuildDirError exceptions to prevent accidental directory removal
- Preserves BUILD_ENV, EPHEM_WHEEL_CACHE, and REQ_BUILD temp directories when needed

## Key Methods

### determine_resolver_variant() (L84-90)
Static method that returns "legacy" if legacy-resolver feature is enabled, otherwise "resolvelib".

### make_requirement_preparer() (L92-145)
Creates RequirementPreparer with resolver-specific configuration:
- Enables lazy wheel loading for resolvelib with "fast-deps" feature
- Configures legacy resolver compatibility
- Handles build isolation, hash checking, and progress bar options

### make_resolver() (L147-204)
Factory for BaseResolver instances:
- Dynamic import of resolver implementation based on variant
- Creates partial function for install requirement construction
- Configures resolver with preparer, finder, caching, and upgrade strategies

### get_requirements() (L206-290)
Parses command-line arguments into InstallRequirement objects:
- Processes constraint files, direct requirements, editable installs, and requirement files
- Enables hash checking if any requirement has hash options
- Validates that at least one requirement is provided

### trace_basic_info() (L292-301)
Logs package finder search locations for debugging.

### _build_package_finder() (L303-329)
Creates PackageFinder with appropriate configuration:
- Sets up LinkCollector with session and options
- Configures SelectionPreferences for yanked packages, prereleases, binary preferences
- Handles Requires-Python compatibility

## Dependencies
- Extensive pip internal modules for requirement handling, resolution, caching
- Uses temp directory management, network sessions, and package finding infrastructure
- Imports resolver implementations dynamically to avoid unnecessary loading

## Architectural Notes
- Separation of concerns: requirement parsing vs package finding to minimize imports
- Factory pattern for resolver and preparer creation
- Feature flag system for experimental functionality (fast-deps, legacy-resolver)
- Comprehensive error handling for missing requirements and build directory conflicts