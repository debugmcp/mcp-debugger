# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_vendor/urllib3/util/wait.py
@source-hash: 7ce5f4fdf6a8cc6d
@generated: 2026-02-09T17:57:45Z

**Primary Purpose:** Cross-platform socket waiting utility that provides efficient, platform-appropriate mechanisms for waiting on socket readiness events.

**Core Architecture:**
- Lazy initialization pattern for platform detection (L126-138)
- Fallback hierarchy: poll() → select() → error on unsupported platforms
- EINTR retry handling for Python < 3.5 compatibility

**Key Functions:**

**`wait_for_socket()` (L126-138):**
- Global function that self-replaces on first call with optimal implementation
- Platform detection logic: prefers poll() on Unix, select() on Windows
- Handles AppEngine platform limitations

**`poll_wait_for_socket()` (L89-106):**
- Unix-optimized implementation using select.poll()
- Converts timeout to milliseconds (L101-104)
- Registers socket with POLLIN/POLLOUT masks

**`select_wait_for_socket()` (L70-86):**
- Windows-compatible implementation using select.select()
- Special handling for Windows non-blocking connect (checks write sockets for exceptions)
- Uses partial application for clean retry integration

**`_retry_on_intr()` (L42-67):**
- Python version-dependent EINTR handling
- Modern Python (≥3.5): direct passthrough (L42-43)
- Legacy Python: manual EINTR retry with deadline tracking (L47-67)

**Public API:**
- `wait_for_read()` (L141-145): Convenience wrapper for read-readiness
- `wait_for_write()` (L148-152): Convenience wrapper for write-readiness
- `NoWayToWaitForSocketError` (L14-15): Exception for unsupported platforms

**Platform Strategy:**
- Unix: Prefers poll() to avoid select() file descriptor limitations
- Windows: Uses select() (no poll() available, but select() works fine)
- AppEngine: Falls back to error (no socket waiting available)

**Dependencies:**
- `select` module for poll()/select() implementations
- `time.monotonic` with fallback to `time.time` for deadline tracking
- `errno` for EINTR signal detection