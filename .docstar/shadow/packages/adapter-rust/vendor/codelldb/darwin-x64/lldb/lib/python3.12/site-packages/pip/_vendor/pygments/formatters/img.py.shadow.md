# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_vendor/pygments/formatters/img.py
@source-hash: 6e495876cd77998c
@generated: 2026-02-09T17:57:40Z

Primary purpose: Provides image-based formatters for Pygments syntax highlighting, converting tokenized source code into PNG, GIF, JPEG, and BMP images using PIL/Pillow.

## Core Components

### Exception Classes
- `PilNotAvailable` (L52-53): Raised when PIL/Pillow is not installed
- `FontNotFound` (L56-57): Raised when no usable fonts are found

### Font Management
- `FontManager` (L60-270): Manages font families across platforms
  - Constructor (L65-90): Handles font initialization from file or system fonts
  - Platform-specific font loading:
    - `_create_nix()` (L106-125): Linux font discovery via fontconfig
    - `_create_mac()` (L130-157): macOS font discovery from system directories
    - `_create_win()` (L174-211): Windows font discovery via registry
  - Font retrieval methods:
    - `get_font()` (L229-252): Returns appropriate font for bold/italic styling
    - `get_style()` (L254-269): Handles variable font styling
    - `get_text_size()` (L219-227): Compatible text sizing for different PIL versions

### Core Formatter
- `ImageFormatter` (L272-640): Main image formatter class
  - Inherits from `Formatter`, supports extensive configuration options
  - Constructor (L392-446): Initializes fonts, colors, line numbering, and image settings
  - Drawing pipeline:
    - `_create_drawables()` (L540-578): Processes token stream into drawable elements
    - `_draw_line_numbers()` (L580-589): Creates line number drawables
    - `format()` (L608-639): Main entry point, orchestrates image generation
  - Layout calculations:
    - Position methods (L458-486): Calculate text and line number positions
    - Size methods (L514-519): Determine required image dimensions
  - Style methods (L488-512): Extract colors and fonts from token styles

### Specialized Formatters
- `GifImageFormatter` (L645-656): GIF-specific formatter
- `JpgImageFormatter` (L659-670): JPEG-specific formatter  
- `BmpImageFormatter` (L673-684): BMP-specific formatter

## Key Dependencies
- PIL/Pillow: Core image manipulation (conditionally imported L20-24)
- subprocess: Font discovery on Linux systems
- winreg: Windows registry access for font discovery
- Pygments formatter base classes and utilities

## Configuration Constants
- `STYLES` (L39-44): Font style name mappings across different font families
- Platform-specific default fonts (L47-49): DejaVu Sans Mono (Linux), Courier New (Windows), Menlo (macOS)

## Architecture Notes
- Cross-platform font discovery with fallback mechanisms
- Lazy PIL import with graceful degradation
- Extensive customization options for line numbers, highlighting, and image formatting
- Two-phase rendering: drawable creation then image painting
- Support for variable fonts with style variations