# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_vendor/packaging/_parser.py
@source-hash: b3f4ef4ef0cd2b43
@generated: 2026-02-09T17:59:45Z

## Purpose
Handwritten recursive descent parser for Python dependency specifiers and marker expressions. Implements PEP 508 dependency specification parsing with detailed syntax validation and error reporting.

## Core Architecture
- **Node Hierarchy (L15-42)**: Base `Node` class with specialized subclasses `Variable`, `Value`, and `Op` for AST representation
- **Type Definitions (L44-47)**: Complex recursive type definitions for marker expressions using Union and Sequence types
- **ParsedRequirement (L50-55)**: NamedTuple representing parsed dependency with name, URL, extras, specifier, and marker fields

## Main Entry Points
- **parse_requirement() (L61-62)**: Public API for parsing full dependency specifiers
- **parse_marker() (L252-253)**: Public API for parsing marker expressions only

## Dependency Parsing Flow
1. **_parse_requirement() (L65-83)**: Top-level parser handling package name, extras, and requirement details
2. **_parse_requirement_details() (L86-134)**: Branches between URL (@package) and version specifier formats
3. **_parse_extras() (L157-173)**: Parses optional extras in brackets [extra1,extra2]
4. **_parse_specifier() (L203-217)**: Handles version specifiers with optional parentheses

## Marker Expression Parsing
- **_parse_marker() (L262-271)**: Parses boolean expressions with BOOLOP operators (and/or)
- **_parse_marker_atom() (L274-293)**: Handles parenthesized expressions and individual comparisons
- **_parse_marker_item() (L296-307)**: Parses comparison triplets (variable op value)
- **_parse_marker_var() (L310-321)**: Processes environment variables and quoted strings

## Key Utilities
- **process_env_var() (L324-328)**: Normalizes platform_python_implementation variables
- **process_python_str() (L331-333)**: Safely evaluates quoted strings using ast.literal_eval
- **_parse_marker_op() (L336-354)**: Handles all comparison operators including 'in'/'not in'

## Dependencies
- Uses custom `_tokenizer.Tokenizer` with `DEFAULT_RULES` for lexical analysis
- Leverages `ast.literal_eval` for safe string evaluation
- Implements context managers for bracket matching validation

## Error Handling
Comprehensive syntax error reporting with position tracking and contextual messages throughout all parsing functions. Uses `tokenizer.raise_syntax_error()` with span information for precise error location.