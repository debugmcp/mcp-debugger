# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_vendor/rich/markup.py
@source-hash: ddeb8628fe6ce353
@generated: 2026-02-09T18:00:04Z

**Primary Purpose**
Parser and renderer for Rich library's console markup language. Handles parsing markup tags like `[bold]`, `[red]`, etc., and converts them into styled Text objects with proper span handling.

**Key Components**

- **Tag class (L20-41)**: NamedTuple representing a markup tag with name and optional parameters. Methods include `__str__` and `markup` property for string representation.

- **escape() function (L48-71)**: Escapes markup text to prevent interpretation as tags. Uses regex substitution to double backslashes before markup patterns and handles trailing backslash edge cases.

- **_parse() function (L73-104)**: Core parser that tokenizes markup into position/text/tag tuples. Handles escape sequences, backslash processing, and parameter extraction using regex `RE_TAGS` (L12-15).

- **render() function (L106-231)**: Main entry point that converts markup string into Rich Text object. Features:
  - Style stack management for nested tags (L137-152)
  - Span collection for text styling (L140-141)
  - Opening tag processing (L219-221)
  - Closing tag processing with explicit/implicit closing (L159-177)
  - Meta tag handling for `@` prefixed tags (L178-215)
  - Emoji replacement integration when enabled

**Key Dependencies**
- `re` for regex pattern matching
- `ast.literal_eval` for safe parameter parsing
- Rich internal modules: `_emoji_replace`, `Style`, `Text`, `Span`
- `MarkupError` for syntax error reporting

**Critical Patterns**
- Uses regex `RE_TAGS` to match markup patterns like `[tag=param]`
- Maintains style stack for proper nesting/closing semantics
- Performance optimizations: early return for markup-free strings (L128), local variable caching
- Escape handling supports both literal backslashes and tag escaping via backslash count division

**Architectural Decisions**
- Separates parsing (_parse) from rendering (render) for modularity
- Uses generator pattern in _parse for memory efficiency
- Span-based styling allows overlapping and nested style ranges
- Meta tags (`@` prefix) support custom handlers with parameters

**Demo/Testing**
Main block (L234-251) contains example markup patterns and renders them in a table format.