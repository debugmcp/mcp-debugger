# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_vendor/truststore/_api.py
@source-hash: 07d2481e2a730484
@generated: 2026-02-09T18:00:13Z

**Truststore SSL API - Cross-Platform SSL Context with System Certificate Store**

This module provides a drop-in replacement for Python's standard `ssl.SSLContext` that leverages system certificate stores across Windows, macOS, and Linux platforms.

## Core Purpose

Implements a `truststore.SSLContext` that uses OS-native certificate verification while maintaining compatibility with the standard SSL library interface. The module enables automatic trust store integration without requiring manual certificate management.

## Key Components

### Module-Level Functions

- **`inject_into_ssl()` (L32-44)**: Monkey-patches `ssl.SSLContext` with the truststore implementation, including urllib3 integration
- **`extract_from_ssl()` (L47-55)**: Restores original SSL context behavior, undoing the injection
- **`_verify_peercerts()` (L296-313)**: Core certificate verification using platform-specific implementations
- **`_get_unverified_chain_bytes()` (L282-293)**: Version-aware certificate chain extraction (handles Python 3.13+ API changes)

### Main Class

**`SSLContext` (L58-274)**: Drop-in replacement for `ssl.SSLContext` that:
- Wraps the original SSL context (`self._ctx`) for delegation
- Uses platform-specific certificate verification via `_configure_context` and `_verify_peercerts_impl`
- Implements custom `TruststoreSSLObject` (L71-80) for handshake-time verification
- Overrides `wrap_socket()` (L83-109) and `wrap_bio()` (L111-127) for certificate validation
- Proxies all standard SSL context properties and methods (L129-274)

### Platform Abstraction

The module imports platform-specific implementations (L17-22):
- Windows: `_windows` module
- Darwin/macOS: `_macos` module  
- Others: `_openssl` module

Each provides `_configure_context` and `_verify_peercerts_impl` functions.

## Architecture Decisions

1. **Composition over Inheritance**: Uses delegation pattern with internal `_ctx` rather than direct inheritance
2. **Context Manager Integration**: Uses `_configure_context` as context manager for state management during SSL operations
3. **Version Compatibility**: Handles Python 3.13+ API changes in certificate chain handling
4. **Exception Safety**: Properly closes SSL sockets on verification failures (L104-108)

## Dependencies

- Standard library: `ssl`, `socket`, `os`, `platform`, `sys`, `typing`
- Internal: `_ssl_constants` module for original SSL context references
- Platform modules: `_windows`, `_macos`, `_openssl` for OS-specific implementations
- Type checking: `pip._vendor.typing_extensions.Buffer`

## Critical Invariants

- Must maintain API compatibility with standard `ssl.SSLContext`
- Platform-specific verification occurs after standard SSL handshake
- Original SSL context state is preserved during injection/extraction cycles