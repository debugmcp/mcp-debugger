# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_internal/network/utils.py
@source-hash: e80e52ad42441141
@generated: 2026-02-09T17:59:29Z

## Purpose
Utility functions for handling HTTP network operations in pip's internal networking layer, focusing on response processing and error handling with special considerations for compressed content.

## Key Components

### Constants
- **HEADERS** (L26): Dict containing `{"Accept-Encoding": "identity"}` to prevent automatic compression handling that could break checksum verification

### Functions

#### raise_for_status(resp: Response) → None (L29-54)
Custom HTTP error handler that converts 4xx/5xx status codes into `NetworkConnectionError` exceptions. Handles both bytes and string response reasons with UTF-8/ISO-8859-1 fallback decoding.

#### response_chunks(response: Response, chunk_size: int = CONTENT_CHUNK_SIZE) → Generator[bytes, None, None] (L57-96)
Streaming response reader that yields raw bytes chunks. Uses `decode_content=False` to preserve original compressed data for checksum verification. Falls back to standard file-like object reading if urllib3 streaming is unavailable.

## Dependencies
- `pip._vendor.requests.models`: Response object and CONTENT_CHUNK_SIZE constant
- `pip._internal.exceptions.NetworkConnectionError`: Custom exception for network errors
- Standard typing annotations

## Architectural Decisions

### Compression Handling Strategy
Both the HEADERS constant and response_chunks function implement a deliberate strategy to avoid automatic decompression:
- Requests identity encoding only to prevent server-side re-compression
- Disables urllib3's automatic content decoding to preserve checksums
- Handles three server compression scenarios (documented in comments L13-25, L73-83)

### Error Handling
- Graceful handling of bytes vs string response reasons
- Fallback encoding strategy (UTF-8 → ISO-8859-1)
- Fallback streaming strategy (urllib3 → standard file operations)

## Critical Constraints
- Must preserve raw bytes for checksum verification
- Must handle various server compression behaviors
- Must support both urllib3 and standard file-like response objects