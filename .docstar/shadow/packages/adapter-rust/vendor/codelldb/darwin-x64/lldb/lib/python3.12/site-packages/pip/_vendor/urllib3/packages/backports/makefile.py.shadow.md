# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_vendor/urllib3/packages/backports/makefile.py
@source-hash: 9dbcedde2d1a80f5
@generated: 2026-02-09T17:56:52Z

This module provides a backport of Python 3's `socket.makefile()` method for compatibility with older Python versions or custom socket-like objects.

## Primary Purpose
Enables creation of file-like objects from socket objects, supporting both binary and text I/O modes with proper buffering strategies.

## Key Function
**`backport_makefile()`** (L13-51) - Main backport implementation that creates file-like objects from socket instances
- **Parameters**: `self` (socket object), `mode` (r/w/b combinations), `buffering` (buffer size), `encoding`, `errors`, `newline`
- **Mode validation** (L19-20): Ensures only 'r', 'w', 'b' characters are used
- **Mode parsing** (L21-29): Determines reading/writing flags and constructs raw mode string
- **SocketIO creation** (L30): Creates raw socket I/O object using parsed mode
- **Reference counting** (L31): Increments `_makefile_refs` on socket object
- **Buffer handling** (L32-39): Sets default buffering (-1 â†’ DEFAULT_BUFFER_SIZE), validates unbuffered binary requirement
- **Buffer wrapping** (L40-46): Creates appropriate buffered wrapper (BufferedRWPair, BufferedReader, or BufferedWriter)
- **Text wrapping** (L47-51): Adds TextIOWrapper for text mode with encoding support

## Dependencies
- `io` module: Provides buffered I/O classes and DEFAULT_BUFFER_SIZE
- `socket.SocketIO`: Core socket I/O implementation

## Architecture Pattern
Follows the decorator/wrapper pattern, progressively wrapping raw socket I/O with buffering and text handling layers to match Python 3 socket.makefile() behavior.

## Critical Constraints
- Mode string must only contain 'r', 'w', 'b' characters
- Unbuffered streams (buffering=0) require binary mode
- Socket object must have `_makefile_refs` attribute for reference counting