# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_internal/utils/direct_url_helpers.py
@source-hash: af6311b64543002b
@generated: 2026-02-09T17:59:35Z

## Purpose and Responsibility
Utility module for converting pip's internal `DirectUrl` and `Link` objects to standardized formats. Bridges pip's internal representations with PEP 440 direct reference strings and creates `DirectUrl` objects from various sources.

## Core Functions

### `direct_url_as_pep440_direct_reference(direct_url, name)` (L9-29)
Converts a `DirectUrl` object to a PEP 440 compliant pip requirement string format. Handles three URL types:
- **VCS URLs**: Formats as `name @ vcs+url@commit_id` (L14-17)
- **Archive URLs**: Formats as `name @ url` with optional hash fragment (L18-21) 
- **Directory URLs**: Formats as `name @ url` (L22-24)

Appends URL fragments for hashes and subdirectories using `#` separator (L25-28).

### `direct_url_for_editable(source_dir)` (L32-36)
Creates a `DirectUrl` for editable installs, converting local file path to URL format with `DirInfo(editable=True)`.

### `direct_url_from_link(link, source_dir, link_is_in_wheel_cache)` (L39-87)
Primary factory function converting `Link` objects to `DirectUrl` objects. Handles three link types:

- **VCS Links** (L42-71): Extracts VCS backend, determines commit ID either from cache (immutable revision) or by inspecting source directory
- **Existing Directory Links** (L72-77): Creates `DirInfo` with URL and optional subdirectory
- **Archive Links** (L78-87): Creates `ArchiveInfo` with optional hash verification data

## Key Dependencies
- `DirectUrl`, `ArchiveInfo`, `DirInfo`, `VcsInfo` from `pip._internal.models.direct_url` (L3)
- `Link` from `pip._internal.models.link` (L4) 
- `path_to_url` utility (L5)
- VCS backend registry from `pip._internal.vcs` (L6)

## Architectural Patterns
- **Factory Pattern**: Functions serve as factories for `DirectUrl` creation from different input types
- **Type-based Dispatch**: Uses `isinstance()` checks to handle different URL/link types appropriately
- **Validation**: Calls `direct_url.validate()` to ensure data integrity (L11)
- **Fragment Handling**: Consistent pattern for building URL fragments with `#` and `&` separators

## Critical Invariants
- VCS links must have either cached wheel (immutable revision) OR source directory for commit ID resolution
- All `DirectUrl` objects must be valid before conversion to requirement strings
- Hash information preserved from links when available