# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_vendor/urllib3/util/ssltransport.py
@source-hash: 340faee6b313ac31
@generated: 2026-02-09T17:57:45Z

## Primary Purpose
Implements SSL/TLS transport layer that wraps existing sockets using memory BIOs for TLS-in-TLS scenarios, particularly useful for HTTP proxy connections through multiple TLS layers.

## Key Architecture
- **SSLTransport (L11-221)**: Main class providing socket-like interface over SSL using memory BIOs
- **Memory BIO Pattern**: Uses `ssl.MemoryBIO()` for incoming/outgoing data buffering (L50-51)
- **SSL I/O Loop**: Core mechanism `_ssl_io_loop()` (L195-221) handles SSL state machine and data transfer

## Critical Methods

### Initialization & Validation
- `_validate_ssl_context_for_tls_in_tls()` (L23-42): Validates SSL context has `wrap_bio` method, raises ProxySchemeUnsupported for Python 2 or non-native contexts
- `__init__()` (L44-61): Creates memory BIOs, wraps socket with SSL context, performs initial handshake

### Socket API Compatibility
- `read()`/`recv()` (L72-78): Read operations via `_wrap_ssl_read()`
- `recv_into()` (L80-87): Buffered read with optional buffer parameter
- `send()`/`sendall()` (L89-103): Write operations with complete data transmission guarantee
- `makefile()` (L105-148): Creates buffered I/O wrappers compatible with Python's http client

### SSL Operations
- `_wrap_ssl_read()` (L186-193): Handles SSL read with EOF suppression for ragged connections
- `_ssl_io_loop()` (L195-221): Core SSL state machine handling WANT_READ/WANT_WRITE states
- SSL info methods: `getpeercert()`, `cipher()`, `version()`, `selected_alpn_protocol()` (L156-175)

## Dependencies
- `ssl` module for SSL/TLS operations and memory BIOs
- `..exceptions.ProxySchemeUnsupported` for TLS-in-TLS validation errors
- `..packages.six` for Python 2/3 compatibility detection

## Key Constants
- `SSL_BLOCKSIZE = 16384` (L8): Buffer size for SSL I/O operations

## Critical Patterns
- **Memory BIO Architecture**: Separates SSL protocol handling from socket I/O
- **Error Handling**: Distinguishes expected SSL errors (WANT_READ/WANT_WRITE) from fatal errors
- **Context Manager Support**: `__enter__`/`__exit__` (L63-67) for resource cleanup
- **Socket API Emulation**: Provides drop-in replacement for socket objects

## Constraints & Invariants
- Requires SSL context with `wrap_bio` method (validated at construction)
- Flags parameter must be 0 for recv/send operations (validates at runtime)
- Maintains socket reference counting for makefile operations (`_io_refs`)
- Suppresses ragged EOF errors by default (`suppress_ragged_eofs=True`)