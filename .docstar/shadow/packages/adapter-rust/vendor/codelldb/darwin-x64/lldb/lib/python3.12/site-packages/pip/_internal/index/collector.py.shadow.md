# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_internal/index/collector.py
@source-hash: 45d3ced092c0966c
@generated: 2026-02-09T17:59:35Z

## Purpose
Link collection module for pip's package index operations. Primary responsibility is collecting and parsing package links from PyPI indexes and find-links locations through the LinkCollector.collect_sources() method.

## Key Components

### Core Classes

**LinkCollector (L390-494)** - Main orchestrator class responsible for collecting Link objects from all configured locations. Key methods:
- `create()` (L406-438): Factory method creating instances from command-line options
- `collect_sources()` (L450-494): Primary entry point that builds and returns CollectedSources from index URLs and find-links
- `fetch_response()` (L444-448): Fetches HTML pages containing package links

**IndexContent (L252-271)** - Immutable dataclass representing a downloaded page response with content, content-type, encoding, URL, and cache control flags.

**HTMLLinkParser (L273-299)** - HTMLParser subclass that extracts base href and anchor elements from HTML pages for link parsing.

**CollectedSources (L385-388)** - NamedTuple containing sequences of LinkSource objects from find_links and index_urls.

**CacheablePageContent (L187-197)** - Wrapper for IndexContent enabling caching based on page URL equality/hashing.

### Core Functions

**parse_links() (L223-250)** - Decorated with caching, parses Simple API Index Content yielding Link objects. Handles both JSON (PEP 691) and HTML formats.

**_get_index_content() (L324-382)** - Fetches and validates index content from a Link, handling VCS schemes, file:// directories, and various network exceptions.

**_get_simple_response() (L113-173)** - Performs GET requests with proper headers and content-type validation for Simple API responses.

**with_cached_index_content() (L203-221)** - Higher-order function decorator providing LRU caching for link parsing based on CacheablePageContent.

### Validation & Utilities

**_ensure_api_header() (L69-88)** - Validates Content-Type headers for Simple API compliance
**_ensure_api_response() (L95-111)** - Sends HEAD requests to validate API responses
**_match_vcs_scheme() (L51-59)** - Detects VCS schemes in URLs
**_get_encoding_from_headers() (L176-184)** - Extracts character encoding from HTTP headers

### Exception Classes
- **_NotAPIContent (L62-67)** - Raised for invalid content types
- **_NotHTTP (L91-92)** - Raised for non-HTTP schemes

## Dependencies
- External: requests library, email.message, html.parser, urllib
- Internal: pip models (Link, SearchScope), network utilities, VCS support
- Local: .sources module (CandidatesFromPage, LinkSource, build_source)

## Architecture Patterns
- Factory pattern in LinkCollector.create()
- Protocol-based typing for ParseLinks function signature
- Decorator pattern for caching (with_cached_index_content)
- Comprehensive exception handling with specific error types
- Content-type negotiation with preference ordering for Simple API formats

## Critical Behavior
- Cache control: Uses max-age=0 to force revalidation while allowing conditional requests (L154)
- Content validation: Strict checking of Simple API content types before processing
- VCS scheme filtering: Prevents web page lookup for unsupported VCS URLs
- Directory handling: Automatically appends index.html to file:// directory URLs
- Link deduplication: Uses OrderedDict to remove duplicate sources by URL