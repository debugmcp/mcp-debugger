# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_internal/vcs/git.py
@source-hash: deda5cf4b400fc9e
@generated: 2026-02-09T17:59:47Z

## Primary Purpose
Git version control adapter for pip's internal VCS system. Handles Git repository operations including cloning, fetching, updating, and resolving revisions for package installations.

## Key Classes and Functions

**Git (L60-527)** - Main VCS adapter class extending VersionControl
- Core attributes: name="git", dirname=".git", schemes for git+http/https/ssh/git/file protocols
- `get_git_version()` (L94-105): Extracts Git version using regex parsing
- `get_current_branch()` (L107-130): Returns current branch name or None for detached HEAD
- `get_revision_sha()` (L132-176): Resolves revision names to commit SHAs, distinguishes branches vs tags
- `is_immutable_rev_checkout()` (L80-92): Determines if checkout represents immutable commit hash
- `resolve_revision()` (L201-245): Core revision resolution with fetching logic
- `fetch_new()` (L262-323): Initial repository cloning with partial clone support for Git 2.17+
- `update()` (L335-347): Updates existing repository, fetches and resets to target revision
- `switch()` (L325-333): Changes remote URL and checks out different revision
- `get_remote_url()` (L349-377): Extracts remote URL, prioritizes origin
- `_git_remote_to_pip_url()` (L379-408): Converts Git URLs to pip-compatible format
- `update_submodules()` (L487-494): Initializes and updates Git submodules

**Utility Functions**
- `looks_like_hash()` (L56-57): Validates 40-character hex strings as Git hashes
- `_should_fetch()` (L178-199): Determines if revision requires fetching from remote

## Key Dependencies
- pip._internal.vcs.versioncontrol: Base VersionControl class and VCS utilities
- pip._internal.utils.subprocess: Command execution via make_command
- pip._internal.exceptions: BadCommand, InstallationError handling

## Important Patterns
- **Regex-based parsing**: Git version (L30-36), commit hashes (L38), SCP URLs (L41-53)
- **Environment isolation**: Unsets GIT_DIR, GIT_WORK_TREE to prevent interference (L73)
- **Partial clone optimization**: Uses --filter=blob:none for Git 2.17+ to speed up cloning (L273-285)
- **Revision resolution strategy**: Tries branch refs first, then tag refs, with fallback to commit lookup
- **URL normalization**: Handles SSH shorthand, file paths, and standard Git URLs uniformly

## Critical Invariants
- Always resolves revisions to commit SHAs for consistency
- Maintains branch tracking when checking out specific branches
- Submodules are automatically updated after major operations
- Remote origin is preferred when multiple remotes exist
- Immutable revisions are cached only when they represent pure commit hashes (not branch/tag aliases)

## Architectural Decisions
- Uses `show-ref` for comprehensive revision lookup rather than individual commands
- Implements conservative fetching strategy to minimize network operations  
- Separates URL parsing logic to handle Git's various URL formats consistently
- Registers itself with the global VCS registry for pip integration (L527)