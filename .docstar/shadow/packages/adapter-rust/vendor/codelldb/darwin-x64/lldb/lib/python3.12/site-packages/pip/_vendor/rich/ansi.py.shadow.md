# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_vendor/rich/ansi.py
@source-hash: 883eb9df6418aa70
@generated: 2026-02-09T18:00:00Z

## Primary Purpose
ANSI escape sequence parser and decoder for converting terminal output with ANSI codes into Rich-styled Text objects. Core component for handling colorized terminal output in the Rich library.

## Key Components

### ANSI Tokenization
- `re_ansi` (L10-16): Regex pattern matching ANSI escape sequences including OSC (Operating System Commands) and SGR (Select Graphic Rendition) codes
- `_AnsiToken` (L19-25): NamedTuple representing tokenized ANSI components with `plain`, `sgr`, and `osc` fields
- `_ansi_tokenize()` (L27-55): Core tokenizer that splits ANSI text into plain text and escape codes, handling special cases like incomplete sequences

### Style Mapping
- `SGR_STYLE_MAP` (L58-116): Comprehensive mapping from SGR numeric codes to Rich style strings, covering:
  - Text attributes (bold, italic, underline, etc.)
  - Standard and bright colors (30-37, 90-97)
  - Background colors (40-47, 100-107)
  - Reset and negation codes

### ANSI Decoder
- `AnsiDecoder` (L119-210): Main decoder class that maintains style state across lines
  - `__init__()` (L122-123): Initializes with null style
  - `decode()` (L125-135): Processes multi-line terminal text
  - `decode_line()` (L137-210): Core decoding logic handling:
    - Plain text preservation with current styling
    - OSC hyperlink sequences (8; prefix)
    - SGR color codes (38 foreground, 48 background) with 256-color and RGB support
    - Style accumulation and reset (code 0)

### Command-Line Interface
- Lines 213-240: Standalone PTY spawner for capturing and converting terminal output to HTML (non-Windows only)

## Key Dependencies
- `.color.Color`: Color creation from ANSI codes and RGB values
- `.style.Style`: Style object manipulation and parsing
- `.text.Text`: Rich text representation with styling

## Critical Behavior
- Style state persists across tokens within a line but resets between decode operations
- Handles malformed ANSI codes gracefully by ignoring invalid sequences
- Carriage returns are handled by taking the rightmost segment (L151)
- Uses iterator pattern with `suppress()` context manager for robust color parameter parsing