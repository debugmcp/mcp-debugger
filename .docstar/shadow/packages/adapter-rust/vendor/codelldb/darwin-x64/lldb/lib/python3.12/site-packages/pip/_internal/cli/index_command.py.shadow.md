# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_internal/cli/index_command.py
@source-hash: 1a658bf36ce9cd2e
@generated: 2026-02-09T17:59:21Z

## Purpose
Base command infrastructure for pip commands that need to interact with package indexes and the network. Provides session management, SSL configuration, and version checking capabilities while using lazy imports to optimize performance for network-light operations.

## Key Components

### Core Classes

**SessionCommandMixin (L45-133)**
- Mixin providing `_build_session()` functionality for commands needing network access
- Manages singleton PipSession instance via `get_default_session()` (L68-76)
- Handles session configuration including SSL, proxies, authentication, and timeouts
- Key methods:
  - `_get_index_urls()` (L54-66): Extracts index URLs from command options
  - `_build_session()` (L78-132): Creates configured PipSession with all network settings

**IndexGroupCommand (L141-172)**
- Abstract base class combining Command and SessionCommandMixin
- Represents commands that support index group options and pip version checking
- `handle_pip_version_check()` (L148-172): Conditionally performs pip version checks

### Utility Functions

**_create_truststore_ssl_context() (L27-42)**
- Creates SSL context using truststore library for Python 3.10+
- Handles missing SSL support and truststore import failures gracefully
- Returns None if truststore unavailable, raises CommandError for version/import issues

**_pip_self_version_check() (L135-138)**
- Wrapper around pip's self-update checking mechanism
- Takes session and options, delegates to internal check function

## Architecture Patterns

### Lazy Import Strategy
Module uses TYPE_CHECKING imports and runtime imports within methods to avoid loading heavy network dependencies unless actually needed. PipSession import occurs at method execution (L85).

### Context Management
SessionCommandMixin integrates with CommandContextMixIn to ensure proper session lifecycle management using `enter_context()` (L71).

### Configuration Aggregation
`_build_session()` consolidates all network-related configuration from options:
- Cache directory validation (L87-88)
- SSL/truststore setup (L90-98)
- Proxy configuration (L121-126)
- Authentication settings (L129-130)
- Timeout handling (L117-118)

## Dependencies
- `pip._internal.cli.base_command.Command`: Base command infrastructure
- `pip._internal.cli.command_context.CommandContextMixIn`: Context management
- `pip._internal.network.session.PipSession`: HTTP session management
- `pip._vendor.truststore`: Optional SSL truststore support

## Critical Invariants
- Cache directory must be absolute path if provided (assertion L88)
- Session is singleton per command instance (L70-71)
- Truststore requires Python 3.10+ (L28-29)
- Version checking disabled for no-index or disabled options (L157-158)