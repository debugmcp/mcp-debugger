# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_internal/network/session.py
@source-hash: 5e66a704a8d5c0f1
@generated: 2026-02-09T17:59:36Z

**Primary Purpose**: Pip's network session management system providing secure HTTP communication, authentication, caching, and trusted host handling for package installation operations.

**Core Classes**:

- `PipSession` (L320-522): Main session class extending `requests.Session` with pip-specific behavior
  - Manages retries, caching, SSL context, and trusted hosts
  - Implements security origin validation and authentication
  - Handles adapter mounting for different protocols (HTTP/HTTPS/file)

- `LocalFSAdapter` (L212-254): Handles `file://` URL requests by reading local filesystem
  - Converts file URLs to filesystem paths and returns appropriate responses
  - Sets proper headers (Content-Type, Last-Modified, Content-Length)

- `_SSLContextAdapterMixin` (L256-288): Mixin providing SSL context forwarding to pool managers
  - Enables dynamic SSL store selection at runtime for truststore backend support

- `HTTPAdapter` (L290-292): Standard HTTP adapter with SSL context support
- `CacheControlAdapter` (L294-296): Caching HTTP adapter with SSL context support  
- `InsecureHTTPAdapter` (L298-307): HTTP adapter that bypasses SSL verification
- `InsecureCacheControlAdapter` (L309-318): Caching adapter that bypasses SSL verification

**Key Functions**:

- `user_agent()` (L110-210): Generates comprehensive user agent string with system/environment info
  - Cached function that collects Python, OS, CI, and tool version details
  - Includes pip version, Python implementation, platform info, and optional Rust toolchain

- `looks_like_ci()` (L100-108): Detects CI environment by checking environment variables
- `is_secure_origin()` (L448-514): Validates if a URL origin is considered secure
  - Checks against hardcoded secure origins and user-trusted hosts
  - Supports IP address/network matching and wildcard patterns

**Security Model**:
- `SECURE_ORIGINS` (L68-78): Hardcoded list of secure protocol/host/port combinations
- Trusted host system allows bypassing HTTPS requirements for specific hosts
- Separate adapters for secure vs insecure connections
- Caching only enabled for secure origins to prevent cache poisoning

**Dependencies**: 
- Core: `requests`, `urllib3` for HTTP functionality
- Auth: `MultiDomainBasicAuth` for authentication across package indexes
- Cache: `SafeFileCache` for response caching
- Utils: URL parsing, network utilities, platform detection

**Architecture Patterns**:
- Adapter pattern for different transport protocols (HTTP/HTTPS/file)
- Mixin pattern for SSL context injection
- Session-based configuration with method chaining
- Lazy initialization with LRU caching for expensive operations

**Critical Invariants**:
- Only secure origins can use caching to prevent poisoning attacks
- Trusted hosts bypass SSL verification but maintain logging
- User agent contains comprehensive environment fingerprinting
- Retry logic specifically handles common transient errors (503, 500, 502, 520, 527)