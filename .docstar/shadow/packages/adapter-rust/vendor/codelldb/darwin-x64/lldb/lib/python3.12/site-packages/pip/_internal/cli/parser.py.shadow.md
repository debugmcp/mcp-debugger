# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_internal/cli/parser.py
@source-hash: 400918eacf0df800
@generated: 2026-02-09T17:59:23Z

**Primary Purpose**: Provides enhanced option parsing infrastructure for pip's CLI, extending optparse with custom formatters and configuration file/environment variable integration.

## Key Classes and Functions

**PrettyHelpFormatter (L18-98)**: Customizes help output formatting with terminal-aware width, aligned help positions, and semantic labeling. Key methods:
- `_format_option_strings()` (L31-55): Formats option display strings with metavars
- `format_description()` (L70-86): Conditionally labels descriptions as "Commands" or "Description" based on parser type
- `indent_lines()` (L95-97): Utility for consistent text indentation

**UpdatingDefaultsHelpFormatter (L100-130)**: Extends PrettyHelpFormatter with configuration-aware default expansion and URL credential redaction. Core functionality in `expand_default()` (L109-129) updates defaults from config before display and sanitizes URL authentication.

**CustomOptionParser (L132-152)**: Minimal optparse extension adding:
- `insert_option_group()` (L133-142): Inserts option groups at specific positions
- `option_list_all` property (L144-151): Aggregates all options including those in groups

**ConfigOptionParser (L154-294)**: Main configuration-aware parser that integrates config files and environment variables. Critical components:
- `__init__()` (L158-169): Initializes with name and Configuration instance
- `_get_ordered_configuration_items()` (L178-204): Yields config items in precedence order: global → command-specific → environment
- `_update_defaults()` (L206-268): Complex default value resolution handling various option types (store_true/false, count, append, callback)
- `get_default_values()` (L270-290): Overrides optparse to load configuration and apply defaults with validation

## Dependencies and Architecture

- **Core dependencies**: `optparse` (extended), `Configuration` for config file handling, `redact_auth_from_url` for security
- **Configuration precedence**: Global config → command-specific config → environment variables (L182)
- **Error handling**: Uses `UNKNOWN_ERROR` exit code and custom error formatting

## Notable Patterns

- **Formatter inheritance chain**: Base optparse → PrettyHelpFormatter → UpdatingDefaultsHelpFormatter
- **Late evaluation pattern**: Callback options processed after initial defaults to handle complex interdependencies (L253, L265-266)
- **Type-specific processing**: Custom handling for boolean, count, append, and callback option types in `_update_defaults()`
- **Terminal awareness**: Dynamic width calculation based on terminal size (L25)

## Critical Invariants

- Configuration keys must be prefixed with "--" for option lookup (L217)
- Option destinations must be non-None for configuration processing
- Boolean config values validated using `strtobool()` with user-friendly error messages
- URL metavar options automatically have credentials redacted in help text