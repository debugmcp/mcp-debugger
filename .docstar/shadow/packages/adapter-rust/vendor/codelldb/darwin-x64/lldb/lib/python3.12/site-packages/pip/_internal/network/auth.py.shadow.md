# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_internal/network/auth.py
@source-hash: 891bb92c110c2bfd
@generated: 2026-02-09T17:59:38Z

## Core Purpose
Provides network authentication infrastructure for pip's package installation process, handling credential management across multiple domains with support for keyring integration, netrc files, and interactive prompting.

## Key Classes

### Credentials (L39-43)
NamedTuple storing authentication triplet: url, username, password. Used for credential caching and keyring operations.

### KeyRingBaseProvider (L45-57) 
Abstract base class defining keyring interface with methods `get_auth_info()` and `save_auth_info()`. Subclasses provide different keyring implementations.

### KeyRingNullProvider (L59-69)
No-op keyring implementation that returns None for all operations. Used when keyring is disabled or unavailable.

### KeyRingPythonProvider (L71-101)
Keyring implementation using locally imported `keyring` package. Supports both legacy `get_password()` and modern `get_credential()` APIs (L85-90). Handles credential retrieval and storage through Python keyring library.

### KeyRingCliProvider (L103-160)
Keyring implementation using external `keyring` CLI executable. Spawns subprocess calls to keyring command with UTF-8 encoding enforcement (L136, L152). Provides fallback when Python keyring package is unavailable.

### MultiDomainBasicAuth (L224-562)
Main authentication handler implementing requests.auth.AuthBase interface. Core authentication orchestrator with these responsibilities:

**Initialization (L225-240):**
- `prompting`: Controls interactive credential prompts
- `index_urls`: List of package index URLs for credential matching
- `keyring_provider`: Configurable keyring backend
- `passwords`: Domain-to-credentials cache
- `_credentials_to_save`: Pending keyring save operations

**Credential Resolution Pipeline:**
1. `_get_new_credentials()` (L331-386): Multi-source credential lookup
   - URL-embedded credentials (highest priority)
   - Index URL credentials 
   - Netrc file credentials
   - Keyring credentials (lowest priority)

2. `_get_url_and_credentials()` (L388-434): Credential aggregation with caching logic

**Request Processing:**
- `__call__()` (L436-450): Requests auth handler that strips credentials from URLs and applies HTTPBasicAuth
- `handle_401()` (L476-537): 401 response handler with interactive prompting and credential retry

## Key Functions

### get_keyring_provider() (L162-221)
Factory function with LRU caching that returns appropriate keyring provider based on configuration. Implements fallback chain: Python import → CLI subprocess → null provider. Includes complex PATH manipulation (L184-214) to avoid circular keyring dependencies.

## Authentication Flow
1. Request intercepted by `__call__()`
2. Credentials resolved via multi-source lookup
3. Basic auth applied to request
4. 401 handler registered for credential retry
5. On auth failure, keyring queried and user prompted
6. Successful credentials optionally saved to keyring

## Critical Dependencies
- `pip._vendor.requests.auth`: HTTPBasicAuth implementation
- `pip._internal.utils.misc`: User interaction utilities (ask, ask_input, ask_password)
- External keyring package or CLI for credential storage

## Global State
- `KEYRING_DISABLED` (L36): Global flag to disable keyring after failures
- LRU cache on `get_keyring_provider()` for provider singleton behavior

## Security Considerations
- URL credential stripping to prevent credential leakage
- Subprocess environment isolation for CLI keyring
- Credential caching limited to session scope
- Optional keyring persistence with user consent