# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_vendor/urllib3/util/ssl_match_hostname.py
@source-hash: 22be1c6551239809
@generated: 2026-02-09T17:57:41Z

## SSL Hostname Verification Utility

Implements SSL certificate hostname verification following RFC 2818 and RFC 6125 standards. This is a backported version of Python 3.3.3's `match_hostname()` function for compatibility with older Python versions.

### Core Functionality

**`match_hostname(cert, hostname)` (L98-159)**
- Primary function that verifies SSL certificate matches target hostname
- Accepts decoded certificate (from `SSLSocket.getpeercert()`) and hostname string
- Raises `CertificateError` on mismatch, returns `None` on success
- Handles both DNS names and IP addresses
- Checks subjectAltName extension first, falls back to commonName in certificate subject

**`CertificateError` (L21-22)**
- Custom exception class inheriting from `ValueError`
- Raised when hostname verification fails

### DNS Matching Logic

**`_dnsname_match(dn, hostname, max_wildcards=1)` (L25-76)**
- Implements RFC 6125 section 6.4.3 wildcard matching rules
- Handles wildcard certificates with security restrictions (max 1 wildcard per label)
- Special handling for internationalized domain names (IDN) with "xn--" prefix
- Returns boolean match result using compiled regex pattern
- Protects against DoS attacks by limiting wildcards

### IP Address Handling

**`_ipaddress_match(ipname, host_ip)` (L86-95)**
- Exact IP address matching for certificate IP addresses
- Uses `ipaddress` module when available (graceful degradation if missing)
- Handles OpenSSL trailing newline quirk in subjectAltName IP addresses

**`_to_unicode(obj)` (L79-83)**
- Utility for Python 2/3 compatibility
- Converts byte strings to unicode for `ipaddress` module compatibility

### Key Dependencies
- `ipaddress` module (optional, L13-16) - for IP address parsing and comparison
- `re` module - for wildcard pattern matching
- `sys` module - for Python version detection

### Security Considerations
- Wildcard limit enforcement prevents ReDoS attacks
- RFC-compliant internationalized domain name handling
- Proper certificate chain validation order (subjectAltName before commonName)

### Version Compatibility
- Supports Python 2.7+ with graceful degradation
- Handles missing `ipaddress` module in older Python versions
- Unicode/byte string compatibility layer for cross-version support