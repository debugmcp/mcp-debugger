# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_vendor/rich/text.py
@source-hash: e6b437cef36b8395
@generated: 2026-02-09T18:00:26Z

## Purpose & Responsibility
Core text rendering and styling module for the Rich library. Provides the `Text` class for creating, manipulating, and rendering styled text with support for markup, ANSI codes, wrapping, alignment, and complex style spans.

## Key Classes

### Span (L46-115)
`NamedTuple` representing a styled text region with start/end indices and associated style.

**Key Methods:**
- `split(offset)` (L62-73): Splits span at given offset, returns tuple of spans
- `move(offset)` (L75-85): Shifts span position by offset
- `right_crop(offset)` (L87-99): Crops span at specified position
- `extend(cells)` (L101-114): Extends span by number of cells

### Text (L117-1330)
Primary class for styled text with comprehensive text manipulation capabilities.

**Core Properties:**
- `_text: List[str]` (L156): Internal text storage as list of strings
- `_spans: List[Span]` (L163): Style spans applied to text
- `style`, `justify`, `overflow`, `no_wrap`, `end`, `tab_size` (L157-162): Rendering options

**Factory Methods:**
- `from_markup(text, style=...)` (L258-290): Creates Text from console markup
- `from_ansi(text, style=...)` (L292-328): Creates Text from ANSI escape codes
- `styled(text, style=...)` (L330-353): Creates Text with pre-applied style
- `assemble(*parts, style=...)` (L355-399): Combines strings/tuples with styles

**Text Manipulation:**
- `append(text, style=None)` (L962-1004): Adds text with optional styling
- `stylize(style, start=0, end=None)` (L456-480): Applies style to text range
- `highlight_regex(re_highlight, style=...)` (L592-628): Highlights regex matches
- `highlight_words(words, style, case_sensitive=True)` (L630-657): Highlights word list

**Layout & Formatting:**
- `wrap(console, width, justify=..., overflow=...)` (L1198-1244): Word wraps text
- `truncate(max_width, overflow=..., pad=False)` (L857-883): Truncates to width
- `align(align, width, character=" ")` (L942-961): Aligns text within width
- `pad_left/pad_right/pad(count, character=" ")` (L915-941): Adds padding

**Advanced Operations:**
- `split(separator="\n", include_separator=False)` (L1059-1101): Splits preserving styles
- `divide(offsets)` (L1103-1180): Divides text at specified offsets with binary search optimization
- `join(lines)` (L776-813): Joins Text instances with this as separator
- `expand_tabs(tab_size=None)` (L815-856): Converts tabs to spaces

**Rendering:**
- `render(console, end="")` (L717-774): Converts to Segment stream for console output
- `__rich_console__(console, options)` (L686-703): Rich protocol implementation
- `markup` property (L228-256): Generates console markup representation

## Key Dependencies
- `Style`, `StyleType` from `.style` (L29): Style system integration
- `Segment` from `.segment` (L28): Console rendering primitives
- `strip_control_codes` from `.control` (L24): Text sanitization
- `cell_len`, `set_cell_size` from `.cells` (L22): Unicode width handling
- `divide_line` from `._wrap` (L20): Text wrapping logic

## Notable Patterns
- **Immutable-style operations**: Most methods return new Text instances rather than modifying in place
- **Span management**: Complex span splitting/merging logic maintains style integrity during text operations
- **Performance optimizations**: Uses binary search for span division (L1142-1178), caches style combinations (L752-764)
- **Rich protocol**: Implements `__rich_console__` and `__rich_measure__` for console integration

## Critical Invariants
- Text content is always sanitized via `strip_control_codes` (L155, L412, L980)
- Spans must not extend beyond text length - enforced by `_trim_spans()` (L884-896)
- Internal `_text` list maintains text fragments, consolidated to single string via `plain` property (L402-406)
- Length tracking via `_length` field must stay synchronized with actual text length