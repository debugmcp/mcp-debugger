# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_vendor/urllib3/_collections.py
@source-hash: a72012249856ef07
@generated: 2026-02-09T18:00:14Z

## Primary Purpose
Custom collection classes for urllib3: a thread-safe LRU cache container and a case-insensitive HTTP header dictionary with multi-value support.

## Key Classes

### RecentlyUsedContainer (L31-105)
Thread-safe LRU (Least Recently Used) cache implementing MutableMapping interface.
- **Constructor (L47-52)**: Takes `maxsize` (default 10) and optional `dispose_func` callback
- **Core mechanism**: Uses OrderedDict + RLock for thread safety
- **Access pattern (L54-59)**: `__getitem__` moves accessed items to end (most recent)
- **Eviction (L61-74)**: `__setitem__` removes oldest items when exceeding maxsize
- **Thread safety**: All operations protected by RLock instance
- **Key constraint**: `__iter__` raises NotImplementedError due to thread safety concerns
- **Cleanup**: Calls `dispose_func(value)` on evicted/deleted items if provided

### HTTPHeaderDict (L107-355) 
Case-insensitive HTTP header container supporting multiple values per header name.
- **Constructor (L141-150)**: Accepts headers dict/iterable and kwargs
- **Storage format**: `_container[key.lower()] = [original_key, value1, value2, ...]`
- **Case handling**: All lookups use `key.lower()` but preserve original casing
- **Multi-value support (L215-229)**: `add()` method appends values instead of overwriting
- **Value access (L156-158)**: Returns comma-separated string of all values
- **Specialized methods**:
  - `getlist()` (L259-269): Returns list of values for a key
  - `extend()` (L231-257): Bulk import supporting various input formats
  - `_prepare_for_method_change()` (L271-287): Removes content headers per RFC 9110
  - `from_httplib()` (L329-355): Parses Python 2 httplib message objects with line folding support

## Dependencies & Imports
- **Collections**: Uses OrderedDict as underlying storage, imports Mapping/MutableMapping with fallback (L3-6)
- **Threading**: RLock with platform fallback no-op implementation (L7-16)
- **Internal**: `.exceptions.InvalidHeader`, `.packages.six` for Python 2/3 compatibility (L21-23)

## Key Patterns
- **Thread safety**: RecentlyUsedContainer uses RLock around all container operations
- **Case preservation**: HTTPHeaderDict stores original case but uses lowercase keys for lookups
- **Compatibility**: Extensive backward compatibility aliases (L289-295) and Python 2 support
- **Sentinel pattern**: Uses `_Null = object()` and `__marker = object()` for default values

## Critical Invariants
- RecentlyUsedContainer: Container size never exceeds `_maxsize`
- HTTPHeaderDict: Internal storage format `[original_key, val1, val2, ...]` must be maintained
- Case-insensitive lookups while preserving original header name casing
- Thread safety for RecentlyUsedContainer requires lock acquisition for all operations