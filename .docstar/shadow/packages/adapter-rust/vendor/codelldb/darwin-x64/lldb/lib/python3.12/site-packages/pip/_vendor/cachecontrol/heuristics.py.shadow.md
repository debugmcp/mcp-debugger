# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_vendor/cachecontrol/heuristics.py
@source-hash: 2187b84261c4456b
@generated: 2026-02-09T17:59:39Z

## HTTP Cache Heuristics Module

**Purpose:** Implements cache expiration heuristics for HTTP responses when explicit cache headers are missing. Part of pip's vendored cachecontrol library for managing HTTP caching behavior.

### Key Functions

**expire_after() (L18-21):** Calculates future expiration datetime by adding timedelta to current time (or provided date). Returns UTC datetime.

**datetime_to_header() (L23-25):** Converts datetime object to HTTP-formatted date string using email.utils.formatdate and calendar.timegm.

### Core Classes

**BaseHeuristic (L27-58):** Abstract base class defining heuristic interface.
- `warning()` (L28-37): Returns default "110 - Response is Stale" warning header
- `update_headers()` (L39-46): Template method for subclasses to provide new headers
- `apply()` (L48-57): Main entry point that updates response headers and adds warning headers

**OneDayCache (L60-75):** Simple 1-day cache heuristic.
- `update_headers()` (L66-74): Sets "expires" header 1 day from response date if not already present, adds "cache-control: public"

**ExpiresAfter (L77-92):** Configurable time-based caching.
- `__init__()` (L82-83): Accepts timedelta kwargs to set cache duration
- `update_headers()` (L85-87): Sets expires header based on configured delta from current time
- `warning()` (L89-91): Returns custom warning mentioning cache duration

**LastModified (L94-152):** RFC 7234 compliant heuristic using Last-Modified header.
- `cacheable_by_default_statuses` (L107-119): Set of HTTP status codes considered cacheable
- `update_headers()` (L121-151): Complex logic implementing Mozilla-style freshness calculation:
  - Requires both "date" and "last-modified" headers
  - Calculates freshness_lifetime as min(age_since_modification/10, 24_hours)
  - Only caches if remaining freshness exceeds current age
- `warning()` (L153-154): Returns None (no warning for standards-compliant heuristic)

### Key Architectural Patterns

- **Strategy Pattern:** BaseHeuristic defines interface with concrete implementations
- **Template Method:** BaseHeuristic.apply() orchestrates header updates and warning generation
- **Conservative Caching:** LastModified implements strict RFC compliance with 24-hour limit
- **Type Safety:** Extensive use of type hints and TYPE_CHECKING imports

### Critical Dependencies

- urllib3.HTTPResponse for HTTP response manipulation
- email.utils for HTTP date formatting
- datetime/calendar for time calculations

### Important Constants

- `TIME_FMT` (L15): GMT format string for HTTP date headers
- 24-hour maximum cache limit in LastModified heuristic (L146)