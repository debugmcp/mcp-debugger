# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_vendor/packaging/metadata.py
@source-hash: 28836e4a4275daef
@generated: 2026-02-09T17:59:58Z

## Purpose
This module provides comprehensive Python packaging metadata parsing and validation functionality. It parses metadata from email-formatted headers (like METADATA files) into structured Python objects, supporting all metadata versions from 1.0 to 2.3.

## Key Components

### Core Data Structures
- **RawMetadata (L64-130)**: TypedDict defining all possible metadata fields from PEP specifications 241, 314, 345, 566, 643, and 685. Maps snake_case field names to their values (strings, lists, or dicts).
- **_STRING_FIELDS, _LIST_FIELDS, _DICT_FIELDS (L132-166)**: Field categorization constants for parsing logic.

### Exception Classes
- **ExceptionGroup (L24-46)**: Compatibility implementation for Python <3.11, handles multiple validation errors.
- **InvalidMetadata (L49-57)**: Raised when metadata field validation fails, includes field name context.

### Email Parsing System
- **parse_email (L276-449)**: Core parser converting email-formatted metadata to RawMetadata. Handles encoding issues, duplicate fields, and special cases like keywords/project URLs.
- **_EMAIL_TO_RAW_MAPPING (L243-273)**: Maps hyphenated email headers to snake_case raw metadata keys.
- **_get_payload (L214-228)**: Extracts email body content with proper encoding handling.

### Parsing Utilities
- **_parse_keywords (L169-171)**: Splits comma-separated keywords into list.
- **_parse_project_urls (L174-211)**: Converts "label, url" strings to dictionary, with duplicate detection.

### Validation Framework
- **_Validator (L462-635)**: Generic descriptor class providing field-specific validation and caching. Each metadata field uses a _Validator instance with custom _process_* methods:
  - `_process_metadata_version` (L523-527): Validates against allowed versions
  - `_process_name` (L529-540): Uses packaging.utils.canonicalize_name
  - `_process_version` (L542-550): Parses using packaging.version
  - `_process_summary` (L552-556): Ensures single line
  - `_process_description_content_type` (L558-588): Validates MIME types
  - `_process_dynamic` (L590-598): Validates dynamic field names
  - `_process_provides_extra` (L600-613): Normalizes extra names
  - `_process_requires_python` (L615-621): Parses version specifiers
  - `_process_requires_dist` (L623-634): Parses requirement strings

### High-Level Interface
- **Metadata (L637-804)**: Main class with validated, typed attributes for all metadata fields. Provides:
  - `from_raw` (L649-703): Creates instance from RawMetadata with optional validation
  - `from_email` (L706-731): Parses email-formatted metadata directly
  - Extensive field definitions (L733-803) with version requirements and validation

## Architecture Patterns
- **Descriptor Protocol**: _Validator uses `__get__` for lazy validation and caching
- **Two-Phase Parsing**: Raw parsing followed by optional validation phase
- **Version-Aware Validation**: Checks field availability against metadata version
- **Graceful Degradation**: Unparseable fields moved to separate dict rather than failing

## Dependencies
- email module for RFC-compliant parsing
- packaging.requirements, packaging.specifiers, packaging.utils for domain validation
- packaging.version for version parsing

## Critical Invariants
- Metadata fields are immutable after validation
- All validation errors collected and raised as ExceptionGroup
- Raw metadata preserves original data structure for debugging
- Field names consistently use snake_case internally, hyphen-case for email headers