# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_internal/resolution/resolvelib/resolver.py
@source-hash: 9cb24eb15304562d
@generated: 2026-02-09T17:57:40Z

## Purpose
Main resolver implementation for pip's resolvelib-based dependency resolution engine. Orchestrates the resolution process from root requirements to a complete installation order while handling conflicts, constraints, and upgrade strategies.

## Key Components

### Resolver Class (L38-214)
Core resolver inheriting from `BaseResolver`. Manages the complete resolution workflow:
- **Constructor (L41-71)**: Initializes with preparer, finder, wheel cache, and resolution configuration. Creates internal `Factory` for candidate/requirement management
- **resolve() (L73-183)**: Main resolution method that:
  - Collects root requirements via factory (L76)
  - Creates `PipProvider` with constraints and upgrade strategy (L77-83)
  - Configures reporter based on `PIP_RESOLVER_DEBUG` environment variable (L84-87)
  - Runs resolvelib resolution with 200,000 round limit (L94-97)
  - Converts resolution result to `RequirementSet`, handling extras and reinstallation logic (L106-183)
- **get_installation_order() (L185-214)**: Generates topologically sorted installation order using dependency graph weights

### Resolution Configuration
- **_allowed_strategies (L39)**: Validates upgrade strategies ("eager", "only-if-needed", "to-satisfy-only")
- **Resolution limit (L94)**: Hard-coded 200,000 rounds maximum to prevent infinite loops
- **Environment-based debugging (L84)**: Uses `PipDebuggingReporter` when `PIP_RESOLVER_DEBUG` is set

### Reinstallation Logic (L127-158)
Complex decision tree for determining when to reinstall:
- Force reinstall flag takes precedence
- Version mismatches trigger reinstall
- Editable packages always reinstall
- Local files (non-wheels) reinstall
- Local wheels skip with warning message

### Topological Sorting

#### get_topological_weights() (L217-303)
Assigns installation weights based on dependency depth:
- **Leaf pruning optimization (L270-292)**: Removes dependency-free packages iteratively for performance on large graphs (200+ packages)
- **Depth-first traversal (L248-263)**: Calculates path lengths while detecting cycles
- **Cycle handling (L249-251)**: Breaks cycles by skipping already-visited nodes in current path
- **Weight assignment (L262-263)**: Uses maximum path depth as weight

#### _req_set_item_sorter() (L306-317)
Sort key function using topological weights with canonical name as tiebreaker for deterministic ordering.

## Dependencies
- **resolvelib**: External resolution library (`RLResolver`, `ResolutionImpossible`)
- **Internal pip modules**: Factory, PipProvider, reporters, requirement handling
- **Type checking**: Uses TYPE_CHECKING guard for resolvelib Result type (L29-32)

## Critical Patterns
- **Error transformation (L99-104)**: Catches `ResolutionImpossible` and converts to pip-specific installation errors
- **Extras handling (L111-124)**: Processes candidates with extras after base packages to ensure proper dependency resolution
- **Yanked package warnings (L161-174)**: Logs warnings for yanked packages but allows installation
- **Graph mutation (L291-292)**: Modifies dependency graph during leaf pruning for performance optimization

## Constraints
- Resolution complexity limited to 200,000 rounds
- Requires factory.collect_root_requirements() to be called before resolution
- get_installation_order() must be called after resolve()
- Topological sorting assumes None as root node (resolvelib guarantee)