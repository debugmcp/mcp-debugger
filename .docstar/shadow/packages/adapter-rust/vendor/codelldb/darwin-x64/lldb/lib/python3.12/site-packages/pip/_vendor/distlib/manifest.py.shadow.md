# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_vendor/distlib/manifest.py
@source-hash: dea7e6026570c51a
@generated: 2026-02-09T17:59:49Z

## Primary Purpose
Python package file manifest system for distlib, providing file discovery and filtering capabilities similar to distutils.filelist but with fixes. Handles MANIFEST.in-style directives for including/excluding files in Python package distributions.

## Key Classes and Functions

### Manifest Class (L38-394)
Core class managing file discovery and filtering for Python package distributions.

**Constructor (L44-53):**
- `__init__(base=None)` - Initializes with base directory (defaults to cwd), sets up file tracking

**Key Attributes:**
- `base` - Absolute normalized base directory path
- `prefix` - Base directory with trailing separator
- `allfiles` - List of all discovered files (populated by findall())
- `files` - Set of currently selected files

**Public API Methods:**
- `findall()` (L59-84) - Recursively discovers all regular files under base directory using stack-based traversal
- `add(item)` (L86-94) - Adds single file to manifest, handles relative/absolute paths
- `add_many(items)` (L96-103) - Bulk adds multiple files
- `sorted(wantdirs=False)` (L105-125) - Returns sorted file list, optionally including parent directories
- `clear()` (L127-130) - Resets file collections
- `process_directive(directive)` (L132-194) - Main entry point for processing MANIFEST.in-style commands

**Private Implementation Methods:**
- `_parse_directive(directive)` (L200-245) - Parses and validates directive syntax, returns action components
- `_include_pattern(pattern, anchor=True, prefix=None, is_regex=False)` (L247-286) - Adds matching files to selection
- `_exclude_pattern(pattern, anchor=True, prefix=None, is_regex=False)` (L288-306) - Removes matching files from selection  
- `_translate_pattern(pattern, anchor=True, prefix=None, is_regex=False)` (L308-361) - Converts glob patterns to compiled regex
- `_glob_to_re(pattern)` (L363-384) - Converts shell glob to regex, handling platform-specific path separators

## Dependencies and Relationships
- Imports: `fnmatch`, `logging`, `os`, `re`, `sys`, `DistlibException`, `fsdecode`, `convert_path`
- Exports: `Manifest` class only (L22)
- Uses distlib utility functions for path conversion and filesystem decoding

## Key Patterns and Architecture

**Directive Processing System:**
Supports 8 MANIFEST.in-style actions: `include`, `exclude`, `global-include`, `global-exclude`, `recursive-include`, `recursive-exclude`, `graft`, `prune`

**Pattern Matching Strategy:**
- Lazy loading of `allfiles` via `findall()` when needed
- Custom glob-to-regex translation that respects platform path separators
- Python version-specific regex handling (L323, L329, L337, L347, L356)

**File Discovery Algorithm:**
Stack-based directory traversal avoiding symbolic link loops, collecting only regular files

## Critical Invariants
- Base directory always stored as absolute normalized path
- File paths in collections are absolute
- Pattern matching respects platform-specific path separators
- Regex compilation handles Python version differences in fnmatch.translate behavior