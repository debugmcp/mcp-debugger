# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_vendor/truststore/
@generated: 2026-02-09T18:16:17Z

## Primary Purpose

The `truststore` package provides cross-platform SSL certificate verification using native system trust stores. It acts as a drop-in replacement for Python's standard SSL library, enabling applications to leverage OS-native certificate validation (Windows Crypto API, macOS Security Framework, OpenSSL) without manual certificate management.

## Architecture Overview

The package follows a layered architecture with clear separation of concerns:

### Public API Layer (`__init__.py`)
- **Entry Point**: Defines the public interface with three core exports
- **Version Gating**: Enforces Python 3.10+ requirement at import time
- **Clean Interface**: Exports `SSLContext`, `inject_into_ssl`, and `extract_from_ssl`

### Core Implementation (`_api.py`)
- **Drop-in Replacement**: `SSLContext` class that wraps standard `ssl.SSLContext` using delegation pattern
- **Platform Abstraction**: Routes to platform-specific implementations via dynamic imports
- **Monkey Patching**: `inject_into_ssl()` and `extract_from_ssl()` functions for global SSL behavior modification
- **Certificate Verification**: Custom `_verify_peercerts()` function that delegates to platform implementations

### Platform-Specific Backends

#### Windows (`_windows.py`)
- **Native Integration**: Uses Windows Crypto API (crypt32.dll) via ctypes
- **Dual Verification**: System trust store + custom CA fallback
- **Chain Engine**: Creates isolated certificate chain engines for custom CAs
- **Policy Validation**: Maps SSL context settings to Windows certificate chain policies

#### macOS (`_macos.py`)
- **Framework Bindings**: Comprehensive ctypes bindings to Security and CoreFoundation frameworks
- **Trust Evaluation**: Uses SecTrust objects for certificate validation
- **Memory Management**: RAII pattern with proper CoreFoundation object lifecycle
- **Error Translation**: Converts OSStatus codes to Python SSL exceptions

#### OpenSSL/Linux (`_openssl.py`)
- **CA Discovery**: Automatic detection of system CA certificate files across distributions
- **Fallback Chain**: Tries OpenSSL defaults first, then common system paths
- **Minimal Implementation**: Delegates to SSL context's native `CERT_REQUIRED` verification
- **Cross-Distribution**: Supports Alpine, Arch, Fedora, RHEL, Debian, Ubuntu, SUSE, BSD

### Support Infrastructure (`_ssl_constants.py`)
- **Compatibility Layer**: Handles differences between CPython and non-CPython implementations
- **Reference Preservation**: Maintains original SSLContext behavior during injection cycles
- **Safe Delegation**: Provides utility for bypassing truststore overrides when needed

## Public API Surface

### Main Entry Points
1. **`truststore.SSLContext`**: Drop-in replacement for `ssl.SSLContext` with system trust store integration
2. **`truststore.inject_into_ssl()`**: Global monkey patch replacing `ssl.SSLContext` with truststore implementation
3. **`truststore.extract_from_ssl()`**: Restores original SSL behavior, undoing the injection

### Key Features
- **API Compatibility**: Full compatibility with standard `ssl.SSLContext` interface
- **Automatic Platform Detection**: Selects appropriate backend based on operating system
- **Custom CA Support**: Integrates with SSL context's custom CA certificates
- **Hostname Verification**: Respects SSL context's `check_hostname` setting
- **Error Consistency**: Translates platform-specific errors to standard Python SSL exceptions

## Data Flow

1. **Initialization**: Platform detection and backend loading during import
2. **Context Creation**: `SSLContext` wraps standard SSL context with platform-specific configuration
3. **Socket Wrapping**: Custom SSL objects intercept handshake completion for verification
4. **Certificate Verification**: Platform backend validates certificate chain using system trust stores
5. **Error Handling**: Platform errors translated to standard SSL exceptions with detailed messages

## Critical Design Patterns

- **Delegation over Inheritance**: Composition pattern maintains SSL context compatibility
- **Platform Abstraction**: Uniform interface across different OS trust store implementations
- **Context Managers**: Proper resource cleanup and temporary state management
- **Error Translation**: Consistent Python exception interface across platform-specific backends
- **Memory Safety**: Careful handling of native resources with proper cleanup patterns

## Dependencies

- **System Requirements**: Python 3.10+, platform-specific system libraries
- **Standard Library**: `ssl`, `socket`, `ctypes`, `contextlib`, `os`, `platform`, `sys`
- **Type Hints**: `typing_extensions` for enhanced type support
- **Platform Libraries**: Native OS frameworks (Security/CoreFoundation on macOS, crypt32 on Windows)

The package provides a seamless integration point for applications requiring robust, OS-native certificate validation while maintaining full compatibility with existing Python SSL code.