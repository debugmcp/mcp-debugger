# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_vendor/pyproject_hooks/_impl.py
@source-hash: eb5189c73422a742
@generated: 2026-02-09T17:59:58Z

**PEP 517 Build Backend Hook Interface Implementation**

This module provides a Python implementation for calling PEP 517 build backend hooks via subprocess isolation. It serves as the primary interface between build tools (like pip) and project build backends.

## Core Classes

**BuildBackendHookCaller (L98-330)**: Main interface class that wraps build backend hook invocation. Manages subprocess execution, environment setup, and communication via temporary JSON files. Key responsibilities:
- Initialize with source directory, backend specification, and optional backend path
- Execute hooks in isolated subprocess with proper environment variables
- Handle fallback mechanisms for optional hooks
- Parse and validate hook responses, raising appropriate exceptions

## Exception Hierarchy

- **BackendUnavailable (L23-27)**: Raised when backend module cannot be imported
- **BackendInvalid (L29-35)**: Raised for invalid backend specifications  
- **HookMissing (L37-42)**: Raised when required hooks are not implemented
- **UnsupportedOperation (L44-48)**: Raised when backend explicitly rejects an operation

## Utility Functions

**JSON I/O Functions (L13-21)**: 
- `write_json()`: UTF-8 JSON serialization with kwargs passthrough
- `read_json()`: UTF-8 JSON deserialization

**Subprocess Runners (L50-72)**:
- `default_subprocess_runner()`: Standard execution using `subprocess.check_call`
- `quiet_subprocess_runner()`: Silent execution using `subprocess.check_output` with stderr redirect

**Path Validation (L74-96)**:
- `norm_and_check()`: Validates backend paths are relative and within source tree, prevents directory traversal attacks

## Hook Methods

The class implements all PEP 517 hooks with consistent patterns:

**Wheel Building**:
- `get_requires_for_build_wheel()` (L155-169)
- `prepare_metadata_for_build_wheel()` (L170-191) 
- `build_wheel()` (L192-214)

**Editable Wheel Building**:
- `get_requires_for_build_editable()` (L215-229)
- `prepare_metadata_for_build_editable()` (L230-251)
- `build_editable()` (L252-275)

**Source Distribution Building**:
- `get_requires_for_build_sdist()` (L276-285)
- `build_sdist()` (L286-296)

**Internal Methods**:
- `_supported_features()` (L151-154): Query backend capabilities
- `_call_hook()` (L297-330): Core subprocess communication logic

## Architecture

Uses subprocess isolation with JSON-based IPC:
1. Serializes hook parameters to temporary `input.json`
2. Executes hook script with environment variables for backend specification
3. Deserializes results from `output.json`
4. Handles error conditions via structured response format

Environment variables used:
- `PEP517_BUILD_BACKEND`: Backend module specification
- `PEP517_BACKEND_PATH`: Additional Python path entries

Dependencies: `_in_process` module for hook script management, standard library modules for subprocess, filesystem, and JSON operations.