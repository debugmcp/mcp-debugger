# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_vendor/distlib/wheel.py
@source-hash: 155402bdef2ef8bd
@generated: 2026-02-09T18:00:03Z

## Primary Purpose
Python wheel package implementation for building and installing wheel files (PEP 427). Part of the distlib library, handles wheel creation, installation, verification, and compatibility checking.

## Key Components

### Platform/Environment Detection (L37-78)
- Auto-detects Python implementation prefix (`IMP_PREFIX`): PyPy, Jython, IronPython, or CPython
- Derives ABI tags using `_derive_abi()` (L59-77) for proper wheel naming
- Sets up platform-specific constants: `PYVER`, `IMPVER`, `ARCH`, `ABI`

### Regular Expressions (L80-101)
- `FILENAME_RE` (L80-89): Parses wheel filename format (name-version-build-python-abi-arch.whl)
- `NAME_VERSION_RE` (L91-96): Extracts name/version from partial filenames
- `SHEBANG_*` patterns (L98-101): Handle script shebang processing

### Mounter Class (L135-170)
Meta-path finder for loading dynamic libraries from wheels. Manages `impure_wheels` registry and provides module loading via `find_module()`/`load_module()` interface.

### Wheel Class (L175-990)
Main wheel manipulation class with comprehensive functionality:

#### Core Properties
- `filename` (L224-239): Constructs wheel filename from components
- `metadata` (L253-283): Cached property that extracts and parses wheel metadata
- `info` (L294-299): Cached wheel metadata dictionary
- `tags` (L246-251): Generator yielding (python, abi, arch) compatibility tags

#### Build Operations
- `build()` (L372-487): Creates wheel from file paths, handles pure/platform libs differently
- `process_shebang()` (L301-329): Normalizes script shebangs to `#!python` format
- `write_records()` (L350-364): Generates RECORD file with file hashes and sizes

#### Installation Operations
- `install()` (L505-743): Full wheel installation with script generation, bytecode compilation
- Supports dry-run mode, lib-only installation, bytecode hashing (PEP-552)
- Handles data/scripts/headers placement and permission preservation

#### Verification & Mounting
- `verify()` (L834-888): Validates wheel integrity via RECORD file hash/size checks
- `mount()`/`unmount()` (L801-832): Add/remove wheels from sys.path for direct import
- `update()` (L890-990): Generic wheel content modification with version auto-increment

#### Utility Methods
- `get_hash()` (L331-341): Computes file hashes (default SHA256) in base64 format
- `skip_entry()` (L489-503): Determines which archive entries to skip during processing
- `_get_extensions()` (L754-787): Extracts and caches dynamic library extensions

## Compatibility System

### Tag Generation (L1004-1086)
`compatible_tags()` generates comprehensive compatibility matrix:
- Python version compatibility (current and older minors)
- ABI compatibility including manylinux variants for different glibc versions
- Architecture compatibility with macOS universal binaries and fat binaries
- Returns sorted set of (python, abi, arch) tuples

### Compatibility Checking
- `is_compatible()` (L1089-1099): Tests wheel against platform compatibility tags
- `COMPATIBLE_TAGS` (L1084): Pre-computed compatibility set for current platform

## Key Dependencies
- Uses `ZipFile` from `.compat` for cross-version zip handling
- Integrates with `.metadata.Metadata` for wheel metadata parsing
- Leverages `.util.FileOperator` for file operations with rollback support
- Connects to `.database.InstalledDistribution` for installation tracking

## Architectural Patterns
- Extensive use of cached properties for expensive operations (metadata parsing)
- Context manager pattern for safe zip file and temporary directory handling
- Plugin architecture via meta-path finder for dynamic library loading
- Version-aware processing with fallbacks for legacy wheel formats
- Comprehensive error handling with custom `DistlibException`

## Critical Invariants
- Wheel filenames must match PEP 427 format for successful parsing
- RECORD file integrity is mandatory - installation fails on hash/size mismatches
- Platform compatibility is strictly enforced for mounting operations
- Script shebang normalization ensures cross-platform compatibility