# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_internal/models/link.py
@source-hash: 8c76b1f4efbdce54
@generated: 2026-02-09T17:59:37Z

## Purpose
Core module for modeling package index links in pip's internal architecture. Handles URL parsing, validation, hash extraction, and metadata for Python package distribution links from PyPI and other package indexes.

## Key Classes

### LinkHash (L44-95)
Frozen dataclass for parsing and validating embedded hash values in URLs. Uses regex pattern matching to extract hash algorithms and values from URL fragments.

Key methods:
- `find_hash_url_fragment()` (L73-79): LRU-cached classmethod to extract hash from URL using regex
- `as_hashes()` (L84-86): Converts to Hashes instance for validation
- `is_hash_allowed()` (L88-94): Validates hash against allowed hashes

### MetadataFile (L98-106)
Frozen dataclass representing core metadata files associated with distributions. Validates that all hash names are supported.

### Link (L182-528)
Primary class representing parsed links from package indexes. Uses `__slots__` for memory efficiency.

Key initialization (L197-258):
- Handles UNC Windows paths by converting to URL format
- Extracts and merges hashes from URL fragments and explicit parameters
- Stores parsed URL components and metadata

Factory methods:
- `from_json()` (L261-309): Creates Link from PyPI JSON API response
- `from_element()` (L312-361): Creates Link from HTML anchor attributes

Key properties:
- `filename` (L394-405): Extracts filename, handling auth credentials safely
- `is_wheel` (L504-505): Checks if link points to wheel file
- `is_vcs` (L508-511): Determines if URL uses VCS scheme
- `is_yanked` (L514-515): Checks if package version is yanked

Hash-related methods:
- `as_hashes()` (L481-482): Converts internal hashes to Hashes object
- `is_hash_allowed()` (L521-527): Validates link hashes against requirements

### _CleanResult (L530-560)
NamedTuple for normalizing links during equivalency checks. Strips auth, normalizes query parameters, and preserves only essential fragment components.

## Key Functions

### URL Processing Functions (L119-179)
- `_clean_url_path_part()` (L119-124): Safely quotes URL path components
- `_clean_file_url_path()` (L127-137): Handles Windows drive letters in file URLs
- `_clean_url_path()` (L144-163): Splits and cleans URL paths preserving VCS revision strings
- `_ensure_quoted_url()` (L166-178): Ensures proper URL encoding without double-quoting

### Link Comparison
- `_clean_link()` (L562-585): Normalizes Link for equivalency comparison
- `links_equivalent()` (L588-589): LRU-cached function to compare link equivalency

## Dependencies
- Uses `urllib.parse` for URL handling and `posixpath` for path operations
- Integrates with pip's hash validation system (`Hashes` from `pip._internal.utils.hashes`)
- Imports VCS schemes dynamically to avoid circular dependencies

## Architecture Notes
- Supports both PyPI JSON API and HTML simple repository formats (PEP 503)
- Handles PEP 714 metadata file specifications with backward compatibility
- Uses regex patterns for fragment parsing with precedence-ordered hash algorithms
- Implements proper URL normalization for Windows UNC paths and VCS URLs
- Link comparison ignores authentication and non-essential fragments to avoid spurious conflicts

## Constants
- `_SUPPORTED_HASHES` (L40): Tuple of supported hash algorithms in precedence order
- Hash extraction regex patterns for URL fragments and egg names