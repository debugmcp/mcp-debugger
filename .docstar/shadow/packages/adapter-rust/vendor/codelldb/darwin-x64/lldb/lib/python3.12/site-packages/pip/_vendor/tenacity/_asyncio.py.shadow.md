# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_vendor/tenacity/_asyncio.py
@source-hash: 422eb0810b066bd3
@generated: 2026-02-09T18:00:07Z

## Purpose
Provides async/await compatible retry functionality for the tenacity library, extending the base retry mechanism to work with coroutines and async functions.

## Core Components

### AsyncRetrying Class (L33-94)
Main async retry controller that extends `BaseRetrying` with async capabilities:
- **Constructor (L36-38)**: Accepts custom sleep function (defaults to `asyncio.sleep`)
- **__call__ method (L40-59)**: Core async retry logic - executes wrapped coroutine with retry behavior
- **Async iteration support (L64-80)**: Implements `__aiter__` and `__anext__` for async context manager usage
- **wraps method (L82-94)**: Creates async decorator that preserves retry attributes

## Key Dependencies
- `asyncio.sleep` (L21): Default async sleep implementation
- Base tenacity components (L23-27): `BaseRetrying`, `AttemptManager`, `DoAttempt`, `DoSleep`, `RetryCallState`

## Type Variables (L29-30)
- `WrappedFnReturnT`: Return type of wrapped async function
- `WrappedFn`: Bound to async callable types

## Execution Flow
1. **__call__** creates `RetryCallState` and enters retry loop
2. Uses `self.iter()` to determine next action (`DoAttempt` or `DoSleep`)
3. On `DoAttempt`: executes wrapped coroutine, captures result/exception
4. On `DoSleep`: awaits sleep duration before next attempt
5. Returns final result or propagates exception based on retry policy

## Architectural Patterns
- **Async Iterator Protocol**: Enables `async for` usage pattern
- **Decorator Factory**: `wraps()` method creates async-aware decorators
- **State Machine**: Retry decisions driven by `iter()` method from base class
- **Exception Handling**: Broad `BaseException` catch (L51) to handle all failure modes

## Critical Invariants
- Wrapped functions must be coroutines (return `Awaitable`)
- Sleep function must be async-compatible
- Iterator protocol explicitly disabled (L61-62) - only async iteration supported
- Preserves retry attributes (`retry`, `retry_with`) on wrapped functions