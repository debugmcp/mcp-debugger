# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_internal/commands/list.py
@source-hash: 46068857890df9e3
@generated: 2026-02-09T17:59:29Z

## Purpose
Implements pip's `list` command for displaying installed packages with various filtering and formatting options. Provides functionality to show outdated packages, up-to-date packages, editable installs, and format output as columns, freeze format, or JSON.

## Key Classes and Functions

### ListCommand (L38-311)
Main command class inheriting from `IndexGroupCommand`. Handles all list command functionality.

**Key methods:**
- `add_options()` (L49-135): Defines CLI options including --outdated, --uptodate, --editable, --format, --not-required, etc.
- `run()` (L164-203): Main execution logic with option validation and package processing pipeline
- `get_outdated()` (L205-212): Filters packages with newer versions available
- `get_uptodate()` (L214-221): Filters packages that are current with latest versions
- `get_not_required()` (L223-235): Filters packages that aren't dependencies of other installed packages
- `iter_packages_latest_infos()` (L237-273): Fetches remote version info for packages using PackageFinder
- `output_package_listing()` (L275-294): Routes output to appropriate formatter based on --format option

### Helper Functions
- `format_for_columns()` (L313-355): Converts package data to tabular format with headers
- `format_for_json()` (L358-375): Serializes package data to JSON format

### Type Definitions (L22-32)
- `_DistWithLatestInfo`: Type-checking class extending `BaseDistribution` with `latest_version` and `latest_filetype` fields
- `_ProcessedDists`: Type alias for sequences of enhanced distribution objects

## Key Dependencies
- `pip._internal.metadata`: Package environment and distribution access
- `pip._internal.index.package_finder`: Remote package discovery and version resolution
- `pip._vendor.packaging`: Package name canonicalization and version handling
- `pip._internal.cli.cmdoptions`: Shared CLI option definitions

## Architecture Patterns
- **Command pattern**: Inherits from `IndexGroupCommand` for consistent CLI interface
- **Pipeline processing**: Sequential filtering of package lists based on options
- **Lazy loading**: Heavy index modules imported only when needed (L147-149)
- **Polymorphic output**: Multiple formatters (columns/freeze/JSON) with unified interface

## Critical Invariants
- `get_not_required()` must run before other filters to properly identify dependencies (L190-195)
- Freeze format incompatible with --outdated option (validation at L168-171)
- --outdated and --uptodate are mutually exclusive (validation at L165-166)
- Packages always sorted by canonical name for consistent output (L278-281)

## Notable Implementation Details
- Uses dirty type casting to add version info to distribution objects (L179-180, L267-268)
- Excludes stdlib packages by default using `stdlib_pkgs` (L175)
- Handles pre-release filtering at two levels: PackageFinder selection preferences and manual filtering (L247-253)
- Supports both local-only and user-only package filtering for virtualenv scenarios