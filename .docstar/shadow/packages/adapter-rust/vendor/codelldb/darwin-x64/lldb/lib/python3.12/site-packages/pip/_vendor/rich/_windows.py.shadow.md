# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_vendor/rich/_windows.py
@source-hash: 681c1a0ff4b9e926
@generated: 2026-02-09T17:59:57Z

## Windows Console Feature Detection

**Primary Purpose**: Detects Windows console capabilities (VT codes, truecolor support) through Windows API inspection with cross-platform fallback.

**Core Architecture**:
- Platform-specific import strategy with graceful degradation (L15-36)
- Dual implementation pattern: Windows API-based vs. fallback (L34-61)

**Key Components**:

### WindowsConsoleFeatures (L6-13)
Dataclass capturing console capabilities:
- `vt` (L9): VT100/ANSI escape sequence support
- `truecolor` (L11): 24-bit color support

### get_windows_console_features() - Two Implementations

**Fallback Implementation (L34-36)**:
Returns default WindowsConsoleFeatures with all capabilities disabled. Activated when Windows APIs unavailable.

**Windows API Implementation (L40-61)**:
- Queries console handle via GetStdHandle() (L46)
- Probes console mode for ENABLE_VIRTUAL_TERMINAL_PROCESSING flag (L48-53)
- Determines truecolor support based on Windows version >= 10.0.15063 (L57-59)
- Gracefully handles LegacyWindowsError exceptions (L50-52)

**Import Strategy (L15-30)**:
Conditional import pattern:
- Attempts ctypes.WinDLL loading on win32 platform (L19-20)
- Imports Windows console API wrappers from `_win32_console` module (L25-30)
- Falls back to stub implementation on import failure (L32-36)

**Dependencies**:
- `ctypes` for Windows API access
- `pip._vendor.rich._win32_console` for console API wrappers
- `sys` for platform detection and Windows version info

**Critical Logic**:
- VT support requires successful console mode query AND ENABLE_VIRTUAL_TERMINAL_PROCESSING flag
- Truecolor requires VT support AND Windows 10 build 15063+
- Platform detection ensures Windows-specific code only runs on win32

**Testing Interface (L64-71)**:
Standalone execution displays detected platform and console features for debugging.