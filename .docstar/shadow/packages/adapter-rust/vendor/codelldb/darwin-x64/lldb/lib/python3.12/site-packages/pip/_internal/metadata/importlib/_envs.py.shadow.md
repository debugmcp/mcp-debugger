# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_internal/metadata/importlib/_envs.py
@source-hash: f001a88db7fb122f
@generated: 2026-02-09T17:57:31Z

This module implements environment and distribution discovery for pip's importlib-based metadata backend, providing a modern alternative to pkg_resources for finding and managing Python packages.

## Core Components

### `_looks_like_wheel(location)` (L24-31)
Utility function that validates wheel files by checking file extension, existence, filename pattern, and ZIP format.

### `_DistributionFinder` (L34-147)
Central distribution discovery class that memoizes found package names to ensure only one distribution per package name is returned (mimicking setuptools behavior). Key methods:

- `_find_impl(location)` (L52-72): Core discovery logic that iterates through a location using `importlib.metadata.distributions()`, handles bad metadata gracefully, and tracks found names to prevent duplicates
- `find(location)` (L74-84): Main entry point for finding distributions in directories or ZIP archives, wrapping results in `Distribution` objects
- `find_linked(location)` (L86-108): Processes egg-link files by reading the first non-empty line as a target path and discovering distributions there
- `find_eggs(location)` (L134-146): Legacy support for egg format discovery using pkg_resources backend

### `_emit_egg_deprecation(location)` (L149-156)
LRU-cached function that emits deprecation warnings for egg format usage, warning exactly once per location.

### `Environment` (L159-189)
Main environment class implementing `BaseEnvironment` interface:

- `__init__(paths)` (L160-161): Stores search paths
- `default()` (L163-165): Creates environment using `sys.path`
- `from_paths(paths)` (L167-171): Factory method with optional path list
- `_iter_distributions()` (L173-181): Iterator that combines standard distributions, eggs (with deprecation warnings), and linked distributions
- `get_distribution(name)` (L183-189): Finds specific distribution by canonical name

## Key Dependencies

- `importlib.metadata`: Primary distribution discovery mechanism
- `pip._internal.metadata.base`: Base classes for distributions and environments
- `pip._vendor.pkg_resources`: Legacy egg format support
- `._compat`: Compatibility utilities for metadata handling
- `._dists`: Distribution wrapper implementation

## Architectural Patterns

- **Memoization**: Distribution names are cached to prevent duplicates
- **Layered Discovery**: Multiple discovery strategies (standard, eggs, linked) with specific precedence
- **Legacy Support**: Maintains backward compatibility with egg format while issuing deprecation warnings
- **Error Resilience**: Graceful handling of bad metadata with logging

## Critical Constraints

- Only one distribution per normalized package name is returned
- Wheel files are explicitly skipped during discovery to avoid invalid installations
- Egg format is deprecated and will be removed in version 24.3
- Discovery order affects precedence (standard → eggs → linked)