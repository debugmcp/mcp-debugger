# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_vendor/cachecontrol/filewrapper.py
@source-hash: 493b6d1a620f06f6
@generated: 2026-02-09T17:59:37Z

## Purpose and Responsibility

File wrapper utility for HTTP response caching that captures data during reading while proxying all other attributes to the underlying file object. Uses temporary files and memory mapping for efficient memory management during the caching process.

## Key Classes and Functions

### CallbackFileWrapper (L14-119)
Primary wrapper class that intercepts read operations to capture data for caching callbacks.

**Key Methods:**
- `__init__(fp, callback)` (L33-38): Initializes with HTTPResponse object and optional callback function
- `__getattr__(name)` (L40-50): Proxies all non-intercepted attributes to underlying file object using name mangling
- `__is_fp_closed()` (L52-68): Checks if underlying file is closed through multiple fallback approaches
- `_close()` (L70-95): Triggers callback with captured data using memory mapping, then cleans up resources
- `read(amt)` (L97-106): Main read method that tees data to temporary buffer while passing through to underlying file
- `_safe_read(amt)` (L108-119): Specialized read method that handles CRLF termination in chunked encoding

## Important Dependencies

- `mmap`: For memory-efficient data access without loading into memory
- `tempfile.NamedTemporaryFile`: For temporary storage with automatic cleanup
- `http.client.HTTPResponse`: Type hint for the wrapped file object

## Architectural Decisions

**Double Underscore Naming Convention**: Uses `__` prefix for internal attributes to avoid conflicts with proxied attributes from the underlying file object.

**Memory Management Strategy**: 
- Uses temporary files as intermediate storage to handle memory pressure
- Employs memory mapping via `mmap` to provide data views without duplication
- Relies on filesystem memory cache for performance with small files

**Garbage Collection Safety**: Explicitly nullifies callback reference (L91) to prevent deadlocks from circular references in CPython's garbage collector.

## Critical Invariants

1. All non-internal attributes are proxied to the underlying file object
2. Data is captured in temporary file during read operations
3. Callback is executed exactly once when file is closed
4. Memory mapping provides zero-copy data access for callbacks
5. Temporary file cleanup occurs after callback execution