# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_internal/utils/encoding.py
@source-hash: aaab170ed8b03088
@generated: 2026-02-09T17:59:35Z

## Purpose
Provides encoding detection and text decoding utilities for pip's internal operations. Handles automatic detection of text encoding from byte-order marks (BOMs) and PEP 263 encoding declarations.

## Key Components

### Constants
- `BOMS` (L7-15): Tuple list mapping byte-order marks to their corresponding encoding names, covering UTF-8, UTF-16 (BE/LE), and UTF-32 (BE/LE) variants
- `ENCODING_RE` (L17): Regex pattern for detecting PEP 263 encoding declarations in source files (`coding[:=]\s*([-\w.]+)`)

### Functions
- `auto_decode(data: bytes) -> str` (L20-36): Primary encoding detection function implementing a three-tier fallback strategy:
  1. BOM detection (L24-26): Checks for Unicode BOMs and decodes accordingly
  2. PEP 263 compliance (L27-33): Scans first two lines for `# coding:` or `# coding=` declarations
  3. System fallback (L34-36): Uses `locale.getpreferredencoding()` or `sys.getdefaultencoding()`

## Dependencies
- `codecs`: BOM constants and encoding operations
- `locale`: System preferred encoding detection
- `re`: Regex pattern matching for encoding declarations
- `sys`: Default system encoding fallback
- `typing`: Type annotations

## Architecture Notes
- Follows Python's encoding detection hierarchy as specified in PEP 263
- Defensive programming with assertion on regex match result (L31)
- Graceful fallback chain ensures decoding always succeeds with reasonable encoding choice
- Designed for pip's file processing needs where encoding detection is critical for setup.py and other Python files