# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_internal/network/cache.py
@source-hash: e3c03def5a82cca3
@generated: 2026-02-09T17:59:32Z

## Purpose
HTTP cache implementation for pip's network layer, providing safe file-based caching that gracefully handles filesystem errors and race conditions.

## Key Components

### Utility Functions
- **`is_from_cache(response)`** (L17-18): Detects if a Response object came from cache by checking `from_cache` attribute
- **`suppressed_cache_errors()`** (L21-29): Context manager that silently catches OSError exceptions, allowing pip to continue without caching when filesystem issues occur

### Core Cache Implementation
**`SafeFileCache`** (L32-106): Thread-safe file-based cache extending `SeparateBodyBaseCache`
- Handles race conditions in two-file cache entries (metadata + body)
- Gracefully degrades when target directory is inaccessible/unwritable
- **Constructor** (L50-53): Validates and stores cache directory path
- **`_get_cache_path(key)`** (L55-61): Generates hierarchical file paths using first 5 chars of hashed key for distribution
- **`get(key)`** (L63-71): Retrieves metadata, validates both files exist before returning
- **`set(key, value, expires)`** (L82-86): Stores metadata using atomic write operations
- **`get_body(key)`** (L95-102): Retrieves response body as file handle, validates both files exist
- **`set_body(key, body)`** (L104-106): Stores response body separately from metadata
- **`delete(key)`** (L88-93): Removes both metadata and body files with error suppression
- **`_write(path, data)`** (L73-80): Atomic write implementation using temporary files and replace

## Dependencies
- **CacheControl**: `SeparateBodyBaseCache`, `SeparateBodyFileCache` for cache infrastructure
- **pip._internal.utils**: `adjacent_tmp_file`, `replace` for atomic operations, `ensure_dir` for directory creation
- **requests**: `Response` model for HTTP response handling

## Architecture Notes
- **Two-file design**: Metadata and body stored separately to match CacheControl's `SeparateBodyBaseCache`
- **Race condition mitigation**: Read operations validate both files exist; write operations use atomic file replacement
- **Error resilience**: All filesystem operations wrapped in error suppression to prevent cache failures from breaking pip
- **Path distribution**: Uses hierarchical directory structure based on key hash for performance

## Critical Constraints
- Cache entries invalid unless both metadata and body files exist
- Assumes server data immutability for same URLs (PyPI constraint)
- Directory must be valid (assertion in constructor)
- All cache operations must be non-blocking and error-tolerant