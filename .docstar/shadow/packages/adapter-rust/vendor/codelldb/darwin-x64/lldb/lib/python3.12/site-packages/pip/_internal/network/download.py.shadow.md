# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_internal/network/download.py
@source-hash: ad9adb8ba39d635f
@generated: 2026-02-09T17:59:31Z

## Primary Purpose
Core file download functionality for pip with progress indicators, caching detection, and filename resolution. Handles both single and batch downloads with proper error handling and logging.

## Key Components

### Utility Functions
- `_get_http_response_size()` (L24-28): Extracts content-length from HTTP response headers, returns None on parse failure
- `sanitize_content_filename()` (L73-77): Security function that strips directory paths from filenames using `os.path.basename()`
- `parse_content_disposition()` (L80-92): Parses Content-Disposition headers to extract sanitized filenames, falls back to default
- `_get_http_response_filename()` (L95-113): Comprehensive filename resolution from HTTP headers, MIME types, and URL extensions
- `_http_get_download()` (L116-120): Creates streaming HTTP GET request with standard headers

### Core Download Logic
- `_prepare_download()` (L31-70): Central download preparation that handles:
  - Progress bar visibility logic (cache status, file size thresholds, log level)
  - Special PyPI URL handling for logging
  - Returns chunked response iterator with optional progress renderer

### Download Classes
- `Downloader` (L123-151): Single file downloader
  - `__call__()` returns tuple of (filepath, content_type)
  - Handles NetworkConnectionError with critical logging
  
- `BatchDownloader` (L154-187): Multiple file downloader
  - `__call__()` yields tuples of (Link, (filepath, content_type))
  - Near-identical logic to single downloader but for iterables

## Dependencies
- `requests` for HTTP operations and chunking constants
- Internal pip modules for progress bars, sessions, caching, and utilities
- Standard library: `email.message`, `mimetypes`, `os` for file operations

## Key Patterns
- Progress bar display threshold: >40KB files show progress (L59)
- Filename resolution cascade: Content-Disposition → MIME type extension → URL extension
- Streaming downloads with chunked responses for memory efficiency
- Security-conscious filename sanitization to prevent path traversal

## Critical Behaviors
- Progress bars hidden for cached responses and small files
- PyPI URLs get special display treatment in logs
- All downloads written in binary mode with explicit filepath construction
- NetworkConnectionError propagation with detailed logging