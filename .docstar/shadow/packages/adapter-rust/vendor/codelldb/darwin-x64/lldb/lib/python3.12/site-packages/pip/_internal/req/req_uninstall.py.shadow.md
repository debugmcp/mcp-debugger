# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_internal/req/req_uninstall.py
@source-hash: ab30c8c49a3e3844
@generated: 2026-02-09T17:59:38Z

## Purpose
Core pip uninstallation engine that handles safe removal of Python packages across different installation types (wheel, egg, editable, legacy). Implements two-phase uninstallation: stash files to temporary locations, then either commit (delete permanently) or rollback (restore).

## Key Components

### Core Functions
- `uninstallation_paths(dist)` (L55-86): Extracts all file paths to uninstall from package metadata (RECORD), including .pyc/.pyo files
- `_script_names(bin_dir, script_name, is_gui)` (L21-38): Generates platform-specific script filenames (.exe, .manifest on Windows)
- `compact(paths)` (L88-104): Minimizes path set by removing redundant parent/child relationships
- `compress_for_rename(paths)` (L107-139): Optimizes removal by identifying entire directories vs individual files
- `compress_for_output_listing(paths)` (L141-187): Formats paths for user display, separating files to remove vs skip

### StashedUninstallPathSet (L190-293)
Handles temporary file relocation during uninstallation:
- `_save_dirs`: Maps root paths to temp directories
- `_moves`: Tracks (old_path, new_path) for rollback
- `stash(path)` (L243-262): Moves files/directories to temp locations
- `commit()` (L264-269): Permanently deletes stashed files
- `rollback()` (L271-288): Restores all stashed files to original locations

### UninstallPathSet (L295-576)
Main uninstallation coordinator:
- `_paths`: Files/directories to remove
- `_refuse`: Files outside environment (cannot remove)
- `_pth`: .pth file entries to modify
- `_moved_paths`: StashedUninstallPathSet instance
- `add(path)` (L321-338): Adds path for removal, handles __pycache__ files automatically
- `remove(auto_confirm, verbose)` (L349-377): Executes uninstallation with user confirmation
- `from_dist(dist)` (L423-575): Factory method detecting installation type and populating paths

**Installation Types Handled:**
- Modern wheel (.dist-info): Uses RECORD file
- Legacy setuptools (.egg-info): Reads top_level.txt, handles namespaces
- Easy Install eggs: Removes .egg directory and easy-install.pth entries
- Editable installs: Handles .egg-link files
- Distutils legacy: Raises LegacyDistutilsInstall exception

### UninstallPthEntries (L578-633)
Manages .pth file modifications:
- `remove()` (L599-625): Removes entries from .pth files, preserves line endings
- `rollback()` (L626-633): Restores original .pth file content

## Dependencies
- pip._internal.metadata.BaseDistribution: Package metadata abstraction
- pip._internal.utils.temp_dir: Temporary directory management
- pip._internal.exceptions: Custom exception types

## Critical Constraints
- Only removes files within current Python environment (virtualenv check)
- Refuses to uninstall standard library packages
- Handles Windows-specific file extensions and path normalization
- Preserves symlinks as files (doesn't follow targets)
- Two-phase commit ensures atomicity of uninstallation

## Architecture Pattern
Uses Command pattern with undo capability - operations are staged in UninstallPathSet, executed via StashedUninstallPathSet, then committed or rolled back.