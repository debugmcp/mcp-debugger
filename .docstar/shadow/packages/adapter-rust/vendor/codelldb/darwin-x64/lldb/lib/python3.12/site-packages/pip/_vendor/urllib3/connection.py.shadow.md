# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_vendor/urllib3/connection.py
@source-hash: f7693db5dff2e0f1
@generated: 2026-02-09T18:00:22Z

## Purpose
This module provides HTTP/HTTPS connection classes that extend Python's standard library http.client connections with enhanced features for urllib3, including SSL/TLS support, proxy handling, and connection customization.

## Key Components

### HTTPConnection (L76-284)
Enhanced HTTP connection class extending `http.client.HTTPConnection` with backward compatibility and additional features:
- **Constructor (L115-130)**: Accepts `source_address`, `socket_options`, `proxy`, `proxy_config` parameters
- **Host Property (L132-159)**: Manages FQDN dot stripping for SSL compatibility while preserving DNS resolution capability
- **_new_conn (L161-190)**: Establishes socket connection with custom options and timeout handling
- **connect (L204-206)**: Main connection establishment method
- **putrequest (L208-219)**: Validates HTTP method for control characters before forwarding
- **putheader (L221-229)**: Handles special SKIP_HEADER logic for selective header omission
- **request (L231-244)**: Adds default User-Agent header and socket timeout management
- **request_chunked (L246-283)**: Implements chunked transfer encoding for request bodies

### HTTPSConnection (L286-533)
SSL-enabled connection class inheriting from HTTPConnection:
- **Constructor (L302-326)**: Manages SSL-specific parameters (certificates, context, hostname)
- **set_cert (L328-359)**: Configures SSL certificate settings (should only be called once)
- **connect (L361-477)**: Complex SSL connection establishment with:
  - TLS-in-TLS proxy support (L367-379)
  - System time validation (L385-393)
  - SSL context creation and certificate loading (L397-417)
  - Certificate verification and hostname matching (L449-472)
- **_connect_tls_proxy (L479-533)**: Handles SSL connection through HTTPS proxies

### Utility Functions
- **_match_hostname (L536-555)**: Custom hostname matching with IP address normalization
- **_get_default_user_agent (L558-559)**: Returns urllib3 user agent string

## Key Dependencies
- `ssl_wrap_socket` from `.util.ssl_`: Core SSL socket wrapping functionality
- `create_urllib3_context`, `resolve_cert_reqs` from `.util.ssl_`: SSL context management
- `connection.create_connection` from `.util`: Low-level socket creation
- `six` package: Python 2/3 compatibility layer

## Configuration Constants
- `port_by_scheme` (L67): Default ports for HTTP (80) and HTTPS (443)
- `RECENT_DATE` (L71): System time validation threshold (2022-01-01)
- `default_socket_options` (L106): TCP_NODELAY enabled by default

## Error Handling
- Converts socket timeouts to `ConnectTimeoutError` (L178-183)
- Converts socket errors to `NewConnectionError` (L185-188)
- Validates HTTP methods for control characters (L212-217)
- Warns about deprecated TLS versions and certificate issues

## Architectural Notes
- Uses `_dns_host` internally to preserve FQDN while exposing stripped hostname
- Supports connection reuse through proper socket state management
- Implements chunked encoding manually for streaming requests
- Provides fallback `DummyConnection` when SSL is unavailable (L568-569)