# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_vendor/packaging/_musllinux.py
@source-hash: a7d66a35888e22d1
@generated: 2026-02-09T17:59:41Z

**Purpose:** Implements PEP 656 support for detecting musl libc runtime and generating compatible musllinux platform tags for Python package distribution.

**Core Functionality:**
- Detects if Python is linked against musl libc and determines the version
- Generates backward-compatible platform tags for musllinux environments
- Provides runtime detection through ELF file analysis and dynamic loader interrogation

**Key Components:**

**_MuslVersion (L18-21):** NamedTuple representing musl version with major/minor integers.

**_parse_musl_version (L23-30):** Parses musl loader output to extract version information. Expects format like "musl libc..." followed by "Version X.Y". Returns None if parsing fails.

**_get_musl_version (L33-53):** Core detection function with LRU caching. 
- Reads ELF executable to find dynamic loader interpreter
- Executes loader directly to get version info via stderr
- Returns None if not musl-linked or detection fails
- Handles OSError, TypeError, ValueError gracefully

**platform_tags (L56-72):** Main API function generating compatibility tags.
- Takes architecture sequence (closest arch first)
- Yields tags like "musllinux_1_2_x86_64" with decreasing minor versions
- Ensures backward compatibility by iterating from current minor down to 0
- Returns empty iterator if not musl-linked

**Dependencies:**
- `_elffile.ELFFile` for binary analysis
- `subprocess` for loader execution
- `functools.lru_cache` for performance optimization

**Architecture Patterns:**
- Defensive programming with extensive error handling
- Caching for expensive operations (version detection)
- Generator pattern for lazy tag enumeration
- Clear separation of parsing, detection, and tag generation concerns

**Critical Constraints:**
- Assumes linux platform as prerequisite
- Requires readable ELF executable
- Depends on musl loader being executable and outputting to stderr
- Tags follow specific naming convention for package manager compatibility