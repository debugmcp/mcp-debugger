# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_vendor/urllib3/contrib/ntlmpool.py
@source-hash: 3657e45bb58c756f
@generated: 2026-02-09T17:57:40Z

**Primary Purpose:** Deprecated NTLM authentication extension for urllib3 connection pools, enabling Windows domain authentication over HTTPS connections.

**Key Classes:**

- **NTLMConnectionPool (L27-130)** - Extends HTTPSConnectionPool to provide NTLM authentication capabilities
  - Inherits from urllib3's HTTPSConnectionPool
  - Fixed scheme: "https" (L32)
  - Constructor (L34-46): Takes Windows credentials (user, password) and auth URL, parses domain\username format
  - `_new_conn()` (L48-113): Core NTLM handshake implementation using 3-way authentication protocol
  - `urlopen()` (L115-130): Wrapper maintaining keep-alive connections for authenticated requests

**Key Dependencies:**
- `ntlm` package for NTLM protocol implementation (L11)
- urllib3's `HTTPSConnectionPool` as base class (L13)
- `HTTPSConnection` for low-level connection management (L14)

**Authentication Flow:**
1. Parse domain\username credentials during initialization (L43-45)
2. Send NTLM negotiate message using `ntlm.create_NTLM_NEGOTIATE_MESSAGE()` (L66-68)
3. Parse server challenge response with `ntlm.parse_NTLM_CHALLENGE_MESSAGE()` (L93-95)
4. Send authentication message via `ntlm.create_NTLM_AUTHENTICATE_MESSAGE()` (L96-98)
5. Validate successful authentication (200 response) or raise exceptions (L106-109)

**Critical Constraints:**
- Socket must remain open throughout request lifecycle for NTLM session persistence
- Manually manages response.fp to prevent premature socket closure (L79, L111)
- Forces "Keep-Alive" connection headers (L59, L127)
- Domain names automatically converted to uppercase (L44)

**Architectural Notes:**
- Module is officially deprecated with removal planned for urllib3 v2.0 (L16-22)
- Extensive debug logging throughout authentication process
- Error handling for wrong credentials (401) and unexpected server responses
- Maintains connection counting via inherited num_connections property