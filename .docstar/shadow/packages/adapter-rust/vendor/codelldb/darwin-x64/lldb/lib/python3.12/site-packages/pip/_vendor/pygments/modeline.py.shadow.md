# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_vendor/pygments/modeline.py
@source-hash: 785daf3b82e9386a
@generated: 2026-02-09T17:59:46Z

## Purpose
Parser for Vim/Vi editor modelines to extract file type information from text buffers. Based on pymodeline library, used by Pygments for syntax highlighting detection.

## Key Components

### `modeline_re` (L16-19)
Compiled regex pattern matching Vim modeline syntax:
- Matches `vi`, `vim`, or `ex` editor declarations
- Captures filetype specifications using `ft`, `filetype`, `syn`, or `syntax` keywords
- Uses verbose regex with whitespace and comments for readability

### `get_filetype_from_line(l)` (L22-25)
Single line modeline parser:
- Takes a string line as input
- Returns captured filetype string if modeline found, None otherwise
- Uses the compiled regex to extract filetype from group(1)

### `get_filetype_from_buffer(buf, max_lines=5)` (L28-42)
Buffer-wide modeline scanner with dual-phase search strategy:
- **Phase 1 (L33-36)**: Scans last `max_lines` lines (bottom of file)
- **Phase 2 (L37-41)**: Scans first `max_lines` lines (top of file)
- Returns first found filetype or None if no modeline detected
- Follows Vim convention of checking file beginning/end for modelines

## Dependencies
- `re` module for regex operations
- No external dependencies

## Architecture Notes
- Simple functional design with minimal state
- Prioritizes end-of-file modelines over beginning-of-file (common Vim practice)
- Defensive programming with bounds checking on line access
- Export controlled via `__all__` limiting public API to main function