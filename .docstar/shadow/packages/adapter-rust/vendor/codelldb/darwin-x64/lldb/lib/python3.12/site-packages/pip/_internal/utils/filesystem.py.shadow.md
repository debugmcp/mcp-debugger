# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_internal/utils/filesystem.py
@source-hash: 4613085d468d54c1
@generated: 2026-02-09T17:59:36Z

**Primary Purpose**: Filesystem utility functions for pip's internal operations, providing cross-platform file/directory operations, ownership checking, and safe file manipulation with retry logic.

**Core Functions**:

- `check_path_owner(path)` (L16-40): Determines if current process owns a path by traversing up directory hierarchy. Returns True on Windows or when no geteuid available. For Unix-like systems, checks actual ownership using `os.access()` for regular users or `get_path_uid()` for root.

- `adjacent_tmp_file(path, **kwargs)` (L44-65): Context manager creating secure temporary files in same directory as target path. Uses `NamedTemporaryFile` with forced flush and fsync for durability. Returns BinaryIO handle.

- `replace` (L71): Retry-wrapped `os.replace()` operation with 1-second timeout and 0.25-second intervals using tenacity library.

- `test_writable_dir(path)` (L76-91): Cross-platform directory writability test. Uses `os.access()` on POSIX, delegates to Windows-specific implementation otherwise.

- `_test_writable_dir_win(path)` (L94-119): Windows-specific writability test creating temporary files with random names (attempts up to 10 times) due to `os.access()` unreliability on Windows.

**File Operations**:
- `find_files(path, pattern)` (L122-129): Recursive file finder using Unix shell glob patterns via `fnmatch`
- `file_size(path)` (L132-136): Returns file size, treating symlinks as 0 bytes
- `directory_size(path)` (L143-149): Recursive directory size calculation
- `format_file_size(path)` (L139-140) / `format_directory_size(path)` (L152-153): Human-readable size formatting

**Key Dependencies**:
- `pip._vendor.tenacity`: Retry mechanism for file operations
- `pip._internal.utils.compat.get_path_uid`: Cross-platform UID retrieval
- `pip._internal.utils.misc.format_size`: Size formatting utilities

**Architectural Notes**:
- Platform-specific handling for Windows vs POSIX systems throughout
- Security-conscious temporary file creation with proper cleanup
- Retry logic for atomic file replacement operations
- Defensive programming with fallback behaviors for edge cases