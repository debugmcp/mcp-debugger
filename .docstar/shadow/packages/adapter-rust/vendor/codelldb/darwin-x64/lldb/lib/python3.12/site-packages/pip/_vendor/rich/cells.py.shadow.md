# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_vendor/rich/cells.py
@source-hash: 68c9862b80635e18
@generated: 2026-02-09T18:00:03Z

## Purpose
Unicode text cell width calculation utilities for terminal/console rendering in the Rich library. Handles proper display width calculation for multi-byte characters, emojis, and wide characters that occupy multiple terminal cells.

## Key Functions

**`cached_cell_len(text: str) -> int` (L13-28)**
- Cached version of cell length calculation using LRU cache (4096 entries)
- Sums character cell sizes for entire text string
- Memory-intensive due to aggressive caching, use sparingly

**`cell_len(text: str) -> int` (L31-44)**
- Primary public API for calculating text display width
- Optimizes by using cache for short strings (<512 chars), direct calculation for longer ones
- Prevents excessive memory usage from caching very long strings

**`get_character_cell_size(character: str) -> int` (L47-57)**
- Returns display width (0, 1, or 2 cells) for single character
- Converts character to codepoint and delegates to `_get_codepoint_cell_size`
- LRU cached (4096 entries) for performance

**`_get_codepoint_cell_size(codepoint: int) -> int` (L60-86)**
- Core logic using binary search through `CELL_WIDTHS` lookup table
- Returns 0 for zero-width chars, 1 for normal chars, 2 for wide chars (CJK, emojis)
- Fallback to width 1 if codepoint not found in table

**`set_cell_size(text: str, total: int) -> str` (L89-122)**
- Truncates or pads text to exact cell width
- Fast path for single-cell-width text using regex optimization (L92)
- Binary search to find truncation point for multi-byte text
- Handles wide character splitting by replacing with space

**`chop_cells(text: str, width: int) -> list[str]` (L124-158)**
- Splits text into lines that fit within specified cell width
- Character-by-character processing with width tracking
- Performance optimized with local function references (L138, L141-142)

## Dependencies
- `CELL_WIDTHS` from `._cell_widths`: Unicode character width lookup table
- `_is_single_cell_widths` regex (L10): Fast detection of ASCII-range text

## Performance Patterns
- Heavy use of LRU caching for character-level operations
- Regex optimization for common ASCII text
- Binary search algorithms for both table lookup and text truncation
- Local function reference optimization in tight loops

## Critical Invariants
- Cell widths are 0 (zero-width), 1 (normal), or 2 (wide) characters
- Width -1 in lookup table maps to 0 (zero-width characters)
- Text truncation preserves visual boundaries (no half-wide characters)