# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_internal/cli/base_command.py
@source-hash: 08d58f84860544d3
@generated: 2026-02-09T17:59:27Z

## Primary Purpose
Base command class for pip CLI commands, providing core command execution framework with error handling, logging setup, option parsing, and temporary directory management.

## Key Classes and Functions

**Command (L44-234)** - Abstract base class for all pip commands
- Inherits from `CommandContextMixIn` for context management capabilities
- **Attributes:**
  - `usage` (L45): Command usage string template
  - `ignore_require_venv` (L46): Flag to bypass virtual environment requirements
  - `name`, `summary` (L51-52): Command identification
  - `parser` (L53): ConfigOptionParser instance for argument parsing
  - `tempdir_registry` (L63): Optional temp directory registry
  - `cmd_opts` (L67): Command-specific option group

**__init__ (L48-77)** - Command initialization
- Sets up ConfigOptionParser with custom formatter
- Creates command-specific option group
- Adds general options via `cmdoptions.make_option_group`
- Calls `add_options()` hook for subclass customization

**Core Execution Methods:**
- `add_options() (L78-79)`: Hook for subclasses to add command-specific options
- `run() (L90-91)`: Abstract method - must be implemented by subclasses
- `parse_args() (L93-95)`: Wrapper around parser.parse_args for testability
- `main() (L97-102)`: Entry point with context management and logging shutdown
- `_main() (L104-234)`: Core execution logic with comprehensive setup and error handling

**handle_pip_version_check (L81-88)** - Version check handler (no-op by default)
- Contains assertion to ensure no_index option isn't present
- Designed to be overridden by subclasses that need version checking

## Core Execution Flow (_main method)

1. **Setup Phase (L108-111):** Initialize temp directory registry and global temp manager
2. **Argument Processing (L113-116):** Parse args and set verbosity level  
3. **Logging Setup (L118-122):** Configure logging with verbosity, colors, and log file
4. **Feature Validation (L124-131):** Warn about always-enabled features
5. **Python Option Validation (L138-142):** Ensure --python appears before subcommand
6. **Environment Setup (L148-152):** Set PIP_NO_INPUT and PIP_EXISTS_ACTION env vars
7. **Virtual Environment Check (L154-158):** Enforce venv requirement if specified
8. **Cache Directory Setup (L160-171):** Validate and configure cache directory with ownership checks

## Exception Handling Architecture

**intercepts_unhandled_exc (L173-224)** - Decorator factory for comprehensive error handling
- Maps specific exceptions to appropriate exit codes:
  - `DiagnosticPipError` → ERROR (with rich formatting)
  - `PreviousBuildDirError` → PREVIOUS_BUILD_DIR_ERROR  
  - `InstallationError/BadCommand/NetworkConnectionError` → ERROR
  - `CommandError` → ERROR
  - `BrokenStdoutLoggingError` → ERROR (with stderr fallback)
  - `KeyboardInterrupt` → ERROR
  - `BaseException` → UNKNOWN_ERROR

**Debug Mode Handling (L227-232):**
- Normal mode: Wraps `self.run` with exception interceptor
- Debug mode: Uses raw `self.run` with rich traceback formatting

## Dependencies

**Internal pip modules:**
- CLI components: cmdoptions, parser, status_codes, command_context
- Exception types: Multiple pip exception classes
- Utilities: filesystem, logging, misc, temp_dir, virtualenv

**External dependencies:**
- `pip._vendor.rich.traceback` for enhanced debug output
- Standard library: functools, logging, optparse, os, sys, traceback

## Architectural Patterns

- **Template Method:** `add_options()` hook for subclass customization
- **Context Manager:** Integration with context management for resource cleanup  
- **Decorator Pattern:** Exception handling wrapper
- **Factory Pattern:** ConfigOptionParser with custom formatter
- **Registry Pattern:** Temporary directory management

## Critical Invariants

- Commands must implement `run()` method
- Temp directory setup must occur before any temp file operations
- Exception handling ensures all errors map to appropriate exit codes
- Virtual environment validation enforced unless explicitly ignored
- Cache directory ownership verified before use