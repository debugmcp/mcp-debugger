# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_vendor/packaging/markers.py
@source-hash: 756292aa7e52a7e8
@generated: 2026-02-09T17:59:48Z

## Primary Purpose
Implements PEP 508 environment markers for Python package dependencies, providing evaluation of conditional expressions like `python_version >= '3.8'` or `sys_platform == 'win32'`. Core component of Python packaging infrastructure.

## Key Components

### Exception Classes (L30-47)
- `InvalidMarker` (L30): Raised for malformed marker syntax
- `UndefinedComparison` (L36): Raised for unsupported operations on values  
- `UndefinedEnvironmentName` (L42): Raised for unknown environment variable names

### Environment System (L49-257)
- `Environment` (L49): TypedDict defining all available environment variables (implementation_name, python_version, platform_system, etc.)
- `default_environment()` (L242): Factory function returning current Python environment as dict
- `format_full_version()` (L234): Formats sys._version_info into PEP 440 compliant version string

### Core Marker Class (L260-325)
- `Marker.__init__()` (L261): Parses marker string using `_parse_marker()`, stores as `_markers` attribute
- `Marker.evaluate()` (L301): Main evaluation method accepting optional environment override
- Standard object methods: `__str__`, `__repr__`, `__hash__`, `__eq__` for object protocol

### Evaluation Engine (L177-231)
- `_eval_op()` (L177): Evaluates single operation (lhs op rhs), handles version specifiers via Specifier class
- `_evaluate_markers()` (L204): Recursive evaluator for complex marker expressions with AND/OR logic
- `_operators` (L165): Maps operator strings to callable functions

### Utilities (L121-202)
- `_normalize_extra_values()` (L121): Canonicalizes 'extra' values per PEP 503
- `_format_marker()` (L137): Serializes parsed markers back to string representation
- `_normalize()` (L192): Applies PEP 685 normalization rules for extra names

## Dependencies
- Internal: `._parser` (MarkerAtom, MarkerList, parsing), `._tokenizer` (ParserSyntaxError), `.specifiers` (version handling), `.utils` (name canonicalization)
- Standard library: operator, os, platform, sys for environment introspection

## Architecture Notes
- Uses recursive data structure for complex expressions: `MarkerList = List[Union[Tuple[Node, ...], str, MarkerList]]`
- Supports both simple operations and nested logical expressions
- Environment evaluation merges default system environment with user overrides
- Backwards compatibility handling for legacy API (None extra values)

## Critical Invariants
- Marker strings must conform to PEP 508 syntax
- Environment keys must match predefined set in Environment TypedDict
- Extra names normalized using PEP 503/685 canonicalization rules
- Version comparisons delegate to Specifier class for PEP 440 compliance