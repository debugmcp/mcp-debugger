# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_vendor/requests/sessions.py
@source-hash: ca44c8f145864a5b
@generated: 2026-02-09T18:00:00Z

Core HTTP session management for the requests library, providing cookie persistence, connection pooling, and configuration management across multiple requests.

## Primary Components

**merge_setting (L61-88)**: Utility function that intelligently merges request-level settings with session-level defaults. Handles dictionary merging with None value removal and prioritizes request settings over session settings.

**merge_hooks (L91-103)**: Specialized merger for event hooks that handles empty response hook lists to prevent breaking session hooks entirely.

**SessionRedirectMixin (L106-354)**: Mixin class providing comprehensive HTTP redirect handling:
- `get_redirect_target` (L107-125): Extracts redirect URL from response headers, handling UTF-8 encoding issues in Location headers
- `should_strip_auth` (L127-157): Security logic determining when to remove Authorization headers during redirects (different hosts, schemes, ports)
- `resolve_redirects` (L159-280): Core redirect resolution generator that handles the full redirect chain with proper cookie/auth management, request method adjustments, and redirect limits
- `rebuild_auth` (L282-301): Manages authentication during redirects, stripping when necessary and reapplying from .netrc
- `rebuild_proxies` (L302-331): Recalculates proxy configuration for redirect targets, handling Proxy-Authorization headers
- `rebuild_method` (L333-353): Implements HTTP redirect method transformation rules (303→GET, 302→GET, 301 POST→GET)

**Session (L356-817)**: Main session class inheriting from SessionRedirectMixin. Manages persistent HTTP client state:
- `__attrs__` (L375-388): Defines serializable session attributes
- `__init__` (L390-450): Initializes default session configuration including headers, auth, proxies, hooks, SSL settings, and HTTP/HTTPS adapters
- `prepare_request` (L457-498): Transforms Request objects into PreparedRequest with merged session settings
- `request` (L500-591): Primary HTTP request method that creates, prepares, and sends requests
- HTTP method shortcuts: `get`, `options`, `head`, `post`, `put`, `patch`, `delete` (L593-671)
- `send` (L673-748): Core request dispatch method handling timing, hooks, redirects, and cookie management
- `merge_environment_settings` (L750-779): Integrates environment variables (CA bundles, proxy settings) with session config
- `get_adapter` (L781-792): URL-to-adapter resolution using longest prefix matching
- `close` (L794-797): Cleanup method closing all registered adapters
- `mount` (L799-808): Registers connection adapters for URL prefixes with proper ordering

**session() (L819-831)**: Deprecated factory function for backward compatibility.

## Key Dependencies

Imports essential components from requests ecosystem: adapters, auth, cookies, exceptions, hooks, models, and utilities. Uses platform-specific timing via `preferred_clock` (L55-58).

## Architectural Patterns

- **Mixin Design**: SessionRedirectMixin separates redirect logic for modularity
- **Adapter Pattern**: Pluggable connection adapters via mount/get_adapter system  
- **Context Manager**: Session supports with-statement usage
- **Setting Inheritance**: Consistent request/session setting merger pattern
- **Hook System**: Event-driven architecture for request/response manipulation

## Critical Behaviors

- Automatic redirect following with security-conscious auth stripping
- Cookie persistence across requests and redirects
- Environment variable integration for proxies and SSL certificates
- Connection pooling through adapter reuse
- Proper resource cleanup via close() method