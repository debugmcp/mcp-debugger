# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_vendor/distlib/locators.py
@source-hash: a35aff33cebf6d12
@generated: 2026-02-09T17:59:53Z

## Purpose
Package distribution locator system for distlib - provides various strategies to find, download, and resolve Python package distributions from different sources (PyPI, directories, JSON metadata, etc.).

## Key Classes and Functions

### Core Base Class
- **Locator (L89-408)**: Abstract base class for all locators with caching, URL preference logic, and distribution conversion utilities
  - `get_project()` (L174-189): Main entry point with caching layer
  - `_get_project()` (L156-166): Abstract method to be implemented by subclasses
  - `locate()` (L353-407): Find most recent distribution matching requirement with version constraints
  - `convert_url_to_download_info()` (L234-305): Parse URLs to extract package info (name, version, etc.)
  - `score_url()` (L191-204): Prioritize URLs (HTTPS > HTTP, PyPI > others, wheels > source)

### PyPI Locators
- **PyPIRPCLocator (L410-456)**: Uses XML-RPC to query PyPI directly
- **PyPIJSONLocator (L459-525)**: Uses PyPI's JSON API (limited functionality)
- **SimpleScrapingLocator (L586-833)**: Multi-threaded HTML scraper for PyPI simple index
  - `_fetch()` (L729-760): Worker thread method for parallel page fetching
  - `get_page()` (L762-819): HTTP page fetcher with caching and encoding handling

### Local Locators  
- **DirectoryLocator (L836-899)**: Scans local directory trees for distributions
- **JSONLocator (L902-938)**: Uses extended JSON metadata (not PyPI standard)
- **DistPathLocator (L941-966)**: Finds installed distributions in a DistributionPath

### Aggregation
- **AggregatingLocator (L969-1055)**: Chains multiple locators with merge/fallback strategies
- **default_locator (L1060-1064)**: Global instance using SimpleScrapingLocator with legacy versioning

### Dependency Resolution
- **DependencyFinder (L1069-1302)**: Resolves complete dependency trees
  - `find()` (L1195-1302): Main dependency resolution algorithm with conflict handling
  - `try_to_replace()` (L1155-1193): Handles version conflicts between providers

### Utility Classes
- **RedirectHandler (L57-86)**: HTTP redirect handler fixing Python 3.2.x bugs
- **Page (L528-583)**: HTML page parser extracting download links with rel attributes

## Key Dependencies
- `distlib.database`: Distribution and DistributionPath classes
- `distlib.metadata`: Metadata handling and validation  
- `distlib.version`: Version scheme and matching logic
- `distlib.wheel`: Wheel format parsing and compatibility checking
- `distlib.util`: Various utilities (ServerProxy, caching, parsing)

## Architectural Patterns
- **Template Method**: Locator base class defines algorithms, subclasses implement specifics
- **Strategy Pattern**: Different locator implementations for different sources
- **Chain of Responsibility**: AggregatingLocator tries multiple strategies
- **Producer-Consumer**: SimpleScrapingLocator uses threaded queue for parallel fetching
- **Caching**: Multiple levels (page cache, project cache, URL preference cache)

## Critical Constants
- `DEFAULT_INDEX` (L39): 'https://pypi.org/pypi' 
- File extensions for source (L93) and binary (L94) distributions
- Regex patterns for URL parsing (L36-38) and HTML scraping (L537-542)

## Threading and Concurrency
- Uses threading.RLock for thread-safe operations in SimpleScrapingLocator
- Queue-based work distribution for parallel HTTP fetching
- Separate locks for internal coordination vs external thread safety (L624)

## Error Handling
- Queue-based error collection system in base Locator class
- Graceful fallback between locators in aggregating mode
- Platform compatibility checking for wheel distributions