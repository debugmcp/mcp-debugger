# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_internal/locations/_sysconfig.py
@source-hash: 206cddb3ad2ab059
@generated: 2026-02-09T17:59:28Z

## Primary Purpose
This module provides Python installation scheme detection and path resolution using Python's `sysconfig` module, with special handling for platform-specific quirks like macOS framework builds and virtual environments.

## Key Functions and Architecture

### Scheme Inference Functions
- **`_should_use_osx_framework_prefix()` (L29-52)**: Detects Apple's special `osx_framework_library` scheme for Command Line Tools Python when installing to system prefix outside virtual environments
- **`_infer_prefix()` (L55-83)**: Platform-aware prefix scheme detection with fallback hierarchy: preferred API → OSX framework → implementation+OS → implementation → OS+prefix → OS → posix_prefix
- **`_infer_user()` (L86-98)**: User scheme detection with OSX framework awareness and UserInstallationInvalid exception for unavailable user schemes
- **`_infer_home()` (L101-108)**: Home scheme detection with OS-specific suffixes

### Main API Functions
- **`get_scheme()` (L124-199)**: Primary entry point returning a Scheme object with platform/virtual environment specific path resolution. Handles scheme conflicts, custom prefixes, and special virtual environment header paths
- **`get_bin_prefix()` (L202-206)**: Returns script installation directory with special handling for macOS system framework installs
- **`get_purelib()`/`get_platlib()` (L209-213)**: Simple accessors for pure Python and platform-specific library paths

## Key Dependencies
- `sysconfig`: Core Python module for installation paths
- `pip._internal.models.scheme.Scheme`: Data structure for installation paths
- `pip._internal.utils.virtualenv.running_under_virtualenv()`: Virtual environment detection
- `.base.{change_root, get_major_minor_version, is_osx_framework}`: Utility functions

## Critical Data Structures
- **`_AVAILABLE_SCHEMES` (L24)**: Set of available sysconfig scheme names
- **`_PREFERRED_SCHEME_API` (L26)**: Optional reference to Python 3.10+ `get_preferred_scheme`
- **`_HOME_KEYS` (L112-121)**: Configuration keys updated when using custom home directory

## Architectural Patterns
- **Platform abstraction**: Multiple inference functions handle cross-platform differences
- **Fallback hierarchy**: Systematic fallback from preferred to generic schemes
- **Special case handling**: Explicit logic for macOS frameworks, virtual environments, and custom prefixes
- **Compatibility layer**: Maintains distutils compatibility while using modern sysconfig

## Critical Invariants
- User and prefix schemes are mutually exclusive (L145-146, L147-148)
- OSX framework library scheme requires non-virtual environment + framework build
- Virtual environments get special header paths with site-packages structure (L177-183)
- Root parameter applies `change_root` transformation to all scheme paths (L194-198)