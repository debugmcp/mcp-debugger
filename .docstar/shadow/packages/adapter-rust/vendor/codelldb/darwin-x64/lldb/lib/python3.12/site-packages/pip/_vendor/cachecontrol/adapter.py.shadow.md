# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_vendor/cachecontrol/adapter.py
@source-hash: 7c1c8efcf77f10e7
@generated: 2026-02-09T17:59:42Z

## Primary Purpose
HTTP caching adapter that integrates with the requests library to provide HTTP response caching with cache control semantics. Acts as a middleware layer that intercepts HTTP requests/responses to implement caching strategies based on HTTP cache headers and heuristics.

## Key Classes and Functions

### CacheControlAdapter (L26-161)
Core caching adapter extending `requests.HTTPAdapter`. Implements intelligent HTTP caching with support for ETags, conditional requests, and cache invalidation.

**Key attributes:**
- `invalidating_methods` (L27): HTTP methods that invalidate cache entries (`PUT`, `PATCH`, `DELETE`)
- `cache`: Storage backend (defaults to `DictCache` if not provided)
- `controller`: `CacheController` instance managing cache logic
- `cacheable_methods`: HTTP methods eligible for caching (defaults to `GET` only)

**Core methods:**
- `__init__()` (L29-48): Initializes adapter with configurable cache backend, controller, serializer, and heuristics
- `send()` (L50-78): Intercepts outgoing requests to check cache and add conditional headers
- `build_response()` (L80-157): Processes responses for caching, handles 304 Not Modified responses, and manages cache invalidation
- `close()` (L159-161): Cleanup method that closes cache backend

## Key Dependencies
- `requests.HTTPAdapter`: Base adapter class being extended
- `CacheController`: Handles cache logic and HTTP semantics
- `CallbackFileWrapper`: Wraps response streams to trigger caching when consumed
- `DictCache`: Default in-memory cache implementation

## Architectural Patterns

### Caching Strategy
1. **Cache Lookup**: Checks for cached responses before sending requests (L67)
2. **Conditional Requests**: Adds ETag/Last-Modified headers for validation (L74)
3. **Response Processing**: Handles 304 responses by updating cached entries (L101-121)
4. **Stream Wrapping**: Uses `CallbackFileWrapper` to cache responses when streams are consumed (L128-133)
5. **Chunk Handling**: Special logic for chunked transfer encoding (L134-144)

### Cache Invalidation
- Invalidates cache entries for mutating HTTP methods (`PUT`, `PATCH`, `DELETE`) on successful responses (L149-152)
- Always caches permanent redirects (301, etc.) regardless of other factors (L122-124)

## Critical Implementation Details
- **Zlib Error Handling**: Gracefully handles corrupted cache entries by treating them as cache misses (L68-69)
- **304 Response Handling**: Properly manages connection cleanup for Not Modified responses (L117-118)
- **Dynamic Method Binding**: Uses `types.MethodType` to patch chunked response behavior (L142-143)
- **Response Attribute Extension**: Adds `from_cache` attribute to response objects (L155)

## Configuration Options
- Configurable cache backend via `cache` parameter
- ETag caching can be disabled via `cache_etags=False`
- Custom controller classes and serializers supported
- Heuristic-based caching for responses without explicit cache headers
- Method-level caching control via `cacheable_methods`