# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_internal/req/req_install.py
@source-hash: dbd2cb078a06e888
@generated: 2026-02-09T17:59:37Z

## Primary Purpose
Core class for representing pip package installation requirements, handling the entire lifecycle from requirement specification to installation. Manages metadata generation, source directory setup, build environment configuration, and actual installation of packages via wheels or legacy setup.py.

## Key Classes and Functions

### InstallRequirement (L64-862)
Central class representing a package requirement with full installation context:
- **Constructor (L71-198)**: Complex initialization handling requirement parsing, link resolution, editable installs, PEP 517 configuration, and build settings
- **Properties**:
  - `name` (L242-245): Package name from requirement spec
  - `specifier` (L260-262): Version constraints
  - `is_direct` (L265-267): Whether specified as direct URL
  - `is_pinned` (L270-277): Whether pinned to exact version
  - `is_wheel` (L465-468): Whether requirement is a wheel file
  - `supports_pyproject_editable` (L247-257): Cached check for PEP 660 support

- **Core Methods**:
  - `load_pyproject_toml()` (L503-529): Parses pyproject.toml and configures PEP 517 backend
  - `prepare_metadata()` (L552-595): Generates package metadata via PEP 517 or legacy setup.py
  - `check_if_exists()` (L426-461): Determines if compatible version already installed
  - `ensure_has_source_dir()` (L635-655): Sets up source directory for building
  - `install()` (L806-861): Main installation method handling both editable and wheel installs
  - `uninstall()` (L699-723): Removes existing installation

### Utility Functions
- `check_invalid_constraint_type()` (L864-889): Validates constraint requirements format
- `check_legacy_setup_py_options()` (L901-918): Handles deprecated build options with warnings

## Dependencies
- **External**: packaging library components (Requirement, Marker, SpecifierSet, etc.)
- **Internal pip modules**: build operations, metadata handling, installation operations, VCS backends
- **Build backends**: PEP 517 build backend integration via BuildBackendHookCaller

## Architecture Patterns
- **State machine**: Tracks installation lifecycle through properties like `prepared`, `install_succeeded`
- **Factory methods**: Different metadata generation paths for PEP 517 vs legacy
- **Caching**: Uses `@functools.cached_property` for expensive operations like PEP 660 support checks
- **Build environment isolation**: Manages temporary directories and build environments

## Critical Invariants
- Source directory must be set before metadata generation or installation
- PEP 517 backend required if `use_pep517=True` 
- Editable installs require either PEP 660 support or setup.py/setup.cfg presence
- Wheel installations require local file path to be set
- Constraint requirements cannot be editable or have extras

## Key Workflows
1. **Requirement creation** → **pyproject.toml loading** → **metadata preparation** → **installation**
2. **Build environment setup** → **source directory preparation** → **metadata generation** → **wheel building/installation**
3. **Existing installation check** → **uninstall if needed** → **fresh installation**