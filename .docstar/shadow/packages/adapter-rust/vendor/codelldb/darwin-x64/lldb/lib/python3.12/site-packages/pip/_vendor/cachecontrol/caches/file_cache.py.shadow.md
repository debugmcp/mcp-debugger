# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_vendor/cachecontrol/caches/file_cache.py
@source-hash: f4096699325ce9cb
@generated: 2026-02-09T17:57:32Z

## File Cache Implementation for HTTP Caching

File-based cache backend for pip's HTTP caching system, providing persistent storage with security features and memory-efficient variants.

### Core Components

**_secure_open_write() (L21-60)**: Security-focused file opening function that prevents symlink attacks using `O_NOFOLLOW` and ensures atomic writes with `O_CREAT | O_EXCL`. Handles cross-platform compatibility for Windows binary mode.

**_FileCacheMixin (L62-142)**: Base implementation shared by both cache variants:
- `__init__()` (L65-93): Configures directory, file permissions (default 0o0600), and requires filelock dependency
- `encode()` (L94-96): Static method using SHA224 hash for key encoding
- `_fn()` (L98-103): Generates file paths using first 5 hash chars as directory structure
- `get()` (L105-112): Retrieves cached data, returns None for missing files
- `set()` (L114-118): Stores data using secure write operations
- `_write()` (L120-134): Thread-safe writing with file locking and directory creation
- `_delete()` (L135-142): Conditional deletion respecting `forever` flag

**FileCache (L144-152)**: Traditional implementation extending BaseCache where response body is stored in memory. Suitable for small responses but not large downloads.

**SeparateBodyFileCache (L154-174)**: Memory-efficient variant extending SeparateBodyBaseCache:
- `get_body()` (L160-165): Returns file handle for streaming body content
- `set_body()` (L167-169): Stores body in separate `.body` file
- `delete()` (L171-173): Removes both metadata and body files

**url_to_file_path() (L176-182)**: Utility function converting URLs to cache file paths using CacheController's URL normalization.

### Architecture Patterns

- **Security-first design**: Prevents symlink attacks and race conditions
- **Cross-platform compatibility**: Handles OS-specific file flags
- **Thread safety**: Uses file locking for concurrent access
- **Memory optimization**: SeparateBodyFileCache reduces peak memory usage
- **Hierarchical storage**: Uses hash prefixes for directory organization

### Dependencies

- `filelock`: Required for thread-safe operations, checked at runtime
- `pip._vendor.cachecontrol.cache`: Base cache interfaces
- `pip._vendor.cachecontrol.controller`: URL processing utilities

### Critical Constraints

- File permissions default to restrictive 0o0600 (user read/write only)
- Hash-based file naming must remain stable (L99-100 warning)
- Requires filelock package installation for functionality
- Forever flag prevents deletion when enabled