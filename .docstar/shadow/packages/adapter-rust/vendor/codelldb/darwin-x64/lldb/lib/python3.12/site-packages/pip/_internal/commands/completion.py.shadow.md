# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_internal/commands/completion.py
@source-hash: 1d3e250f46e0b1f9
@generated: 2026-02-09T17:59:21Z

## Primary Purpose
Implements pip's shell completion command that generates tab-completion scripts for bash, zsh, fish, and PowerShell shells. This allows users to get autocomplete functionality for pip commands and options.

## Key Components

### Shell Completion Scripts (L14-72)
**COMPLETION_SCRIPTS** dictionary contains completion script templates for four shells:
- **bash** (L15-23): Uses `_pip_completion()` function with `COMPREPLY` array
- **zsh** (L24-38): Uses `__pip()` function with `compadd` and handles autoload vs eval contexts
- **fish** (L39-49): Uses `__fish_complete_pip` function with Fish's completion system
- **powershell** (L50-71): Implements `TabExpansion` function that backs up existing tab expansion

Each script sets environment variables (`COMP_WORDS`, `COMP_CWORD`, `PIP_AUTO_COMPLETE=1`) to communicate with pip's completion system.

### BASE_COMPLETION Template (L10-12)
Simple template that wraps generated scripts with shell-specific comment markers for easy identification.

### CompletionCommand Class (L75-130)
Inherits from `Command` and implements the completion subcommand:
- **ignore_require_venv** (L78): Allows running outside virtual environments
- **add_options()** (L80-114): Adds shell-specific flags (`--bash`, `--zsh`, `--fish`, `--powershell`)
- **run()** (L116-130): Main execution logic that validates shell choice and outputs formatted completion script

## Key Dependencies
- `pip._internal.cli.base_command.Command`: Base class for pip commands
- `pip._internal.utils.misc.get_prog()`: Gets the pip program name for script generation
- `textwrap.dedent()`: Cleans up indentation in completion scripts

## Architecture Patterns
- Template-based script generation using format strings
- Shell detection through command-line options
- Environment variable communication protocol between shell and pip for completion data

## Critical Behavior
All completion scripts rely on pip recognizing `PIP_AUTO_COMPLETE=1` environment variable to enter completion mode. The `{prog}` placeholder gets replaced with actual pip executable name via `get_prog()`.

## Error Handling
Returns SUCCESS (0) even when invalid shell specified, but writes error message to stderr (L127-129).