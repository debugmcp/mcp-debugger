# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_internal/distributions/sdist.py
@source-hash: 3e570fe1aebe47a7
@generated: 2026-02-09T17:59:28Z

## Purpose
Implements source distribution handling for pip's package installation system. Manages metadata generation, build isolation, and dependency resolution for packages distributed as source code that require building before installation.

## Core Components

### SourceDistribution Class (L16-158)
Primary class extending `AbstractDistribution` that orchestrates the build process for source packages:

**Key Properties:**
- `build_tracker_id` (L24-27): Returns URL identifier for tracking build operations
- `get_metadata_distribution()` (L29-30): Retrieves distribution metadata object

**Main Workflow Method:**
- `prepare_distribution_metadata()` (L32-69): Central orchestration method that:
  - Loads pyproject.toml to determine PEP 517 usage (L39)
  - Sets up build isolation when required (L42-56)
  - Validates build dependencies (L57-68)
  - Triggers metadata preparation (L69)

### Build Environment Management
**Build Backend Setup:**
- `_prepare_build_backend()` (L71-95): Creates isolated build environment and installs static build requirements
- `_install_build_reqs()` (L115-132): Installs dynamic build requirements after querying the backend

**Requirement Gathering:**
- `_get_build_requires_wheel()` (L97-103): Queries PEP 517 backend for wheel build dependencies
- `_get_build_requires_editable()` (L105-113): Queries backend for editable installation dependencies

### Error Handling
- `_raise_conflicts()` (L134-149): Formats and raises errors for conflicting build dependencies
- `_raise_missing_reqs()` (L151-158): Formats and raises errors for missing build dependencies

## Key Dependencies
- `BuildEnvironment`: Manages isolated build contexts
- `AbstractDistribution`: Base distribution interface
- `PackageFinder`: Locates and retrieves packages
- PEP 517 backend integration for modern Python packaging

## Architecture Patterns
- **Strategy Pattern**: Handles both PEP 517 and legacy setup.py workflows
- **Template Method**: `prepare_distribution_metadata()` defines build workflow skeleton
- **Dependency Injection**: Accepts `PackageFinder` for package resolution
- **Context Management**: Uses `with` statements for build environment isolation (L98, L106)

## Critical Invariants
- Build isolation is enforced when `use_pep517=True` and `build_isolation=True`
- Static requirements (pyproject.toml) must be installed before querying dynamic requirements
- Editable installations require additional validation for PEP 660 or setup.py/setup.cfg presence
- All build dependency conflicts must halt installation with descriptive errors

## Flow Control
1. Load pyproject.toml configuration
2. Create isolated build environment if needed
3. Install static build dependencies
4. Validate editable installation compatibility
5. Query and install dynamic build dependencies
6. Check for dependency conflicts
7. Generate package metadata