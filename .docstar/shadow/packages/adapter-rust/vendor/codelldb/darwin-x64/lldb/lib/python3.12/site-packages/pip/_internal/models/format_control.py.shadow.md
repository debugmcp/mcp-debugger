# packages/adapter-rust/vendor/codelldb/darwin-x64/lldb/lib/python3.12/site-packages/pip/_internal/models/format_control.py
@source-hash: c2db10a922bd1da5
@generated: 2026-02-09T17:59:26Z

## Purpose
Manages package installation format constraints (binary vs source) for pip, controlling whether packages should be installed from binary wheels or built from source.

## Key Components

### FormatControl Class (L8-78)
Core data structure that tracks format preferences for packages using two sets:
- `no_binary` (L23): Set of package names that must be built from source
- `only_binary` (L24): Set of package names that must use binary distributions

**Constructor** (L13-24): Initializes both sets, defaulting to empty sets if None provided.

**Equality Methods** (L26-36): 
- `__eq__` (L26-33): Compares instances by checking class type, slots, and attribute values
- `__repr__` (L35-36): String representation showing both sets

### Format Control Logic

**handle_mutual_excludes** (L38-59): Static method that parses comma-separated package specifications and updates target/other sets with mutual exclusion logic:
- Handles special tokens `:all:` (apply to all packages) and `:none:` (clear restrictions)
- Removes conflicting entries between no_binary and only_binary sets
- Canonicalizes package names using packaging utils
- Validates input format (rejects values starting with "-")

**get_allowed_formats** (L61-71): Determines allowed installation formats for a specific package:
- Returns frozenset containing "binary" and/or "source"
- Applies package-specific rules first, then global `:all:` rules
- Priority: specific package rules > global `:all:` rules

**disallow_binaries** (L73-78): Convenience method that applies `:all:` to no_binary set, forcing all packages to build from source.

## Dependencies
- `pip._vendor.packaging.utils.canonicalize_name`: Package name normalization
- `pip._internal.exceptions.CommandError`: Error handling for invalid inputs

## Architecture Notes
- Uses `__slots__` for memory efficiency
- Implements proper equality semantics for value objects
- Mutual exclusion logic ensures no_binary and only_binary sets don't overlap
- Special tokens (`:all:`, `:none:`) provide global control mechanisms