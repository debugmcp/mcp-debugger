# examples/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.48.0/tests/rt_handle_block_on.rs
@source-hash: 00bdd48af152700d
@generated: 2026-02-09T18:12:46Z

## Purpose
Test file for Tokio runtime's `Handle::block_on` functionality across different runtime configurations. Tests synchronous blocking operations within async contexts, runtime shutdown behavior, and various async primitives like channels, file I/O, networking, and timers.

## Key Components

### Test Macros (L16-93)
- `multi_threaded_rt_test!` (L17-47): Generates tests for multi-threaded runtimes with 1 and 4 worker threads
- `rt_test!` (L50-93): Generates tests for current thread, multi-threaded 1-worker, and multi-threaded 4-worker runtimes
- Each macro creates modules with `rt()` function to build appropriate runtime configurations

### Core Test Functions (L97-138)
- `basic()` (L97-103): Tests simple `Handle::current().block_on()` with async block
- `bounded_mpsc_channel()` (L105-115): Tests blocking on mpsc channel send/receive operations
- `unbounded_mpsc_channel()` (L117-127): Tests unbounded channel operations
- `yield_in_block_in_place()` (L129-138): Tests yielding within `tokio::task::block_in_place`

### Runtime-Specific Tests (L141-451)
Generated by `rt_test!` macro, includes:

**File System & Blocking Tasks:**
- `basic_fs()` (L145-154): Tests blocking file read operations
- `fs_shutdown_before_started()` (L156-170): Tests file operations after runtime shutdown
- `basic_spawn_blocking()` (L172-186): Tests `spawn_blocking` with sleep
- `spawn_blocking_after_shutdown_fails()` (L188-203): Tests spawn_blocking failure after shutdown
- `thread_park_ok()` (L223-239): Tests thread parking behavior

**Network Operations:**
- `tcp_listener_bind()` (L244-252): Tests TCP listener binding
- `udp_socket_bind()` (L295-303): Tests UDP socket binding
- Multiple ignored tests (L254-411) for post-shutdown network behavior

**Nesting & Lifecycle:**
- `nesting()` (L415-428): Tests panic when nesting runtimes (should panic)
- `spawn_after_runtime_dropped()` (L430-450): Tests spawning after runtime drop

### Multi-Threaded Only Tests (L454-512)
Generated by `multi_threaded_rt_test!` macro:
- Unix listener tests and timer operations requiring multi-threaded runtime
- Timer shutdown behavior tests with expected panics

### Utility Functions (L516-567)
- `new_multi_thread()` (L518-524): Creates multi-threaded runtime with n workers
- `new_current_thread()` (L527-532): Creates current-thread runtime
- `test_with_runtimes()` (L535-567): Runs tests across all runtime configurations

## Key Dependencies
- `tokio::runtime::{Handle, Runtime}` - Core runtime and handle types
- `tokio::sync::mpsc` - Multi-producer single-consumer channels
- `tokio::{net, time, fs}` - Network, timer, and filesystem operations (WASI-conditional)

## Architecture Patterns
- Macro-based test generation for runtime variations
- Conditional compilation for WASI/Unix platform differences
- Runtime shutdown testing with explicit timeouts
- Handle-based blocking operations within runtime context

## Critical Constraints
- Many I/O tests are `#[ignore]`d due to known shutdown bugs (L4-8, L254, L274, etc.)
- WASI platform limitations exclude threading and network tests
- Nesting runtime operations should panic with specific error message
- Timer operations only work on multi-threaded runtimes when using `Handle::block_on`