# examples/rust/async_example/.cargo/registry/src/index.crates.io-6f17d22bba15001f/pin-project-lite-0.2.16/tests/expand/pinned_drop/struct.expanded.rs
@source-hash: 9643f7d71b94675a
@generated: 2026-02-09T18:02:42Z

## Primary Purpose

This is an expanded test file generated by the `pin-project-lite` macro, demonstrating the complete code expansion for a `Struct` with pinned projection capabilities and custom drop implementation. It serves as a test fixture to verify macro expansion correctness.

## Key Components

### Original Struct (L2-5)
- `Struct<T, U>`: Generic struct with `pinned: T` and `unpinned: U` fields
- Template for pin-project macro expansion

### Generated Projection Types
- `Projection<'__pin, T, U>` (L30-36): Mutable projection with `pinned` field wrapped in `Pin<&mut T>` and `unpinned` as `&mut U`
- `ProjectionRef<'__pin, T, U>` (L50-56): Immutable projection with `pinned` field wrapped in `Pin<&T>` and `unpinned` as `&U`

### Core Implementation Methods (L57-84)
- `project()` (L60-70): Creates mutable projections using unsafe `get_unchecked_mut()` and `Pin::new_unchecked()`
- `project_ref()` (L73-83): Creates immutable projections using unsafe `get_ref()` and `Pin::new_unchecked()`

### Pin Safety Infrastructure
- `__Origin<'__pin, T, U>` (L86-90): Helper struct for `Unpin` analysis with `AlwaysUnpin<U>` wrapper
- `Unpin` implementation (L91-96): Conditional `Unpin` based on `PinnedFieldsOf<__Origin>`
- `__assert_not_repr_packed()` (L112-115): Compile-time assertion preventing `#[repr(packed)]` usage

### Custom Drop Implementation (L97-110)
- Implements `Drop` trait with pinned-aware dropping via `__drop_inner()`
- Creates pinned self-reference for safe cleanup
- Inner `__drop_inner()` function provides drop customization point

## Dependencies
- `pin_project_lite::pin_project`: Core macro (imported L1)
- `pin_project_lite::__private`: Internal utilities for `Pin`, `PhantomData`, `AlwaysUnpin`, etc.

## Architectural Patterns
- **Macro Expansion**: Complete procedural macro output showing all generated code
- **Unsafe Pin Projections**: Uses unsafe code with invariant preservation
- **Conditional Unpin**: Sophisticated `Unpin` implementation based on field analysis
- **Pinned Drop**: Custom drop implementation that respects pin semantics

## Critical Invariants
- Pin safety maintained through careful unsafe usage in projections
- `#[repr(packed)]` forbidden to prevent unaligned references
- Lifetime `'__pin` ensures projection validity
- Generated code hidden from documentation (`#[doc(hidden)]`)