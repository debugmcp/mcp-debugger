# examples/rust/async_example/.cargo/registry/src/index.crates.io-6f17d22bba15001f/pin-project-lite-0.2.16/tests/expand/naming/enum-ref.expanded.rs
@source-hash: fa708877f09333c4
@generated: 2026-02-09T18:03:22Z

## Purpose
Code generated by the `pin_project_lite` proc macro demonstrating reference projection for enums. This is a test/example file showing the macro expansion output for an enum with both pinned and unpinned fields.

## Key Components

### Original Enum (L2-5)
- `Enum<T, U>`: Generic enum with two variants
  - `Struct`: Contains `pinned: T` and `unpinned: U` fields
  - `Unit`: Empty variant

### Generated Projection Enum (L19-28)
- `EnumProjRef<'__pin, T, U>`: Reference projection type for `Enum`
  - Mirrors original enum structure but with projected field types
  - `pinned` field becomes `Pin<&'__pin (T)>` (L24)
  - `unpinned` field becomes `&'__pin (U)` (L25)

### Core Implementation (L38-58)
- `project_ref()` method (L41-57): Converts `Pin<&Self>` to `EnumProjRef`
  - Uses `unsafe` block to perform field projection
  - Pattern matches on enum variants and constructs projected equivalents
  - Uses `Pin::new_unchecked()` for pinned fields (L48-50)

### Unpin Implementation Support (L60-70)
- `__Origin<'__pin, T, U>` struct (L60-64): Phantom type for Unpin analysis
  - Contains phantom data and field type information
  - `Struct` field uses `AlwaysUnpin<U>` wrapper for unpinned field (L62)
- Conditional `Unpin` implementation (L65-70): Auto-implements `Unpin` when pinned fields are `Unpin`

### Drop Safety (L71-74)
- `MustNotImplDrop` trait: Ensures the original enum doesn't implement `Drop`
- Prevents unsound behavior by rejecting types with custom drop implementations

## Dependencies
- `pin_project_lite` crate for core pinning utilities
- Uses private APIs from `pin_project_lite::__private`

## Architectural Patterns
- **Proc Macro Expansion**: Shows typical structure of generated pin projection code
- **Safety Through Types**: Uses phantom types and trait bounds to ensure memory safety
- **Conditional Unpin**: Automatically implements `Unpin` when safe to do so
- **Drop Checking**: Compile-time validation against unsafe `Drop` implementations

## Key Invariants
- Pinned fields must maintain their memory location stability
- Reference projections preserve lifetime relationships
- Drop implementation is forbidden on the original type for safety