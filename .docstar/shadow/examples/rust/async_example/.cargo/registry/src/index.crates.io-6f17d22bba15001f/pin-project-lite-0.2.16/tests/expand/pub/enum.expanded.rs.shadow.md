# examples/rust/async_example/.cargo/registry/src/index.crates.io-6f17d22bba15001f/pin-project-lite-0.2.16/tests/expand/pub/enum.expanded.rs
@source-hash: c52cfaa064ffbf04
@generated: 2026-02-09T18:02:41Z

## Purpose
Macro-expanded code generated by `pin_project_lite` demonstrating safe pinning projection for a generic enum. This is a test expansion file showing how pin-project-lite transforms a user-defined enum into safe projection patterns.

## Key Structures

### Original Enum (L2-5)
- `Enum<T, U>`: Generic enum with two variants
  - `Struct { pinned: T, unpinned: U }`: Variant with both pinned and unpinned fields
  - `Unit`: Empty variant

### Generated Projection Types

#### EnumProj (L19-28)
- Mutable projection enum with lifetime `'__pin`
- `Struct` variant projects `pinned` field to `Pin<&'__pin mut T>`, leaves `unpinned` as `&'__pin mut U`
- Maintains original variant structure for safe field access

#### EnumProjRef (L42-51)
- Immutable projection enum with lifetime `'__pin`
- `Struct` variant projects `pinned` field to `Pin<&'__pin T>`, leaves `unpinned` as `&'__pin U`
- Read-only equivalent of EnumProj

## Key Methods

### project (L64-80)
- Takes `Pin<&'__pin mut Self>` and returns `EnumProj<'__pin, T, U>`
- Uses `unsafe` block with `get_unchecked_mut()` for performance
- Creates new `Pin` wrapper for pinned field using `Pin::new_unchecked`

### project_ref (L83-99)
- Takes `Pin<&'__pin Self>` and returns `EnumProjRef<'__pin, T, U>`
- Uses `unsafe` block with `get_ref()` for immutable access
- Creates new `Pin` wrapper for pinned field reference

## Pin Safety Infrastructure

### __Origin Struct (L102-106)
- Phantom type used for `Unpin` analysis
- Contains field representations: `(T, AlwaysUnpin<U>)` for Struct variant
- Enables compile-time verification of pinning requirements

### Unpin Implementation (L107-112)
- Conditional `Unpin` implementation based on `PinnedFieldsOf<__Origin>`
- Ensures enum is only `Unpin` when safe to move

### Drop Safety (L113-116)
- `MustNotImplDrop` trait prevents manual `Drop` implementation
- Ensures pin safety guarantees aren't violated by custom destructors

## Dependencies
- `pin_project_lite::__private`: Internal utilities for Pin operations
- Core pin machinery: `Pin`, `PhantomData`, `AlwaysUnpin`

## Architectural Patterns
- **Safe Projection**: Transforms pinned enum access into type-safe field projections
- **Phantom Types**: Uses `__Origin` for compile-time pin analysis without runtime cost
- **Unsafe Encapsulation**: Isolates unsafe operations within well-defined projection methods
- **Variant Mirroring**: Each projection enum mirrors original structure with appropriate Pin wrappers