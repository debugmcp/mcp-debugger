echo "🧪 Running tests before push to ensure code quality..."
echo "💡 This prevents broken code from being pushed to GitHub."
echo ""

# Clean build to ensure no stale artifacts
echo "🔨 Running clean build to ensure fresh compilation..."
npm run clean
npm run build

if [ $? -ne 0 ]; then
    echo ""
    echo "❌ Build failed! Push blocked to prevent broken code on GitHub."
    echo "💡 Fix build errors before pushing."
    exit 1
fi

echo "✅ Build successful!"
echo ""

# Run the full test suite
npm test

if [ $? -eq 0 ]; then
    echo ""
    echo "✅ All tests passed! Push will proceed."
    echo "🚀 Code quality maintained for GitHub repository."
else
    echo ""
    echo "❌ Tests failed! Push blocked to prevent broken code on GitHub."
    echo "💡 Fix failing tests or use 'git push --no-verify' for emergency pushes."
    echo "🔧 You can still make local commits for WIP - tests only run on push."
    exit 1
fi
