echo "ğŸ§ª Running tests before push to ensure code quality..."
echo "ğŸ’¡ This prevents broken code from being pushed to GitHub."
echo ""

# Run linting first to catch syntax and style issues
echo "ğŸ” Running ESLint to catch linting issues..."
pnpm run lint

if [ $? -ne 0 ]; then
    echo ""
    echo "âŒ Lint failed! Push blocked to prevent broken code on GitHub."
    echo "ğŸ’¡ Run 'pnpm run lint' to see all errors, or 'pnpm run lint:fix' for auto-fixes."
    exit 1
fi

echo "âœ… Lint passed!"
echo ""

# Clean build to ensure no stale artifacts
echo "ğŸ”¨ Running clean build to ensure fresh compilation..."
npm run clean
npm run build

if [ $? -ne 0 ]; then
    echo ""
    echo "âŒ Build failed! Push blocked to prevent broken code on GitHub."
    echo "ğŸ’¡ Fix build errors before pushing."
    exit 1
fi

echo "âœ… Build successful!"
echo ""

# Run the full test suite
npm test

if [ $? -eq 0 ]; then
    echo ""
    echo "âœ… All tests passed! Push will proceed."
    echo "ğŸš€ Code quality maintained for GitHub repository."
else
    echo ""
    echo "âŒ Tests failed! Push blocked to prevent broken code on GitHub."
    echo "ğŸ’¡ Fix failing tests or use 'git push --no-verify' for emergency pushes."
    echo "ğŸ”§ You can still make local commits for WIP - tests only run on push."
    exit 1
fi
